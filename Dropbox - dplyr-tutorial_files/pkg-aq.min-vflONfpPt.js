(function(){define("modules/clean/expose/panel",["external/classnames","external/react","modules/clean/expose/services","modules/clean/flux/store_mixin","modules/clean/react/css"],function(e,t,i,n,s){var r,o,a;return r=i.ExposeActions,a=i.ExposeStore,o=t.createClass({displayName:"ExposePanel",mixins:[t.addons.PureRenderMixin,n(a)],_get_state_from_stores:function(){return{isEnabled:a.shouldDisplayAnnotations(),isVisible:a.shouldDisplayPanel()}},_toggleAnnotationsHandler:function(){return this.state.isEnabled?r.disableAnnotations():r.enableAnnotations()},render:function(){var i;return i={"expose-panel":!0,"expose-panel--enabled":this.state.isEnabled},this.state.isVisible?t.createElement("div",{className:e(i)},t.createElement("button",{className:"expose-panel__toggle",onClick:this._toggleAnnotationsHandler},"Enable experiment annotations")):null}}),o=s(o,["/static/css/expose/panel-vflNzNuGL.css"])})}).call(this),function(){var e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e},t={}.hasOwnProperty;define("modules/clean/expose/services",["external/immutable","modules/clean/ajax","modules/clean/flux/base_store","modules/clean/flux/dispatcher","modules/core/browser"],function(t,i,n,s,r){var o,a,l,c,u,p,d,_,h;return p=i.WebRequest,c=t.Map,o={UPDATE_ANNOTATIONS:"EXPOSE_UPDATE_ANNOTATIONS",UPDATE_BOUNDARIES:"EXPOSE_UPDATE_BOUNDARIES",SHOW_ANNOTATIONS:"EXPOSE_SHOW_ANNOTATIONS",HIDE_ANNOTATIONS:"EXPOSE_HIDE_ANNOTATIONS",ENSURE_PANEL:"EXPOSE_ENSURE_PANEL",ENSURE_NO_PANEL:"ENSURE_NO_PANEL"},h=function(e,t){var i,n,s,o,a,l;return i=decodeURIComponent(r.get_href()),a=new RegExp("[\\?&]stormcrow_override="+e+"([^&#]*)"),l=a.exec(i),l?(n=l[0],s=i.replace(n,n.replace(/:.*/,":"+t))):(o=i.split("?")[1]?"&":"?",s=""+i+o+"stormcrow_override="+e+":"+t),r.redirect(s)},_=function(e){return p({url:"/admin/stormcrow/features/name/"+e,type:"GET",dataType:"json"})},u=function(){function e(e,t){this._thunk=e,this._fps=t,this._cleanup_func=function(){},this._is_running=!1}return e.prototype.start=function(){var e,t,i,n,s,r;return this._is_running=!0,r=this._thunk,e=this._fps,s=-1,n=-1,t=1e3/e,i=function(e,s){var r,o;return null==s&&(s=0),o=Date.now(),r=o-s,r>t&&(e(),s=o-r%t),n=requestAnimationFrame(function(){return i(e,s)})},s=requestAnimationFrame(function(){return i(r)}),this._cleanup_func=function(){return cancelAnimationFrame(s),cancelAnimationFrame(n)}},e.prototype.stop=function(){return this._is_running=!1,this._cleanup_func()},e.prototype.isRunning=function(){return this._is_running},e}(),d=function(e){var t,i;return(t=document.querySelector("[data-exp-id='"+e+"']"))?(i=t.getBoundingClientRect(),{left:i.left+window.scrollX,top:i.top+window.scrollY,width:i.right-i.left,height:i.bottom-i.top}):void 0},a=function(){function e(){}return e.prototype.updateAnnotations=function(e){var t;return t=Object.keys(e).length,t?(s.dispatch({type:o.UPDATE_ANNOTATIONS,data:e}),s.dispatch({type:o.ENSURE_PANEL})):s.dispatch({type:o.ENSURE_NO_PANEL})},e.prototype.updateBoundaries=function(e){var t,i,n,r,a;for(i={},n=0,a=e.length;a>n;n++)r=e[n],t=d(r),t?i[r]=t:delete i[r];return s.dispatch({type:o.UPDATE_BOUNDARIES,data:i})},e.prototype.enableAnnotations=function(){return s.dispatch({type:o.SHOW_ANNOTATIONS})},e.prototype.disableAnnotations=function(){return s.dispatch({type:o.HIDE_ANNOTATIONS})},e}(),l=function(i){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,i),n.prototype._init=function(){return this._featureIdMap=c(),this._boundaryIdMap=c(),this._shouldDisplayAnnotations=!1,this._shouldDisplayPanel=!1},n.prototype._setFeatureIdMap=function(e){return this._featureIdMap=c(e).map(function(e){return c(e)}),this.emit_change()},n.prototype._updateBoundaryIdMap=function(e){var i;return i=this._boundaryIdMap,this._boundaryIdMap=c(e).map(function(e,n){var s,r;return r=i.get(n),s=c(e),t.is(r,s)?r:s}),t.is(i,this._boundaryIdMap)?void 0:this.emit_change()},n.prototype._showAnnotations=function(){return this._shouldDisplayAnnotations=!0,this.emit_change()},n.prototype._hideAnnotations=function(){return this._shouldDisplayAnnotations=!1,this.emit_change()},n.prototype._ensurePanel=function(){return this._shouldDisplayPanel=!0},n.prototype._ensureNoPanel=function(){return this._shouldDisplayPanel=!0},n.prototype.getFeatureIdMap=function(){return this._featureIdMap},n.prototype.getBoundaryIdMap=function(){return this._boundaryIdMap},n.prototype.shouldDisplayAnnotations=function(){return this._shouldDisplayAnnotations},n.prototype.shouldDisplayPanel=function(){return this._shouldDisplayPanel},n.prototype._new_payload=function(e){var t;switch(t=e.action.data,e.action.type){case o.UPDATE_ANNOTATIONS:return this._setFeatureIdMap(t);case o.UPDATE_BOUNDARIES:return this._updateBoundaryIdMap(t);case o.SHOW_ANNOTATIONS:return this._showAnnotations();case o.HIDE_ANNOTATIONS:return this._hideAnnotations();case o.ENSURE_PANEL:return this._ensurePanel();case o.ENSURE_NO_PANEL:return this._ensureNoPanel()}},n}(n),{ExposeActions:new a,ExposeStore:new l,getStormcrowVariantsForFeature:_,RenderAtFps:u,setStormcrowUrlOverride:h}})}.call(this),function(){define("modules/clean/react/accessibility_audit_tool",["jquery","external/react","modules/clean/accessibility/audit","modules/clean/react/bubble_dropdown","modules/clean/react/flag","modules/clean/react/sprite","modules/clean/react/tabs/tab_util","modules/clean/react/tabs/tabs"],function(e,t,i,n,s,r,o,a){var l,c,u,p,d,_,h,m;return d=a.Tabs,p=a.TabContent,m=t.DOM,_=t.createElement,h=t.addons.classSet,u=t.PropTypes,l=t.createClass({displayName:"AxAuditTool",getInitialState:function(){return{results:null,filter:"all",onlyVisible:!0,ignoreDropboxCommon:!0}},componentWillMount:function(){return this.runAudit()},runAudit:function(){var e;return e=i.runAudit({includeHeadings:!0,ignoreDropboxCommon:this.state.ignoreDropboxCommon,ignoreSelectors:".ax-audit__dialog",onlyVisible:this.state.onlyVisible}),this.setState({results:e})},toggleVisible:function(){return this.setState({onlyVisible:!this.state.onlyVisible})},toggleDropbox:function(){return this.setState({ignoreDropboxCommon:!this.state.ignoreDropboxCommon})},changeFilter:function(e){return this.setState({filter:e.target.value})},renderButton:function(){var e,i,n,s,r,o;return e=null!=(r=this.state.results.fail)?r.length:void 0,e>0&&(s="ax-audit__button--fail",i=e>1?e+" types of accessibility error found":e+" type of accessibility error found",n=t.createElement("span",{className:"ax-audit__error-decorator"},t.createElement("span",{"aria-hidden":"true"},"(",e,")"),t.createElement("span",{className:"ax-visually-hidden"},i)),o=null!=i?i:"Accessibility Status"),t.createElement("button",{className:"ax-audit__button u-pad-xxs "+s,title:o},t.createElement("span",{className:"ax-visually-hidden"},"Accessibility Status"),t.createElement("span",{"aria-hidden":"true"},"AX"),n)},renderFail:function(){return this.state.results.fail&&"pass"!==this.state.filter?this.state.results.fail.map(function(e){return function(e,i){return t.createElement(c,{status:"fail",result:e,key:e.code})}}(this)):void 0},renderPass:function(){return this.state.results.pass&&"fail"!==this.state.filter?this.state.results.pass.map(function(e){return function(e,i){return t.createElement(c,{status:"pass",result:e,key:e.code})}}(this)):void 0},renderSkip:function(){return this.state.results.skip&&"all"===this.state.filter?this.state.results.skip.map(function(e){return function(e,i){return t.createElement(c,{status:"skip",result:e,key:e.code})}}(this)):void 0},renderResults:function(){var e;return this.state.results?e=t.createElement(d,{variant:o.variants.UNDERLINE},this.renderAuditTab(),this.renderHeadingsTab(),this.renderConfigurationTab()):void 0},renderAuditTab:function(){return t.createElement(p,{title:"Results"},t.createElement("div",null,t.createElement("label",{htmlFor:"ax-audit__filter",className:"ax-audit__filter-label"},"Filter Results"),t.createElement("select",{id:"ax-audit__filter",onChange:this.changeFilter},t.createElement("option",{value:"all"},"All"),t.createElement("option",{value:"fail"},"Failing"),t.createElement("option",{value:"pass"},"Passing")),t.createElement("p",null,"Click 'Show Errors' next to a rule to see a red outline around visible failing elements.\nCheck the Javascript console for a full list of elements that fail a given accessibility check."),t.createElement("ul",{className:"ax-audit__list",ref:"auditList"},this.renderFail(),this.renderPass(),this.renderSkip())))},renderHeadingsTab:function(){var e;return e=0===this.state.results.headings.length?t.createElement("p",null,"No headings were detected on this page! Yikes!"):t.createElement("div",null,t.createElement("p",null,"Does the following heading order detected for this page reflect the visual hierarchy?"),t.createElement("ul",{className:"ax-audit__heading-list"},this.state.results.headings.map(function(e){return function(e,i){return t.createElement("li",{className:"ax-audit__heading-item",key:"heading"+i},t.createElement("b",null,e.level,":")," ",e.element.textContent)}}(this)))),t.createElement(p,{title:"Headings"},e,t.createElement("p",null,"Every page should have a logical heading order. Not only is this semantic HTML, but it\nhelps screenreader users navigate. Always prefer using H1 - H6 elements over\nother HTML elements styled to look like headings."))},renderConfigurationTab:function(){var e,i;return i=t.createElement("input",{type:"checkbox",onChange:this.toggleVisible,checked:this.state.onlyVisible,id:"ax-audit__visibleToggle"}),e=t.createElement("input",{type:"checkbox",onChange:this.toggleDropbox,checked:this.state.ignoreDropboxCommon,id:"ax-audit__dropboxToggle","aria-describedby":"ax-audit__dropboxToggleDescription"}),t.createElement(p,{title:"Settings"},t.createElement("fieldset",{className:"ax-audit__configuration"},t.createElement("legend",null,"Configure accessibility checks"),t.createElement(s,{alignment:"top",spacing:"xs",leftAttachment:i},t.createElement("label",{htmlFor:"ax-audit__visibleToggle"},"Ignore hidden elements")),t.createElement(s,{alignment:"top",spacing:"xs",leftAttachment:e},t.createElement("div",null,t.createElement("label",{htmlFor:"ax-audit__dropboxToggle"},"Ignore wide-reaching issues"),t.createElement("div",{id:"ax-audit__dropboxToggleDescription"},"(These are issues that tend to affect multiple areas of the product and cannot easily be\n addressed with a single bug fix, such as the low contrast of the default blue link color.)")))),t.createElement("p",null,"In addition to these automated checks, make sure to manually verify\nthat you can activate every clickable element with just your keyboard."))},render:function(){return t.createElement(n,{arrow_position:"bottom-right",targetButton:this.renderButton(),shouldDisableBubbleDropdownHideOnResize:!1,closeBubbleDropdownOnWindowScroll:!1,bubbleDropdownScrollable:!0,targetFixed:!0,bubbleDropdownShown:this.runAudit},t.createElement("div",{className:"ax-audit__dialog"},t.createElement("h2",null,"Accessibility Status"),t.createElement("p",null,"Check the accessibility of the current page with our automated accessibility tool."),t.createElement("button",{className:"ax-audit__run-button button-tertiary",onClick:this.runAudit},"Re-run accessibility checks"),this.renderResults(),t.createElement("small",{className:"ax-audit__footer"},"Questions? ",t.createElement("a",{href:"https://paper.dropbox.com/folder/show/Accessibility-e.gGYOBAB7ymbRGcAAHhsdFkIjzFZIcLSmyfjrQezgoLOgnD",target:"_blank"},"Read our docs")," or contact ",t.createElement("b",null,"ask-accessibility@"),".")))}}),c=t.createClass({displayName:"AxAuditToolRow",propTypes:function(){return{status:t.PropTypes.string.required,result:t.PropTypes.object.required}},getInitialState:function(){return{errorsShown:!1}},componentWillReceiveProps:function(e){return this.state.errorsShown&&this.props.result.elements!==e.result.elements?(this.toggleVisualHighlight(this.props.result.elements,!1),this.toggleVisualHighlight(e.result.elements,!0)):void 0},componentWillUnmount:function(){return this.state.errorsShown?this.toggleVisualHighlight(this.props.result.elements,!1):void 0},toggleVisualHighlight:function(e,t){var i,n,s,r;if(null!=e){for(r=[],n=0,s=e.length;s>n;n++)i=e[n],t?(i.setAttribute("ax-audit__old-outline",i.style.outline),i.style.outline="3px solid red",r.push(i.setAttribute("ax-audit__error",this.props.result.code))):(i.style.outline=i.getAttribute("ax-audit__old-outline"),i.removeAttribute("ax-audit__old-outline"),r.push(i.removeAttribute("ax-audit__error")));return r}},toggleErrors:function(){var e;return e=!this.state.errorsShown,this.toggleVisualHighlight(this.props.result.elements,e),e&&console.warn("[Accessibility] These elements fail "+this.props.result.code+" ("+this.props.result.description+"):",this.props.result.elements),this.setState({errorsShown:e})},render:function(){var e,i,n,o,a,l,c,u;switch(a=this.props.result,this.props.status){case"pass":e="pass",l="bulletpoint-check",c="Passing";break;case"fail":e="fail",l="bulletpoint-x",c="Failing",a.elements.length&&(i="("+a.elements.length+")",u=t.createElement("button",{className:"ax-audit__item__toggle button-as-link",onClick:this.toggleErrors,"aria-describedby":"ax-audit-"+a.code},this.state.errorsShown?"Hide Errors":"Show Errors"));break;default:e="na",l="info",c="Skipped"}return n=t.createElement(r,{group:"web",name:l,alt:c,title:c}),a.link&&(o=t.createElement("a",{href:a.link.url,target:"_blank"},a.link.text)),t.createElement("li",{className:"ax-audit__item ax-audit__item--"+e},t.createElement(s,{alignment:"top",spacing:"xs",leftAttachment:n},t.createElement("div",null,t.createElement("h3",{id:"ax-audit-"+a.code,className:"ax-audit__item__heading"},a.code," ",i),u,t.createElement("p",null,a.description," ",o))))}}),{AxAuditTool:l}})}.call(this),function(){define("modules/clean/sharing/actions/share_modal",["external/rsvp","modules/clean/flux/dispatcher","modules/clean/react/modal","modules/clean/sharing/action_types","modules/clean/sharing/stores/sharing_info","modules/core/i18n","modules/core/notify"],function(e,t,i,n,s,r,o){var a,l,c,u;return a=i.Modal,l=n.ShareModalActionTypes,u=r.i18n_default_project("sharing")._,c=function(){function i(e,t,i){this._sharingKey=e,this._client=t,this._user=i}return i.prototype.getSharingInfo=function(){return s.getSharingInfo(this._sharingKey)},i.prototype._getContentInfo=function(){return this.getSharingInfo().contentInfo()},i.prototype.initializeShareModal=function(t){var i,n;return this._dispatch(l.SHARE_MODAL_OPEN,{contentInfo:t}),n=this.getSharingInfo(),i=[],n.isTeamPolicyLoaded()||i.push(this._fetchTeamPolicy()),e.all(i)},i.prototype.fetchMetadata=function(){},i.prototype._fetchTeamPolicy=function(){return this._client.getCurrentAccountCached().then(function(e){return function(t){var i;return e._dispatch(l.FETCH_TEAM_POLICY_SUCCESS,{teamPolicy:null!=(i=t.team)?i.sharing_policies:void 0})}}(this))},i.prototype.fetchLinkMetadata=function(e){return this._dispatch(l.FETCH_LINK_METADATA_REQUEST),this._client.sharedLinkInfo({fileIdOrPath:e.idForLink()}).then(function(e){return function(t){return e._dispatch(l.FETCH_LINK_METADATA_SUCCESS,{metadata:t})}}(this))},i.prototype.updateMembers=function(e){return this._dispatch(l.FETCH_USER_ACCOUNTS_REQUEST),this._client.listMembers({contentId:e}).then(function(e){return function(t){return e._dispatch(l.FETCH_USER_ACCOUNTS_SUCCESS,{members:t})}}(this))},i.prototype.setMembers=function(e){return this._dispatch(l.FETCH_USER_ACCOUNTS_SUCCESS,{members:e})},i.prototype.createLink=function(){return this._dispatch(l.CREATE_LINK_REQUEST),this._client.createSharedLink({fileIdOrPath:this._getContentInfo().idForLink()}).then(function(e){return this._dispatch(l.CREATE_LINK_SUCCESS,{linkInfo:e})}).catch(function(){return this._dispatch(l.CREATE_LINK_FAILURE)})},i.prototype.changeRecipientMessage=function(e){return this._dispatch(l.CHANGE_RECIPIENT_MESSAGE,{message:e})},i.prototype.changeMemberAccess=function(e,t,i){var n;return n=t.access_type,this._dispatch(l.CHANGE_MEMBER_ACCESS_REQUEST,{member:t,newAccess:i}),this._client.updateMember({contentId:e,memberId:t.memberId(),accessLevel:i}).catch(function(e){return function(){return e._dispatch(l.CHANGE_MEMBER_ACCESS_FAILURE,{member:t,prevAccess:n})}}(this))},i.prototype.removeMember=function(e,t,i){return this._dispatch(l.REMOVE_MEMBER_REQUEST,{member:t}),this._client.removeMember({contentId:e,memberId:t.memberId(),leaveACopy:i}).then(function(e){return function(){return o.success(u("Removed %(name)s").format({name:t.displayName()})),e._dispatch(l.REMOVE_MEMBER_SUCCESS,{member:t})}}(this)).catch(function(e){return function(){return e._dispatch(l.REMOVE_MEMBER_FAILURE,{member:t})}}(this))},i.prototype.canRelinquishMembership=function(){return this._dispatch(l.CAN_RELINQUISH_MEMBERSHIP)},i.prototype.closeModal=function(){return a.close()},i.prototype._dispatch=function(e,i){return null==i&&(i={}),t.dispatch({type:e,sharingKey:this._sharingKey,content:i})},i}()})}.call(this),function(){var e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e},t={}.hasOwnProperty;define("modules/clean/sharing/stores/sharing_info",["external/immutable","modules/clean/flux/base_store","modules/clean/sharing/action_types","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants"],function(t,i,n,s,r,o){var a,l,c,u,p,d,_,h,m,f;return d=n.ShareModalActionTypes,p=s.ShareApiClient,l=s.FileShareApiClient,c=s.FolderShareApiClient,u=r.PermissionSetting,f=r.makeMemberKey,a=o.ACCESS_LEVEL,h=function(i){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,i),n.prototype._init=function(){return this.state=new t.Map},n.prototype.getSharingInfo=function(e){return this.state.get(e)},n.prototype._new_payload=function(e){var t,i;return i=null!=e&&null!=(t=e.action)?t.sharingKey:void 0,this.state.has(i)||(this.state=this.state.set(i,new _)),this.state.get(i)._new_payload(e.action.type,e.action.content)?this.emit_change():void 0},n}(i),_=function(){function e(){}return e.prototype._clear=function(){return this._metadata=null,this._linkMetadata=null,this._members=null,this._teamPolicy=null,this._modalInfo=null},e.prototype._new_payload=function(e,t){var i;switch(e){case d.SHARE_MODAL_OPEN:this._clear(),this._modalInfo=new m(t.contentInfo);break;case d.FETCH_METADATA_REQUEST:this._modalInfo._isMetadataLoaded=!1;break;case d.FETCH_METADATA_SUCCESS:this._modalInfo._isMetadataLoaded=!0,this._metadata=t.metadata;break;case d.FETCH_LINK_METADATA_REQUEST:this._modalInfo._isLinkMetadataLoaded=!1;break;case d.FETCH_LINK_METADATA_SUCCESS:this._modalInfo._isLinkMetadataLoaded=!0,this._linkMetadata=t.metadata;break;case d.FETCH_USER_ACCOUNTS_REQUEST:this._modalInfo._areMembersLoaded=!1;break;case d.FETCH_USER_ACCOUNTS_SUCCESS:this._modalInfo._areMembersLoaded=!0,this._members=t.members;break;case d.FETCH_TEAM_POLICY_REQUEST:this._modalInfo._isTeamPolicyLoaded=!1;break;case d.FETCH_TEAM_POLICY_SUCCESS:this._modalInfo._isTeamPolicyLoaded=!0,this._teamPolicy=t.teamPolicy;break;case d.REMOVE_MEMBER_REQUEST:this._modalInfo._pendingRemoval=this._modalInfo._pendingRemoval.add(t.member.memberKey());break;case d.REMOVE_MEMBER_SUCCESS:i=t.member,this._members=this._members.deleteIn([i.type(),i.memberKey()]),this._modalInfo._pendingRemoval=this._modalInfo._pendingRemoval.delete(i.memberKey());break;case d.REMOVE_MEMBER_FAILURE:this._modalInfo._pendingRemoval=this._modalInfo._pendingRemoval.delete(t.member.memberKey());break;case d.CHANGE_MEMBER_ACCESS_REQUEST:i=t.member,this._members=this._members.setIn([i.type(),i.memberKey(),"access_type"],t.newAccess);break;case d.CHANGE_MEMBER_ACCESS_FAILURE:i=t.member,this._members=this._members.setIn([i.type(),i.memberKey(),"access_type"],t.prevAccess);break;case d.CHANGE_RECIPIENT_MESSAGE:this._modalInfo._message=t.message;break;case d.CHANGE_RECIPIENT_ACCESS:this._modalInfo._recipientAccess=t.newAccess;break;case d.SEND_SHARE_START:this._modalInfo._isSending=!0;break;case d.SEND_SHARE_SUCCESS:this._modalInfo._isSending=!1;break;case d.SEND_SHARE_FAILURE:this._modalInfo._isSending=!1;break;case d.CAN_RELINQUISH_MEMBERSHIP:this._modalInfo._canRelinquishMembership=!0;break;default:return!1}return!0},e.prototype.areMembersLoaded=function(){return this._modalInfo._areMembersLoaded},e.prototype.canRelinquishMembership=function(){return this._modalInfo._canRelinquishMembership},e.prototype.contentInfo=function(){return this._modalInfo._contentInfo},e.prototype.isFolder=function(){return this._modalInfo._contentInfo.isFolder()},e.prototype.isLinkMetadataLoaded=function(){return this._modalInfo._isLinkMetadataLoaded},e.prototype.isMetadataLoaded=function(){return this._modalInfo._isMetadataLoaded},e.prototype.isTeamPolicyLoaded=function(){return this._modalInfo._isTeamPolicyLoaded},e.prototype.isSending=function(){return this._modalInfo._isSending},e.prototype.linkMetadata=function(){return this._linkMetadata},e.prototype.members=function(){return this._members},e.prototype.message=function(){return this._modalInfo._message},e.prototype.metadata=function(){return this._metadata},e.prototype.pendingRemoval=function(){return this._modalInfo._pendingRemoval},e.prototype.recipientAccess=function(){return this._modalInfo._recipientAccess},e.prototype.teamPolicy=function(){return this._teamPolicy},e}(),m=function(){function e(e){this._areMembersLoaded=!1,this._isLinkMetadataLoaded=!1,this._isMetadataLoaded=!1,this._isTeamPolicyLoaded=!1,this._contentInfo=e,this._canRelinquishMembership=!1,this._message="",this._recipientAccess=this._contentInfo.isFolder()?a.WRITER:a.READER,this._isSending=!1,this._pendingRemoval=new t.Set}return e}(),new h})}.call(this),function(){define("modules/dirty/react/file_viewer/container",["external/react","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/file_viewer","modules/dirty/react/file_viewer/share_helpers"],function(e,t,i,n){var s;return s=e.createClass({displayName:"FileViewerContainer",propTypes:{files:e.PropTypes.array.isRequired,currentIndex:e.PropTypes.number.isRequired,user:e.PropTypes.object,fileViewerProps:e.PropTypes.object.isRequired,shareToken:e.PropTypes.object,sharePermissions:e.PropTypes.object},componentWillMount:function(){return t.setup(this.props.files,this.props.currentIndex,this.props.user,{shareToken:this.props.shareToken,sharePermissions:this.props.sharePermissions,disableFlipping:!1})},componentWillUnmount:function(){return t.cleanup()},render:function(){var t;return t=this.props.fileViewerProps,t.shareHelpers=n,e.createElement(i,t)}})})}.call(this),function(){define("modules/dirty/revisions/file_revisions_ui",["dropbox","jquery","external/react","external/underscore","modules/clean/analytics","modules/clean/filepath","modules/clean/react/form_handlers_mixin","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/react/tooltip","modules/constants/python","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/browse_interface","modules/clean/react/react_i18n","modules/clean/teams/team_promo_banner","modules/clean/viewer","modules/clean/revisions/file_revisions_iterator","modules/core/browser"],function(e,t,i,n,s,r,o,a,l,c,u,p,d,_,h,m,f,E,y,v,b){var g,S,A,T,N,I,R,C,w,P,x,M,k,O,L,U,D;return N=e.FileViewer,I=e.Forms,k=s.TeamsWebActionsLogger,R=a.Modal,w=u.REVISION_REASON,C=u.OREF_CONSTANTS,O=d._,D=d.ungettext,L=i.createElement,U=i.DOM,P=f.R_,x=i.addons.CSSTransitionGroup,M=i.createFactory(l),S=i.createClass({displayName:"FileRevisionItemClass",propTypes:{revision:i.PropTypes.shape({id:i.PropTypes.number.isRequired,ns_id:i.PropTypes.number.isRequired,ns_path:i.PropTypes.string.isRequired,date:i.PropTypes.string.isRequired,time:i.PropTypes.string.isRequired,author:i.PropTypes.string,revision_reason:i.PropTypes.number,is_primary_revision:i.PropTypes.bool,host_id:i.PropTypes.number,host_name:i.PropTypes.string,device_name:i.PropTypes.string,size_str:i.PropTypes.string,filename:i.PropTypes.string}),userId:i.PropTypes.number,latestNsId:i.PropTypes.number,latestNsPath:i.PropTypes.string,isLatest:i.PropTypes.bool,filePreviews:i.PropTypes.array.isRequired},onRestore:function(e,t,i,n,s){return e.stopPropagation(),e.preventDefault(),R.showInstance(R({title:O("Restore version"),acceptButtonText:O("Restore"),dismissButtonText:"Cancel",className:"restore-modal",onAccept:function(e){var r;return r={ns_id:t.ns_id,sjid:t.id,latest_ns_id:s,latest_ns_path:n},I.postRequest(h({path:"/file_revisions/restore",query:{_subject_uid:i}}),r)}},U.div,P({filename:t.filename,date:t.date,time:t.time},"“<b>%(filename)s</b>” will be restored to the version from %(date)s at %(time)s. All other versions will still be saved.")))},onPreview:function(e){var i;return e.stopPropagation(),i=y.get_viewer().get_user_by_id(this.props.userId),N.show(this.props.revision.preview_info,i,{hide_restore:this.props.isLatest},C.HISTORY),t("#file-viewer-container .restore-button").on("click",function(e){return function(t){return e.onRestore(t,e.props.revision,e.props.userId,e.props.latestNsPath,e.props.latestNsId)}}(this))},render:function(){var e,t,n;return n=this.props.revision.is_primary_revision,e=i.addons.classSet({"file-revisions__row":!0,"file-revisions__row--primary":n,"file-revisions__row--secondary":!n}),n?U.li({className:e,onClick:n?this.onPreview:null,"data-identity":this.props.revision.ns_id.toString()+"_"+this.props.revision.id.toString()},U.div({className:"file-revisions__row__col file-revisions__row__col--icon"},M({group:"web",name:r.file_icon(this.props.revision.ns_path)+"_32"},"")),U.div({className:"file-revisions__row__col file-revisions__row__col--filename-and-time"},U.div({className:"file-revisions__text file-revisions__text--filename"},this.props.revision.filename),U.div({className:"file-revisions__text file-revisions__text--time"},"  "+String.fromCharCode(8226)+"  "+this.props.revision.time)),U.div({className:"file-revisions__row__col file-revisions__row__col--owner"},U.div({className:"file-revisions__text file-revisions__text--action"},this.props.revision.action_description),U.div({className:"file-revisions__text file-revisions__text--host"},U.span({},"  "+String.fromCharCode(8226)+"  "),U.span({className:"title_bubble","data-title":this.props.revision.host_name},this.props.revision.device_name))),U.div({className:"file-revisions__row__col file-revisions__row__col--size"},this.props.revision.size_str||""),U.div({className:"file-revisions__row__col file-revisions__row__col--restore"},this.props.isLatest?U.div({className:"file-revisions__current-version"},O("Current version")):U.button({ref:"restore",className:"restore-revision-button button-elm button-secondary main-button",type:"button",onClick:function(e){return function(t){return e.onRestore(t,e.props.revision,e.props.userId,e.props.latestNsPath,e.props.latestNsId)}}(this)},O("Restore")))):(t="file-revisions__row__col file-revisions__row__col--icon",w.RENAME===this.props.revision.revision_reason?t+=" file-revisions__row__col--rename":w.MOVE===this.props.revision.revision_reason?t+=" file-revisions__row__col--move":w.SHARE===this.props.revision.revision_reason?t+=" file-revisions__row__col--share":w.UNSHARE===this.props.revision.revision_reason&&(t+=" file-revisions__row__col--unshare"),U.li({className:e},U.div({className:t},""),U.div({className:"file-revisions__row__col file-revisions__row__col--description"},U.span({className:"file-revisions__text file-revisions__text--description"},this.props.revision.action_description)),U.div({className:"file-revisions__row__col file-revisions__row__col--restore"},this.props.isLatest?U.div({className:"file-revisions__current-version"},O("Current version")):void 0)))}}),g=i.createFactory(S),T=i.createClass({displayName:"FileRevisionViewClass",propTypes:{revisions:i.PropTypes.array.isRequired,more:i.PropTypes.bool.isRequired,cursor:i.PropTypes.string,path:i.PropTypes.string,"fq-path":i.PropTypes.string.isRequired,filename:i.PropTypes.string,"user-id":i.PropTypes.number.isRequired,"ns-id":i.PropTypes.number.isRequired,"read-only":i.PropTypes.bool,"limited-team-banner-upsell":i.PropTypes.bool.isRequired,"trademark-business":i.PropTypes.string.isRequired},getInitialState:function(){return{revisions:this.props.revisions||[],hasMore:this.props.more||!1}},componentWillMount:function(){return this._initFileRevisionsIterator()},componentDidMount:function(){return this.props["limited-team-banner-upsell"]?k.log("banner_version_history_displayed"):void 0},_initFileRevisionsIterator:function(){return this.iterator=new v(this.props["fq-path"],this.props["user-id"],{initialCursor:this.props.cursor,deserializer:n.identity})},_loadMoreRevisions:function(e){var t;return e.preventDefault(),t=this.iterator.next(),t.done(function(e){return function(t){return e.setState({revisions:e.state.revisions.concat(t.revisions),hasMore:t.hasMore})}}(this)),t.fail(function(e){var t;return t=e.errorText||O("An error occurred while loading."),_.error(t)})},_groupRevisionsIntoSameDate:function(e){var t,i,n,s,r,o,a,l,c;for(t=e.map(function(e){return e.preview_info}),l=[],r=e[0].date,c=[],n=i=0,o=e.length;o>i;n=++i)a=e[n],r!==a.date&&(l.push(c),r=a.date,c=[]),s=0===n,c.push(g({key:n,revision:a,userId:this.props["user-id"],isLatest:s,filePreviews:t,latestNsPath:this.props.path,latestNsId:this.props["ns-id"]}));return c!==[]&&l.push(c),l},renderUpsellPromoBanner:function(){return L(E,{className:"u-mar-top-l",description:[O("Did you know that previous versions of files are only saved for 30 days? Upgrade to %(trademark_business)s to get unlimited version history.").format({trademark_business:this.props["trademark-business"]}),U.a({className:"upsell_info u-pad-xxs",href:"/help/113",target:"_blank",key:"info-link"},L(M,{group:"web",name:"info",alt:"more info"}))],buttons:[{text:O("Upgrade now"),handler:function(){return b.redirect(h({path:"/team/upgrade",query:{tk:"version_history",camp:"web"}}))}}]})},render:function(){var e,t,i;return t=this._groupRevisionsIntoSameDate(this.state.revisions),U.div({className:"file-revisions-page"},U.div({className:"file-revisions-page__head"},U.div({className:"file-revisions-page__head__filename"},this.props.filename),U.div({className:"file-revisions-page__head__title"},O("version history")),U.span({className:"file-revisions-page__head__description"},P({},"You can restore any version below to make it the current file. All other versions will still be saved.")),this.props["limited-team-banner-upsell"]?this.renderUpsellPromoBanner():void 0),U.div({className:"file-revisions-page__content"},function(){var n,s,r;for(r=[],e=n=0,s=t.length;s>n;e=++n)i=t[e],r.push(U.div({className:"file-revisions-page__content__revision-table",key:e},U.span({className:"revision-date"},i[0].props.revision.date),U.ul({className:"file-revisions"},i)));return r}(),this.state.hasMore?U.div({ref:"loadMore",className:"load-more-revisions",onClick:this._loadMoreRevisions},O("Load older versions")):void 0))}}),A=i.createFactory(T),{FileRevisionViewClass:T,FileRevisionItemClass:S}})}.call(this);
//# sourceMappingURL=pkg-aq.min.js-vflbuuB2A.map