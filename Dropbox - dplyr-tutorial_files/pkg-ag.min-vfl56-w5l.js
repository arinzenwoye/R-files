(function(){define("modules/clean/file_operations/notifications",["external/underscore","modules/core/html","modules/core/i18n","modules/core/notify","modules/clean/react/browse/api","modules/clean/browse_interface","modules/clean/em_string","modules/clean/react/browse/dispatcher","modules/clean/filepath","modules/clean/undo"],function(e,t,s,r,n,o,i,a,l,u){var c,d,p,h,f,m,_,g,y,S,b;return c=s._,b=s.ungettext,S=function(e,t,s,o){var i;return i=function(){return n.rollbackChangeSets({changesets:s,userId:t.id,progressText:c("Undoing…"),onSuccess:function(){return r.success(c("Undo complete.")),"function"==typeof o?o():void 0}})},u.notifyWithUndo(e,s,i)},d=function(t,s){var r,n,a;return n=o.browse_uri_for_fq_path(s,t),a=40,r=i.em_snippet(l.filename(t),a),{href:n,text:e.escape(r)}},p=function(e,s,r,n,o){var i,a,l;return null==n&&(n=null),n?(i=d(n,s),l=b('Copied %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Copied %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e),a=l.format({num_items:e,dest_href:i.href,dest_name:i.text}),a=new t(a)):(a=b("Copied %(num_items)d item.","Copied %(num_items)d items.",e),a=a.format({num_items:e})),S(a,s,r,o)},m=function(e,s,r,n,o){var i,a,l;return a=null,n?(i=d(n,s),l=b('Moved %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Moved %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e),a=l.format({num_items:e,dest_href:i.href,dest_name:i.text}),a=new t(a)):(l=b("Moved %(num_items)d item.","Moved %(num_items)d items.",e),a=l.format({num_items:e})),S(a,s,r,o)},h=function(e,s,r,n){var o,i;return i=b("Deleted %(num_items)d item","Deleted %(num_items)d items",e),o=i.format({num_items:e}),o=new t(o),S(o,s,r,n)},g=function(e,s,r){var n;return n=c("Rename complete."),n=new t(n),S(n,e,s,r)},f=function(e,s,r){var n,o;return o=c("Created folder %(folder_name)s"),n=o.format({folder_name:e}),n=new t(n),S(n,s,r)},_=function(e){var t,s;return s=b("Permanently deleted %(num)s item","Permanently deleted %(num)s items",e),t=s.format({num:e}),r.success(t)},y=function(s){var n,o,i,a;return n=s.length,1===n?(o=l.filename(s[0].fq_path),o=e.escape(o),a=c("Restored <strong>%(filename)s</strong>."),i=a.format({filename:o}),i=new t(i)):(a=b("Restored %(num)s file.","Restored %(num)s files.",n),i=a.format({num:n})),r.success(i)},{notifyCopySuccess:p,notifyMoveSuccess:m,notifyDeleteSuccess:h,notifyRestoreSuccess:y,notifyPurgeSuccess:_,notifyFolderCreationSuccess:f,notifyRenameSuccess:g}})}).call(this),function(){"use strict";var e=[].slice;define("modules/clean/flux/store_mixin",[],function(){var t;return t=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],{getInitialState:function(){return this._get_state_from_stores(this.props)},componentDidMount:function(){var e,s,r;for(e=0,s=t.length;s>e;e++)r=t[e],r.add_change_listener(this._handle_store_changed);return this.setState(this._get_state_from_stores(this.props))},componentWillUnmount:function(){var e,s,r,n;for(r=[],e=0,s=t.length;s>e;e++)n=t[e],r.push(n.remove_change_listener(this._handle_store_changed));return r},_handle_store_changed:function(){var e;return this.isMounted()&&(e=this._get_state_from_stores(this.props),null!=e)?this.setState(e):void 0}}}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},s={}.hasOwnProperty;define("modules/clean/payments/pro_trial_onboarding_tour",["jquery","modules/clean/ajax","modules/clean/dbmodal"],function(s,r,n){var o,i,a,l;return o=n.DBModal,a=function(n){function o(t){this.options=t,this._log=e(this._log,this),this._redraw=e(this._redraw,this),this._log_and_show_current_step=e(this._log_and_show_current_step,this),this._log_link_click=e(this._log_link_click,this),this._finish_tour=e(this._finish_tour,this),this._advance_tour=e(this._advance_tour,this),this._go_back_tour=e(this._go_back_tour,this),this._hide=e(this._hide,this),this._show=e(this._show,this),o.__super__.constructor.call(this,this.options),this.vertical_offset=200}return t(o,n),o.show=function(e){var t;return t=new this({element_id:"pro-trial-onboarding-tour",click_out_to_close:!0,vars:{trigger:e}}),t.show()},o.prototype._show=function(){return o.__super__._show.apply(this,arguments),this._listen(),this._current_step=0,this._log_and_show_current_step(this.vars.trigger)},o.prototype._hide=function(){return o.__super__._hide.apply(this,arguments),this._unlisten(),s("#pro-trial-tour-header-bubble").removeClass("force-hidden")},o.prototype._listen=function(){return s(document).on("click",".prev-step",this._go_back_tour),s(document).on("click","button.next-step",this._advance_tour),s(document).on("click","button.finish-tour",this._finish_tour),s(document).on("click",".tour-feature a.link",this._log_link_click)},o.prototype._unlisten=function(){return s(document).off("click",".prev-step",this._go_back_tour),s(document).off("click","button.next-step",this._advance_tour),s(document).off("click","button.finish-tour",this._finish_tour),s(document).off("click",".tour-feature a.link",this._log_link_click)},o.prototype._go_back_tour=function(e){return e.preventDefault(),this._current_step-=1,this._log_and_show_current_step()},o.prototype._advance_tour=function(e){return e.preventDefault(),this._current_step+=1,this._log_and_show_current_step()},o.prototype._finish_tour=function(){return this._log("finish_trial_onboarding"),this.hide()},o.prototype._log_link_click=function(e){var t;return t={current_step:this._current_step,header_text:s(".tour-feature[data-step-num="+this._current_step+"] h1.title").first().text(),link_href:e.target.href,link_text:e.target.text},this._log("pro_onboarding_link_clicked",t)},o.prototype._log_and_show_current_step=function(e){var t;return t=e?{trigger:e}:{},this._log("view_trial_onboarding_"+this._current_step,t),this._redraw()},o.prototype._redraw=function(){var e;return this.$modal_window.find(".welcome, .tour-feature").hide(),e=this.$modal_window.find(".db-modal-x"),0===this._current_step?(this.$modal_window.find(".welcome").show(),e.hide()):(this.$modal_window.find(".tour-feature[data-step-num="+this._current_step+"]").show(),e.show())},o.prototype._log=function(e,t){return r.WebRequest({url:"/pro/trial_onboarding_tour_log",data:{evt:e,extra_data:JSON.stringify(t)}})},o}(o),l=function(){function e(e){this.$container=e,this._listen()}return e.prototype._listen=function(){return this.$container.find(".start-tour").on("click",function(e){return function(e){return e.preventDefault(),a.show("restart_tour")}}(this))},e}(),i=function(){function e(e){this.active_onboarding_class=e,this._listen()}return e.prototype._listen=function(){return s(this.active_onboarding_class).on("click",function(t){var r;return r=s(t.currentTarget).data("onboarding-step"),e.setUserOnboardingAttribute(t.currentTarget,r)})},e.setUserOnboardingAttribute=function(e,t){var n;return n=this.active_onboarding_class||"global-actions__button--onboarding",r.WebRequest({url:"/ajax_set_pro_onboarding_step",data:{queue_onboarding_step:parseInt(t)},success:function(t){var r,o,i;if(t)try{if(i=JSON.parse(t),i.subgrowth_pro_onboarding_step_increase)return s(e).removeClass(n)}catch(e){return r=e,s.noop()}}})},e}(),{ProTrialOnboardingTour:a,ProTrialOnboardingTourHeaderLink:l,ProOnboardingTooltips:i}})}.call(this),function(){define("modules/clean/raf",function(){var e,t,s,r,n,o,i;for(t=window.requestAnimationFrame,e=window.cancelAnimationFrame,o=["ms","moz","webkit","o"],s=0,n=o.length;n>s&&(i=o[s],!t);s++)t=window[i+"RequestAnimationFrame"],e=window[i+"CancelAnimationFrame"]||window[i+"CancelRequestAnimationFrame"];return t||(r=0,t=function(e,t){var s,n,o,i;return s=(new Date).getTime(),i=Math.max(0,16-(s-r)),n=function(){return e(s+i)},o=setTimeout(n,i),r=s+i,o}),e||(e=function(e){return clearTimeout(e)}),{requestAnimationFrame:t.bind(window),cancelAnimationFrame:e.bind(window)}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/browse/api",["external/underscore","modules/clean/ajax","modules/clean/react/browse/constants","modules/clean/filepath","modules/clean/history","modules/clean/pagination_manager","modules/clean/react/browse/store","modules/clean/viewer","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri","modules/constants/browse","modules/constants/viewer"],function(t,s,r,n,o,i,a,l,u,c,d,p,h,f){var m,_,g,y,S,b,v,T,w,F,I,D,E,P,C,R,N,O,A,x,M;return S=r.LoadingStates,y=a.File,m=a.BrowseContext,g=a.Config,_=a.BrowseStore,b=c._,M=function(e){var t,s;try{return JSON.parse(e)}catch(e){if(s=e,!(s instanceof SyntaxError))throw s}return null},I=function(t){var s,r;return s=null!=(r=t.containing_fq_path)?r:"",0!==s.indexOf("/")&&(s="/"+s),new m({currentNSID:t.containing_ns_id,currentFQPath:s,currentMountPoint:t.containing_mount_point,currentNSPath:t.containing_ns_path,currentSharedFolderPermissionRole:t.containing_sf_perm_role,currentNSAllowsNesting:e.call(t.containing_ns_permissions,"mount_shared_folders")>=0,inactiveNSIDByFQPath:t.old_path_to_ns_id,permanentDeletionDisabledStateByNSID:t.permanent_delete_is_disabled_by_ns_id,isInFolderMode:t.inside_dir,isInsideSharedFolder:t.inside_shared_folder,isInsideAutoTeamFolder:t.inside_auto_team_folder,isInsideTeamFolderTree:t.inside_team_folder_tree,isInsideDeletedFolder:t.inside_deleted_dir,isInsideDeletedSharedFolder:Boolean(t.inside_deleted_shared_folder),isInsideDeletedNestedSharedFolder:t.inside_deleted_nested_shared_folder,showSharedFolderCreateTeamPromo:t.show_shared_folder_create_team_promo,blockHash:t.block_hash,config:new g({isSimpleSharingEnabled:t.simple_sharing_enabled,isPublicFolderEnabled:t.public_folder_enabled,publicAppToken:t.public_app_token})})},C=function(e){var r,n,o,a,l,u,c,d,h,f;return u=e.path,f=e.userId,n=e.includeDeletedFiles,h=null!=(d=e.sortFoldersFirst)?d:!0,c=e.pathLoadCallback,r=e.filesAppendCallback,o=e.loadingStateCallback,a=e.mountPointCallback,l=e.onError,s.WebRequest({data:{show_deleted:n||"",sort_folders_first:h},url:p({path:"/browse"+u}),subject_user:f,success:function(e){var s,n,l;try{return t.isString(e)&&(e=JSON.parse(e)),s=I(e),a({mountPoints:e.ns_id_to_mount_point}),e.paginated?(o({loadingState:S.LOADING_REMAINING_PAGES}),l=new i,c({path:u,files:[],context:s}),l.initialize(e.first_page,"sjid","/browse_get_next",f,function(e,t){return r({path:u,files:t}),e.areAllItemsReady()?(o({loadingState:S.LOADED}),e.stopAutoFetching()):void 0}),l.startAutoFetching()):(n=e.file_info,c({path:u,files:n,context:s}),void o({loadingState:S.LOADED}))}catch(e){}},error:function(e,t,s){return"function"==typeof l?l(e,t,s):void 0}})},v=function(r){var n,o,i,a,l,u;return o=r.files,a=r.newPath,u=r.userId,l=r.onSuccess,i=function(){var e,t,s;for(s=[],e=0,t=o.length;t>e;e++)n=o[e],s.push(n.fq_path);return s}(),e.call(i,a)>=0?(d.error(b("You can’t copy a folder into itself.")),null):s.WebProgressRequest({url:p({path:"/cmd/copy"}),data:{files:i,to_path:a},subject_user:u,progress_text:b("Copying files..."),success:function(e){try{return t.isString(e)&&(e=JSON.parse(e)),o=function(){var t,s,r,o;for(r=e.new_browse_files,o=[],t=0,s=r.length;s>t;t++)n=r[t],o.push(y.fromServerObject(n));return o}(),l({files:o,destinationPath:a,changesets:e.changesets})}catch(e){}}})},F=function(e){var r,n,o,i,a;return n=e.files,a=e.userId,i=e.onSuccess,o=function(){var e,t,s;for(s=[],e=0,t=n.length;t>e;e++)r=n[e],s.push(r.fq_path);return s}(),s.WebProgressRequest({url:p({path:"/cmd/delete"}),data:{files:o},subject_user:a,progress_text:b("Deleting files..."),success:function(e){var s,r;try{return t.isString(e)&&(e=JSON.parse(e)),r=function(){var e,t,r;for(r=[],e=0,t=n.length;t>e;e++)s=n[e],r.push({before:s,after:null});return r}(),i({fileDeltas:r,changesets:e.changesets})}catch(e){}}})},R=function(r){var o,i,a,l,u,c,h;return c=r.path,i=r.files,l=r.newPath,h=r.userId,u=r.onSuccess,c===l?(d.error(b("Those files already exist in that folder.")),null):(a=function(){var e,t,s;for(s=[],e=0,t=i.length;t>e;e++)o=i[e],s.push(o.fq_path);return s}(),e.call(a,l)>=0?(d.error(b("You can’t move a folder into itself.")),null):s.WebProgressRequest({url:p({path:"/cmd/move"}),data:{files:a,to_path:l},subject_user:h,progress_text:b("Moving files..."),success:function(e){var s;try{return t.isString(e)&&(e=JSON.parse(e)),i=_.filesMap(),s=function(){var s,r,l,u;for(l=e.new_browse_files,u=[],s=0,r=l.length;r>s;s++)o=l[s],u.push({before:i.get(t.find(a,function(e){return n.filename(e)===n.filename(o.fq_path)}),null),after:y.fromServerObject(o)});return u}(),u({path:c,destinationPath:l,fileDeltas:s,changesets:e.changesets})}catch(e){}}}))},O=function(e){var t,r,n,o,i;return t=e.file,r=e.newName,i=e.userId,o=e.onSuccess,n=e.onError,s.WebRequest({url:p({path:"/cmd/rename"+t.fq_path}).toString(),subject_user:i,data:{to_path:r},success:function(e,t,s){var r,i,a,l;l=null;try{l=JSON.parse(e)}catch(e){if(r=e,!(r instanceof SyntaxError))throw r}return l?(a=y.fromServerObject(l.new_browse_files[0]),o({changesets:l.changesets,renamedFile:a})):n?n():void 0},error:n?n:void 0})},P=function(e){var t,s,r,n;return t=e.fqPath,n=e.userId,s={prev:p.parse(o.get_url()).setFragment("").toString()},s[f.UID_PARAM_NAME]=n,t=t.replace(/^[\/]/,""),r=p({path:"/restore/"+t}).updateQuery(s),r.toString()},E=function(e){var t,s,r,n;return t=e.fqPath,n=e.userId,r={undelete:1},r[f.UID_PARAM_NAME]=n,t=t.replace(/^[\/]/,""),s=h.REVISION_HISTORY_WEB?"/history":"/revisions",p({path:s+"/"+t}).updateQuery(r)},A=function(e){var r,n,o;return r=e.files,o=e.userId,n=e.onSuccess,s.WebProgressRequest({url:"/cmd/restore",data:{files:t.pluck(r,"fq_path")},subject_user:o,dataType:"json",progress_text:b("Restoring…"),success:function(e){return n()}})},N=function(e){var r,n,o,i,a;return r=e.files,a=e.userId,n=e.onSuccess,o=null!=(i=e.progressText)?i:b("Deleting…"),s.WebProgressRequest({url:"/cmd/purge",data:{files:t.pluck(r,"fq_path")},subject_user:a,dataType:"text",progress_text:o,success:function(e){var t;return t=M(e),t&&"success"===t.status?n():void 0}})},x=function(e){var t,r,n,o;return o=e.userId,t=e.changesets,n=e.progressText,r=e.onSuccess,s.WebProgressRequest({url:p({path:"/cmd/rollback"}),data:{ns_to_cs:JSON.stringify(t)},subject_user:o,progress_text:n,success:function(){return r()}})},w=function(e){var t,r,n,o,i;return o=e.pathName,t=e.folderName,i=e.userId,n=e.onSuccess,r=e.onError,s.WebProgressRequest({url:p({path:"/cmd/new"+o}),data:{to_path:t,folder:"yes"},subject_user:i,success:function(e){var t,s;return t=M(e),t?(s=y.fromServerObject(t.new_browse_files[0]),n({changesets:t.changesets,createdFolder:s})):void 0},error:function(){return r()}})},D=function(e){var t,r,n,o,i,a,l,u,c;return a=e.path,c=e.userId,r=e.namespaceToJournalIdMap,t=e.includeDeletedFiles,o=e.onSuccess,l="/"===a?"":a,i={fq_dir:l,ns_map:function(){var e;e=[];for(n in r)u=r[n],e.push(n+"_"+u);return e}().join(","),show_deleted:Boolean(t)},s.WebRequest({url:p({path:"/update/list_dir"}),subject_user:c,data:i,dataType:"text",success:function(e){var t;return t=M(e),t?o(t):void 0}})},T=function(e){var t,r,n,o;return t=e.folder,r=e.name,o=e.userId,n=e.onSuccess,s.WebProgressRequest({url:"/collection_from_folder",data:{path:t,album_name:r},subject_user:o,progress_text:b("Creating album…"),success:function(e){var t;return t=M(e),t?n({url:t.url}):void 0}})},{loadPath:C,copyFiles:v,moveFiles:R,deleteFiles:F,renameFile:O,getFileHistoryUrl:E,getRestoreFileUrl:P,restoreFiles:A,purgeFiles:N,rollbackChangeSets:x,getChangesForDirectory:D,createNewFolder:w,extractBrowseContext:I,createAlbum:T}})}.call(this),function(){define("modules/clean/react/browse/dispatcher",["modules/clean/flux/dispatcher"],function(e){return e})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/browse/file_jump",["modules/clean/keycode","modules/clean/react/browse/store","modules/core/dom","modules/clean/react/browse/constants","modules/clean/flux/dispatcher"],function(t,s,r,n,o){var i,a,l,u,c;return l=s.BrowseStore,a=n.BrowseActionTypes,i=["/","\\",":","?","*","<",">","|"],c=1e3,u={_timeout:null,_reset:function(){return o.dispatch({type:a.RESET_FILE_JUMP})},handleKeyPress:function(s){var n,u,d;return u=null!=(d=s.which)?d:s.keyCode,n=String.fromCharCode(u),u<t.SPACE||e.call(i,n)>=0||r.focus_in_input()||s.metaKey||s.altKey||s.altGraphKey||s.ctrlKey||u===t.SPACE&&!l.isFileJumping()?void 0:(u===t.SPACE&&l.isFileJumping()&&s.preventDefault(),o.dispatch({type:a.ADD_FILE_JUMP_KEY_CODE,data:{keyChar:n}}),null!=this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(this._reset,c))}}})}.call(this),function(){define("modules/clean/react/browse/internal_drag_status",["external/immutable","external/react","jquery","modules/clean/react/sprite"],function(e,t,s,r){var n,o,i;return i=t.DOM,o=t.createElement,n=t.createClass({displayName:"InternalDragStatus",mixins:[t.addons.PureRenderMixin],propTypes:{files:t.PropTypes.array.isRequired},render:function(){return i.div({id:"drag-status",className:"active"},i.div({id:"drag-selection-status"},this.props.files.slice(0,4).map(function(e,t){return e.thumbnail_url_tmpl?i.img({key:t,src:e.thumbnail_url_tmpl,className:"icon icon"+t,alt:""}):o(r,{key:t,group:"web",name:e.icon,className:"icon icon"+t,alt:""})}),i.span({className:"badge"},this.props.files.length)))}}),{InternalDragStatus:n}})}.call(this),function(){define("modules/clean/react/browse/keyboard_shortcuts",["external/react","modules/core/browser","modules/core/i18n","modules/clean/react/flag"],function(e,t,s,r){var n,o,i,a,l;return i=s._,l=e.DOM,a=e.createElement,o=[{key:"↑",desc:i("Select previous file (hold shift to select range)",{comment:"Shift refers to the shift key"})},{key:"↓",desc:i("Select next file (hold shift to select range)",{comment:"Shift refers to the shift key"})},{windowsKey:"ctrl + a",macKey:"⌘ + a",desc:i("Select all files")},{key:"esc",desc:i("Deselect all files (and hide these instructions)")},{key:"←",desc:i("Go up a folder")},{key:"/",desc:i("Search")},{key:"→",desc:i("Open folder")},{key:"enter",desc:i("Open file or folder")},{key:"alt + a",desc:i("Show action menu for selected file(s)")},{windowsKey:"ctrl + c",macKey:"⌘ + c",desc:i("Copy selected file(s)")},{windowsKey:"ctrl + v",macKey:"⌘ + v",desc:i("Paste selected file(s) into the current folder")},{key:"F2",desc:i("Rename selected file")},{windowsKey:"Delete",macKey:"delete",desc:i("Delete selected file(s)")},{windowsKey:"ctrl + z",macKey:"⌘ + z",desc:i("Undo recent move/copy/rename/delete")},{key:"?",desc:i("Show keyboard shortcuts")}],n=e.createClass({displayName:"KeyboardShortcuts",_renderShortcutsItem:function(e){var s;return s=l.span({className:"keyboard-shortcuts__key"},e.key?e.key:t.mac?e.macKey:e.windowsKey),l.li({className:"keyboard-shortcuts__item u-mar-bottom-xs"},a(r,{leftAttachment:s,alignment:"top"},l.span({className:"keyboard-shortcuts__desc"},e.desc)))},render:function(){var e;return l.div({className:"keyboard-shortcuts u-pad-m"},l.h2({},i("Dropbox keyboard shortcuts")),l.ul({className:"keyboard-shortcuts__pane u-unlist u-trim-padding"},function(){var t,s,r;for(r=[],t=0,s=o.length;s>t;t++)e=o[t],r.push(this._renderShortcutsItem(e));return r}.call(this)))}})})}.call(this),function(){define("modules/clean/react/browse/name_input",["external/underscore","external/classnames","external/react","modules/core/i18n","modules/clean/keycode","modules/core/notify","modules/clean/raf"],function(e,t,s,r,n,o,i){var a,l,u,c;return u=r._,c=s.DOM,l=s.PropTypes,a=s.createClass({mixins:[s.addons.PureRenderMixin],displayName:"NameInput",propTypes:{defaultValue:l.string.isRequired,label:l.string.isRequired,onSubmit:l.func,onCancel:l.func,className:l.string},getDefaultProps:function(){return{onSubmit:e.noop,onCancel:e.noop,className:""}},componentDidMount:function(){var e;return e=this.refs.input.getDOMNode(),e.focus(),i.requestAnimationFrame(function(){var t,s;return t=e.value,s=t.lastIndexOf("."),-1===s&&(s=t.length),e.setSelectionRange(0,s)})},_checkValue:function(){var e;return e=this.refs.input.getDOMNode().value.trim(),e===this.props.defaultValue?(this.props.label===u("Folder name")&&o.error(u("Please provide a name for the new folder.")),this.props.onCancel()):this.props.onSubmit(e)},_onSubmit:function(e){return e.preventDefault(),this._checkValue()},_onKeyDown:function(e){return e.keyCode===n.ESC?(e.preventDefault(),this.props.onCancel()):void 0},_onBlur:function(e){return this._checkValue()},render:function(){var e;return e=c.input({ref:"input",defaultValue:this.props.defaultValue,className:t("c-input",this.props.className),onBlur:this._onBlur,onKeyDown:this._onKeyDown,"aria-label":this.props.label}),c.form({className:"u-pad-right-xs",onSubmit:this._onSubmit},e)}})})}.call(this),function(){define("modules/clean/react/browse/render_partials",["external/react","modules/clean/react/sprite","modules/clean/react/browse/models"],function(e,t,s){var r,n,o,i;return r=s.File,i=e.DOM,o=e.createElement,n=e.createClass({displayName:"FileIconView",propTypes:{file:e.PropTypes.instanceOf(r).isRequired,onClick:e.PropTypes.func,onMouseDown:e.PropTypes.func,className:e.PropTypes.string},getDefaultProps:function(){return{onClick:function(){},onMouseDown:function(){},onDragStart:function(){},className:""}},getInitialState:function(){return{hasThumbFailed:!1}},render:function(){return this.props.file.thumbnail_url_tmpl&&!this.state.hasThumbFailed?i.img({src:this.props.file.thumbnail_url_tmpl,className:"browse-file-row__accessory "+this.props.className,alt:"",onError:function(e){return function(){return e.setState({hasThumbFailed:!0})}}(this),onClick:this.props.onClick,onDragStart:this.props.onDragStart,onMouseDown:this.props.onMouseDown}):o(t,{group:"web",name:this.props.file.icon,className:"browse-file-row__accessory "+this.props.className,alt:"",onClick:this.props.onClick,onDragStart:this.props.onDragStart,onMouseDown:this.props.onMouseDown})}}),{FileIcon:n}})}.call(this),function(){define("modules/clean/react/browse/settings_gear_menu",["external/react","modules/clean/react/bubble_menu","modules/clean/react/sprite"],function(e,t,s){var r,n,o,i,a;return r=t.BubbleMenu,n=t.BubbleMenuItem,a=e.DOM,i=e.createElement,o=e.createClass({displayName:"settingsGearMenuBubble",propTypes:{isShowing:e.PropTypes.bool.isRequired,alt:e.PropTypes.string.isRequired,menuItems:e.PropTypes.arrayOf(e.PropTypes.shape({label:e.PropTypes.string,action:e.PropTypes.func})).isRequired},componentDidUpdate:function(){return this.props.isShowing?this.refs.gearBubbleMenu.show():this.refs.gearBubbleMenu.hide()},render:function(){var e,t;return e=a.button({className:"sprite-button bubble-button"},i(s,{group:"web",name:"gear",alt:this.props.alt})),i(r,{arrow_position:"top",targetButton:e,ref:"gearBubbleMenu",items:function(){var e,s,r,o;for(r=this.props.menuItems,o=[],e=0,s=r.length;s>e;e++)t=r[e],o.push(i(n,{onClick:t.action},t.label));return o}.call(this)})}}),{SettingsGearMenuBubble:o}})}.call(this),function(){var e=function(e,s){function r(){this.constructor=e}for(var n in s)t.call(s,n)&&(e[n]=s[n]);return r.prototype=s.prototype,e.prototype=new r,e.__super__=s.prototype,e},t={}.hasOwnProperty,s=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/browse/store",["external/underscore","external/immutable","modules/core/browser","modules/core/exception","modules/clean/filepath","modules/clean/flux/base_store","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/file_uploader/store","modules/clean/react/columnheader","modules/clean/react/selectable_list"],function(t,r,n,o,i,a,l,u,c,d,p){var h,f,m,_,g,y,S,b,v,T,w,F,I,D,E,P,C,R;return C=o.assert,h=l.BrowseActionTypes,m=l.BrowseSortField,y=l.Direction,T=l.FileTypes,w=l.LoadingStates,F=l.NewFolderCreationState,I=l.RenameStates,S=u.File,g=u.Config,f=u.BrowseContext,b=u.FileRename,P=c.UploaderStore,E=c.UploaderActionTypes,v=c.FileStatus,D=d.SortDirections,R=p.createSelection,_=function(o){function a(){return a.__super__.constructor.apply(this,arguments)}return e(a,o),a.prototype._init=function(){return this._unsortedFiles=r.Map(),this._sortedFiles=r.List(),this._path="",this._user=null,this._urlPrefix="",this._selection=R(),this._loadingState=w.LOADING_FIRST_PAGE,this._context=new f,this._mountPoints=null,this._shouldShowDeletedFiles=!1,this._activeDropTarget=null,this._inCopyMode=!1,this._clipboardFiles=r.Set(),this._currentSort={sortField:m.FILENAME,direction:D.ASCENDING},this._fileRename=null,this._newFolderCreationState=F.CREATE_FOLDER_INACTIVE,this._filePathsToSelectOnNextUpdate=r.Set(),this._activeFileJumpFilter="",this._fileJumpIndex=[]},a.prototype.files=function(){return this._sortedFiles},a.prototype.filesMap=function(){return this._unsortedFiles},a.prototype.path=function(){return this._path},a.prototype.user=function(){return this._user},a.prototype.urlPrefix=function(){return this._urlPrefix},a.prototype.selection=function(){return this._selection},a.prototype.selectedFiles=function(){return this._sortedFiles.filter(function(e){return function(t){return e._selection.selected.has(t.fq_path)}}(this)).toOrderedSet()},a.prototype.loadingState=function(){return this._loadingState},a.prototype.context=function(){return this._context},a.prototype.mountPoints=function(){return this._mountPoints},a.prototype.shouldShowDeletedFiles=function(){return this._shouldShowDeletedFiles},a.prototype.activeDropTarget=function(){return this._activeDropTarget},a.prototype.getIndexOfFile=function(e){return this._sortedFiles.findIndex(function(t){return t.sjid===e.sjid})},a.prototype.getFileByFilename=function(e){return this._sortedFiles.find(function(t){return i.filename(t.fq_path)===e})||null},a.prototype.inCopyMode=function(){return this._inCopyMode},a.prototype.clipboardFiles=function(){return this._clipboardFiles},a.prototype.fileRename=function(){return this._fileRename},a.prototype.newFolderCreationState=function(){return this._newFolderCreationState},a.prototype.isFileJumping=function(){return this._activeFileJumpFilter.length>0},a.prototype._initializeEverything=function(e){var t,s,n,o,i,a,l,u,c;return c=e.user,a=e.path,s=e.files,u=e.urlPrefix,t=e.context,i=e.mountPoints,n=e.fqPathsToSelect,o=e.loadingState,l=e.shouldShowDeletedFiles,this._user=c,this._path=a,this._urlPrefix=u,this._appendFiles({path:a,files:s},!1),this._context=t,this._mountPoints=r.Map(i),this._loadingState=o,o===w.LOADED?this._selectFqPaths({fqPathsToSelect:n},!1):this._filePathsToSelectOnNextUpdate=r.Set(n),this._shouldShowDeletedFiles=Boolean(l)},a.prototype._setUser=function(e){var t;return t=e.user,null==this.user()?this._user=t:void 0},a.prototype._setPathData=function(e){var t,s,r;return r=e.path,s=e.files,t=e.context,r===this.path()?(this._unsortedFiles=this._unsortedFiles.clear(),this._sortedFiles=this._sortedFiles.clear(),this._selection=R(),this._appendFiles({path:r,files:s},!1),this._context=t,this.emit_change()):void 0},a.prototype._appendFiles=function(e,t){var s,n,o,i,a,l;if(l=e.path,n=e.files,null==t&&(t=!0),l===this.path()){for(o=[],i=0,a=n.length;a>i;i++)s=n[i],s instanceof S||(s=S.fromServerObject(s)),o.push([s.fq_path,s]);if(this._unsortedFiles=this._unsortedFiles.merge(o),this._sortedFiles=this._sortedFiles.concat(r.List(function(){var e,t,r;for(r=[],e=0,t=n.length;t>e;e++)s=n[e],r.push(this._unsortedFiles.get(s.fq_path));return r}.call(this))),C(this._unsortedFiles.size===this._sortedFiles.size,"appendFiles ended up with mismatched data structures"),this._sortFiles(this._currentSort,!1),this._filePathsToSelectOnNextUpdate.count()&&this._selectFqPaths({fqPathsToSelect:this._filePathsToSelectOnNextUpdate.toArray()},!1),this._buildFileJumpIndex(),t)return this.emit_change()}},a.prototype._isMostRecentVersionOfFile=function(e){var t,s;return s=e.file,t=s&&this._unsortedFiles.get(s.fq_path),t?t.sjid<s.sjid:!0},a.prototype._insertOrUpdateFile=function(e){var t,s,r,n,o,i,a,l;return n=e.file,o=null!=(a=e.forceUpdate)?a:!1,this._unsortedFiles=this._unsortedFiles.set(n.fq_path,n),i=n.fq_path.toLowerCase(),t=function(e){return e.fq_path.toLowerCase()===i},l=this._sortedFiles.findEntry(t)||[null,null],r=l[0],s=l[1],s?o||n.sjid>s.sjid?this._sortedFiles=this._sortedFiles.set(r,n):void 0:this._sortedFiles=this._sortedFiles.push(n)},a.prototype._removeFile=function(e){var t,s;return t=e.file,C(this._unsortedFiles.has(t.fq_path),"trying to remove a file that doesn't exist in the file map"),s=this._sortedFiles.indexOf(t),C(-1!==s,"tried to remove file that doesn't exist in the sorted file list"),this._unsortedFiles=this._unsortedFiles.delete(t.fq_path),this._sortedFiles=this._sortedFiles.delete(s)},a.prototype._replaceFile=function(e){var t,s,r,n;return t=e.existingFile,r=e.newFile,C(this._unsortedFiles.has(t.fq_path),"tried to replace file, but previous file doesn't exist in map"),s=this._sortedFiles.indexOf(t),C(-1!==s,"tried to update file, but previous file doesn't exist in sorted list"),t.fq_path===r.fq_path?(this._sortedFiles=this._sortedFiles.set(s,r),this._unsortedFiles=this._unsortedFiles.set(t.fq_path,r)):(this._sortedFiles=this._sortedFiles.delete(s),this._unsortedFiles=this._unsortedFiles.delete(t.fq_path),this._unsortedFiles=this._unsortedFiles.set(r.fq_path,r),this._sortedFiles=this._sortedFiles.push(r),(null!=(n=this._fileRename)?n.state:void 0)===I.SAVING_INPUT?(this._updateRenameState(t,null),this._selectFqPaths({fqPathsToSelect:[r.fq_path]})):void 0)},a.prototype._applyFileDelta=function(e){var t,s,r;return s=e.before,t=e.after,r=e.pathForDelta,t&&!i.paths_are_equal(i.parent_dir(t.fq_path),r)&&(t=null),t!==s&&this._isMostRecentVersionOfFile({file:t})?t&&s?this._replaceFile({existingFile:s,newFile:t}):t&&!s?this._insertOrUpdateFile({file:t}):s&&!t?this._removeFile({file:s}):void 0:void 0},a.prototype._applyFileDeltas=function(e){var t,s,n,o,a,l,u,c;if(l=e.path,n=e.fileDeltas,i.paths_are_equal(l,this._path)){for(o=0,a=n.length;a>o;o++)c=n[o],s=c.before,t=c.after,this._applyFileDelta({before:s,after:t,pathForDelta:l});return this._filePathsToSelectOnNextUpdate.size&&(u=this._selectFqPaths({fqPathsToSelect:this._filePathsToSelectOnNextUpdate.toArray()},!1),u.size===this._filePathsToSelectOnNextUpdate.size&&(this._filePathsToSelectOnNextUpdate=r.Set())),C(this._unsortedFiles.size===this._sortedFiles.size,"applyFileDeltas ended up with mismatched file collections (map vs. sorted list)"),this._sortFiles(this._currentSort,!1),this._buildFileJumpIndex(),this.emit_change()}},a.prototype._applyTeamFolderDowngrade=function(e){var t,s,r;return r=this.mountPoints().get(e),s=this.filesMap().get(r),null!=s&&(t=s.merge({icon:"folder_user_32",type:T.SHARED_FOLDER}),this._replaceFile({existingFile:s,newFile:t})),this.emit_change()},a.prototype._setPath=function(e){var t;return t=e.path,this._path=t,this.emit_change()},a.prototype._setUrlPrefix=function(e){var t;return t=e.prefix,this._urlPrefix=t,this.emit_change()},a.prototype._setLoadingState=function(e){var t;return t=e.loadingState,this._loadingState=t,t===w.LOADED&&(this._filePathsToSelectOnNextUpdate=r.Set()),this.emit_change()},a.prototype._setMountPoints=function(e){var t;return t=e.mountPoints,this._mountPoints=r.Map(t)},a.prototype._setSelection=function(e){var t;return t=e.selection,this._selection=t,this.emit_change()},a.prototype._selectFqPaths=function(e,t){var n,o,i,a,l,u;return i=e.fqPathsToSelect,null==t&&(t=!0),a=i.map(function(e){return e.toLowerCase()}),o=this._sortedFiles.filter(function(e){var t;return t=e.fq_path.toLowerCase(),s.call(a,t)>=0}),l=o.map(function(e){return e.fq_path}),u=this._selection.set("selected",r.OrderedSet(l)),n=l.size?l.get(0):null,u=u.set("anchor",n),this._selection=u,t&&this.emit_change(),
l},a.prototype._toggleFqPathSelected=function(e){var t,s,r,n,o,i,a,l,u,c,d;if(a=e.path,d=this._selection,d.selected.has(a)){for(d=d.update("selected",function(e){return e.delete(a)}),i=null,t=this._selection.selected.indexOf(a),s=n=l=t+1,u=this._selection.selected.count();u>=l?u>n:n>u;s=u>=l?++n:--n)if(r=this._selection.selected.get(s),d.selected.has(r)){i=r;break}if(!i)for(s=o=c=t-1;0>=c?0>=o:o>=0;s=0>=c?++o:--o)if(r=this._selection.selected.get(s),d.selected.has(r)){i=r;break}i||(i=this._selection.selected.get(0)),d=d.set("anchor",i)}else d=d.update("selected",function(e){return e.add(a)}).set("anchor",a);return this._selection=d,this.emit_change()},a.prototype._setShouldShowDeletedFiles=function(e){var t;return t=e.shouldShowDeletedFiles,this._shouldShowDeletedFiles=Boolean(t),this.emit_change()},a.prototype._setDropTarget=function(e){var t;return t=e.target,this._activeDropTarget=t,this.emit_change()},a.prototype._setCopyMode=function(e){var t;return t=e.copyMode,this._inCopyMode=t,this.emit_change()},a.prototype._sortFiles=function(e,s){var r,o,i,a,l,u,c,d,p;return p=e.sortField,c=e.direction,null==s&&(s=!0),d=c===D.ASCENDING?1:-1,r=function(e,t){var s,r,n,o,i,a,l,u;for(s="=ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=l=0,u=Math.max(e.length,t.length);u>=0?u>l:l>u;o=u>=0?++l:--l){if(r=e.charAt(o),n=t.charAt(o),!r)return-d;if(!n)return d;if(i=s.indexOf(r),a=s.indexOf(n),a>i)return-d;if(i>a)return d}return 0},o=function(e,s){var n,o,i,a,l,u;if(t.isArray(e)&&t.isArray(s)){for(a=l=0,u=Math.max(e.length,s.length);u>=0?u>l:l>u;a=u>=0?++l:--l){if(o=e[a],i=s[a],null==o)return-d;if(null==i)return d;if(t.isNumber(o)&&t.isString(i))return-d;if(t.isNumber(i)&&t.isString(o))return d;if(t.isString(o)&&t.isString(i)){if(n=r(o,i),0!==n)return n}else{if(i>o)return-d;if(o>i)return d}}return 0}return e===s?0:s>e?-d:d},l=function(e,t){var s,r;return s=e.value,r=t.value,o(s,r)},a=function(e,t){var s,r,n,i;return r=e.isFolder,s=e.value,i=t.isFolder,n=t.value,r&&i?o(s,n):r?-d:i?d:o(s,n)},i=function(e,t){var s,r,n,i;return r=e.isFolder,s=e.value,i=t.isFolder,n=t.value,r&&i?o(s,n):r?1:i?-1:""===s?1:""===n?-1:o(s,n)},p===m.FILENAME?(u=n.mac?l:a,this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:e.sort_key}},u)):p===m.MODIFIED?this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:e.ts}},i):p===m.CATEGORY?this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:S.getCategoryDescription(e)}},i):p===m.EXTENSION?this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:S.getExtension(e)}},i):p===m.SIZE&&(this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:-e.bytes}},i)),this._currentSort={sortField:p,direction:c},s?this.emit_change():void 0},a.prototype._setClipboardToSelectedFiles=function(){return this._clipboardFiles=this.selectedFiles(),this.emit_change()},a.prototype._updateRenameState=function(e,r){var n;return r?(n=t.values(I),C(s.call(n,r)>=0,"_updateRenameState received: "+r+", but expected one of: "+n),this._fileRename=new b({file:e,state:r})):this._fileRename=null,this.emit_change()},a.prototype._setNewFolderCreationState=function(e){return this._newFolderCreationState=e,this.emit_change()},a.prototype._setFilePathsToSelectOnNextUpdate=function(e){var t,s;return t=null!=(s=e.fqPathsToSelect)?s:[],this._filePathsToSelectOnNextUpdate=r.Set(t)},a.prototype._addCommentStatusBatch=function(e){var s,r;return s=e.commentStatusByFqPath,r=this._unsortedFiles,t.each(s,function(e){return function(t,s){var n,o;return n=r.get(s),null!=n?(o=n.merge(t),e._insertOrUpdateFile({file:o,forceUpdate:!0})):void 0}}(this)),this.emit_change()},a.prototype._buildFileJumpIndex=function(){return this._fileJumpIndex=this._unsortedFiles.keySeq().toArray().map(function(e){var t;return t=i.filename(e).toLowerCase(),{filename:t,fqPath:e}}),this._fileJumpIndex.sort(function(e,t){var s,r;return s=e.filename,r=t.filename,r>s?-1:s>r?1:0})},a.prototype._addFileJumpKeyCode=function(e){var t,s,r,n,o,i,a,l;for(o=e.keyChar,this._activeFileJumpFilter+=o.toLowerCase(),r=null,a=this._fileJumpIndex,n=0,i=a.length;i>n;n++)if(l=a[n],s=l.fqPath,t=l.filename,t>=this._activeFileJumpFilter){r=s;break}return null!=r?this._selectFqPaths({fqPathsToSelect:[r]}):void 0},a.prototype._resetFileJump=function(){return this._activeFileJumpFilter=""},a.prototype._completeUpload=function(){var e,t;return t=P.fileList().find(function(e){var t;return(t=e.status)===v.PENDING||t===v.UPLOADING}),t?void 0:(e=P.fileList().valueSeq().filter(function(e){return e.status===v.COMPLETE}).map(function(e){return i.normalize(e.dest)+i.normalize(e.name)}),e.every(function(e){return function(t){return e._unsortedFiles.has(t)}}(this))?this._selectFqPaths({fqPathsToSelect:e.toArray()}):this._setFilePathsToSelectOnNextUpdate({fqPathsToSelect:e.toArray()}))},a.prototype._new_payload=function(e){switch(e.action.type){case h.INITIALIZE_EVERYTHING:return this._initializeEverything(e.action.data);case h.LOAD_PATH:return this._setPathData(e.action.data);case h.ADD_FILES:return this._appendFiles(e.action.data);case h.SET_PATH:return this._setPath(e.action.data);case h.SET_USER:return this._setUser(e.action.data);case h.SET_URL_PREFIX:return this._setUrlPrefix(e.action.data);case h.CHANGE_FILES:return this._applyFileDeltas(e.action.data);case h.OPEN_PREVIEW:return this._setPreviewFile(e.action.data);case h.CLOSE_PREVIEW:return this._setPreviewFile(e.action.data);case h.SET_SELECTION:return this._setSelection(e.action.data);case h.SELECT_FILES_BY_FQ_PATH:return this._selectFqPaths(e.action.data);case h.TOGGLE_FQ_PATH_SELECTED:return this._toggleFqPathSelected(e.action.data);case h.SET_LOADING_STATE:return this._setLoadingState(e.action.data);case h.SET_SEARCH_ACTIVE:return this._setSearchActive(e.action.data);case h.SET_MOUNT_POINTS:return this._setMountPoints(e.action.data);case h.SET_SHOULD_SHOW_DELETED_FILES:return this._setShouldShowDeletedFiles(e.action.data);case h.SET_DROP_TARGET:return this._setDropTarget(e.action.data);case h.SET_COPY_MODE:return this._setCopyMode(e.action.data);case h.COPY_SELECTED_FILES_TO_CLIPBOARD:return this._setClipboardToSelectedFiles();case h.SORT_FILES:return this._sortFiles(e.action.data);case h.REQUEST_NEW_FILE_NAME:return this._updateRenameState(e.action.data.file,I.PENDING_INPUT);case h.SET_FILE_RENAME_PENDING:return this._updateRenameState(e.action.data.file,I.SAVING_INPUT);case h.SET_FILE_RENAME_COMPLETE:case h.CANCEL_FILE_RENAME:return this._updateRenameState(e.action.data.file,null);case h.REQUEST_FOLDER_NAME:return this._setNewFolderCreationState(F.PENDING_INPUT);case h.CREATE_FOLDER_PENDING:return this._setNewFolderCreationState(F.SAVING_INPUT);case h.CREATE_FOLDER_COMPLETE:case h.CANCEL_CREATE_FOLDER:return this._setNewFolderCreationState(F.CREATE_FOLDER_INACTIVE);case h.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE:return this._setFilePathsToSelectOnNextUpdate(e.action.data);case h.TEAM_FOLDER_DOWNGRADE:return this._applyTeamFolderDowngrade(e.action.data.nsId);case h.ADD_COMMENT_STATUS_BATCH:return this._addCommentStatusBatch(e.action.data);case h.ADD_FILE_JUMP_KEY_CODE:return this._addFileJumpKeyCode(e.action.data);case h.RESET_FILE_JUMP:return this._resetFileJump();case E.COMPLETE_UPLOAD:return this._completeUpload(e.action.data)}},a}(a),{BrowseStore:new _,File:S,BrowseContext:f,Config:g}})}.call(this),function(){define("modules/clean/react/browse/util",["modules/clean/em_string","modules/clean/filepath","modules/constants/browse","modules/constants/viewer","modules/core/i18n","modules/core/uri"],function(e,t,s,r,n,o){var i,a,l,u;return i=n._,u=n.ungettext,a=function(s){var r,n,o,a,l,c,d,p,h,f,m;return r=13.5,1===s.count()?(a=s.first(),l=t.filename(a.fq_path),o=e.em_snippet(l,r)):s.count()>1&&(n=function(e){return e.isDeleted},h=s.some(n)&&!s.every(n),p=function(){var e,t,r,n;for(r=s.toArray(),n=[],e=0,t=r.length;t>e;e++)d=r[e],d.is_dir&&n.push(d);return n}(),c=function(){var e,t,r,n;for(r=s.toArray(),n=[],e=0,t=r.length;t>e;e++)a=r[e],a.is_dir||n.push(a);return n}(),h?o=i("No available actions"):(f=[],c.length&&(m=u("%(num_files)d file","%(num_files)d files",c.length).format({num_files:c.length}),f.push(m)),p.length&&(m=u("%(num_folders)d folder","%(num_folders)d folders",p.length).format({num_folders:p.length}),f.push(m)),o=2===f.length?i("%(x)s and %(y)s",{comment:'The whole string is a phrase like "2 files and 3 folders". `x` is a string containing a phrase like "2 files" and `y` is a string containing a phrase like "3 folders".'}).format({x:f[0],y:f[1]}):f[0])),o},l=function(e,t,n){return null==n&&(n={}),n[r.UID_PARAM_NAME]=String(t),s.REVISION_HISTORY_WEB?o({path:"/history"+e}).updateQuery(n):o({path:"/revisions"+e}).updateQuery(n)},{describeFiles:a,getRevisionsUri:l}})}.call(this),function(){define("modules/clean/react/columnheader",["jquery","external/react","modules/clean/react/sprite","modules/core/i18n","modules/clean/css","modules/clean/react/css"],function(e,t,s,r,n,o){var i,a,l,u,c,d,p,h,f,m,_;return c=r._,_=t.DOM,f=t.createElement,m=t.addons.classSet,u={ASCENDING:"ASCENDING",DESCENDING:"DESCENDING"},l={STATIC:"STATIC",SINGLE:"SINGLE",MULTI:"MULTI"},a=t.PropTypes.shape({type:t.PropTypes.oneOf([l.STATIC,l.SINGLE,l.MULTI]).isRequired,label:t.PropTypes.string.isRequired,headerClassName:t.PropTypes.string,sortCallback:t.PropTypes.func,switchColumnCallback:t.PropTypes.func,columns:t.PropTypes.arrayOf(t.PropTypes.shape({type:t.PropTypes.oneOf([l.SINGLE]).isRequired,label:t.PropTypes.string.isRequired})),content:t.PropTypes.node}.isRequired),i=t.createClass({displayName:"ColumnHeader",propTypes:{columns:t.PropTypes.arrayOf(a).isRequired,className:t.PropTypes.string,css:t.PropTypes.string,tabbable:t.PropTypes.bool,disabled:t.PropTypes.bool},getDefaultProps:function(){return{tabbable:!0,disabled:!1}},getInitialState:function(){var e,t;return(t=this.props.columns[0].type)===l.STATIC||t===l.SINGLE?e=this.props.columns[0].label:this.props.columns[0].type===l.MULTI&&(e=this.props.columns[0][0].label),{activeColumn:e,cssLoaded:!1}},componentWillMount:function(){return this.props.css?n.require_css(this.props.css,function(e){return function(){return e.setState({cssLoaded:!0})}}(this)):this.setState({cssLoaded:!0})},setActiveColumn:function(e){return this.state.activeColumn!==e?this.setState({activeColumn:e}):void 0},render:function(){var e,t;return this.state.cssLoaded?(e=function(){var e,s,r,n;for(r=this.props.columns,n=[],e=0,s=r.length;s>e;e++)t=r[e],t.type===l.STATIC?n.push(f(h,{key:t.label,label:t.label,className:t.headerClassName||"",content:t.content})):t.type===l.SINGLE?n.push(f(p,{key:t.label,label:t.label,isSelected:t.label===this.state.activeColumn,direction:u.ASCENDING,sortCallback:t.sortCallback,setActiveColumn:this.setActiveColumn,canTriggerSortDirection:!0,className:t.headerClassName||"",tabbable:this.props.tabbable,disabled:this.props.disabled})):t.type===l.MULTI?n.push(f(d,{key:t.columns[0].label,columns:t.columns,setActiveColumn:this.setActiveColumn,activeColumn:this.state.activeColumn,switchColumnCallback:t.switchColumnCallback,tabbable:this.props.tabbable,disabled:this.props.disabled})):n.push(void 0);return n}.call(this),_.ul({role:"row",className:"c-column-header "+this.props.className},e)):_.ul({})}}),h=t.createClass({displayName:"_StaticColumnHeader",propTypes:{label:t.PropTypes.string.isRequired,className:t.PropTypes.string.isRequired,content:t.PropTypes.node},render:function(){return _.li({role:"columnheader",className:"c-column-header__header u-pad-vertical-xs "+this.props.className},null!=this.props.content?this.props.content:void 0,_.span({className:"col-header-contents"},this.props.label))}}),p=t.createClass({displayName:"_SingleColumnHeader",propTypes:{label:t.PropTypes.string.isRequired,className:t.PropTypes.string.isRequired,direction:t.PropTypes.string.isRequired,setActiveColumn:t.PropTypes.func,isSelected:t.PropTypes.bool.isRequired,sortCallback:t.PropTypes.func,canTriggerSortDirection:t.PropTypes.bool.isRequired,multiColumnClick:t.PropTypes.func,nextColumnLabel:t.PropTypes.string,tabbable:t.PropTypes.bool,disabled:t.PropTypes.bool},getDefaultProps:function(){return{tabbable:!0,disabled:!1}},getInitialState:function(){return{sortDirection:this.props.direction}},handleClick:function(e){var t;return t=u.ASCENDING,this.props.isSelected||this.state.sortDirection!==u.ASCENDING&&this.setState({sortDirection:u.ASCENDING}),this.props.canTriggerSortDirection&&this.props.isSelected&&(this.state.sortDirection===u.ASCENDING&&(t=u.DESCENDING),this.setState({sortDirection:t})),this.props.setActiveColumn&&this.props.setActiveColumn(this.props.label),this.props.sortCallback&&this.props.sortCallback(t),this.props.multiColumnClick?this.props.multiColumnClick(e):void 0},render:function(){var e,t,r,n;return this.state.sortDirection===u.DESCENDING?(n="arrow-down-gray",r="descending",e=c("Sort in ascending order")):this.state.sortDirection===u.ASCENDING&&(n="arrow-up-gray",r="ascending",e=c(this.props.isSelected?"Sort in descending order":"Sort in ascending order")),this.props.nextColumnLabel&&(e=c("Swap column to %(nextlabel)s",{comment:"nextlabel is the name of the column that the current column will be replaced with when this button is clicked."}).format({nextlabel:this.props.nextColumnLabel})),t={"u-font-strong":this.props.isSelected},_.li({role:"columnheader","aria-sort":this.props.isSelected?r:"",className:"c-column-header__header u-pad-vertical-xs "+this.props.className},_.button({className:"c-column-header__button u-trim-margin u-trim-padding "+m(t),onClick:this.handleClick,ref:"columnButton",title:e,tabIndex:this.props.tabbable?0:-1,disabled:this.props.disabled},this.props.label,this.props.isSelected?f(s,{group:"web",name:n,alt:"",className:"c-column-header__sort-icon u-mar-left-xxs u-l-ib--m"}):void 0))}}),d=t.createClass({displayName:"_MultiColumnHeader",propTypes:{columns:t.PropTypes.arrayOf(a).isRequired,activeColumn:t.PropTypes.string.isRequired,setActiveColumn:t.PropTypes.func.isRequired,switchColumnCallback:t.PropTypes.func,tabbable:t.PropTypes.bool,disabled:t.PropTypes.bool},getDefaultProps:function(){return{tabbable:!0}},getInitialState:function(){return{currentColumn:0,columnCount:this.props.columns.length}},handleClick:function(e){var t;return t=(this.state.currentColumn+1)%this.state.columnCount,this.setState({currentColumn:t},function(e){return function(){return e.refs.singleColumn.refs.columnButton.getDOMNode().focus()}}(this)),this.props.setActiveColumn(this.props.columns[t].label),this.props.switchColumnCallback(t)},render:function(){var e,t;return e=this.state.currentColumn,t=(this.state.currentColumn+1)%this.state.columnCount,f(p,{canTriggerSortDirection:!1,className:this.props.columns[this.state.currentColumn].headerClassName||"",direction:u.ASCENDING,isSelected:this.props.columns[e].label===this.props.activeColumn,key:this.props.columns[e].label,label:this.props.columns[e].label,multiColumnClick:this.handleClick,nextColumnLabel:this.props.columns[t].label,ref:"singleColumn",sortCallback:this.props.columns[t].sortCallback,tabbable:this.props.tabbable,disabled:this.props.disabled})}}),{ColumnHeader:o(i,["/static/css/components/column-headers-vflS11lNY.css","/static/css/scooter/scooter-scoped-vfljb_RbQ.css"]),SortDirections:u,ColumnTypes:l}})}.call(this),function(){define("modules/clean/react/context_menu_v2",["jquery","external/immutable","external/keymaster","external/react","external/underscore","modules/clean/keycode","modules/clean/react/css","modules/clean/react/sprite_div","modules/core/browser","modules/core/dom","modules/clean/react/browse/constants"],function(e,t,s,r,n,o,i,a,l,u,c){var d,p,h,f,m,_,g,y,S,b;return _=c.MouseEventButton,y=r.createElement,S=r.addons.classSet,b=r.DOM,g="",h=t.Record({icon:null,text:"",shouldShow:!0,isDisabled:!1,onClick:n.noop,href:null,subMenuItems:null}),m=r.createClass({displayName:"GlobalContextMenu",propTypes:{alwaysOpenOnCapture:r.PropTypes.bool,ignoreSelectors:r.PropTypes.string,items:r.PropTypes.arrayOf(h),onMenuOpen:r.PropTypes.func,onMenuClose:r.PropTypes.func},getDefaultProps:function(){return{alwaysOpenOnCapture:!1,ignoreSelectors:"a, input, button, textarea, select",onMenuOpen:n.noop,onMenuClose:n.noop}},getInitialState:function(){return{isMenuOpen:!1}},componentDidMount:function(){return e(document).on("contextmenu.GlobalContextMenu",function(t){return function(s){return 0===e(s.target).closest(t.props.ignoreSelectors).size()?t.toggleMenu(s):t.closeMenu()}}(this)),e(document).on("click.GlobalContextMenu",function(t){return function(s){return s.button!==_.RIGHT&&0===e(s.target).closest(".context-menu").size()?t.closeMenu():void 0}}(this))},componentWillUnmount:function(){return e(document).off(".GlobalContextMenu")},openMenuAtPosition:function(e,t,s){return this.setState({isMenuOpen:!0,left:e,top:t}),this.props.onMenuOpen(s)},closeMenu:function(){return this.state.isMenuOpen?(this.setState({isMenuOpen:!1}),this.props.onMenuClose()):void 0},toggleMenu:function(e){return e.shiftKey?void 0:(e.preventDefault(),this.state.isMenuOpen&&!this.props.alwaysOpenOnCapture?this.closeMenu():this.openMenuAtPosition(e.clientX,e.clientY,e))},render:function(){return b.span({},this.state.isMenuOpen?y(f,{initialLeft:this.state.left,initialTop:this.state.top,onMenuClose:this.closeMenu,items:this.props.items,ref:"contextMenu"}):void 0)}}),p=r.createClass({displayName:"ContextMenuHandler",propTypes:{alwaysOpenOnCapture:r.PropTypes.bool,className:r.PropTypes.string,items:r.PropTypes.arrayOf(h),onMenuOpen:r.PropTypes.func,onMenuClose:r.PropTypes.func},getDefaultProps:function(){return{onMenuOpen:n.noop,onMenuClose:n.noop,alwaysOpenOnCapture:!1}},getInitialState:function(){return{isMenuOpen:!1}},componentDidMount:function(){return e(document).on("click.ContextMenuHandler",function(t){return function(s){return s.button!==_.RIGHT&&0===e(s.target).closest(".context-menu").size()?t.closeMenu():void 0}}(this))},componentWillUnmount:function(){return e(document).off(".ContextMenuHandler")},openMenuAtPosition:function(e,t,s){return this.setState({isMenuOpen:!0,left:e,top:t}),this.props.onMenuOpen(s)},closeMenu:function(){return this.setState({isMenuOpen:!1}),this.props.onMenuClose()},toggleMenu:function(e){return e.shiftKey?void 0:(e.preventDefault(),this.state.isMenuOpen&&!this.props.alwaysOpenOnCapture?this.closeMenu():this.openMenuAtPosition(e.clientX,e.clientY,e))},render:function(){return b.span({className:this.props.className},this.state.isMenuOpen?y(f,{initialLeft:this.state.left,initialTop:this.state.top,onMenuClose:this.closeMenu,items:this.props.items,ref:"contextMenu"}):void 0,b.span({"aria-haspopup":!0,onContextMenuCapture:this.toggleMenu,ref:"contextMenuTarget"},this.props.children))}}),d=r.createClass({displayName:"ContextMenu",propTypes:{initialLeft:r.PropTypes.number,initialTop:r.PropTypes.number,items:r.PropTypes.arrayOf(h),onMenuClose:r.PropTypes.func,onCurrentMenuClose:r.PropTypes.func,level:r.PropTypes.number,shouldAutoSelect:r.PropTypes.bool},getDefaultProps:function(){return{initialLeft:null,initialTop:null,items:null,onMenuClose:n.noop,onCurrentMenuClose:n.noop,level:0,shouldAutoSelect:!1}},getInitialState:function(){return{selectedIndex:null,left:null,right:null,isSubMenuOpen:!1}},componentWillMount:function(){return this.setState({left:this.props.initialLeft,top:this.props.initialTop})},componentDidMount:function(){return g=key.getScope(),key.setScope("ContextMenu"),this.updateCoordinates(),this.refs.contextMenu.getDOMNode().focus(),this.props.shouldAutoSelect?this._selectNextItem():void 0},componentDidUpdate:function(e){return e.items!==this.props.items||e.initialLeft!==this.props.initialLeft||e.initialTop!==this.props.initialTop?(this.setState({selectedIndex:null}),this.updateCoordinates(),this.refs.contextMenu.getDOMNode().focus()):void 0},componentWillUnmount:function(){return key.setScope(g)},_getReachableIndices:function(){var e,t,s,r,n,o;for(n=[],o=this.props.items,e=s=0,r=o.length;r>s;e=++s)t=o[e],t.shouldShow&&!t.isDisabled&&n.push(e);return n},_selectNextItem:function(){var e,t;return e=this._getReachableIndices(),t=null!=this.state.selectedIndex?(e.indexOf(this.state.selectedIndex)+1)%e.length:0,null!=t?this.selectItem(e[t]):void 0},_selectPreviousItem:function(){var e,t;return e=this._getReachableIndices(),t=null!=this.state.selectedIndex?(e.indexOf(this.state.selectedIndex)+e.length-1)%e.length:e.length-1,null!=t?this.selectItem(e[t]):void 0},_handleKeyDown:function(e){var t,s,r,n,i,a,l,u;if(!this.state.isSubMenuOpen)switch(e.keyCode){case o.TAB:return e.preventDefault(),e.stopPropagation();case o.ESC:return this.props.onMenuClose();case o.SPACE:case o.ENTER:if(null!=this.state.selectedIndex)return l=this.props.items[this.state.selectedIndex],this.clickItem(l,e),this.openSubMenu(l,!0),e.preventDefault(),e.stopPropagation();break;case o.DOWN:return this._selectNextItem(),e.preventDefault(),e.stopPropagation();case o.UP:return this._selectPreviousItem(),e.preventDefault(),e.stopPropagation();case o.RIGHT:if(null!=this.state.selectedIndex)return this.openSubMenu(this.props.items[this.state.selectedIndex],!0);break;case o.LEFT:if(this.props.level>0)return this.props.onCurrentMenuClose(),e.preventDefault(),e.stopPropagation();break;default:for(u=String.fromCharCode(e.keyCode),i=this.props.items,a=[],t=r=0,n=i.length;n>r;t=++r)if(s=i[t],s.shouldShow&&!s.isDisabled){if(s.text[0].toUpperCase()===u){this.selectItem(t),e.preventDefault(),e.stopPropagation();break}a.push(void 0)}return a}},openSubMenu:function(e,t){var s;return(null!=(s=e.subMenuItems)?s.length:void 0)>0?this.setState({isSubMenuOpen:!0,shouldAutoSelectSubMenu:t}):void 0},closeSubMenu:function(){return this.refs.contextMenu.getDOMNode().focus(),this.setState({isSubMenuOpen:!1})},selectItemWithMouse:function(e){return this.refs.contextMenu.getDOMNode().focus(),this.selectItem(e,!0,!1)},selectItem:function(e,t,s){return this.setState({selectedIndex:e}),t?this.openSubMenu(this.props.items[e],s):void 0},clickItem:function(e,t){return null!=e.subMenuItems||e.isDisabled?void 0:(null!=e.href?l.redirect(e.href):e.onClick(t),this.props.onMenuClose())},updateCoordinates:function(){var t,s,r,n,o,i,a,l;return t=this.props.initialLeft,a=this.props.initialTop,null!=t&&null!=a&&null!=this.refs.contextMenu&&(l=u.viewport_dimensions(),i=15,o=e(this.refs.contextMenu.getDOMNode()).width(),n=e(this.refs.contextMenu.getDOMNode()).height(),s=l.width-i-o,t>s&&(t=s),r=l.height-i-n,a>r&&(a=r)),this.setState({left:t,top:a})},getSelectedItemDomId:function(){return null!=this.state.selectedIndex?"contextMenu"+this.props.level+"-item"+this.state.selectedIndex:""},_renderItem:function(e,t){var s,r,n,o,i;return n=this.state.selectedIndex===t,r=(null!=(i=e.subMenuItems)?i.length:void 0)>0,o="contextMenu"+this.props.level+"-item"+t,s={"context-menu-item":!0,"context-menu-item--has-submenu":r,"context-menu-item--selected":n,"context-menu-item--disabled":e.isDisabled},b.li({key:o,id:o,"data-action":e.text,className:S(s),role:"menuitem","aria-haspopup":r,"aria-disabled":e.isDisabled,onMouseEnter:function(s){return function(){return e.isDisabled?s.setState({selectedIndex:null}):s.selectItemWithMouse(t)}}(this),onClick:function(t){return function(s){return t.clickItem(e,s)}}(this)},null!=e.icon?y(a,{group:e.icon.group,name:e.icon.name,alt:"",text:e.text}):b.span({},e.text),r?b.span({className:"context-menu-item__accessory c-arrow--right"}):void 0,r&&n&&this.state.isSubMenuOpen?y(d,{initialLeft:null,initialTop:null,className:"context-menu--secondary",level:this.props.level+1,items:e.subMenuItems,onMenuClose:this.props.onMenuClose,onCurrentMenuClose:this.closeSubMenu,shouldAutoSelect:this.state.shouldAutoSelectSubMenu}):void 0)},render:function(){var e,t,s;return null!=this.state.left&&null!=this.state.top&&(s={left:this.state.left,top:this.state.top}),b.ul({id:"contextMenu"+this.props.level,ref:"contextMenu",className:S("no-padding","bubble-dropdown","context-menu",this.props.className),style:s,role:"menu",tabIndex:-1,"aria-activedescendant":this.getSelectedItemDomId(),onKeyDown:this._handleKeyDown},function(){var s,r,n,o;for(n=this.props.items,o=[],e=s=0,r=n.length;r>s;e=++s)t=n[e],t.shouldShow&&o.push(this._renderItem(t,e));return o}.call(this))}}),f=i(d,["/static/css/components/bubble_dropdown-vflBim83A.css","/static/css/scooter/scooter-scoped-vfljb_RbQ.css"]),{GlobalContextMenu:m,ContextMenuHandler:p,ContextMenu:d,ContextMenuItem:h}})}.call(this),function(){define("modules/clean/react/file_modal_controller",["external/react","external/underscore","modules/clean/filepath","modules/clean/react/browse/api","modules/clean/react/css","modules/clean/react/file_modals","modules/clean/react/modal"],function(e,t,s,r,n,o,i){var a,l,u,c,d,p,h,f;return u=o.FileTransferModal,h=o.RestoreFilesModal,p=o.PermanentlyDeleteModal,a=o.DeleteFileModal,c=i.Modal,f=e.createElement,d={COPY:"copy",MOVE:"move"},l=function(){function e(){}return e.showCopy=function(e,t,s){var r,n,o,i,a,l,p;return o=null!=(a=s.onSuccess)?a:null,i=null!=(l=s.onUndo)?l:null,n=null!=(p=s.onRequestNotSent)?p:null,r=f(u,{files:t,operation:d.COPY,user:e,onSuccess:o,onUndo:i,onRequestNotSent:n}),c.showInstance(r)},e.showMove=function(e,t,s,r){var n,o,i,a,l,p,h;return i=null!=(l=r.onSuccess)?l:null,a=null!=(p=r.onUndo)?p:null,o=null!=(h=r.onRequestNotSent)?h:null,n=f(u,{files:t,path:s,operation:d.MOVE,user:e,onSuccess:i,onUndo:a,onRequestNotSent:o}),c.showInstance(n)},e.showRestore=function(e,t,s){var r;return r=f(h,{files:t,userId:e.id,onSuccess:s}),c.showInstance(r)},e.showPermanentlyDelete=function(e,t,s){var r;return r=f(p,{files:t,userId:e.id,onSuccess:s}),c.showInstance(r)},e.showDelete=function(e,t,r,n){var o,i,l;return i=s.filename(r.currentFQPath),l=r.isInsideSharedFolder,o=f(a,{files:t,user:e,parentSharedFolderName:l?i:null,onUndo:n}),c.showInstance(o)},e}(),{FileModalController:l}})}.call(this),function(){define("modules/clean/react/file_modals",["external/react","external/underscore","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/render_partials","modules/clean/react/css","modules/clean/react/react_i18n","modules/clean/react/modal","modules/clean/react/tree_view","modules/clean/file_operations/notifications","modules/clean/filepath","modules/clean/user","modules/core/html","modules/core/i18n"],function(e,t,s,r,n,o,i,a,l,u,c,d,p,h,f){var m,_,g,y,S,b,v,T,w,F,I,D,E,P,C;return S=r.FileTypes,_=n.File,g=o.FileIcon,F=a.R_,v=l.Modal,b=u.FolderTreeView,D=f._,C=f.ungettext,P=e.DOM,E=e.createElement,T={COPY:"copy",MOVE:"move"},w=e.createClass({displayName:"PermanentlyDeleteModal",propTypes:{files:e.PropTypes.arrayOf(_).isRequired,userId:e.PropTypes.number.isRequired},getDefaultProps:function(){return{onSuccess:t.noop}},handlePurged:function(){return c.notifyPurgeSuccess(this.props.files.length),this.props.onSuccess.apply(null,arguments)},handleAccept:function(){return s.purgeFiles({files:this.props.files,userId:this.props.userId,onSuccess:this.handlePurged})},isSingleSharedFolder:function(e){return console.log(e),1===e.length&&e[0].type===S.SHARED_FOLDER},getTitle:function(e){var t;return t=e.length,this.isSingleSharedFolder(e)?D("Remove access to folder?"):C("Permanently delete %(num)s file?","Delete %(num)s items permanently?",t).format({num:t})},renderContent:function(e){var t,s;return t=e.length,1===t?(s=d.filename(e[0].fq_path),this.isSingleSharedFolder(e)?E(F,{filename:s},"Are you sure you want to remove your access to <strong>%(filename)s</strong>? It will no longer be viewable in your list of shared folders, and you won’t be able to re-add it to your Dropbox unless you’re re-invited."):E(F,{filename:s},"Are you sure you want to delete <strong>%(filename)s</strong> from your Dropbox permanently?")):P.span(null,C("Are you sure you want to permanently delete %(num)s item from your Dropbox?","Are you sure you want to permanently delete %(num)s items from your Dropbox?",t).format({num:t}))},render:function(){var e;return e={ref:"modal",title:this.getTitle(this.props.files),acceptButtonText:D(this.isSingleSharedFolder(this.props.files)?"Remove my access":"Delete permanently"),dismissButtonText:D("Cancel"),onAccept:this.handleAccept},E(v,e,this.renderContent(this.props.files))}}),I=e.createClass({displayName:"RestoreFilesModal",propTypes:{files:e.PropTypes.arrayOf(_).isRequired,userId:e.PropTypes.number.isRequired,onSuccess:e.PropTypes.func},getDefaultProps:function(){return{onSuccess:t.noop}},handleRestoreSuccess:function(){return c.notifyRestoreSuccess(this.props.files),this.props.onSuccess.apply(null,arguments)},handleRestoreClick:function(e){return e.preventDefault(),s.restoreFiles({files:this.props.files,userId:this.props.userId,onSuccess:this.handleRestoreSuccess}),this.refs.modal.close()},handleCancelClick:function(e){return e.preventDefault(),this.refs.modal.close()},getTitle:function(e){return C("Restore %(num)s file?","Restore %(num)s items…",e).format({num:e})},renderSingleFileContent:function(e,t){return[E(F,{filename:d.filename(e.fq_path)},D("The most recent version of <strong>%(filename)s</strong> will be restored.")),P.div({className:"file-modal__single-file-row"},E(g,{file:e,className:"file-modal__single-file-row-icon"}),P.a({href:t,className:"file-modal__single-file-row-link"},d.filename(e.fq_path)))]},renderMultiFileContent:function(e){return P.span({},C("Are you sure you want to restore %(num)s item?","Are you sure you want to restore %(num)s items?",e.length).format({num:e.length}))},renderButtons:function(e){return P.div({className:"file-modal__buttons"},e?P.div({className:"file-modal__buttons__alt",ref:"revisionButton"},P.a({href:e},D("View other versions"))):void 0,P.div({className:"file-modal__buttons__main"},P.button({className:"button-primary db-modal-button",onClick:this.handleRestoreClick,ref:"primaryButton"},D("Restore")),P.button({className:"button-tertiary db-modal-button",onClick:this.handleCancelClick,ref:"tertiaryButton"},D("Cancel"))))},render:function(){var e,t,r,n;return t=this.props.files.length,n=null,1===t&&(n=s.getFileHistoryUrl({fqPath:this.props.files[0].fq_path,userId:this.props.userId}).toString()),r={ref:"modal",title:this.getTitle(t),buttonComponent:this.renderButtons(n)},e=1===t?this.renderSingleFileContent(this.props.files[0],n):this.renderMultiFileContent(this.props.files),E(v,r,e)}}),I=i(I,["/static/css/react/file_modal-vfl5O9OmZ.css"]),y=e.createClass({displayName:"FileTransferModal",statics:{Operations:T},propTypes:{files:e.PropTypes.arrayOf(e.PropTypes.shape({fq_path:e.PropTypes.string,is_dir:e.PropTypes.bool})).isRequired,operation:e.PropTypes.oneOf([T.COPY,T.MOVE]).isRequired,user:e.PropTypes.instanceOf(p).isRequired,onSuccess:e.PropTypes.func,onUndo:e.PropTypes.func,onRequestNotSent:e.PropTypes.func,path:e.PropTypes.string},getDefaultProps:function(){return{onSuccess:t.noop}},getInitialState:function(){return{selectedPath:null}},handleOperationSuccess:function(e){var t,s,r;return t=e.changesets,s=this.props.files.length,r=this.props.user,this.props.operation===T.MOVE?c.notifyMoveSuccess(s,r,t,this.state.selectedPath,this.props.onUndo):this.props.operation===T.COPY&&c.notifyCopySuccess(s,r,t,this.state.selectedPath,this.props.onUndo),this.props.onSuccess.apply(null,arguments)},handleAccept:function(){var e,t,r;if(this.props.operation===T.MOVE){if(r=s.moveFiles({path:this.props.path,files:this.props.files,newPath:this.state.selectedPath,userId:this.props.user.id,onSuccess:this.handleOperationSuccess}),!r)return"function"==typeof(e=this.props).onRequestNotSent?e.onRequestNotSent():void 0}else if(this.props.operation===T.COPY&&(r=s.copyFiles({files:this.props.files,newPath:this.state.selectedPath,userId:this.props.user.id,onSuccess:this.handleOperationSuccess}),!r))return"function"==typeof(t=this.props).onRequestNotSent?t.onRequestNotSent():void 0},handleFolderSelected:function(e){return this.setState({selectedPath:e
})},_getTitle:function(){var e,t;return e=this.props.files.length,this.props.operation===T.MOVE?t=this.props.files[0].is_dir?C("Move %(num)s folder to…","Move %(num)s items to…",e,{comment:'"items" is a (potential) mix of files and folders'}):C("Move %(num)s file to…","Move %(num)s items to…",e,{comment:'"items" is a (potential) mix of files and folders'}):this.props.operation===T.COPY&&(t=this.props.files[0].is_dir?C("Copy %(num)s folder to…","Copy %(num)s items to…",e,{comment:'"items" is a (potential) mix of files and folders'}):C("Copy %(num)s file to…","Copy %(num)s items to…",e,{comment:'"items" is a (potential) mix of files and folders'})),t.format({num:e})},_getActionButtonText:function(){return this.props.operation===T.COPY?D("Copy"):this.props.operation===T.MOVE?D("Move"):void 0},handleModalShown:function(){var e;return e=this.refs.treeView.getDOMNode(),e?e.focus():void 0},render:function(){return E(v,{ref:"modal",title:this._getTitle(),acceptButtonText:this._getActionButtonText(),onAccept:this.handleAccept,acceptButtonDisabled:!this.state.selectedPath,autoFocusPrimaryInput:!1,onShow:this.handleModalShown,dismissButtonText:D("Cancel")},E(b,{ref:"treeView",rootPath:"/",user:this.props.user,onFolderSelected:this.handleFolderSelected,isRootSelectable:!0}))}}),m=e.createClass({displayName:"DeleteFileModal",propTypes:{files:e.PropTypes.arrayOf(e.PropTypes.shape({fq_path:e.PropTypes.string,is_dir:e.PropTypes.bool})).isRequired,user:e.PropTypes.instanceOf(p).isRequired,parentSharedFolderName:e.PropTypes.string,onUndo:e.PropTypes.func},getDefaultProps:function(){return{parentSharedFolderName:null}},handleNotify:function(e){var t;return t=e.changesets,c.notifyDeleteSuccess(this.props.files.length,this.props.user,t,this.props.onUndo)},handleAccept:function(){return s.deleteFiles({files:this.props.files,userId:this.props.user.id,onSuccess:this.handleNotify})},_isRemovingSharedFolder:function(){return 1===this.props.files.length&&this.props.files[0].target_ns},_getTitle:function(){var e;return e=this.props.files,e.length<1?"":this._isRemovingSharedFolder()?D("Remove shared folder?"):1===e.length?D(e[0].is_dir?"Delete folder?":"Delete file?"):C("Delete %(item_count)s item?","Delete %(item_count)s items?",e.length).format({item_count:e.length})},_getContents:function(){var e,t,s,r;return e=this.props.files,null==(null!=e?e.length:void 0)||e.length<1?"":(s=d.filename(e[0].fq_path),t=e[0].target_ns,null!=this.props.parentSharedFolderName?(r=this.props.parentSharedFolderName,1===e.length&&t?F({filename:s},"Are you sure you want to remove the shared folder <b>%(filename)s</b> from your Dropbox?"):1===e.length?F({filename:s,shared_folder_name:r},"Are you sure you want to delete <b>%(filename)s</b> from the shared folder ‘%(shared_folder_name)s’?"):C("Are you sure you want to delete %(item_count)s item from the shared folder ‘%(shared_folder_name)s’?","Are you sure you want to delete %(item_count)s items from the shared folder ‘%(shared_folder_name)s’?",e.length).format({item_count:e.length,shared_folder_name:r})):1===e.length&&t?F({filename:s},"Are you sure you want to remove the shared folder <b>%(filename)s</b> from your Dropbox? This shared folder will stay shared with other members and you can re-add it later."):1===e.length?F({filename:s},"Are you sure you want to delete <b>%(filename)s</b> from your Dropbox?"):C("Are you sure you want to delete %(item_count)s item from your Dropbox?","Are you sure you want to delete %(item_count)s items from your Dropbox?",e.length).format({item_count:e.length}))},render:function(){return E(v,{ref:"modal",title:this._getTitle(),onAccept:this.handleAccept,acceptButtonText:D(this._isRemovingSharedFolder()?"Remove":"Delete"),dismissButtonText:D("Cancel")},this._getContents())}}),{FileTransferModal:y,RestoreFilesModal:I,PermanentlyDeleteModal:w,DeleteFileModal:m}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_uploader/actions",["modules/core/i18n","modules/core/exception","modules/clean/flux/dispatcher","modules/clean/filepath","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/plu_wrapper","modules/clean/base64"],function(t,s,r,n,o,i,a){var l,u,c,d,p,h,f,m,_,g,y;return m=t._,_=s.assert,g=n.file_extension,y=n.file_extension_for_logging,f=o.UploaderStore,p=o.UploaderActionTypes,u=o.FileStatus,c=o.FileUpload,d=o.UploadErrorType,l=["pages","key","app","numbers","band","photolibrary","rcproject","rtfd","graffle","logic","logicx","lpdf","sketch","screenflow","scriv","dvdproj","mindnode","cmproj","xcodeproj","imovielibrary","mpkg","imovieproject","1password","agilekeychain","fcpbundle","abbu","mindnode","theater","gameproj","aplibrary","itlp","lrdata","ydevice","bundle","framework","plugin","kext","pkg"],h=function(){function t(){}return t.prototype.initPLU=function(){return i.isInitialized?void 0:(i.init(),i.onFilesAdded(function(t){return function(s){var n,o,i,a,u,c,h,f,_,g;for(o=function(){var e,t,r;for(r=[],e=0,t=s.length;t>e;e++)i=s[e],null==i.size&&r.push(i);return r}(),s=function(){var e,t,r;for(r=[],e=0,t=s.length;t>e;e++)i=s[e],null!=i.size&&r.push(i);return r}(),a=0,c=o.length;c>a;a++)n=o[a],r.dispatch({type:p.ADD_NEW_FAILED_FILE,data:{file:n,errorType:d.EMPTY_OR_FOLDER,errorMessage:m("This folder or empty file could not be uploaded because of browser limitations. Try zipping up the content before uploading it, or use the Dropbox desktop client to sync it.")}});for(f=function(t){var s;return s=y(t.name),e.call(l,s)>=0&&t.size%34===0},g=function(){var e,t,r;for(r=[],e=0,t=s.length;t>e;e++)i=s[e],f(i)&&r.push(i);return r}(),s=function(){var e,t,r;for(r=[],e=0,t=s.length;t>e;e++)i=s[e],f(i)||r.push(i);return r}(),u=0,h=g.length;h>u;u++)_=g[u],r.dispatch({type:p.ADD_NEW_FAILED_FILE,data:{file:_,errorType:d.PACKAGE_FILE,errorMessage:m("This file is a package file and can’t be uploaded directly. To upload a package file via the web, try zipping it first.")}});return o.length&&t.cancelUploads({files:o}),g.length&&t.cancelUploads({files:g}),r.dispatch({type:p.QUEUE_UPLOADS,data:{files:s}}),t._frobPLU()}}(this)),i.onUploadProgress(function(e){var t,s,n,o,a;return f.isUploadCancelled(e.uploadId)?void 0:(o=e.percentUploaded,s=o*f.currentUpload().size/100,a=s+f.totalSizeOfCompletedUploads(),t=i.bytesPerSec(),n=f.fileList().count(function(e){var t;return(t=e.status)===u.PENDING||t===u.UPLOADING}),r.dispatch({type:p.SET_CURRENT_UPLOAD_PROGRESS,data:{percentComplete:o,numSecondsLeft:(f.totalSize()-a)/t+n}}))}),i.onFileUploaded(function(e){return function(t,s){var n;return f.isUploadCancelled(t.uploadId)?void 0:(n=JSON.parse(s.response),"error"in n?(i.removeFiles({files:[t]}),"ignored"===n.error?r.dispatch({type:p.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:d.IGNORED,errorMessage:m("This file was skipped because it’s an internal system file.")}}):r.dispatch({type:p.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:d.GENERIC}})):(_("complete"===n.status),_(n.total_size===t.size),_(n.upload_id===t.uploadId),r.dispatch({type:p.COMPLETE_UPLOAD,data:{uploadId:t.uploadId}})),e._frobPLU())}}(this)),i.onError(function(e){return function(t,s,n){return f.fileList().has(t.uploadId)?r.dispatch({type:p.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:s,errorMessage:n}}):r.dispatch({type:p.ADD_NEW_FAILED_FILE,data:{file:t,errorType:s,errorMessage:n}}),e._frobPLU()}}(this)))},t.prototype.setPath=function(e){var t,s,n;return s=e.path,t=null!=(n=e.hasPermissionToUploadToFolder)?n:!0,s!==f.path()||t!==f.hasPermissionToUploadToFolder()?r.dispatch({type:p.SET_PATH,data:{path:s,hasPermissionToUploadToFolder:t}}):void 0},t.prototype.setUser=function(e){var t;return t=e.user,r.dispatch({type:p.SET_USER,data:{user:t}})},t.prototype.setNumDraggingFiles=function(e){var t,s,n;return s=e.numDraggingFiles,t=null!=(n=e.isInternalTransfer)?n:!1,r.dispatch({type:p.SET_NUM_DRAGGING_FILES,data:{numDraggingFiles:s,isInternalTransfer:t}})},t.prototype.addFilesToPLU=function(e){var t;return t=e.files,i.addFiles({files:t}),this.setIsInlineStatusDismissed({isInlineStatusDismissed:!1})},t.prototype.addDirectoriesToPLU=function(t){var s,n,o,i,a,u,c,h,_,g,S,b;for(n=t.directoryEntries,s=f.path(),i=[],h=0,a=function(e){return function(){var t;return(t=function(){var s,r,n;return i.length>0?(n=i.pop(),r=n.entry,s=n.dest,r.file(function(r){return e.setPath({path:s}),e.addFilesToPLU({files:[r]}),t()})):void 0})()}}(this),_=function(e){var t,r;return h+=1,r=e.createReader(),(t=function(){return r.readEntries(function(r){var n,o,l;if(r.length>0){for(n=0,o=r.length;o>n;n++)l=r[n],l.isDirectory?_(l):i.push({entry:l,dest:s+e.fullPath});return t()}return h-=1,0===h?a():void 0})})()},S=[],u=0,c=n.length;c>u;u++)b=n[u],g=y(b.name),e.call(l,g)>=0?(o=new File({name:b.name,dest:s}),S.push(r.dispatch({type:p.ADD_NEW_FAILED_FILE,data:{file:o,errorType:d.PACKAGE_FILE,errorMessage:m('Due to browser limitations, OSX package files files cannot be uploaded using drag-and-drop. Please try using the "Upload…" dialog.')}}))):S.push(_(b));return S},t.prototype.setIsUploadModalOpen=function(e){var t;return t=e.isUploadModalOpen,r.dispatch({type:p.SET_IS_UPLOAD_MODAL_OPEN,data:{isUploadModalOpen:t}})},t.prototype.setIsInlineStatusDismissed=function(e){var t;return t=e.isInlineStatusDismissed,r.dispatch({type:p.SET_IS_INLINE_STATUS_DISMISSED,data:{isInlineStatusDismissed:t}})},t.prototype.cancelUploads=function(e){var t;return t=e.files,i.removeFiles({files:t}),r.dispatch({type:p.CANCEL_UPLOADS,data:{files:t}}),this._frobPLU()},t.prototype._startUpload=function(e){var t,s,n,o;return s=e.file,r.dispatch({type:p.START_UPLOAD,data:{file:s}}),o="url"===(n=g(s.name,t=!0))||"webloc"===n||"website"===n?0:1,i.setAjaxParams({dest:s.dest,reported_total_size:s.size,uploadId:s.uploadId,_subject_uid:s.userId,offset:0,overwrite:o}),i.start(),!0},t.prototype._frobPLU=function(){var e;return e=f.nextUpload(),null!=e&&null==f.currentUpload()?(_(e instanceof c),this._startUpload({file:e})):void 0},t}(),{UploaderDispatcher:r,UploaderActions:new h}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/react/file_uploader/plu_wrapper",["jquery","modules/core/exception","external/plupload_dev","external/react","external/underscore","modules/clean/static_urls","modules/core/cookies","modules/clean/react/file_uploader/store","modules/constants/request","modules/constants/env","modules/core/i18n"],function(t,s,r,n,o,i,a,l,u,c,d){var p,h,f,m,_,g,y,S,b,v,T;return b=s.assert,g=i.UrlConstants,_=l.UploaderStore,p=l.FileUpload,m=l.UploadErrorType,v=l.generateUploadId,y=d._,T=window.plupload,S=function(e,t){var s,r;return null==t&&(t={}),s=o.extend({},t,e),new p({uploadId:s.uploadId,dest:s.dest,name:s.name,size:s.size,userId:s.userId,percentUploaded:null!=(r=s.percent)?r:0})},f=function(){function s(){this.removeFiles=e(this.removeFiles,this),this.bytesPerSec=e(this.bytesPerSec,this),this.onError=e(this.onError,this),this.onFileUploaded=e(this.onFileUploaded,this),this.onUploadProgress=e(this.onUploadProgress,this),this.onFilesAdded=e(this.onFilesAdded,this),this.setBrowseButton=e(this.setBrowseButton,this),this.setAjaxParams=e(this.setAjaxParams,this),this.start=e(this.start,this),this.addFiles=e(this.addFiles,this),this.init=e(this.init,this),this.isInitialized=!1}return s.prototype.idToUploadIdMap={},s.prototype.PLU_CONTAINER_ID="flash-upload-container",s.prototype.init=function(){var e;if(!this.isInitialized)return this.isInitialized=!0,this.$secretBrowseButton=t("<button>").addClass("secret-file-uploader-button").hide().appendTo(t("body")),this.$pluContainer=t("<div>").attr("id",this.PLU_CONTAINER_ID).css({position:"absolute",left:-2e3}).appendTo(t("body")),this.$currentExternalBrowseButton=t(),e={url:"https://"+c.BLOCK_CLUSTER+"/chunked_upload",file_data_name:"file",runtimes:this._runtimes,multipart_params:{},multipart:!1,max_file_size:"50000mb",chunk_size:"8mb",max_retries:2,browse_button:this.$secretBrowseButton[0],container:this.PLU_CONTAINER_ID,flash_swf_url:g.MOXIE_SWF_URL,init:{ChunkUploaded:function(e){return function(t,s,r){var n,o;return o=e.idToUploadIdMap[s.id],b(JSON.parse(r.response).upload_id===o),n=_.fileList().get(o),e.setAjaxParams({dest:n.dest,reported_total_size:n.size,uploadId:o,_subject_uid:n.userId,offset:r.offset,overwrite:1})}}(this)}},this.uploader=new T.Uploader(e),this.uploader.init()},s.prototype._runtimes=function(){var e,t,s,r,n;r={"MSIE 8.0":"flash","MSIE 9.0":"flash"},s="html5";for(e in r)n=r[e],-1!==(null!=(t=navigator.userAgent)?t.indexOf(e):void 0)&&(s=n);return s}(),s.prototype.addFiles=function(e){var t;return t=e.files,this.isInitialized||this.init(),this.uploader.addFile(t)},s.prototype.start=function(){return this.isInitialized||this.init(),this.uploader.start()},s.prototype.setAjaxParams=function(e){var t,s,r,n,o,i;if(o=e.reported_total_size,s=e.dest,i=e.uploadId,r=e.offset,t=e._subject_uid,n=e.overwrite,this.isInitialized||this.init(),null==o||null==s||null==i||null==r||null==t||null==n)throw new Error("A required parameter to setAjaxParams was not given.");return this.uploader.settings.multipart_params={t:a.read(u.JS_CSRF_COOKIE),reported_total_size:o,dest:s,upload_id:i,offset:r,_subject_uid:t,overwrite:n}},s.prototype.setBrowseButton=function(e){var s;return this.isInitialized||this.init(),"flash"===this.uploader.runtime?(this.$currentExternalBrowseButton=t(e),this.$currentExternalBrowseButton.length?(t("#"+this.PLU_CONTAINER_ID).show().css({"z-index":1e3,position:"absolute",top:this.$currentExternalBrowseButton.offset().top,left:this.$currentExternalBrowseButton.offset().left,width:this.$currentExternalBrowseButton.outerWidth(),height:this.$currentExternalBrowseButton.outerHeight()}),s=t("#"+this.PLU_CONTAINER_ID+" > .moxie-shim"),s[0].style.top="0px",s[0].style.left="0px",s[0].style.width="100%",s[0].style.height="100%"):t("#"+this.PLU_CONTAINER_ID).hide()):(this.$currentExternalBrowseButton.off("click.PLUBrowseButton"),this.$currentExternalBrowseButton=t(e),this.$currentExternalBrowseButton.on("click.PLUBrowseButton",function(e){return function(){return e.$secretBrowseButton.click()}}(this)))},s.prototype.onFilesAdded=function(e){return this.isInitialized||this.init(),this.uploader.bind("FilesAdded",function(t){return function(s,r){var n;return n=r.map(function(e){var s;return s=v(),t.idToUploadIdMap[e.id]=s,S(e,{uploadId:s,dest:_.path(),userId:_.user().id})}),e(n)}}(this))},s.prototype.onUploadProgress=function(e){return this.isInitialized||this.init(),this.uploader.bind("UploadProgress",function(t){return function(s,r){var n,o;return o=t.idToUploadIdMap[r.id],n=_.fileList().get(o),e(n.set("percentUploaded",r.percent))}}(this))},s.prototype.onFileUploaded=function(e){return this.isInitialized||this.init(),this.uploader.bind("FileUploaded",function(t){return function(s,r,n){var o,i;return i=t.idToUploadIdMap[r.id],o=_.fileList().get(i),e(o,n)}}(this))},s.prototype.onError=function(e){return this.isInitialized||this.init(),this.uploader.bind("Error",function(t){return function(s,r){var n,o,i,a;if(null==r.file)throw new Error("PLU error without an associated file.");return o=function(){switch(r.code){case T.FILE_SIZE_ERROR:return m.FILE_SIZE_ERROR;case T.HTTP_ERROR:return 0===r.status?m.CONNECTION_ERROR:507===r.status?m.OVER_QUOTA_ERROR:m.HTTP_ERROR;default:return m.GENERIC}}(),n=function(){switch(o){case m.OVER_QUOTA_ERROR:return y("This file can’t be uploaded because you are over your storage quota. If you believe this message to be in error, try refreshing the page.");case m.FILE_SIZE_ERROR:return y("This file is too large to upload using the Dropbox website. Please use the desktop client.");case m.HTTP_ERROR:return y("Something went wrong while uploading this file. There was a server error during the upload request. If the problem persists, please try the basic uploader.");case m.CONNECTION_ERROR:return y("Something went wrong while uploading this file. Check your connection to the internet and try again.");default:return y("Something went wrong while uploading this file. If the problem persists, please try the basic uploader.")}}(),a=t.idToUploadIdMap[r.file.id],i=_.fileList().has(a)?_.fileList().get(a):S(r.file,{uploadId:v(),dest:_.path()}),e(i,o,n)}}(this))},s.prototype.bytesPerSec=function(){var e;return this.isInitialized||this.init(),null!=(e=this.uploader.total)?e.bytesPerSec:void 0},s.prototype.removeFiles=function(e){var t,s,r,n,i,a;for(s=e.files,this.isInitialized||this.init(),a=[],r=0,n=s.length;n>r;r++)t=s[r],i=o.find(this.uploader.files,function(e){return function(s){return e.idToUploadIdMap[s.id]===t.uploadId}}(this)),a.push(this.uploader.removeFile(i));return a},s}(),h=new f})}.call(this),function(){var e=function(e,s){function r(){this.constructor=e}for(var n in s)t.call(s,n)&&(e[n]=s[n]);return r.prototype=s.prototype,e.prototype=new r,e.__super__=s.prototype,e},t={}.hasOwnProperty;define("modules/clean/react/file_uploader/store",["external/immutable","modules/clean/base64","modules/clean/flux/base_store","modules/clean/react/browse/constants","modules/core/browser","modules/core/exception"],function(t,s,r,n,o,i){var a,l,u,c,d,p,h,f,m;return a=n.BrowseActionTypes,f=i.assert,p={SET_PATH:"UPLOADER_SET_PATH",SET_USER:"UPLOADER_SET_USER",SET_NUM_DRAGGING_FILES:"SET_NUM_DRAGGING_FILES",QUEUE_UPLOADS:"QUEUE_UPLOADS",START_UPLOAD:"START_UPLOAD",COMPLETE_UPLOAD:"COMPLETE_UPLOAD",CANCEL_UPLOADS:"CANCEL_UPLOADS",SET_CURRENT_UPLOAD_PROGRESS:"SET_CURRENT_UPLOAD_PROGRESS",UPLOAD_ERROR:"UPLOAD_ERROR",SET_IS_UPLOAD_MODAL_OPEN:"SET_IS_UPLOAD_MODAL_OPEN",SET_IS_INLINE_STATUS_DISMISSED:"SET_IS_INLINE_STATUS_DISMISSED",ADD_NEW_FAILED_FILE:"ADD_NEW_FAILED_FILE"},l={PENDING:"PENDING",UPLOADING:"UPLOADING",COMPLETE:"COMPLETE",CANCELLED:"CANCELLED",FAILED:"FAILED"},d={FILE_SIZE_ERROR:"FILE_SIZE_ERROR",HTTP_ERROR:"HTTP_ERROR",CONNECTION_ERROR:"CONNECTION_ERROR",OVER_QUOTA_ERROR:"OVER_QUOTA_ERROR",IGNORED:"IGNORED",EMPTY_OR_FOLDER:"EMPTY_OR_FOLDER",PACKAGE_FILE:"PACKAGE_FILE",GENERIC:"GENERIC"},c=o.msie?"text":"application/x-dropbox-file-list",u=t.Record({uploadId:void 0,dest:"",userId:null,name:"",size:0,percentUploaded:0,status:l.PENDING,errorType:d.GENERIC,errorMessage:""}),m=function(){var e,t,r,n;for(e="",t=r=0;15>=r;t=++r)e+=String.fromCharCode(Math.floor(256*Math.random()));return n=s.encode(e),n=n.replace(/\+/g,"-"),n=n.replace(/\//g,"_"),n=n.replace(/\=*$/,"")},h=function(s){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,s),r.prototype._init=function(){return this._path="/",this._hasPermissionToUploadToFolder=!0,this._user=null,this._fileList=t.OrderedMap(),this._currentUploadId=null,this._numDraggingFiles=0,this._isInternalTransfer=!1,this._isUploadModalOpen=!1,this._isInlineStatusDismissed=!1,this._numSecondsLeft=0},r.prototype.fileList=function(){return this._fileList},r.prototype.currentUpload=function(){return this._fileList.get(this._currentUploadId)},r.prototype.currentUploadPercentage=function(){return this.currentUpload().percentUploaded},r.prototype.numSecondsLeft=function(){return this._numSecondsLeft},r.prototype.isUploadCancelled=function(e){var t;return(null!=(t=this._fileList.get(e))?t.status:void 0)===l.CANCELLED},r.prototype.isInlineStatusDismissed=function(){return this._isInlineStatusDismissed},r.prototype.path=function(){return this._path},r.prototype.hasPermissionToUploadToFolder=function(){return this._hasPermissionToUploadToFolder},r.prototype.user=function(){return this._user},r.prototype.nextUpload=function(){return this._fileList.find(function(e){return e.status===l.PENDING})},r.prototype.numDraggingFiles=function(){return this._numDraggingFiles},r.prototype.isInternalTransfer=function(){return this._isInternalTransfer},r.prototype.totalSizeOfCompletedUploads=function(){return this._fileList.reduce(function(e,t){return t.status===l.COMPLETE?e+t.size:e},0)},r.prototype.totalSize=function(){return this._fileList.reduce(function(e,t){var s;return(s=t.status)===l.COMPLETE||s===l.PENDING||s===l.UPLOADING?e+t.size:e},0)},r.prototype.isUploadModalOpen=function(){return this._isUploadModalOpen},r.prototype._setUser=function(e){var t;return t=e.user,this._user=t,this.emit_change()},r.prototype._setPath=function(e){var t,s,r;return s=e.path,t=null!=(r=e.hasPermissionToUploadToFolder)?r:!0,this._path=s,this._hasPermissionToUploadToFolder=t,this.emit_change()},r.prototype._initializeEverything=function(e){var t,s,r;return r=e.user,s=e.path,t=e.context,this._user=r,this._path=s,this._hasPermissionToUploadToFolder=t.isCurrentPathWriteable(),this.emit_change()},r.prototype._queueUploads=function(e){var t,s,r,n,o;for(s=e.files,o={},r=0,n=s.length;n>r;r++)t=s[r],o[t.uploadId]=t;return this._fileList=this._fileList.merge(o),this.emit_change()},r.prototype._startUpload=function(e){var t;return t=e.file,f(null==this._currentUpload),f(null!=t),f(this._fileList.get(t.uploadId)===t),this._fileList=this._fileList.update(t.uploadId,function(e){return e.set("status",l.UPLOADING)}),this._currentUploadId=t.uploadId,this.emit_change()},r.prototype._completeUpload=function(e){var t,s;return t=e.uploadId,s=this._fileList.find(function(e){return e.status===l.UPLOADING}),f(t===(null!=s?s.uploadId:void 0)),this._fileList=this._fileList.update(s.uploadId,function(e){return e.set("status",l.COMPLETE)}),this._currentUploadId=null,this.emit_change()},r.prototype._cancelUploads=function(e){var t,s,r,n;for(s=e.files,r=0,n=s.length;n>r;r++)t=s[r],this._fileList=this._fileList.update(t.uploadId,function(e){var t;return(t=e.status)===l.PENDING||t===l.UPLOADING?e.set("status",l.CANCELLED):e}),t.uploadId===this._currentUploadId&&(this._currentUploadId=null);return this.emit_change()},r.prototype._setCurrentUploadProgress=function(e){var t,s;return s=e.percentComplete,t=e.numSecondsLeft,this._fileList=this._fileList.update(this._currentUploadId,function(e){return e.set("percentUploaded",s)}),this._numSecondsLeft=t,this.emit_change()},r.prototype._handleUploadError=function(e){var t,s,r,n;return n=e.uploadId,s=e.errorType,t=e.errorMessage,r=this._fileList.get(n),f(r.uploadId===this._currentUploadId),this._fileList=this._fileList.update(r.uploadId,function(e){return e.set("status",l.FAILED).set("errorType",s).set("errorMessage",t)}),this._currentUploadId=null,this.emit_change()},r.prototype._setNumDraggingFiles=function(e){var t,s,r;return s=e.numDraggingFiles,t=null!=(r=e.isInternalTransfer)?r:!1,this._numDraggingFiles=s,this._isInternalTransfer=t,this.emit_change()},r.prototype._setIsUploadModalOpen=function(e){var t;return t=e.isUploadModalOpen,this._isUploadModalOpen=t,this.emit_change()},r.prototype._setIsInlineStatusDismissed=function(e){var t;return t=e.isInlineStatusDismissed,this._isInlineStatusDismissed=t,this.emit_change()},r.prototype._addNewFailedFile=function(e){var t,s,r;return r=e.file,s=e.errorType,t=e.errorMessage,null==r.uploadId&&(r=r.set("uploadId",m())),r=r.set("status",l.FAILED).set("errorType",s).set("errorMessage",t),this._fileList=this._fileList.set(r.uploadId,r),this.emit_change()},r.prototype._new_payload=function(e){switch(e.action.type){case a.INITIALIZE_EVERYTHING:return this._initializeEverything(e.action.data);case a.SET_USER:case p.SET_USER:return this._setUser(e.action.data);case a.SET_PATH:case p.SET_PATH:return this._setPath(e.action.data);case p.QUEUE_UPLOADS:return this._queueUploads(e.action.data);case p.START_UPLOAD:return this._startUpload(e.action.data);case p.COMPLETE_UPLOAD:return this._completeUpload(e.action.data);case p.CANCEL_UPLOADS:return this._cancelUploads(e.action.data);case p.SET_CURRENT_UPLOAD_PROGRESS:return this._setCurrentUploadProgress(e.action.data);case p.UPLOAD_ERROR:return this._handleUploadError(e.action.data);case p.SET_NUM_DRAGGING_FILES:return this._setNumDraggingFiles(e.action.data);case p.SET_IS_UPLOAD_MODAL_OPEN:return this._setIsUploadModalOpen(e.action.data);case p.SET_IS_INLINE_STATUS_DISMISSED:return this._setIsInlineStatusDismissed(e.action.data);case p.ADD_NEW_FAILED_FILE:return this._addNewFailedFile(e.action.data)}},r}(r),{UploaderStore:new h,UploaderActionTypes:p,FileUpload:u,FileStatus:l,UploadErrorType:d,generateUploadId:m,INTERNAL_FILE_DATA_TRANSFER_TYPE:c}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_uploader/uploader",["jquery","external/immutable","external/react","external/underscore","modules/clean/browse_interface","modules/clean/browse/browse_drag_utils","modules/clean/datetime","modules/clean/display_format","modules/clean/em_string","modules/clean/filepath","modules/clean/flux/store_mixin","modules/clean/react/button","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/flag","modules/clean/react/image","modules/clean/react/modal","modules/clean/react/react_i18n","modules/clean/react/sprite","modules/clean/react/tooltip","modules/clean/static_urls","modules/clean/viewer","modules/constants/env","modules/constants/request","modules/core/browser","modules/core/cookies","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri"],function(t,s,r,n,o,i,a,l,u,c,d,p,h,f,m,_,g,y,S,b,v,T,w,F,I,D,E,P,C,R,N){var O,A,x,M,L,U,k,B,q,H,G,V,W,j,z,K,Q,Y,J,X,Z,$,ee,te,se,re,ne,oe,ie,ae,le,ue,ce,de,pe;return re=o.get_browse_root_name,Y=o.browse_uri_for_fq_path,J=p.button,W=h.UploaderActions,j=f.UploaderStore,A=f.FileUpload,O=f.FileStatus,V=f.UploadErrorType,L=f.INTERNAL_FILE_DATA_TRANSFER_TYPE,k=y.Modal,q=S.R_,B=S.RP_,H=v.Tooltip,G=v.TooltipPosition,ce=T.static_url,z=C._,pe=C.ungettext,X=r.createElement,Z=r.addons.classSet,le=r.DOM,ee=le.div,Q=le.a,de=le.ul,ie=le.ol,oe=le.li,ue=le.span,ne=le.input,se=le.form,ae=le.p,$=r.DOM,K=function(e){var t,s,r,n,o,i,a,l;return null==e&&(e={}),a=e.user,r=e.path,s=null!=(n=e.maxLength)?n:1e3,l=w.get_viewer(),l.is_paired&&a.is_team&&(i=u.em_snippet(l.team_name,s)),o="/"===r?l.is_paired?a.is_team?z(" upload to your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({team_name:i}):z(" upload to your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}):z(" upload to your Dropbox"):(t=u.em_snippet(c.filename(r),s),l.is_paired?a.is_team?z(" upload to the folder ‘%(folder)s’ in your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t,team_name:i}):z(" upload to the folder ‘%(folder)s’ in your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}):z(" upload to the folder ‘%(folder)s’",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}))},M=r.createClass({displayName:"FileUploaderModal",mixins:[d(j)],DROPZONE_ID:"upload-modal-dropzone",propTypes:{dragAndDropEnabled:r.PropTypes.bool,shouldShowDestinationLink:r.PropTypes.bool,onModalDismissed:r.PropTypes.func,clickOutToClose:r.PropTypes.bool},getDefaultProps:function(){return{dragAndDropEnabled:!0,shouldShowDestinationLink:!0,onModalDismissed:function(){},clickOutToClose:!0}},getInitialState:function(){return{usingBasicUploader:!1,basicUploaderFile:null}},_get_state_from_stores:function(){return{path:j.path(),user:j.user(),fileList:j.fileList(),numDraggingFiles:j.numDraggingFiles(),currentUpload:j.currentUpload(),numSecondsLeft:j.numSecondsLeft(),hasPermissionToUploadToFolder:j.hasPermissionToUploadToFolder()}},componentDidMount:function(){return this._setBrowseButton(),t(window).on("resize.uploaderModal",function(e){return function(){return e._setBrowseButton()}}(this))},componentDidUpdate:function(e,s){var r,n,o,i,a;return this._setBrowseButton(),this.state.numDraggingFiles?this.state.usingBasicUploader?R.error("You can‖t drag and drop upload right now."):(r=t(this.refs.modal.refs.modalBox.getDOMNode()).find("#"+this.DROPZONE_ID),r.length||t("#"+this.DROPZONE_ID).clone().prependTo(t(this.refs.modal.refs.modalBox.getDOMNode())).css({width:"100%",height:"100%",position:"absolute",opacity:0}).show().fadeTo(500,1)):t(this.refs.modal.getDOMNode()).find("#"+this.DROPZONE_ID).remove(),this.state.fileList.count()>s.fileList.count()&&(i=t(this.refs.uploadFilesList.getDOMNode()),n=null!=(a=i.find(".upload-file"))?a.eq(s.fileList.count()):void 0,n.length&&i.scrollTop(i.scrollTop()+n.position().top)),o=t(this.getDOMNode()),o.find(".basic-uploader-link").off("click.switchUploader").on("click.switchUploader",function(e){return function(t){return t.preventDefault(),e.setState({usingBasicUploader:!0})}}(this)),o.find(".enhanced-uploader-link").off("click.switchUploader").on("click.switchUploader",function(e){return function(t){return t.preventDefault(),e.setState({usingBasicUploader:!1})}}(this))},componentWillUnmount:function(){return m.setBrowseButton(null),t(window).off("resize.uploaderModal")},FILENAME_SNIPPET_LENGTH:15,DEST_SNIPPET_LENGTH:13,_setBrowseButton:function(){var e;return m.setBrowseButton(null!=(e=this.refs.pluFileChooseButton)?e.getDOMNode():void 0)},_handleClose:function(){var e,t;t=this.state.fileList.find(function(e){var t;return(t=e.status)===O.PENDING||t===O.UPLOADING}),t||W.setIsInlineStatusDismissed({isInlineStatusDismissed:!0}),W.setIsUploadModalOpen({isUploadModalOpen:!1}),k.close(),"function"==typeof(e=this.props).onModalDismissed&&e.onModalDismissed()},_handleCancel:function(e){return W.cancelUploads({files:[e]})},_handleBasicChooseButtonMouseClick:function(e){return null!=this.refs.fileInput?t(this.refs.fileInput.getDOMNode()).click():void 0},_handleBasicFileInputChange:function(e){var t,s,r,n,o;return r=this.refs.fileInput.getDOMNode(),s=null!=(n=r.files)&&"function"==typeof n.item?n.item(0):void 0,o=r.value,null!=s?this.setState({basicUploaderFile:new A({name:s.name,size:s.size,dest:this.state.path,userId:this.state.user.id,percentUploaded:100,status:O.UPLOADING})},function(e){return function(){return e.refs.basicUploadForm.getDOMNode().submit()}}(this)):null!=o?(t="C:\\fakepath\\",0===o.indexOf(t)?this.setState({basicUploaderFile:new A({name:o.slice(t.length),size:null,dest:this.state.path,userId:this.state.user.id,percentUploaded:100,status:O.UPLOADING})},function(e){return function(){return e.refs.basicUploadForm.getDOMNode().submit()}}(this)):this.refs.basicUploadForm.getDOMNode().submit()):void 0},_renderIntroModalButtons:function(){var e,t,s;return e=$.div({className:"u-font-small"},null!=this.state.basicUploaderFile?z("This may take a while depending on the size of the file."):this.state.usingBasicUploader?q({},'Uploading multiple files? Try our <a class="enhanced-uploader-link" href="#">enhanced uploader</a>.'):q({},'Having problems? Try the <a class="basic-uploader-link" href="#">basic uploader</a>.')),t=null,s=null,this.state.usingBasicUploader?null==this.state.basicUploaderFile&&(t=$.button({className:"dbmodal-button c-btn c-btn--primary",onClick:this._handleBasicChooseButtonMouseClick},z("Choose a file"))):t=$.button({ref:"pluFileChooseButton",className:"dbmodal-button c-btn c-btn--primary"},z("Choose files")),null==this.state.basicUploaderFile&&(s=$.button({importance:"tertiary",className:"dbmodal-button c-btn c-btn--secondary u-mar-left-s",onClick:this._handleClose},z("Cancel"))),$.div({className:"u-mar-top-l"},X(_,{spacing:"s",rightAttachment:$.div({},t,s)},e))},_renderFileListModalButtons:function(){var e,t,s,r;return s=this.state.fileList.find(function(e){var t;return(t=e.status)===O.PENDING||t===O.UPLOADING}),t=s?"tertiary":"primary",r=$.button({ref:"pluFileChooseButton",className:"dbmodal-button c-btn c-btn--secondary"},z("Add more files")),e=$.button({className:"dbmodal-button c-btn c-btn--"+t,onClick:this._handleClose},z(s?"Hide":"Done")),$.div({className:"u-mar-top-s"},X(_,{leftAttachment:r,
rightAttachment:e,spacing:"s"},$.div({className:"u-font-small"},s?void 0:q({},'Having problems? Try the <a class="basic-uploader-link" href="#">basic uploader</a>.'))))},_renderIntroMessage:function(){var e;return e=K({user:this.state.user,path:this.state.path}),$.span({},this.state.usingBasicUploader?q({comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"',upload_folder_name:e},"Choose a file to %(upload_folder_name)s. The basic uploader can only upload one file at a time."):this.props.dragAndDropEnabled?q({comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"',upload_folder_name:e},"Choose files to %(upload_folder_name)s. You can select more than one file at a time. You can also drag and drop files anywhere on this page to start uploading."):q({comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"',upload_folder_name:e},"Choose files to %(upload_folder_name)s. You can select more than one file at a time."))},_renderDropzone:function(){return $.div({ref:"dropzone",id:this.DROPZONE_ID,style:{display:"none"}},$.div({},B({comment:"upload_action is a phrase like 'upload to folder 'XYZ'",n:this.state.numDraggingFiles,upload_action:K({user:this.state.user,path:this.state.path,maxLength:20})},"Drop your file to %(upload_action)s","Drop your files to %(upload_action)s")))},_renderFileListRowStatus:function(e){var t;return $.div({className:"status-col"},e.status===O.UPLOADING&&100===e.percentUploaded?X(g,{src:ce("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),srcHiRes:ce("/static/images/icons/ajax-loading-small@2x-vflAxdZTP.gif")}):(t=e.status)===O.PENDING||t===O.UPLOADING?$.button({className:"button-as-link",onClick:function(t){return function(s){return s.preventDefault(),t._handleCancel(e)}}(this)},X(b,{group:"web",name:"xclose",alt:z("Cancel")})):e.status===O.COMPLETE?X(b,{group:"web",name:"s_check",alt:z("Upload successful")}):e.status===O.CANCELLED?X(g,{src:ce("/static/images/cancelsync-vflGFIEUK.png"),srcHiRes:ce("/static/images/cancelsync@2x-vflzmHGI0.png"),alt:z("Upload cancelled")}):e.status===O.FAILED?X(g,{src:ce("/static/images/nosync-vfl18cuTS.png"),srcHiRes:ce("/static/images/nosync@2x-vflgS4F07.png"),alt:z("Error")}):void 0)},_renderFileListRowError:function(e){var t,s;return t=(null!=(s=e.errorMessage)?s.length:void 0)>0?e.errorMessage:z("Something went wrong while uploading this file. If the problem persists, please try the basic uploader."),$.div({className:"error-col"},$.span({className:"error-msg"},z(e.errorType===V.FILE_SIZE_ERROR?"File too large":"Upload Error")),$.span({className:"error-details"},X(H,{position:G.RIGHT,tooltip_contents:$.div({},t),tooltip_classname:"upload-error-tooltip"},X(b,{group:"web",name:"information",alt:z("More information")}))))},_renderFileListRowDest:function(e){var t,s;return $.div({className:"dest-col"},e.status===O.CANCELLED?z("Canceled"):(s=w.get_viewer().get_user_by_id(e.userId),t=re(s),$.a({href:Y(s,e.dest).toString()},u.em_snippet(""+t+e.dest,this.DEST_SNIPPET_LENGTH,0))))},_renderFileListRow:function(e,t){var s,r;return s=e.status===O.UPLOADING?e.percentUploaded:e.status===O.PENDING?0:100,r={"upload-file":!0,complete:e.status===O.COMPLETE,cancelled:e.status===O.CANCELLED,error:e.status===O.FAILED},$.li({className:Z(r),key:e.uploadId},$.div({className:"upload-progress-bar",style:{width:s+"%"}}),$.div({className:"upload-file-info",style:{overflow:"hidden"}},$.div({className:"filename-col"},X(b,{group:"web",name:c.file_icon(e.name),alt:""}),$.span({className:"filename"},u.em_snippet(e.name,this.FILENAME_SNIPPET_LENGTH)),null!=e.size?$.span({className:"size"}," - ",l.format_bytes(e.size)):void 0),e.status!==O.FAILED?t?this._renderFileListRowDest(e):void 0:this._renderFileListRowError(e),this._renderFileListRowStatus(e)))},_renderFileList:function(e,t){var s,r,n;return n=null!=(r=(null!=t?t:{}).shouldShowDestinationLink)?r:!0,$.ol({ref:"uploadFilesList",id:"upload-files-list",style:{margin:0,padding:0,maxHeight:228,overflowY:"auto",position:"relative"}},function(){var t,r,o;for(o=[],t=0,r=e.length;r>t;t++)s=e[t],o.push(this._renderFileListRow(s,n));return o}.call(this))},_renderTimeLeft:function(){var e;return e=this.state.currentUpload,null!=e&&e.status===O.UPLOADING?$.div({style:{marginTop:8,textAlign:"right"}},z("%(time_left)s left").format({time_left:a.format_time(this.state.numSecondsLeft)})):void 0},_renderBasicUploaderForm:function(){return $.form({id:"basic-upload-form",ref:"basicUploadForm",encType:"multipart/form-data",noValidate:"novalidate",method:"post",action:"https://"+F.BLOCK_CLUSTER+"/upload"},$.input({type:"hidden",name:"t",value:E.read(I.JS_CSRF_COOKIE)}),$.input({type:"hidden",name:"_subject_uid",value:this.state.user.id}),$.input({type:"hidden",name:"plain",value:"yes"}),$.input({type:"hidden",name:"dest",value:this.state.path}),$.input({type:"file",name:"file","aria-label":z("Upload file"),tabIndex:"-1",style:{display:"none"},ref:"fileInput",onChange:this._handleBasicFileInputChange}))},render:function(){return $.div({ref:"container"},this._renderDropzone(),X(k,{ref:"modal",title:z("Upload to Dropbox"),showX:!1,clickOutToClose:this.props.clickOutToClose,buttonComponent:0===this.state.fileList.count()||this.state.usingBasicUploader?this._renderIntroModalButtons():this._renderFileListModalButtons(),onDismiss:function(e){return function(t){return null!=e.state.basicUploaderFile?void t.preventDefault():W.setIsUploadModalOpen({isUploadModalOpen:!1})}}(this)},this.state.usingBasicUploader?this._renderBasicUploaderForm():void 0,null!=this.state.basicUploaderFile?this._renderFileList([this.state.basicUploaderFile],{shouldShowDestinationLink:!1}):0===this.state.fileList.count()||this.state.usingBasicUploader?this._renderIntroMessage():this._renderFileList(this.state.fileList.toArray(),{shouldShowDestinationLink:this.props.shouldShowDestinationLink}),this._renderTimeLeft()))}}),U=r.createClass({displayName:"InlineUploadStatus",propTypes:{fileList:r.PropTypes.instanceOf(s.OrderedMap).isRequired,currentUpload:r.PropTypes.instanceOf(A),numSecondsLeft:r.PropTypes.number,onViewDetails:r.PropTypes.func},FILENAME_SNIPPET_LENGTH:30,_getOverallUploadState:function(){return this.props.fileList.find(function(e){var t;return(t=e.status)===O.PENDING||t===O.UPLOADING})?"uploading":this.props.fileList.find(function(e){return e.status===O.FAILED})?"error":"complete"},_getProgressBarWidth:function(){var e;return e=this._getOverallUploadState(),"uploading"===e&&null!=this.props.currentUpload?this.props.currentUpload.percentUploaded:"complete"===e||"error"===e?100:0},_getNumPendingFiles:function(){return this.props.fileList.count(function(e){return e.status===O.PENDING})},_getNumCompletedFiles:function(){return this.props.fileList.count(function(e){return e.status===O.COMPLETE})},_getNumNoncancelledFiles:function(){return this.props.fileList.count(function(e){return e.status!==O.CANCELLED})},_getNumErrors:function(){return this.props.fileList.count(function(e){return e.status===O.FAILED})},_renderIcon:function(){var e;return e=this._getOverallUploadState(),"uploading"===e?X(b,{group:"web",name:"s_sync",alt:z("Uploading")}):"complete"===e?X(b,{group:"web",name:"s_check",alt:z("Upload successful")}):X(g,{src:ce("/static/images/nosync-vfl18cuTS.png"),srcHiRes:ce("/static/images/nosync@2x-vflgS4F07.png"),alt:z("Error")})},_renderCloseButton:function(){return $.button({className:"button-as-link",onClick:function(e){return e.preventDefault(),W.setIsInlineStatusDismissed({isInlineStatusDismissed:!0})}},X(b,{group:"web",name:"xclose",alt:z("Close")}))},_renderViewDetailsLink:function(){var e;return e=this._getNumPendingFiles(),$.span({className:"details"}," - ",$.button({className:"view-details button-as-link",onClick:function(e){return function(t){var s;return t.preventDefault(),"function"==typeof(s=e.props).onViewDetails?s.onViewDetails():void 0}}(this)},e>0?pe("%(num_pending_files)d file left","%(num_pending_files)d files left",e).format({num_pending_files:e}):z("View details")))},_renderFileDescription:function(){var e,t,s,r;return r=this._getOverallUploadState(),s=this._getNumNoncancelledFiles(),t=this._getNumErrors(),$.span({className:"file-desc"},null!=this.props.currentUpload?z("Uploading %(filename)s").format({filename:u.em_snippet(this.props.currentUpload.name,this.FILENAME_SNIPPET_LENGTH)}):"uploading"===r?z("Starting upload..."):"complete"===r?s>1?z("Uploaded %(num_files)d files").format({num_files:s}):z("Uploaded %(filename)s").format({filename:u.em_snippet(this.props.fileList.last().name,this.FILENAME_SNIPPET_LENGTH)}):"error"===r?s>1?[z("Uploaded %(num_completed)d of %(num_files)d files").format({num_completed:this._getNumCompletedFiles(),num_files:s})," ",$.span({className:"num-errors"},pe("- %d error","- %d errors",t).format(t))]:(e=this.props.fileList.last().errorType,e===V.GENERIC?z("Unable to upload %(filename)s").format({filename:u.em_snippet(this.props.fileList.last().name,this.FILENAME_SNIPPET_LENGTH)}):z("Unable to upload %(filename)s: %(reason)s").format({filename:u.em_snippet(this.props.fileList.last().name,this.FILENAME_SNIPPET_LENGTH),reason:function(){switch(e){case V.OVER_QUOTA_ERROR:return z("over quota");case V.FILE_SIZE_ERROR:return z("file too large");case V.CONNECTION_ERROR:return z("lost connection");case V.HTTP_ERROR:return z("server error");case V.EMPTY_OR_FOLDER:return z("can’t upload folders or empty files");case V.PACKAGE_FILE:return z("OSX package file")}}()})):void 0)},render:function(){var e,t;return e=this._getOverallUploadState(),t={"upload-file":!0,error:"error"===e,complete:"complete"===e},$.div({id:"inline-upload-status",className:Z(t)},$.div({className:"inline-upload-info"},$.div({className:"icon"},this._renderIcon()),$.div({className:"files-info"},this._renderFileDescription(),$.span({className:"num-errors"}),this._renderViewDetailsLink()),$.div({className:"status"},"uploading"===e&&null!=this.props.numSecondsLeft?z("%(time_left)s left").format({time_left:a.format_time(this.props.numSecondsLeft)}):this._renderCloseButton())),$.div({className:"inline-upload-bar"},$.div({className:"inline-upload-progress",style:{width:this._getProgressBarWidth()+"%"}})))}}),te=null,x=r.createClass({displayName:"FileUploader",mixins:[d(j)],propTypes:{dragAndDropEnabled:r.PropTypes.bool,shouldShowDestinationLink:r.PropTypes.bool,onFileUploadComplete:r.PropTypes.func,onAllFileUploadsComplete:r.PropTypes.func,onModalDismissed:r.PropTypes.func,clickOutToClose:r.PropTypes.bool},statics:{showModal:function(){return te?te.showModal():void console.warn("Tried to show the file upload modal, but no FileUploader component has been instantiated on the page yet.")}},getDefaultProps:function(){return{dragAndDropEnabled:!0,shouldShowDestinationLink:!0,onFileUploadComplete:function(){},onAllFileUploadsComplete:function(){},onModalDismissed:function(){},clickOutToClose:!0}},_get_state_from_stores:function(){return{path:j.path(),user:j.user(),fileList:j.fileList(),numDraggingFiles:j.numDraggingFiles(),isInternalTransfer:j.isInternalTransfer(),currentUpload:j.currentUpload(),isUploadModalOpen:j.isUploadModalOpen(),numSecondsLeft:j.numSecondsLeft(),isInlineStatusDismissed:j.isInlineStatusDismissed(),hasPermissionToUploadToFolder:j.hasPermissionToUploadToFolder()}},INLINE_STATUS_CONTAINER_CLASS:"inline-upload-status-container",showModal:function(){return k.showInstance(X(M,{dragAndDropEnabled:this.props.dragAndDropEnabled,shouldShowDestinationLink:this.props.shouldShowDestinationLink,onModalDismissed:this.props.onModalDismissed,clickOutToClose:this.props.clickOutToClose})),W.setIsUploadModalOpen({isUploadModalOpen:!0})},componentWillMount:function(){if(te)throw new Error("Only one FileUploader component may be rendered to the page at any time. You have tried to instantiate multiple uploaders.");return te=this},componentDidMount:function(){var s;return W.initPLU(),this.dragEnterCount=0,this.lastEnteredElement=null,s=t(document),s.on("dragover.fileUploader",function(e){return e.preventDefault(),e.stopPropagation()}).on("dragenter.fileUploader",function(t){return function(s){var r,o,i,a;return s.preventDefault(),s.stopPropagation(),s.target!==t.lastEnteredElement?(t.lastEnteredElement=s.target,t.dragEnterCount+=1,i=function(){var e;try{return null!=(e=s.originalEvent.dataTransfer.mozItemCount)?e:Object.keys(s.originalEvent.dataTransfer.items).length}catch(e){return 1}}(),a=s.originalEvent.dataTransfer.types,r=["Files","application/x-moz-file",L,"text/x-moz-url","text/uri-list","Url"],null!=a&&(null!=a.indexOf&&n.intersection(a,r).length>0||a instanceof DOMStringList&&(a.contains("Files")||a.contains("text/x-moz-url")||D.msie&&(a.contains("Text")||a.contains("text/plain"))))?(o=e.call(a,L)>=0||e.call(a,"text/plain")>=0||a instanceof DOMStringList&&(a.contains("Text")||a.contains("text/plain")),W.setNumDraggingFiles({numDraggingFiles:i,isInternalTransfer:o})):void 0):void 0}}(this)).on("dragleave.fileUploader",function(e){return function(t){return t.preventDefault(),t.stopPropagation(),e.lastEnteredElement=null,e.dragEnterCount-=1,e.dragEnterCount<1?(e.dragEnterCount=0,W.setNumDraggingFiles({numDraggingFiles:0})):void 0}}(this)).on("drop.fileUploader",this._handleFileDrop),t("<div>").addClass(this.INLINE_STATUS_CONTAINER_CLASS).prependTo(t("#page-content")),t(window).on("beforeunload.fileUploader",function(e){return function(t){var s,r;return s=null!=e.state.fileList.find(function(e){var t;return(t=e.status)===O.PENDING||t===O.UPLOADING}),s&&e.state.fileList.count()>0?(r=z("Leaving this page will cancel your uploads."),t.returnValue=r,r):void 0}}(this))},updateInlineStatus:function(){var e,s,n;return n=null!=this.state.fileList.find(function(e){var t;return(t=e.status)===O.PENDING||t===O.UPLOADING}),s=!this.state.isUploadModalOpen&&(n||this.state.fileList.count()>0&&!n&&!this.state.isInlineStatusDismissed),e=t("."+this.INLINE_STATUS_CONTAINER_CLASS),s?r.render(X(U,{fileList:this.state.fileList,currentUpload:this.state.currentUpload,onViewDetails:this._handleInlineStatusViewDetails,numSecondsLeft:this.state.numSecondsLeft}),e[0]):r.unmountComponentAtNode(e[0])},componentWillUpdate:function(e,t){var s,r,n;return null==t.currentUpload&&null!=this.state.currentUpload&&"function"==typeof(s=this.props).onFileUploadComplete&&s.onFileUploadComplete(this.state.currentUpload),t.fileList!==this.state.fileList&&(n=null!=t.fileList.find(function(e){var t;return(t=e.status)===O.PENDING||t===O.UPLOADING}),!n&&t.fileList.count()>0)&&"function"==typeof(r=this.props).onAllFileUploadsComplete?r.onAllFileUploadsComplete(this.state.fileList):void 0},componentDidUpdate:function(e,s){var r,n;return r=t(".external-drop-indicator"),this.state.numDraggingFiles&&!this.state.isInternalTransfer?(s.numDraggingFiles||r.css("opacity",0).fadeTo(500,.6),this.state.hasPermissionToUploadToFolder?r.removeClass("external-drop-indicator--uploads-disabled"):r.addClass("external-drop-indicator--uploads-disabled"),this.state.isUploadModalOpen||(this.state.hasPermissionToUploadToFolder?(n=z("Drop your files to %(upload_action)s",{comment:"upload_action is a phrase like 'upload to folder 'XYZ'"}).format({upload_action:K({user:this.state.user,path:this.state.path})}),R.success(n,60)):R.error(z("You don’t have permission to add to this folder.")))):!this.state.numDraggingFiles&&s.numDraggingFiles&&(r.hide().removeClass("external-drop-indicator--uploads-disabled"),R.clear()),this.updateInlineStatus()},componentWillUnmount:function(){return t(document).off("dragover.fileUploader").off("dragenter.fileUploader").off("dragleave.fileUploader").off("drop.fileUploader"),t("."+this.INLINE_STATUS_CONTAINER_CLASS).remove(),t(window).off("beforeunload.fileUploader"),te=null},_handleFileDrop:function(e){var t,s,r,n,o,a,l,u,c,d,p,h,f,m,_,g,y,S,b,v,T,w,F;if(e.preventDefault(),e.stopPropagation(),this.dragEnterCount=0,this.lastEnteredElement=null,W.setNumDraggingFiles({numDraggingFiles:0}),t=e.originalEvent.dataTransfer,s=D.msie?"text":"application/x-dropbox-file-list",f=t.getData(s),null!=f)try{if(v=JSON.parse(f),F=v.userId,p=v.fromPath,c=v.filePaths,(null!=c?c.length:void 0)>0&&null!=p&&null!=F)return this.state.hasPermissionToUploadToFolder?F!==this.state.user.id?void R.error(z("You can’t move or copy files here from another Dropbox.")):(w=e.ctrlKey||e.altKey,void require(["modules/dirty/react/browse/actions"],function(e){return function(t){return w?t.copyFiles({files:c.map(function(e){return{fq_path:e}}),newPath:e.state.path}):p!==e.state.path?t.moveFiles({path:p,files:c.map(function(e){return{fq_path:e}}),newPath:e.state.path}):void 0}}(this))):void R.error(z("You don’t have permission to add to this folder."))}catch(e){}if(this.state.hasPermissionToUploadToFolder){if(n=i.getDraggedLink(t),null!=n)return b=i.buildUrlLinkfileContents(n),S=new Blob([b],{type:"text/plain"}),y=N.parse(n).getAuthority(),S.name=y+".url",S.overwrite=!1,void W.addFilesToPLU({files:[S]});if(m=t.items,d=t.files,null!=(null!=m&&null!=(T=m[0])?T.webkitGetAsEntry:void 0)){for(a=function(){var e,t,s;for(s=[],h=e=0,t=m.length;t>=0?t>e:e>t;h=t>=0?++e:--e)s.push(m[h].webkitGetAsEntry());return s}(),l=function(){var e,t,s;for(s=[],e=0,t=a.length;t>e;e++)o=a[e],(null!=o?o.isFile:void 0)&&s.push(o);return s}(),r=function(){var e,t,s;for(s=[],e=0,t=a.length;t>e;e++)o=a[e],(null!=o?o.isDirectory:void 0)&&s.push(o);return s}(),_=0,g=l.length;g>_;_++)u=l[_],u.file(function(e){return W.addFilesToPLU({files:[e]})});if(r.length>0)return W.addDirectoriesToPLU({directoryEntries:r})}else if(null!=(null!=d?d.length:void 0))return d=function(){var e,t,s;for(s=[],h=e=0,t=d.length;t>=0?t>e:e>t;h=t>=0?++e:--e)s.push(d.item(h));return s}(),W.addFilesToPLU({files:d})}},_handleInlineStatusViewDetails:function(){return this.showModal()},render:function(){return $.div({})}}),{FileUploader:x}})}.call(this),function(){define("modules/clean/react/outside_event",["external/react","external/underscore","modules/clean/react/util"],function(e,t,s){var r,n,o,i,a,l;return l=s.mergeProps,i=e.createElement,a=e.DOM,o=function(s,r,n,o){var a,u,c;return a=null!=(c=s.displayName)?c:"UnnamedComponent",e.createClass({displayName:"Outside"+r+"Handled"+a,propTypes:(u={},u[""+n]=e.PropTypes.func,u[""+o]=e.PropTypes.func,u),componentDidMount:function(){return document.addEventListener(r,this._handleOutsideEvent,!1)},componentWillUnmount:function(){return document.removeEventListener(r,this._handleOutsideEvent,!1)},render:function(){var e,r;return r=l(t.omit(this.props,n,o,"children"),(e={},e[""+n]=this._handleInsideEvent,e)),i(s,r,this.props.children)},_handleOutsideEvent:function(e){var t;return"function"==typeof(t=this.props)[o]?t[o](e):void 0},_handleInsideEvent:function(e){var t,s;return e.stopPropagation(),"function"==typeof(t=e.nativeEvent).stopImmediatePropagation&&t.stopImmediatePropagation(),"function"==typeof(s=this.props)[n]?s[n](e):void 0}})},r=o("div","click","onClick","onOutsideClick"),n=o("div","mousedown","onMouseDown","onOutsideMouseDown"),{OutsideClickHandler:r,OutsideMouseDownHandler:n,addOutsideEventHandling:o}})}.call(this),function(){var e=[].slice,t={}.hasOwnProperty;define("modules/clean/react/selectable_list",["jquery","external/underscore","external/react","external/immutable","external/keymaster","modules/clean/keycode","modules/clean/react/outside_event","modules/core/browser","modules/core/exception","modules/clean/react/helpers"],function(s,r,n,o,i,a,l,u,c,d){var p,h,f,m,_,g,y,S,b,v,T,w,F,I;return y=l.addOutsideEventHandling,S=c.assert,I=d.shallowCompareStateAndProps,f="",m=n.PropTypes,g=o.Record({selected:new o.OrderedSet,anchor:null}),T=function(e,t){return null==e&&(e=[]),null==t&&(t=null),new g({selected:new o.OrderedSet(e),anchor:t||e[0]})},h="up",p="down",F=function(e){return u.mac&&e.metaKey||!u.mac&&e.ctrlKey},b=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],function(){var e,s,n,o;for(o=[],s=0,n=t.length;n>s;s++)e=t[s],r.isFunction(e)&&o.push(e.apply(this,arguments));return o}},_={onMouseEnter:"handleMouseEnterRow",onMouseDown:"handleMouseDownInRow",onMouseUp:"handleMouseUpInRow"},w=function(){var e;return"INPUT"===(e=document.activeElement.tagName)||"TEXTAREA"===e||"SELECT"===e||"BUTTON"===e},v=function(e,i){var a,l;return l=null!=(a=(null!=i?i:{}).shouldComponentUpdate)?a:I,e=y(e,"mouseup","onMouseUp","onOutsideMouseUp"),n.createClass({displayName:"Selectable"+e.displayName,propTypes:{onSelectionChange:n.PropTypes.func,selection:n.PropTypes.instanceOf(g),defaultSelection:n.PropTypes.instanceOf(g),keyScope:n.PropTypes.string,linkedOutsideClasses:n.PropTypes.array,addTabbingClassWhenKeyboardNavigating:n.PropTypes.bool},getDefaultProps:function(){return{onSelectionChange:r.noop,selection:null,defaultSelection:new g,keyScope:"SelectableList",linkedOutsideClasses:[],addTabbingClassWhenKeyboardNavigating:!0}},getInitialState:function(){return{selection:this.props.defaultSelection}},componentWillMount:function(){return this._focusedItem=null,this._handlerCache={},this._isFocused=!1,this._mostRecentMousedownTarget=null,this._isSelecting=!1},componentDidMount:function(){return this._setupKeyboardShortcuts(),this._focusItem(this._selection().anchor),s(this.getDOMNode()).on("focusin.SelectableList",this.getFocusHandler(!0)).on("focusout.SelectableList",this.getFocusHandler(!1))},shouldComponentUpdate:l,componentDidUpdate:function(e,t){var s,r;return(null!=(s=e.selection)?s.anchor:void 0)!==(null!=(r=this.props.selection)?r.anchor:void 0)&&this._selection().selected.size&&(this._focusedItem=this._selection().anchor),this._focusedItem?(this._focusItem(this._focusedItem),this._focusedItem=null):void 0},componentWillUnmount:function(){return this._handlerCache=null,f!==this.props.keyScope&&(key.clearScope(this.props.keyScope),key.setScope(f)),s(this.getDOMNode()).off(".SelectableList")},getFocusHandler:function(e){return function(t){return function(){return t._isFocused=e,!0}}(this)},_setupKeyboardShortcuts:function(){var e,t,s,r,n,o,i,a,l;return f=key.getScope(),f!==this.props.keyScope&&key.setScope(this.props.keyScope),o=function(e){return function(t){return e._isFocused&&"BUTTON"!==t.target.tagName}}(this),n=function(e){return function(t){return!document.activeElement||document.activeElement===document.body||e.getDOMNode().contains(t.target)}}(this),r=function(e,t){return function(s){return e(s)?(s.preventDefault(),t(s)):null}},l=function(e){return function(){return e._selectNeighboringItem({direction:h})}}(this),s=function(e){return function(){return e._extendSelectionRange({direction:h})}}(this),a=function(e){return function(){return e._selectNeighboringItem({direction:p})}}(this),t=function(e){return function(){return e._extendSelectionRange({direction:p})}}(this),i=function(e){return function(){return e._selectAllItems()}}(this),e=function(e){return function(){return e._deselectAllItems()}}(this),key("up",this.props.keyScope,r(n,l)),key("shift+up",this.props.keyScope,r(n,s)),key("down",this.props.keyScope,r(n,a)),key("shift+down",this.props.keyScope,r(n,t)),key("escape",this.props.keyScope,r(n,e)),u.mac?key("command+a",this.props.keyScope,r(o,i)):key("ctrl+a",this.props.keyScope,r(o,i))},_focusItem:function(e){var t;return t=this.refs[e],t?t.getDOMNode().focus():void 0},_itemIds:function(){var e;return e=[],n.Children.forEach(this.props.children,function(t){return function(t){var s;return(null!=t&&null!=(s=t.props)?s.selectableListId:void 0)?e.push(t.props.selectableListId):(null!=t?t.key:void 0)?e.push(t.key):void 0}}(this)),o.List(e)},_selection:function(){return this.props.selection?this.props.selection:this.state.selection},_updateState:function(e){return o.is(this._selection(),e)?void 0:(this.props.selection||this.setState({selection:e}),this.props.onSelectionChange(e))},_selectAllItems:function(){return this.setSelectedItems({itemIds:this._itemIds().toArray()})},_deselectAllItems:function(){return this.setSelectedItems({itemIds:[]}),this.getDOMNode().contains(document.activeElement)?document.activeElement.blur():void 0},_toggleItemSelected:function(e){var t,s,r,n,o,i,a,l,u,c,d;if(r=e.itemId,d=this._selection(),d.selected.has(r)){for(d=d.update("selected",function(e){return e.delete(r)}),a=null,t=this._itemIds().indexOf(r),s=o=l=t+1,u=this._itemIds().count();u>=l?u>o:o>u;s=u>=l?++o:--o)if(n=this._itemIds().get(s),d.selected.has(n)){a=n;break}if(!a)for(s=i=c=t-1;0>=c?0>=i:i>=0;s=0>=c?++i:--i)if(n=this._itemIds().get(s),d.selected.has(n)){a=n;break}a||(a=this._itemIds().get(0)),d=d.set("anchor",a)}else d=d.update("selected",function(e){return e.add(r)}).set("anchor",r);return this._updateState(d)},_selectItemsInRangeTo:function(e){var t,s,r,n,o,i,a,l,u,c,d,p,h;return i=e.itemId,p=this._selection(),(t=null!=(c=p.anchor)?c:this._itemIds().get(0))?(s=this._itemIds().indexOf(t),u=this._itemIds().indexOf(i),d=this._rangeOfSelectedBlockSurrounding(t),h=d.startIndex,r=d.endIndex,a=function(){var e,t,s,i;for(s=this._itemIds().toArray(),i=[],o=e=0,t=s.length;t>e;o=++e)n=s[o],o>=h&&r>=o&&i.push(n);return i}.call(this),l=function(){var e,t,r,i;for(r=this._itemIds().toArray(),i=[],o=e=0,t=r.length;t>e;o=++e)n=r[o],(o>=u&&s>=o||o>=s&&u>=o)&&i.push(n);return i}.call(this),s>u&&l.reverse(),p=p.update("selected",function(e){return e.subtract(a).union(l)}),this._updateState(p)):void 0},_selectNeighboringItem:function(e){var t,r,n,o;return t=e.direction,n=this._itemIds().indexOf(this._selection().selected.last()),r=0,t===h?r=Math.max(0,n-1):t===p&&(r=Math.min(this._itemIds().count()-1,n+1)),o=this._itemIds().get(r),this._focusedItem=o,this.setSelectedItems({itemIds:[o]}),this.props.addTabbingClassWhenKeyboardNavigating?s(document.body).addClass("tabbing"):void 0},_extendSelectionRange:function(e){var t,r,n,o,i,a,l,u,c;return n=e.direction,u=i=this._selection(),(t=null!=(a=u.anchor)?a:this._itemIds().get(0))?(r=this._itemIds().indexOf(t),l=this._rangeOfSelectedBlockSurrounding(t),c=l.startIndex,o=l.endIndex,n===h?r===o?c-1>=0&&(u=u.update("selected",function(e){return function(t){return t.add(e._itemIds().get(c-1))}}(this))):u=u.update("selected",function(e){return function(t){return t.delete(e._itemIds().get(o))}}(this)):n===p&&(r===c||r!==o?o+1<this._itemIds().count()&&(u=u.update("selected",function(e){return function(t){return t.add(e._itemIds().get(o+1))}}(this))):u=u.update("selected",function(e){return function(t){return t.delete(e._itemIds().get(c))}}(this))),u!==i&&(this._focusedItem=u.selected.last(),this._updateState(u)),this.props.addTabbingClassWhenKeyboardNavigating?s(document.body).addClass("tabbing"):void 0):void 0},_rangeOfSelectedBlockSurrounding:function(e){var t,s,r,n;for(s=this._itemIds().indexOf(e);;)if(n=s,s-=1,0>s||!this._selection().selected.has(this._itemIds().get(s)))break;for(s=n;;){if(r=this._itemIds().get(s),null==r||!this._selection().selected.has(r))break;t=s,s+=1}return{startIndex:n,endIndex:t}},setSelectedItems:function(e){var t,s,r;return s=e.itemIds,r=this._selection().set("selected",o.OrderedSet(s)),t=s.length>0?s[0]:this._itemIds().get(0),this._updateState(r.set("anchor",t))},handleMouseEnterRow:function(e,t){return this._isSelecting?this._selectItemsInRangeTo({itemId:e}):void 0},handleMouseDownInRow:function(e,t){return 2===t.button?void(this._selection().selected.has(e)||this.setSelectedItems({itemIds:[e]})):t.shiftKey?void this._selectItemsInRangeTo({itemId:e}):F(t)?void this._toggleItemSelected({itemId:e}):(this._selection().selected.has(e)||(this.setSelectedItems({itemIds:[e]}),this._isSelecting=!0),this._mostRecentMousedownTarget=e)},handleMouseUpInRow:function(e,t,s){return e===this._mostRecentMousedownTarget&&this.setSelectedItems({itemIds:[e]}),this._isSelecting=!1},handleOutsideMouseUp:function(e){var t;return this._isSelecting=!1,this._mostRecentMousedownTarget=null,t=this.getDOMNode(),t.contains(e.target)||s(e.target).closest(this.props.linkedOutsideClasses.join()).length||this._mostRecentMousedownTarget?void 0:this._deselectAllItems()},render:function(){var s,o,i,a;return o=this._handlerCache,this._handlerCache={},s=n.Children.map(this.props.children,function(e){return function(s){var i,a,l,u,c,d,p,h;if(!(null!=s&&null!=(d=s.props)?d.selectableListId:void 0)&&!(null!=s?s.key:void 0))return s;c=null!=(p=null!=s&&null!=(h=s.props)?h.selectableListId:void 0)?p:s.key,u={};for(l in _)t.call(_,l)&&(a=_[l],S(!s.props[l],"SelectableList does not support children having seperate "+l+" listeners"),i=l+c,u[l]=o[i]||e[a].bind(e,c),e._handlerCache[i]=u[l]);return n.addons.cloneWithProps(s,r.extend(u,{ref:c,isSelected:e._selection().selected.has(c)}))}}(this)),i=Object.keys(this.constructor.propTypes),a=r.extend({},r.omit(this.props,i),{selection:this._selection(),onOutsideMouseUp:this.handleOutsideMouseUp}),n.createElement(e,a,s)}})},{createSelectableList:v,createSelection:T}})}.call(this),function(){define("modules/clean/react/tree_view",["jquery","external/immutable","external/underscore","external/react","modules/clean/ajax","modules/clean/em_string","modules/clean/filepath","modules/clean/react/css","modules/clean/react/image","modules/clean/react/sprite","modules/clean/viewer","modules/core/i18n","modules/core/notify","modules/clean/keycode"],function(e,t,s,r,n,o,i,a,l,u,c,d,p,h){var f,m,_,g,y,S,b,v,T,w,F,I,D,E,P;return P=i.filename,F=d._,E=r.DOM,D=r.addons.classSet,I=r.createElement,_=20,m=15,g={None:"None",TreeItem:"TreeItem",HeaderItem:"HeaderItem",StaticHeader:"StaticHeader"},v=t.Record({key:void 0,label:"",icon:null,disabled:!1,canExpand:!1}),y=t.Record({childItemsByParentKey:t.Map(),parentItemByChildKey:t.Map(),items:t.Map(),rootItem:new v}),y.createWithRootItem=function(e){return new y({rootItem:e,items:t.Map([[e.key,e]])})},y.prototype.getParentItem=function(e){var t;if(e)return t=this.parentItemByChildKey.get(e.key),t?this.items.get(t):null},y.prototype.getChildItems=function(e){return this.childItemsByParentKey.get(e.key)||null},y.prototype.isParent=function(e){return this.childItemsByParentKey.has(e.key)},y.prototype.setChildItems=function(e,s){return this.withMutations(function(r){var n;return s=t.List(s),n=t.Map(s.map(function(e){return[e.key,e]})),r.set("items",r.items.merge(n)),r.set("childItemsByParentKey",r.childItemsByParentKey.set(e.key,s)),s.forEach(function(t){return r.set("parentItemByChildKey",r.parentItemByChildKey.set(t.key,e.key))})})},S=r.createClass({displayName:"TreeGroupView",propTypes:{ariaLabel:r.PropTypes.string},render:function(){return E.ul({className:"tree-view__group",role:"group"},this.props.children)}}),T=r.createClass({displayName:"TreeItemView",propTypes:{item:r.PropTypes.instanceOf(v).isRequired,id:r.PropTypes.string.isRequired,isSelected:r.PropTypes.bool,isExpanded:r.PropTypes.bool,canExpand:r.PropTypes.bool,level:r.PropTypes.number,onClick:r.PropTypes.func,onExpandButtonClick:r.PropTypes.func,showAsHeader:r.PropTypes.bool},getDefaultProps:function(){return{isSelected:!1,isExpanded:!1,canExpand:!1,level:0,onClick:s.noop,onExpandButtonClick:s.noop,showAsHeader:!1}},handleClick:function(e){return e.preventDefault(),e.stopPropagation(),this.props.item.disabled||this.refs.expandButton&&this.refs.expandButton.getDOMNode().contains(e.target)?void 0:this.props.onClick(this.props.item)},handleExpandClick:function(e){return e.preventDefault(),this.props.item.disabled?void 0:this.props.onExpandButtonClick(this.props.item,!this.props.isExpanded)},_renderExpandButton:function(){return E.div({className:"tree-view__expand-button",onClick:this.handleExpandClick,ref:"expandButton",role:"button"},I(u,{group:"web",name:this.props.isExpanded?"bullet_minus":"bullet_plus",alt:""}))},_renderIcon:function(){return E.div({className:"tree-view__icon-wrapper"},I(u,{className:"tree-view__item-icon",group:"web",name:this.props.item.icon,alt:""}))},render:function(){var e,t,s;return t=!this.props.canExpand,e=D({"tree-view__item":!0,"tree-view__item--leaf":t,"tree-view__item--disabled":this.props.item.disabled}),s={key:this.props.item.key,id:this.props.id,className:e,onClick:this.handleClick,role:"treeitem","aria-disabled":this.props.item.disabled,"aria-label":this.props.item.label,
"aria-level":this.props.level+1},this.props.canExpand&&!this.props.showAsHeader&&(s["aria-expanded"]=this.props.isExpanded),this.props.isSelected&&(s["aria-selected"]=!0),E.li(s,E.span({className:"tree-view__item-row",style:{paddingLeft:this.props.showAsHeader?0:this.props.level*m}},this.props.showAsHeader||t?void 0:this._renderExpandButton(),this.props.item.icon?this._renderIcon():void 0,this.props.item.label?E.span({className:"tree-view__item-label"},o.em_snippet(this.props.item.label,_)):void 0),this.props.children)}}),b=r.createClass({displayName:"TreeHeaderView",propTypes:{item:r.PropTypes.instanceOf(v).isRequired,id:r.PropTypes.string.isRequired},_renderIcon:function(){return this.props.item.icon?I(u,{className:"tree-view__header-icon",group:"web",name:this.props.item.icon,alt:""}):null},render:function(){return E.div({className:"tree-view__item-row"},this._renderIcon(),E.h3({className:"tree-view__header",id:this.props.id},this.props.item.label))}}),w=r.createClass({displayName:"TreeView",propTypes:{tree:r.PropTypes.instanceOf(y).isRequired,rootStyle:r.PropTypes.oneOf(s.keys(g)),onItemSelected:r.PropTypes.func,onItemExpanded:r.PropTypes.func},getDefaultProps:function(){return{rootStyle:g.None,onItemSelected:function(){},onItemExpanded:function(){}}},getInitialState:function(){return{selectedItemKey:null,expandedItemKeys:t.Set([this.props.tree.rootItem.key]),showFocused:!1}},componentDidMount:function(){return e(this.getDOMNode()).on("keydown",this.handleKeyDown)},componentWillUnmount:function(){return e(this.getDOMNode()).off("keydown")},componentDidUpdate:function(t,s){var r,n;return this.state.selectedItemKey&&this.state.selectedItemKey!==s.selectedItemKey&&(r=e(this.getDOMNode()),n=r.find('[aria-selected="true"]').eq(0),n.length)?this._scrollElementIntoViewIfNeeded(n,r):void 0},_scrollElementIntoViewIfNeeded:function(e,t){var s,r,n,o,i,a,l;return n=t.scrollTop(),i=n+e.position().top,l=i-n,0>l?void t.scrollTop(i):(s=t.innerHeight(),r=n+s,o=e.innerHeight(),a=i+o,a>r?t.scrollTop(i-s+o):void 0)},_hasSelectableRootItem:function(){var e;return e=this.props.rootStyle,e===g.TreeItem||e===g.HeaderItem},_getHTMLIdPrefix:function(){return this._HTMLIdPrefix||(this._HTMLIdPrefix="tree-view-"+Math.floor(16777215*Math.random()).toString(16))},selectItem:function(e){return this.setState({selectedItemKey:null!=e?e.key:void 0}),this.props.onItemSelected(e)},_getLastLeafOf:function(e){var t;return t=this.props.tree.getChildItems(e),this.state.expandedItemKeys.contains(e.key)&&t.size>0?this._getLastLeafOf(t.last()):e},_getPrevItem:function(e){var t,s,r,n;return(r=this.props.tree.getParentItem(e))?(n=this.props.tree.getChildItems(r),s=n.indexOf(e),s>0?this._getLastLeafOf(n.get(s-1)):0===s?(t=r===this.props.tree.rootItem,t&&!this._hasSelectableRootItem()?null:r):null):null},_getNextItem:function(e,t){var s,r,n,o,i,a;return null==t&&(t=!0),e?(n=this.state.expandedItemKeys.contains(e.key),s=n&&this.props.tree.isParent(e),t&&s?this.props.tree.getChildItems(e).first():(i=this.props.tree.getParentItem(e))?(a=this.props.tree.getChildItems(i),o=a.size-1,r=a.indexOf(e),r===o?this._getNextItem(i,!1):r>=0&&o>r?a.get(r+1):null):null):null},advanceSelection:function(e){var t,s,r;return null==e&&(e=!1),this.state.selectedItemKey?(r=this.props.tree.items.get(this.state.selectedItemKey),s=e?this._getPrevItem(r):this._getNextItem(r),s?(this.selectItem(s),!0):void 0):(t=this._hasSelectableRootItem()?this.props.tree.rootItem:this.props.tree.getChildItems(this.props.tree.rootItem).first(),this.selectItem(t),!0)},_getValidHTMLIdForItem:function(e){return(""+this._getHTMLIdPrefix()+e.key).replace(/\s+/g,"_")},_setItemExpanded:function(e,t){return t?this.state.expandedItemKeys.add(e):this.state.expandedItemKeys.delete(e)},_canItemExpand:function(e){return e&&(e.canExpand||this.props.tree.isParent(e))},handleExpandButtonClick:function(e,t){return this.setState({expandedItemKeys:this._setItemExpanded(e.key,t)}),this.props.onItemExpanded(e,t)},handleKeyDown:function(e){var t;switch(e.which){case h.UP:if(this.advanceSelection(!0))return e.preventDefault();break;case h.DOWN:if(this.advanceSelection(!1))return e.preventDefault();break;case h.RIGHT:if(t=this.props.tree.items.get(this.state.selectedItemKey),this._canItemExpand(t))return this.handleExpandButtonClick(t,!0),e.preventDefault();break;case h.LEFT:if(t=this.props.tree.items.get(this.state.selectedItemKey),this._canItemExpand(t))return this.handleExpandButtonClick(t,!1),e.preventDefault()}},_renderSingleItem:function(e,t,r,n){var o,i;return null==r&&(r=null),null==n&&(n={}),o={id:this._getValidHTMLIdForItem(e),key:e.key,item:e,isSelected:this.state.selectedItemKey===e.key,isExpanded:this.state.expandedItemKeys.contains(e.key),canExpand:this._canItemExpand(e),level:t,onClick:this.selectItem,onExpandButtonClick:this.handleExpandButtonClick},i=s.extend({},o,n),I(T,i,r)},_renderItemAndDescendants:function(e,t){var s,r;return r=this.state.expandedItemKeys.contains(e.key),this.props.tree.isParent(e)&&r&&(s=this._renderChildrenOfItemAsGroup(e,t+1)),this._renderSingleItem(e,t,s)},_renderChildrenOfItemAsGroup:function(e,t){var s;return e&&this.props.tree.isParent(e)?(s=this.props.tree.getChildItems(e).map(function(e){return function(s){return e._renderItemAndDescendants(s,t)}}(this)),I(S,null,s.toJS())):null},render:function(){var e,t,s,r,n;if(t={role:"tree",tabIndex:0,onFocus:function(e){return function(){return e.setState({showFocused:!0})}}(this),onBlur:function(e){return function(){return e.setState({showFocused:!1})}}(this),className:D("tree-view","ax-focusable",{"is-focused":this.state.showFocused})},s=this.props.tree.rootItem,this.state.selectedItemKey&&(r=this.props.tree.items.get(this.state.selectedItemKey),t["aria-activedescendant"]=this._getValidHTMLIdForItem(r)),this.props.rootStyle===g.TreeItem)n=I(S,null,this._renderItemAndDescendants(s,0));else if(this.props.rootStyle===g.HeaderItem)e=this._getValidHTMLIdForItem(s),n=I(S,null,this._renderSingleItem(s,0,null,{showAsHeader:!0,id:e}),this._renderChildrenOfItemAsGroup(s,0));else if(this.props.rootStyle===g.StaticHeader)e=this._getValidHTMLIdForItem(s),n=I(S,null,I(b,{item:s,id:e}),this._renderChildrenOfItemAsGroup(s,0));else{if(this.props.rootStyle!==g.None)throw new Error("Unknown root style: "+this.props.rootStyle);n=this._renderChildrenOfItemAsGroup(this.props.tree.rootItem,0)}return e&&(t["aria-labelledby"]=e),E.div(t,n,this.props.children)}}),w=a(w,["/static/css/react/tree_view-vflGRlOff.css","/static/css/accessibility-vfle8A-zy.css"]),f=r.createClass({displayName:"FolderTreeView",propTypes:{user:r.PropTypes.object.isRequired,rootPath:r.PropTypes.string,onFolderSelected:r.PropTypes.func,showReadOnly:r.PropTypes.bool,isRootSelectable:r.PropTypes.bool},getDefaultProps:function(){return{rootPath:"/",showReadOnly:!0,onFolderSelected:function(){},isRootSelectable:!1}},getInitialState:function(){return{showLoadingScreen:!1,tree:null}},componentWillMount:function(){var e;return this.state.tree?void 0:(e=this._constructRootItem(),this.setState({tree:y.createWithRootItem(e)}))},componentDidMount:function(){return this._isMounted=!0,this.asyncFetchSubFoldersForItem(this.state.tree.rootItem)},componentWillUnmount:function(){return this._isMounted=!1,this._pendingAjaxRequest?(this._pendingAjaxRequest.abort(),this._pendingAjaxRequest=null):void 0},_constructRootItem:function(){var e,t;return t=c.get_role_title(this.props.user)||F("Dropbox"),e=c.get_viewer().is_paired?this.props.user.is_team?"s_briefcase":"s_house":"dropbox",new v({key:this.props.rootPath,icon:e,label:t})},_parseFolderList:function(e,s){var r,n,o,i,a,l;for(null==s&&(s=!1),a=JSON.parse(e),l=[],n=0,i=a.length;i>n;n++)r=a[n],r.read_only&&s||(o=r.path,l.push(new v({key:o,label:P(r.path),canExpand:r.has_subdirs,icon:r.icon,disabled:r.read_only})));return t.List(l)},asyncFetchSubFoldersForItem:function(e){var t,s;return s=e.key,t=e===this.state.tree.rootItem,t&&this.setState({showLoadingScreen:!0}),this._pendingAjaxRequest&&this._pendingAjaxRequest.abort(),this._pendingAjaxRequest=n.WebRequestOref({url:"/browse_util/tree_view_folders",type:"POST",subject_user:this.props.user.id,data:{folder:s},success:function(t){return function(s){var r,n,o;return o=!t.props.showReadOnly,r=t._parseFolderList(s,o),n=t.state.tree.setChildItems(e,r),t.setState({tree:n})}}(this),error:function(){return p.error(F("An error occurred while trying to load your folder."))},complete:function(e){return function(){return e._pendingAjaxRequest=null,e._isMounted&&t?e.setState({showLoadingScreen:!1}):void 0}}(this)})},handleItemSelected:function(e){return this.props.onFolderSelected(e.key)},handleExpandButtonClick:function(e,t){return t&&!this.state.tree.isParent(e)?this.asyncFetchSubFoldersForItem(e):void 0},_renderLoadingMessage:function(){return E.span({className:"tree-view__loading-label"},F("Loading your folders…"))},render:function(){var e;return e=this.props.isRootSelectable?g.HeaderItem:g.StaticHeader,I(w,{tree:this.state.tree,rootStyle:e,onItemSelected:this.handleItemSelected,onItemExpanded:this.handleExpandButtonClick},this.state.showLoadingScreen?this._renderLoadingMessage():void 0)}}),{RootStyle:g,FolderTreeView:f,TreeView:w,TreeItemView:T,TreeItem:v,Tree:y}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/search/actions",["external/immutable","modules/clean/filepath","modules/clean/history","modules/clean/search/api","modules/clean/search/constants","modules/clean/search/dispatcher","modules/clean/search/store","modules/constants/viewer","modules/core/uri"],function(t,s,r,n,o,i,a,l,u){var c,d,p,h;return d=o.SearchActionTypes,h=o.SearchLoadingStates,c=l.ROLE_WORK,new(p=function(){function t(){this._loadDeletedResults=e(this._loadDeletedResults,this),this.loadMoreResults=e(this.loadMoreResults,this),this.searchApi=new n}return t.prototype.focusSearchBar=function(){return i.dispatch({type:d.FOCUS_SEARCH_BAR})},t.prototype.blurSearchBar=function(){return i.dispatch({type:d.BLUR_SEARCH_BAR})},t.prototype.setSearchQuery=function(e){var t,s,r;return t=e.path,s=e.query,r=e.user,s!==a.rawQuery()?(i.dispatch({type:d.SET_SEARCH_QUERY,data:{query:s}}),a.isSearchBarLoading()?this.searchApi.loadSuggestions({user:r,path:t,query:a.normalizedQuery(),onSuccess:this.setSearchSuggestions}):void 0):void 0},t.prototype.setSearchSuggestions=function(e){var t;return t=e.searchResults,i.dispatch({type:d.SET_SEARCH_SUGGESTIONS,data:{searchResults:t}})},t.prototype.setHighlightedRow=function(e){var t;return t=e.index,i.dispatch({type:d.SET_HIGHLIGHTED_ROW,data:{index:t}})},t.prototype.highlightPreviousRow=function(){return i.dispatch({type:d.HIGHLIGHT_PREVIOUS_ROW})},t.prototype.highlightNextRow=function(){return i.dispatch({type:d.HIGHLIGHT_NEXT_ROW})},t.prototype.runSearch=function(e){var t,s,r;return r=e.user,t=e.path,s=e.query,i.dispatch({type:d.START_SEARCH,data:{query:s}}),this.searchApi.loadResults({user:r,path:t,query:s,loadDeleted:!1,start:0,onSuccess:function(e){return function(s){var n,o;return o=s.searchResults,n=s.context,e._setSearchResults({searchResults:o,context:n}),e._loadDeletedResults({path:t,user:r})}}(this)})},t.prototype.loadMoreResults=function(e){var t,s,r;if(t=e.path,r=e.user,a.loadingState()===h.LOADED){if(a.hasMoreResults())s=!1;else{if(!a.hasMoreResults(!0))return;s=!0}return i.dispatch({type:d.CONTINUE_SEARCH,data:{didLoadDeletedResults:s}}),this.searchApi.loadResults({user:r,path:t,query:a.latestQuery(),loadDeleted:s,start:s?a.numDeletedResults():a.searchResults().size,onSuccess:function(e){return function(s){var n,o,i;return i=s.searchResults,n=s.context,o=s.deleted,e._appendSearchResults({searchResults:i,context:n,deleted:o}),e._loadDeletedResults({path:t,user:r})}}(this)})}},t.prototype._setSearchResults=function(e){var t,s;return s=e.searchResults,t=e.context,i.dispatch({type:d.SET_SEARCH_RESULTS,data:{searchResults:s,context:t}})},t.prototype._appendSearchResults=function(e){var t,s,r;return r=e.searchResults,t=e.context,s=e.deleted,i.dispatch({type:d.APPEND_SEARCH_RESULTS,data:{searchResults:r,context:t,deleted:s}})},t.prototype._loadDeletedResults=function(e){var t,s;return t=e.path,s=e.user,a.hasMoreResults()||a.didLoadDeletedResults()?void 0:this.loadMoreResults({path:t,user:s})},t.prototype.setSearchSelection=function(e){var t;return t=e.selection,i.dispatch({type:d.SET_SEARCH_SELECTION,data:{selection:t}})},t.prototype.clearSearch=function(){return i.dispatch({type:d.CLEAR_SEARCH})},t}())})}.call(this),function(){define("modules/clean/search/api",["modules/clean/ajax","modules/clean/react/browse/models","modules/clean/search/constants"],function(e,t,s){var r,n,o;return r=t.BrowseContext,n=s.MaxResults,o=function(){function t(){this._activeRequest=null}return t.prototype.loadSuggestions=function(e){var t,s,r,o,i,a;return a=e.user,r=e.path,o=e.query,s=e.onSuccess,t=e.onError,i={query:o,fq_path:r,filename_only:!0,max_results:n.MAX_SEARCH_SUGGESTIONS},this._fetchResults(i,a,!1,s,t)},t.prototype.loadResults=function(e){var t,s,r,o,i,a,l,u;return u=e.user,o=e.path,i=e.query,t=e.loadDeleted,l=e.start,r=e.onSuccess,s=e.onError,a={query:i,fq_path:o,filename_only:!1,max_results:n.MAX_SEARCH_RESULTS,deleted:t,start:l},this._fetchResults(a,u,t,r,s)},t.prototype._extractBrowseContext=function(e){return new r({isInFolderMode:e.inside_dir,inactiveNSIDByFQPath:e.old_path_to_ns_id,permanentDeletionDisabledStateByNSID:e.permanent_delete_is_disabled_by_ns_id})},t.prototype._fetchResults=function(t,s,r,n,o){var i;return null!=(i=this._activeRequest)&&i.abort(),this._activeRequest=e.WebRequest({url:"/ajax_fulltext_search",data:t,dataType:"json",subject_user:s,success:function(e){return function(t,s,o){var i,a;return i=e._extractBrowseContext(t),a=t.file_info,n({context:i,searchResults:a,loadDeleted:r})}}(this),error:function(e,t,s){return"abort"!==t&&"function"==typeof o?o(s):void 0},complete:function(){return this._activeRequest=null}})},t}()})}.call(this),function(){define("modules/clean/search/constants",[],function(){var e;return e={},e.MaxResults={MAX_SEARCH_SUGGESTIONS:8,MAX_SEARCH_RESULTS:100},e.SearchActionTypes={SET_USER:"SET_USER",FOCUS_SEARCH_BAR:"FOCUS_SEARCH_BAR",BLUR_SEARCH_BAR:"BLUR_SEARCH_BAR",SET_SEARCH_QUERY:"SET_SEARCH_QUERY",SET_SEARCH_SUGGESTIONS:"SET_SEARCH_SUGGESTIONS",SET_HIGHLIGHTED_ROW:"SET_HIGHLIGHTED_ROW",HIGHLIGHT_PREVIOUS_ROW:"HIGHLIGHT_PREVIOUS_ROW",HIGHLIGHT_NEXT_ROW:"HIGHLIGHT_NEXT_ROW",START_SEARCH:"START_SEARCH",SET_SEARCH_RESULTS:"SET_SEARCH_RESULTS",CONTINUE_SEARCH:"CONTINUE_SEARCH",APPEND_SEARCH_RESULTS:"APPEND_SEARCH_RESULTS",CLEAR_SEARCH:"CLEAR_SEARCH",SET_SEARCH_SELECTION:"SET_SEARCH_SELECTION"},e.SearchLoadingStates={LOADED:"LOADED",LOADING_FIRST_PAGE:"LOADING_FIRST_PAGE",LOADING_ADDITIONAL_PAGE:"LOADING_ADDITIONAL_PAGE"},e})}.call(this),function(){define("modules/clean/search/dispatcher",["modules/clean/flux/dispatcher"],function(e){return e})}.call(this),function(){define("modules/clean/search/search_bar",["jquery","external/purify","external/react","external/underscore","modules/core/uri","modules/clean/analytics","modules/clean/filepath","modules/clean/flux/store_mixin","modules/clean/keycode","modules/clean/react/button","modules/clean/react/css","modules/clean/react/input","modules/clean/react/react_i18n","modules/clean/react/sprite","modules/clean/search/actions","modules/clean/search/search_helpers","modules/clean/search/store","modules/core/accessible_announce","modules/core/browser","modules/core/i18n"],function(e,t,s,r,n,o,i,a,l,u,c,d,p,h,f,m,_,g,y,S){var b,v,T,w,F,I,D,E,P,C,R,N,O;return E=o.TeamsWebActionsLogger,b=p.R_,P=S._,O=S.ungettext,C=s.createElement,R=s.addons.classSet,N=s.DOM,v=s.createClass({displayName:"SearchBar",mixins:[a(_)],propTypes:{user:s.PropTypes.object.isRequired,currentPath:s.PropTypes.string.isRequired,onSearch:s.PropTypes.func.isRequired,onFileOrFolderOpen:s.PropTypes.func.isRequired,limitedTeamBannerUpsell:s.PropTypes.bool,trademarkBusiness:s.PropTypes.string},_get_state_from_stores:function(){return{isFocused:_.isSearchBarFocused(),isActive:_.isSearchBarActive(),isSearchActive:!!_.latestQuery(),rawQuery:_.rawQuery(),normalizedQuery:_.normalizedQuery(),suggestions:_.searchSuggestions()}},_handleInputChange:function(e){return f.setSearchQuery({path:this.props.currentPath,query:e.target.value,user:this.props.user})},_handleInputKeydown:function(e){return e.keyCode===l.ESC?void this.props.onSearch(""):(e.stopPropagation(),e.keyCode===l.UP?(e.preventDefault(),f.highlightPreviousRow()):e.keyCode===l.DOWN?(e.preventDefault(),f.highlightNextRow()):void 0)},_handleInputSubmit:function(e){return e.preventDefault(),0===_.highlightedSearchRow()?this.props.onSearch(this.state.normalizedQuery):this.props.onFileOrFolderOpen(_.highlightedSuggestion())},_handleHighlightDropdownItem:function(e){return f.setHighlightedRow({index:e})},render:function(){var e;return e=r.extend({onInputChange:this._handleInputChange,onInputKeydown:this._handleInputKeydown,onInputSubmit:this._handleInputSubmit,onSearchBarFocus:f.focusSearchBar,onSearchBarBlur:f.blurSearchBar,onHighlightDropdownItem:this._handleHighlightDropdownItem,ref:"searchBarView",highlightedRow:_.highlightedSearchRow()},this.state,this.props),C(D,e)}}),D=s.createClass({displayName:"SearchBarView",propTypes:{isSearchActive:s.PropTypes.bool.isRequired,isActive:s.PropTypes.bool.isRequired,isFocused:s.PropTypes.bool.isRequired,onFileOrFolderOpen:s.PropTypes.func.isRequired,onInputChange:s.PropTypes.func.isRequired,onInputKeydown:s.PropTypes.func.isRequired,onInputSubmit:s.PropTypes.func.isRequired,onSearch:s.PropTypes.func.isRequired,onSearchBarBlur:s.PropTypes.func.isRequired,onSearchBarFocus:s.PropTypes.func.isRequired,onHighlightDropdownItem:s.PropTypes.func.isRequired,currentPath:s.PropTypes.string.isRequired,highlightedRow:s.PropTypes.number.isRequired,suggestions:s.PropTypes.array.isRequired,rawQuery:s.PropTypes.string,normalizedQuery:s.PropTypes.string,limitedTeamBannerUpsell:s.PropTypes.bool,trademarkBusiness:s.PropTypes.string},getDefaultProps:function(){return{rawQuery:"",normalizedQuery:""}},componentDidUpdate:function(e){return this.props.normalizedQuery&&!_.isSearchBarLoading()?g.polite(O("Found %(num)s search result","Found %(num)s search results",this.props.suggestions.length).format({num:this.props.suggestions.length})):void 0},handleNavigation:function(){var e;return e=this.refs.searchBarInput.refs.searchBarTextInput.getDOMNode(),e.blur()},_renderUpsellBar:function(){return this.props.limitedTeamBannerUpsell?N.div({className:"search-bar__upsell"},N.div({className:"search-bar__upsell__message"},P("Search through file contents in addition to file names with %(trademark_business)s").format({trademark_business:this.props.trademarkBusiness})),N.div({className:"search-bar__upsell__action"},C(u.button,{className:"search-bar__upsell__cta-button",onClick:function(){return y.redirect(n({path:"/team/upgrade",query:{tk:"search_upsell_bar",camp:"web"}}))},onMouseDown:function(e){return e.stopPropagation(),e.preventDefault()}},P("Upgrade")))):void 0},render:function(){var e,t,s;return e={"search-bar":!0,"is-expanded":this.props.isSearchActive,"is-focused":this.props.isFocused,"is-active":this.props.isActive},N.div({className:"search-bar--container u-l-fr"},N.div({className:R(e)},s=C(I,{isActive:this.props.isActive,isFocused:this.props.isFocused,onFileOrFolderOpen:this.props.onFileOrFolderOpen,onInputChange:this.props.onInputChange,onInputKeydown:this.props.onInputKeydown,onInputSubmit:this.props.onInputSubmit,onSearchBarBlur:this.props.onSearchBarBlur,onSearchBarFocus:this.props.onSearchBarFocus,rawQuery:this.props.rawQuery,highlightedRow:this.props.highlightedRow,ref:"searchBarInput"}),(null!=(t=this.props.normalizedQuery)?t.length:void 0)?C(T,{onFileOrFolderOpen:function(e){return function(t){return e.props.onFileOrFolderOpen(t),e.handleNavigation()}}(this),onSearch:function(e){return function(t){return e.props.onSearch(t),e.handleNavigation()}}(this),currentPath:this.props.currentPath,highlightedRow:this.props.highlightedRow,isOpen:this.props.isFocused,normalizedQuery:this.props.normalizedQuery,onHighlightDropdownItem:this.props.onHighlightDropdownItem,ref:"searchBarDropdown",suggestions:this.props.suggestions,bottomBanner:this._renderUpsellBar()}):void 0))}}),I=s.createClass({displayName:"SearchBarInput",propTypes:{isActive:s.PropTypes.bool.isRequired,isFocused:s.PropTypes.bool.isRequired,onFileOrFolderOpen:s.PropTypes.func.isRequired,onInputChange:s.PropTypes.func.isRequired,onInputKeydown:s.PropTypes.func.isRequired,onInputSubmit:s.PropTypes.func.isRequired,onSearchBarBlur:s.PropTypes.func.isRequired,onSearchBarFocus:s.PropTypes.func.isRequired,rawQuery:s.PropTypes.string,highlightedRow:s.PropTypes.number.isRequired},componentDidMount:function(){return e(this.refs.searchBarTextInput.getDOMNode()).on("keydown.SearchBarInput",this.props.onInputKeydown),e(this.refs.searchBarTextInput.getDOMNode()).on("focusout.SearchBarInput",this.props.onSearchBarBlur)},componentWillUnmount:function(){return e(this.refs.searchBarTextInput.getDOMNode()).off(".SearchBarInput")},_onSubmit:function(e){return this.refs.searchBarTextInput.getDOMNode().blur(),this.props.onInputSubmit(e)},render:function(){return N.form({className:"search-bar__input",onSubmit:this._onSubmit},N.input({"aria-activedescendant":"search-suggestion"+this.props.highlightedRow,"aria-autocomplete":"list","aria-expanded":this.props.isFocused&&this.props.isActive,"aria-label":P("Search"),"aria-owns":"search-bar__suggestions",className:"search-bar__text-input",onChange:this.props.onInputChange,onFocus:this.props.onSearchBarFocus,placeholder:P("Search"),ref:"searchBarTextInput",role:"combobox",value:this.props.rawQuery}),N.input({"aria-label":P("Search"),className:"search-bar__button",ref:"searchBarSearchButton",type:"submit",value:""}))}}),T=s.createClass({displayName:"SearchBarDropdown",propTypes:{isOpen:s.PropTypes.bool.isRequired,onFileOrFolderOpen:s.PropTypes.func.isRequired,onSearch:s.PropTypes.func.isRequired,onHighlightDropdownItem:s.PropTypes.func.isRequired,currentPath:s.PropTypes.string.isRequired,normalizedQuery:s.PropTypes.string.isRequired,suggestions:s.PropTypes.array.isRequired,bottomBanner:s.PropTypes.element},render:function(){var e,t,s,r;return r=_.isSearchBarLoading(),!r&&this.props.isOpen&&this.props.bottomBanner&&!this._banner_view_logged&&(this._banner_view_logged=!0,E.log("banner_search_displayed",{location:"search_bar",item_count:this.props.suggestions.length})),e={"search-bar__dropdown":!0,"is-expanded":this.props.isOpen},N.div({className:R(e),"aria-hidden":!this.props.isOpen},N.ul({className:"search-bar__suggestions",id:"search-bar__suggestions",role:"listbox"},C(w,{onSearch:this.props.onSearch,onHighlightDropdownItem:this.props.onHighlightDropdownItem,currentPath:this.props.currentPath,normalizedQuery:this.props.normalizedQuery,highlightedRow:this.props.highlightedRow}),function(){var e,r,n,o;if(this.props.suggestions.length){for(n=this.props.suggestions,o=[],s=e=0,r=n.length;r>e;s=++e)t=n[s],o.push(C(F,{file:t,key:t.fq_path,onFileOrFolderOpen:this.props.onFileOrFolderOpen,onHighlightDropdownItem:this.props.onHighlightDropdownItem,rank:s,highlightedRow:this.props.highlightedRow}));return o}}.call(this)),r?N.div({className:"search-bar__loading"},N.span({className:"ax-visually-hidden"},P("Loading search..."))):this.props.bottomBanner)}}),w=s.createClass({displayName:"SearchBarDropdownSearchItem",propTypes:{onSearch:s.PropTypes.func.isRequired,onHighlightDropdownItem:s.PropTypes.func.isRequired,currentPath:s.PropTypes.string.isRequired,normalizedQuery:s.PropTypes.string.isRequired,highlightedRow:s.PropTypes.number.isRequired},render:function(){var e,t;return t=0===this.props.highlightedRow,e={"search-bar__suggestion":!0,"search-bar__suggestion--is-highlighted":t},N.li({className:R(e),id:"search-dropdown-query",onMouseDown:function(e){return function(){return e.props.onSearch(e.props.normalizedQuery)}}(this),onMouseEnter:function(e){return function(){return e.props.onHighlightDropdownItem(0)}}(this),role:"option","aria-selected":t},N.div({className:"search-bar__suggestion-icon--search"}),N.div({className:"search-bar__suggestion-name"},b({current_path:i.filename(this.props.currentPath),query:this.props.normalizedQuery},"Search for ‘<strong>%(query)s</strong>’ in %(current_path)s")))}}),F=s.createClass({displayName:"SearchBarDropdownSuggestion",propTypes:{file:s.PropTypes.shape({filename_highlights:s.PropTypes.array,fq_path:s.PropTypes.string,icon:s.PropTypes.string}).isRequired,onFileOrFolderOpen:s.PropTypes.func.isRequired,onHighlightDropdownItem:s.PropTypes.func.isRequired,rank:s.PropTypes.number.isRequired,highlightedRow:s.PropTypes.number.isRequired},render:function(){var e,s,r,n,o;return s=i.filename(this.props.file.fq_path),r=m.highlightMatchString(s,this.props.file.filename_highlights),o=i.parent_dir(this.props.file.fq_path),n=this.props.rank+1,e={"search-bar__suggestion":!0,"search-bar__suggestion--is-highlighted":n===this.props.highlightedRow},N.li({className:R(e),id:"search-dropdown-suggestion"+n,role:"option",onMouseDown:function(e){return function(){return e.props.onFileOrFolderOpen(e.props.file)}}(this),onMouseEnter:function(e){return function(){return e.props.onHighlightDropdownItem(n)}}(this)},C(h,{group:"web",name:this.props.file.icon,className:"search-bar__suggestion-icon",alt:""}),N.div({className:"search-bar__suggestion-name",dangerouslySetInnerHTML:{__html:t.sanitize(r)}}),N.div({className:"search-bar__suggestion-desc"},b({location:o,comment:"Describes the parent directory of a file in a list of search results."},"<span title='%(location)s'>in %(location)s</span>")))}}),v=c(v,["/static/css/search/search_bar_react-vflWyVw-a.css"])})}.call(this),function(){var e=function(e,s){function r(){this.constructor=e}for(var n in s)t.call(s,n)&&(e[n]=s[n]);return r.prototype=s.prototype,e.prototype=new r,e.__super__=s.prototype,e},t={}.hasOwnProperty;define("modules/clean/search/store",["external/immutable","modules/clean/ajax","modules/clean/flux/base_store","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/selectable_list","modules/clean/search/constants","modules/clean/viewer"],function(t,s,r,n,o,i,a,l){var u,c,d,p,h,f,m,_;return u=n.BrowseActionTypes,d=o.File,c=o.BrowseContext,_=i.createSelection,p=a.MaxResults,h=a.SearchActionTypes,f=a.SearchLoadingStates,new(m=function(s){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,s),r.prototype._init=function(){return this._resetSearchBar(),this._resetSearchResults()},r.prototype._resetSearchBar=function(){return this._isSearchBarFocused=!1,this._isSearchBarLoading=!1,this._rawQuery="",this._normalizedQuery="",this._searchSuggestions=[],this._highlightedSearchRow=0},r.prototype._resetSearchResults=function(){return this._browseContext=new c,this._latestQuery="",this._loadingState=f.LOADED,this._searchResults=t.List(),this._selection=_(),this._hasMoreLiveResults=!0,this._numDeletedResults=0,this._hasMoreDeletedResults=!0,this._didLoadDeletedResults=!1},r.prototype.isSearchBarFocused=function(){return this._isSearchBarFocused},r.prototype.isSearchBarActive=function(){return!!this._rawQuery},r.prototype.isSearchBarLoading=function(){return this._isSearchBarLoading},r.prototype.rawQuery=function(){return this._rawQuery},r.prototype.normalizedQuery=function(){return this._rawQuery.trim().replace(/\ +/g," ")},r.prototype.searchSuggestions=function(){return this._searchSuggestions},r.prototype.highlightedSearchRow=function(){return this._highlightedSearchRow},r.prototype.highlightedSuggestion=function(){var e,t;return t=this._highlightedSearchRow-1,e=this._searchSuggestions[t],this._searchSuggestions[t]},r.prototype.browseContext=function(){return this._browseContext},r.prototype.latestQuery=function(){return this._latestQuery},r.prototype.loadingState=function(){return this._loadingState},r.prototype.searchResults=function(){return this._searchResults},r.prototype.hasMoreResults=function(e){return null==e&&(e=!1),this._hasMoreLiveResults||e&&this._hasMoreDeletedResults},r.prototype.numDeletedResults=function(){return this._numDeletedResults},r.prototype.didLoadDeletedResults=function(){return this._didLoadDeletedResults},r.prototype.selection=function(){return this._selection},r.prototype.selectedFiles=function(){return this._searchResults.filter(function(e){return function(t){return e._selection.selected.has(t.fq_path)}}(this)).toOrderedSet()},r.prototype._focusSearchBar=function(){return this._isSearchBarFocused=!0,this._highlightedSearchRow=0,this.emit_change()},r.prototype._blurSearchBar=function(){return this._isSearchBarFocused=!1,this.emit_change()},r.prototype._setSearchQuery=function(e){var t;return t=e.query,this._rawQuery=t,this._searchSuggestions=[],this._highlightedSearchRow=0,this._isSearchBarLoading=!!this.normalizedQuery(),this.emit_change()},r.prototype._setSearchSuggestions=function(e){var t,s;return t=e.searchResults,this._isSearchBarLoading=!1,this._searchSuggestions=function(){var e,r,n;for(n=[],e=0,r=t.length;r>e;e++)s=t[e],n.push(d.fromServerObject(s));return n}(),this.emit_change()},r.prototype._setHighlightedSearchRow=function(e){var t;return t=e.index,this._highlightedSearchRow=t,this.emit_change()},r.prototype._highlightPreviousSearchRow=function(){return this._highlightedSearchRow=Math.max(0,this._highlightedSearchRow-1),this.emit_change()},r.prototype._highlightNextSearchRow=function(){return this._highlightedSearchRow=Math.min(this._searchSuggestions.length,this._highlightedSearchRow+1),this.emit_change()},r.prototype._startSearch=function(e){var t;return t=e.query,this._resetSearchResults(),this._rawQuery=t,this._latestQuery=this.normalizedQuery(),this._loadingState=f.LOADING_FIRST_PAGE,this.emit_change()},r.prototype._setSearchResults=function(e){var s,r,n;return n=e.searchResults,s=e.context,this._searchResults=t.List(function(){var e,t,s;for(s=[],e=0,t=n.length;t>e;e++)r=n[e],s.push(d.fromServerObject(r));return s}()),this._loadingState=f.LOADED,this._browseContext=s,this._updateMoreResults(n),this.emit_change()},r.prototype._continueSearch=function(e){var t;return t=e.didLoadDeletedResults,t&&(this._didLoadDeletedResults=!0),this._loadingState=f.LOADING_ADDITIONAL_PAGE,this.emit_change()},r.prototype._appendSearchResults=function(e){var t,s,r,n,o;return s=e.deleted,o=e.searchResults,t=e.context,s&&(this._numDeletedResults+=o.length),r=function(){var e,t,s;for(s=[],e=0,t=o.length;t>e;e++)n=o[e],s.push(d.fromServerObject(n));return s}(),this._searchResults=this._searchResults.concat(r),this._loadingState=f.LOADED,this._browseContext=t,this._updateMoreResults(o),this.emit_change()},r.prototype._clearSearch=function(){return this._resetSearchBar(),this._resetSearchResults(),this.emit_change()},r.prototype._updateMoreResults=function(e){var t;return t=e.length===p.MAX_SEARCH_RESULTS,this._hasMoreLiveResults?this._hasMoreLiveResults=t:this._hasMoreDeletedResults?this._hasMoreDeletedResults=t:void 0},r.prototype._setSearchSelection=function(e){var t;return t=e.selection,this._selection=t,this.emit_change()},r.prototype._new_payload=function(e){switch(e.action.type){case h.FOCUS_SEARCH_BAR:return this._focusSearchBar();case h.BLUR_SEARCH_BAR:return this._blurSearchBar();case h.SET_SEARCH_QUERY:return this._setSearchQuery(e.action.data);case h.SET_SEARCH_SUGGESTIONS:return this._setSearchSuggestions(e.action.data);case h.SET_HIGHLIGHTED_ROW:return this._setHighlightedSearchRow(e.action.data);case h.HIGHLIGHT_PREVIOUS_ROW:return this._highlightPreviousSearchRow();case h.HIGHLIGHT_NEXT_ROW:return this._highlightNextSearchRow();case h.START_SEARCH:return this._startSearch(e.action.data);case h.SET_SEARCH_RESULTS:return this._setSearchResults(e.action.data);case h.CONTINUE_SEARCH:return this._continueSearch(e.action.data);case h.APPEND_SEARCH_RESULTS:return this._appendSearchResults(e.action.data);case h.SET_SEARCH_SELECTION:
return this._setSearchSelection(e.action.data);case h.CLEAR_SEARCH:return this._clearSearch();case u.SET_URL:return this._clearSearch()}},r}(r))})}.call(this),function(){define("modules/clean/sharing/models/file",["modules/clean/react/browse/constants","modules/constants/legacy"],function(e,t){var s,r;return s=e.FileTypes,r=function(e,r){var n;return e.type!==s.FOLDER?!1:(r.config.isPublicFolderEnabled||null!=r.config.publicAppToken)&&(n=e.fq_path.toLowerCase(),"/public"===n||n.startsWith("/public/"))?!1:r.isCurrentPathWriteable()?!(e.ns_id!==t.root_ns&&!r.currentNSAllowsNesting):!1},{canConvertToSharedFolder:r}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/dirty/react/browse/actions",["jquery","external/underscore","modules/constants/env","modules/constants/viewer","modules/clean/css","modules/clean/em_string","modules/clean/history","modules/clean/browse_interface","modules/clean/filepath","modules/clean/file_operations/notifications","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/dispatcher","modules/clean/react/browse/store","modules/clean/react/file_modal_controller","modules/clean/react/selectable_list","modules/clean/search/constants","modules/clean/search/dispatcher","modules/clean/undo","modules/constants/python","modules/constants/request","modules/constants/viewer","modules/core/browser","modules/core/cookies","modules/core/exception","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","modules/dirty/react/file_viewer/controller","modules/clean/downloads"],function(t,s,r,n,o,i,a,l,u,c,d,p,h,f,m,_,g,y,S,b,v,T,w,F,I,D,E,P,C,R,N){var O,A,x,M,L,U,k,B,q,H,G,V,W,j,z,K,Q,Y,J;return O=p.BrowseActionTypes,M=p.Direction,B=p.FileTypes,q=p.LoadingStates,H=p.REACT_FILE_VIEWER_ELEMENT_ID,L=p.ELEMENTS_BEHIND_REACT_FILE_VIEWER,V=p.SEARCH_PREFIX,U=f.File,x=f.BrowseStore,k=m.FileModalController,Y=_.createSelection,W=g.SearchActionTypes,G=T.ROLE_WORK,Q=I.assert,j=E._,J=E.ungettext,z=["#page-header","#page-sidebar","#browse-box",".growth-onboarding-progress-bar__container",".team-progress-bar-experience","#flash-upload-container"].join(),K=function(e){var r,n,o,i,a,l,u,c,d,p;return r=e.files,n=e.indexOfPreviewFile,p=e.user,c=e.shouldFocusComment,d=null!=(a=e.updateBrowserLocation)?a:!0,o=null!=(l=e.onCloseViewer)?l:s.noop,i=null!=(u=e.onViewerUnmount)?u:s.noop,R.open(r,n,p,H,{fileViewTarget:b.FileViewTargetType.PRIVATE,fileViewOrigin:b.FileViewOriginType.BROWSE,fileViewAction:b.FileViewActionType.CLICK,shouldFocusCommentInput:c,disableRouting:!d,onCloseViewer:o,onComponentDidMount:function(){return t(z).hide()},onComponentWillUnmount:function(){return t(z).show(),i()}})},new(A=function(){function o(){this.setShouldShowDeletedFiles=e(this.setShouldShowDeletedFiles,this),this.navigateToParentFolder=e(this.navigateToParentFolder,this),this.navigateToFileOrFolder=e(this.navigateToFileOrFolder,this),this.computeAndApplyDeltasFromNotServer=e(this.computeAndApplyDeltasFromNotServer,this),this.pasteClipboardFilesToCurrentPath=e(this.pasteClipboardFilesToCurrentPath,this)}return o.prototype.initializeEverything=function(e){var t,s,r,n,o,i,a,l,u;return u=e.user,i=e.path,s=e.files,l=e.urlPrefix,t=e.context,o=e.mountPoints,a=e.shouldShowDeletedFiles,r=e.fqPathsToSelect,n=e.loadingState,h.dispatch({type:O.INITIALIZE_EVERYTHING,data:{user:u,path:i,files:s,urlPrefix:l,context:t,mountPoints:o,shouldShowDeletedFiles:a,fqPathsToSelect:r,loadingState:n}})},o.prototype.load=function(e){var t,s,r;return r=e.path,s=e.files,t=e.context,h.dispatch({type:O.LOAD_PATH,data:{path:r,files:s,context:t}})},o.prototype.add=function(e){var t,s;return s=e.path,t=e.files,h.dispatch({type:O.ADD_FILES,data:{path:s,files:t}})},o.prototype.setLoadingState=function(e){var t;return t=e.loadingState,h.dispatch({type:O.SET_LOADING_STATE,data:{loadingState:t}})},o.prototype.setMountPoints=function(e){var t;return t=e.mountPoints,h.dispatch({type:O.SET_MOUNT_POINTS,data:{mountPoints:t}})},o.prototype.setPath=function(e){var t,s;return s=e.path,t=e.onPathLoaded,h.dispatch({type:O.SET_PATH,data:{path:s}}),this.setLoadingState({loadingState:q.LOADING_FIRST_PAGE}),d.loadPath({path:s,userId:x.user().id,sortFoldersFirst:!w.mac,includeDeletedFiles:x.shouldShowDeletedFiles(),pathLoadCallback:function(e){return function(s){var r,n,o;return o=s.path,n=s.files,r=s.context,e.load({path:o,files:n,context:r}),"function"==typeof t?t():void 0}}(this),filesAppendCallback:this.add,loadingStateCallback:this.setLoadingState,mountPointCallback:this.setMountPoints,onError:function(e){return function(){return"/"!==s?e.setPath({path:"/",onPathLoaded:t}):void 0}}(this)})},o.prototype.reloadCurrentPath=function(){return this.setPath({path:x.path()})},o.prototype.setUser=function(e){var t;return t=e.user,h.dispatch({type:O.SET_USER,data:{user:t}})},o.prototype.updatePreview=function(e){var t;return t=e.files,R.updateFiles(t)},o.prototype.closeFileViewer=function(){return R.close()},o.prototype.setUrlPrefix=function(e){var t;return t=e.prefix,h.dispatch({type:O.SET_URL_PREFIX,data:{prefix:t}})},o.prototype.setUrl=function(e){var t,s,r,n,o,i;t=e.path,s=e.prefix,r=e.qargs,s===V?(i=x.user(),o=i.role===G?l.WORK_ROOT:l.PERSONAL_ROOT,s+=o,a.push_state(s,r)):(n={},"1"===a.deconstruct_url().qargs.d&&(n.d="1"),a.push_state(x.urlPrefix()+C.encode_parts(t),n),h.dispatch({type:O.SET_SELECTION,data:{selection:Y()}}))},o.prototype.copySelectedFilesToClipboard=function(){var e,t;return e=x.selectedFiles(),e&&e.size?e.some(function(e){return e.isDeleted})?(P.error(j("Deleted files cannot be added to the clipboard")),!1):(t=J("Added %(num_items)s item to clipboard","Added %(num_items)s items to clipboard",e.size).format({num_items:e.size}),P.success(t),h.dispatch({type:O.COPY_SELECTED_FILES_TO_CLIPBOARD})):void 0},o.prototype.pasteClipboardFilesToCurrentPath=function(){return this.copyFiles({files:x.clipboardFiles().toArray(),newPath:x.path()})},o.prototype.selectRowsFromNotServer=function(e){return null==e&&(e=[]),this.setFilePathsToSelectOnNextUpdate({fqPathsToSelect:e.map(function(e){return e.fq_path})})},o.prototype.setFilePathsToSelectOnNextUpdate=function(e){var t;return t=e.fqPathsToSelect,h.dispatch({type:O.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE,data:{fqPathsToSelect:t}})},o.prototype.copyFiles=function(e){var t,s,r;return t=e.files,s=e.newPath,r=x.user(),d.copyFiles({files:t,newPath:s,userId:r.id,onSuccess:function(e){return function(n){var o,i;return i=n.files,o=n.changesets,c.notifyCopySuccess(t.length,r,o,s,function(){return e.selectRowsFromNotServer(t)}),e.selectRowsFromNotServer(i)}}(this)})},o.prototype.deleteFiles=function(e){var t,s;return t=e.files,s=x.user(),d.deleteFiles({files:t,userId:s.id,onSuccess:function(e){var r,n;return n=e.fileDeltas,r=e.changesets,c.notifyDeleteSuccess(t.length,s,r,function(e){return function(){return e.selectRowsFromNotServer(t)}}(this))}})},o.prototype.moveFiles=function(e){var t,s,r,n;return r=e.path,t=e.files,s=e.newPath,n=x.user(),d.moveFiles({path:r,files:t,newPath:s,userId:n.id,onSuccess:function(e){return function(r){var o,i,a;return a=r.path,i=r.fileDeltas,o=r.changesets,c.notifyMoveSuccess(t.length,n,o,s,function(){return e.selectRowsFromNotServer(t)})}}(this)})},o.prototype.showFileRename=function(e){var t;return t=e.file,h.dispatch({type:O.REQUEST_NEW_FILE_NAME,data:{file:t}})},o.prototype.cancelFileRename=function(e){var t;return t=e.file,h.dispatch({type:O.CANCEL_FILE_RENAME,data:{file:t}})},o.prototype.renameFile=function(e){var t,s,r;return t=e.file,s=e.newName,h.dispatch({type:O.SET_FILE_RENAME_PENDING,data:{file:t}}),r=x.user(),d.renameFile({file:t,newName:s,userId:r.id,onSuccess:function(e){return function(s){var n,o;return o=s.renamedFile,n=s.changesets,c.notifyRenameSuccess(r,n,function(){return e.selectRowsFromNotServer([t])}),e.selectRowsFromNotServer([o])}}(this),onError:function(e){return function(s,r,n){return e.cancelFileRename({file:t})}}(this)})},o.prototype.applyFileDeltas=function(e){var t,s;return s=e.path,t=e.fileDeltas,h.dispatch({type:O.CHANGE_FILES,data:{path:s,fileDeltas:t}})},o.prototype._getMountPointUpdateForCurrentPath=function(e){var t,r,n,o,i,a,l,u;return n=x.path(),t=(null!=(u=x.mountPoints())?u.toJS():void 0)||{},o=function(e){return function(e){return e===n}}(this),r=parseInt(s.findKey(t,o),10),r?(a=e[r]||null,l=t[r]||null):(l=null,i=Boolean(s.findKey(e,o)),a=i?n:null),[l,a]},o.prototype._getPathForNewMountPoint=function(e,t){return e&&!t?x.path():e&&t?u.paths_are_equal(e,t)?null:t:!e&&t?x.path():null},o.prototype._showUserNotificationForPathChange=function(e,t){var r,n,o,i,a,c,d,p,h;return c=t.old_fq_path,h=l.get_browse_root(e)+t.new_fq_path,r=function(e){return s.escape(u.filename(e))},o=function(e){return P.success(new D(e))},n=function(e){return P.error(new D(e))},a=!t.is_changing_view,i=null!=(p=t.change_type)?p.toLowerCase():void 0,"moved"===i?a?o(j("This folder has been moved")):(d=j('The folder ‘%(folder_name)s’ has been moved. <a href="%(href)s">View</a>'),d=d.format({folder_name:r(c),href:s.escape(h)}),n(d)):"renamed"===i?a?(d=j("This folder has been renamed to ‘%(folder_name)s’"),d=d.format({folder_name:r(t.change_to_fq_path)}),o(d)):(d=j('The folder ‘%(folder_name)s’ has been renamed. <a href="%(href)s">View</a>'),d=d.format({folder_name:r(c),href:s.escape(h)}),n(d)):"deleted"===i?(d=j("The folder ‘%(folder_name)s’ has been deleted"),d=d.format({folder_name:r(c)}),n(d)):void 0},o.prototype.computeAndApplyDeltasFromNotServer=function(e){var t,s,r,n,o,i,a,l,u,c,d,p,h,f,m,_,g,y,S,b,v,T,w,F,I,D;if(S=e.path,b=e.payload,t=b.added,m=b.moved,F=b.removed,f=b.mount_points,y=b.parent_changes,null!=y?y.change_to_fq_path:void 0)return D=x.user(),this._showUserNotificationForPathChange(D,y),void this.setUrl({path:y.change_to_fq_path});if(T=this._getMountPointUpdateForCurrentPath(f),n=T[0],_=T[1],n&&!_&&P.success(j("The folder was unshared.")),I=this._getPathForNewMountPoint(n,_))return void this.setPath({path:I});for(this.setMountPoints({mountPoints:f}),o=x.filesMap(),i=[],l=0,d=t.length;d>l;l++)g=t[l],r=null,s=U.fromServerObject(g),i.push({before:r,after:s});for(u=0,p=m.length;p>u;u++)w=m[u],v=w[0],g=w[1],r=o.get(v,null),s=U.fromServerObject(g),i.push({before:r,after:s});for(c=0,h=F.length;h>c;c++)a=F[c],r=o.get(a,null),s=null,i.push({before:r,after:s});return this.applyFileDeltas({path:S,fileDeltas:i})},o.prototype.setSelection=function(e){var t;return t=e.selection,h.dispatch({type:O.SET_SELECTION,data:{selection:t}})},o.prototype.selectFilesByFqPath=function(e){var t;return t=e.fqPathsToSelect,h.dispatch({type:O.SELECT_FILES_BY_FQ_PATH,data:{fqPathsToSelect:t}})},o.prototype.toggleFqPathSelected=function(e){var t;return t=e.path,h.dispatch({type:O.TOGGLE_FQ_PATH_SELECTED,data:{path:t}})},o.prototype.navigateToFileOrFolder=function(e){var t,s,r,n,o,i,a;return t=e.file,a=null!=(o=e.shouldFocusComment)?o:!1,n=e.onFileViewerUnmount,t.is_dir?this.setUrl({path:t.fq_path}):(s=x.getIndexOfFile(t),s>-1?r=null!=(i=x.files())?i.toJS():void 0:(s=0,r=[t]),t.isDeleted?k.showRestore(x.user(),[t]):"download"===t.preview_type?w.unsafe_open_tab(t.href):K({files:r,indexOfPreviewFile:s,shouldFocusComment:a,user:x.user(),onViewerUnmount:n}))},o.prototype.openPreviewForFile=function(e){var t,s;return t=e.file,s=e.onCloseViewer,K({files:[t],indexOfPreviewFile:0,user:x.user(),updateBrowserLocation:!1,onCloseViewer:function(){return"function"==typeof s?s():void 0}})},o.prototype.navigateToParentFolder=function(){var e;return e=u.parent_dir(x.path()),this.setUrl({path:e})},o.prototype.setShouldShowDeletedFiles=function(e){var t,s,r;return r=e.shouldShowDeletedFiles,s=null!=(t=e.shouldReloadFolder)?t:!0,r?a.update_query_param("d","1"):a.remove_query_param("d"),h.dispatch({type:O.SET_SHOULD_SHOW_DELETED_FILES,data:{shouldShowDeletedFiles:r}}),s?this.reloadCurrentPath():void 0},o.prototype.sortFiles=function(e){var t,s;return s=e.sortField,t=e.direction,h.dispatch({type:O.SORT_FILES,data:{sortField:s,direction:t}})},o.prototype.setCopyMode=function(e){var t;return t=e.copyMode,h.dispatch({type:O.SET_COPY_MODE,data:{copyMode:t}})},o.prototype.downloadFiles=function(e){var t,s,r,n,o,i;return r=e.files,t=e.context,i=e.user,1!==r.count()||r.first().is_dir?t.blockHash?(o=t.currentFQPath,n=function(){var e,t,n,o;for(n=r.toArray(),o=[],e=0,t=n.length;t>e;e++)s=n[e],o.push(s.fq_path);return o}(),N.get_zip({fq_paths:n,subject_uid:i.id,block_hash:t.blockHash,parent_path:o})):!1:void N.get_blockserver_link({url:r.first().direct_blockserver_link})},o.prototype.nameNewFolder=function(){return h.dispatch({type:O.REQUEST_FOLDER_NAME})},o.prototype.createFolder=function(e){var t,s,r;return s=e.pathName,t=e.folderName,h.dispatch({type:O.CREATE_FOLDER_PENDING}),r=x.user(),d.createNewFolder({pathName:s,folderName:t,userId:r.id,onSuccess:function(e){return function(s){var n,o;return n=s.changesets,o=s.createdFolder,h.dispatch({type:O.CREATE_FOLDER_COMPLETE}),c.notifyFolderCreationSuccess(t,r,n),e.selectRowsFromNotServer([o])}}(this),onError:function(){return h.dispatch({type:O.CANCEL_CREATE_FOLDER})}})},o.prototype.cancelCreateFolder=function(){return h.dispatch({type:O.CANCEL_CREATE_FOLDER})},o.prototype.addCommentStatusBatch=function(e){var t;return t=e.commentStatusByFqPath,h.dispatch({type:O.ADD_COMMENT_STATUS_BATCH,data:{commentStatusByFqPath:t}})},o.prototype.viewInPhotos=function(e){var s,o,i,a,l,u,c,d,p,h;return l=e.files,h=e.user,l=l.toArray(),u=C({scheme:"https",authority:r.WEBSERVER,path:"/app/view_in_timeline"}).updateQuery(n.UID_PARAM_NAME,h.id).toString(),p=t("<form>",{action:u,method:"post"}),o=t("<input>",{name:"t",value:F.read(v.JS_CSRF_COOKIE)}),o.appendTo(p),c=JSON.stringify(function(){var e,t,s;for(s=[],e=0,t=l.length;t>e;e++)a=l[e],s.push(a.ns_id);return s}()),s=t("<input>",{name:"ns_ids",value:c}),s.appendTo(p),d=JSON.stringify(function(){var e,t,s;for(s=[],e=0,t=l.length;t>e;e++)a=l[e],s.push(a.ns_path);return s}()),i=t("<input>",{name:"ns_paths",value:d}),i.appendTo(p),t(document.body).append(p),p.submit(),p.remove()},o.prototype.createAlbum=function(e){var t,s,r;return t=e.file,r=e.user,s=u.filename(t.fq_path),d.createAlbum({folder:t.fq_path,name:s,userId:r.id,onSuccess:function(e){var t;return t=e.url,w.redirect(t)}})},o.prototype.setDropTarget=function(e){var t;return t=e.target,h.dispatch({type:O.SET_DROP_TARGET,data:{target:t}})},o}())})}.call(this),function(){define("modules/dirty/react/browse/browse",["jquery","external/immutable","external/react","external/underscore","external/classnames","modules/clean/account/email","modules/clean/browse_interface","modules/clean/em_string","modules/clean/flux/store_mixin","modules/clean/history","modules/clean/notserver","modules/clean/pagination_manager","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/keyboard_shortcuts","modules/clean/react/browse/store","modules/clean/react/css","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/uploader","modules/clean/react/file_uploader/store","modules/clean/react/outside_event","modules/clean/search/actions","modules/clean/search/search_bar","modules/clean/search/store","modules/clean/sharing/ui_util","modules/clean/viewer","modules/clean/web_timing_logger","modules/constants/comments_panel","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri","modules/dirty/react/browse/actions","modules/dirty/react/browse/browse_location","modules/dirty/react/browse/comment_status","modules/dirty/react/browse/context_menu","modules/dirty/react/browse/file_list","modules/dirty/react/browse/global_actions","modules/dirty/react/browse/selection_actions","modules/dirty/react/browse/preview_sf_members","modules/dirty/react/file_viewer/controller","modules/dirty/search/search_results","modules/dirty/sharing/browse_ui_util"],function(e,t,s,r,n,o,i,a,l,u,c,d,p,h,f,m,_,g,y,S,b,v,T,w,F,I,D,E,P,C,R,N,O,A,x,M,L,U,k,B,q,H,G){var V,W,j,z,K,Q,Y,J,X,Z,$,ee,te,se,re,ne,oe,ie,ae,le,ue,ce,de,pe,he,fe,me,_e,ge;return X=o.EmailVerification,oe=c.NotClients,le=h.REACT_FILE_VIEWER_ELEMENT_ID,J=h.DropTargetHighlightMode,ee=h.FileTypes,re=h.LoadingStates,ne=h.NameSpaceAccess,ce=h.ShareFolderModalTypes,ue=h.SEARCH_PREFIX,K=m.BrowseStore,Z=m.File,W=m.BrowseContext,de=g.UploaderActions,te=y.FileUploader,pe=S.UploaderStore,ie=b.OutsideMouseDownHandler,ge=F.showZendeskFlyoutIfAllowed,he=C._,j=M.BrowseContextMenu,$=L.FileListController,se=U.GlobalActions,z=k.BrowseSelectionMenu,ae=B.PreviewSFMembersPanel,_e=G.showTiburonUIIfAllowed,me=s.DOM,fe=s.createElement,V=s.createClass({displayName:"BrowseAppController",mixins:[l(K,pe,w)],propTypes:{"from-scl-sync-modal":s.PropTypes.bool,"init-data":s.PropTypes.object,"limited-team-banner-upsell":s.PropTypes.bool,"notify-path-does-not-exist":s.PropTypes.string,"notify-path-is-deleted":s.PropTypes.string,"share-link":s.PropTypes.bool,"share-prefill-email":s.PropTypes.string,"trademark-business":s.PropTypes.string,"email-just-verified":s.PropTypes.bool,"email-just-verified-and-changed":s.PropTypes.bool,"send-verification-email":s.PropTypes.bool},_get_state_from_stores:function(){return{context:K.context(),files:K.files(),loadingState:K.loadingState(),path:K.path(),selection:K.selection(),selectedFiles:K.selectedFiles(),fileRename:K.fileRename(),user:K.user(),shouldShowDeletedFiles:K.shouldShowDeletedFiles(),isDraggingInternalFiles:pe.numDraggingFiles()>0&&pe.isInternalTransfer(),isDraggingExternalFiles:pe.numDraggingFiles()>0&&!pe.isInternalTransfer(),activeDropTarget:K.activeDropTarget(),isUploadModalOpen:pe.isUploadModalOpen(),isTextSelectable:!!K.fileRename(),inCopyMode:K.inCopyMode(),createNewFolderState:K.newFolderCreationState(),isSearchMode:!!w.latestQuery()}},_preloadLargeModules:function(){return require(["dropbox"])},componentWillMount:function(){var e,t,s,r,n,o,a,l,c,h,f,m,_,g,y,S,b,T;return this.previousHistoryCallbackPath=null,this.hasLoadedFilesForTheVeryFirstTime=!1,this.props["from-scl-sync-modal"]&&ge("tiburon_receive",he("You just received a folder with Dropbox")),T=I.get_viewer().get_user_by_id(this.props["user-id"]),b=i.get_browse_root(T,this.props["is-maestro"]),t=u.deconstruct_url(),_=this.props["init-fq-path"]||"/",g=Boolean(this.props["should-show-deleted-files"]),this._setupFileEventListener(T.id),a=this.props["init-data"],a?(e=p.extractBrowseContext(a),c=Boolean(a.paginated)?re.LOADING_REMAINING_PAGES:re.LOADED,l=c===re.LOADING_REMAINING_PAGES,s=l?[]:a.file_info,h=a.ns_id_to_mount_point,r=this.props["select-fq-paths"],O.initializeEverything({user:T,path:_,files:s,urlPrefix:b,context:e,mountPoints:h,fqPathsToSelect:r,loadingState:c,shouldShowDeletedFiles:g}),l&&(m=new d,f=function(e,t){return O.add({path:_,files:t}),e.areAllItemsReady()?(O.setLoadingState({loadingState:re.LOADED}),e.stopAutoFetching()):void 0},m.initialize(a.first_page,"sjid","/browse_get_next",T.id,f),"undefined"!=typeof RUNNING_IN_REACTSERVER&&null!==RUNNING_IN_REACTSERVER||m.startAutoFetching())):(O.setUrlPrefix({prefix:b}),O.setUser({user:T}),O.setShouldShowDeletedFiles({shouldShowDeletedFiles:g,shouldReloadFolder:!1}),r=this.props["select-fq-paths"],O.setFilePathsToSelectOnNextUpdate({fqPathsToSelect:r}),this.hasTTIBeenLogged=!1,this.props["search-query"]||this.navigateToPath(_)),this.props["search-query"]||(o=Boolean(this.props["preview-file-info"]),o||(S=this._getUrlForFQPath(_),this._sanitizeBrowserLocation(S))),n=Boolean(this.props["search-query"]),y=!n,u.add_callback(b,this.handleFileLocationChange,!0),u.add_callback(ue,this.handleSearchLocationChange,y),u.add_exit_callback(ue,v.clearSearch),this.setState(this._get_state_from_stores())},componentDidMount:function(){var e,t,s,r;return this.props["init-data"]&&(this.hasTTIBeenLogged||(D.mark_time_to_view(),D.mark_time_to_interactive(),this.hasTTIBeenLogged=!0,this._preloadLargeModules())),this._mountFileViewerTarget(),t=this.props["initial-share-modal-type"],r=this.props["preview-file-info"],r?(s=Z.fromServerObject(r),O.openPreviewForFile({file:s,onCloseViewer:this._restoreUrlAfterFileViewClose}),t&&_e(this.state.user,s,{origin:this.props["share-prefill-email"]?"GRANT_ACCESS":"DESKTOP_CLIENT",prefillEmail:this.props["share-prefill-email"]})):t&&this._showShareModal(t,this.state.path,this.state.user),this._maybeShowLegacySharedLinkModalIfQargPresent(),null!=this.props["notify-path-is-deleted"]?(e=he("The folder ‘%(folder_name)s’ is deleted.").format({folder_name:a.em_snippet(this.props["notify-path-is-deleted"],15)}),R.error(e)):null!=this.props["notify-path-does-not-exist"]&&(e=he("The folder ‘%(folder_name)s’ doesn’t exist.").format({folder_name:a.em_snippet(this.props["notify-path-does-not-exist"],15)}),R.error(e)),this.props["email-just-verified"]?X.getForRole(this.state.user.role).show_verified_modal():this.props["email-just-verified-and-changed"]?X.getForRole(this.state.user.role).show_verified_and_changed_modal():this.props["send-verification-email"]&&X.getForRole(this.state.user.role).show_sent_modal(),E.ALLOW_STATUS_IN_BROWSE?x.setup():void 0},componentWillUpdate:function(e,t){return t.files.equals(this.state.files)?void 0:setTimeout(function(e){return function(){return e.handleFileListUpdated()}}(this),0)},_restoreUrlAfterFileViewClose:function(){var e,t;return t=this._getUrlForFQPath(this.state.path),Boolean(this.props["loaded-with-explicit-preview"])?(e=u.deconstruct_url().qargs,delete e.preview):e={},u.replace_state(t,e)},_getUrlForFQPath:function(e){var t;return t="/"===e?"":N.encode_parts(e),K.urlPrefix()+t},_sanitizeBrowserLocation:function(e){var t,s;return t=u.deconstruct_url().qargs,s=r.pick(t,"d","select","preview"),u.replace_state(e,s)},_mountFileViewerTarget:function(){var e;return e=document.getElementById(le),e?void 0:(e=document.createElement("div"),e.id=le,document.body.insertBefore(e,document.body.children[0]))},_showShareModal:function(e,t,s){return _e(s,{fqPath:this.props["init-fq-path"],isFolder:!0,nsId:this.props["ns-id"]&&this.props["ns-path"]?this.props["ns-id"]:null,origin:this.props["share-prefill-email"]?"GRANT_ACCESS":"DESKTOP_CLIENT",targetNsId:this.props["ns-id"]&&!this.props["ns-path"]?this.props["ns-id"]:null,prefillEmail:this.props["share-prefill-email"]})?void 0:require(["dropbox"],function(r){var n;switch(n=r.SharingModals,e){case ce.ShareExisting:return n.show_share_existing_modal(t,s);case ce.EditShared:return n.show_shared_folder_options_modal(t,s);case ce.EditSharedSubFolder:return n.show_shared_subfolder_modal(t,s)}})},_setupFileEventListener:function(e){var t,s;return s=oe[e],t=s.subscribe_sfj({name:"BrowseEventDispatcher",handler:function(r){return function(){var n;return n=r.state.path,p.getChangesForDirectory({path:n,userId:e,namespaceToJournalIdMap:s.get_ns_map(),includeDeletedFiles:r.state.shouldShowDeletedFiles,onSuccess:function(e){return O.computeAndApplyDeltasFromNotServer({payload:e,path:n}),s.handler_success(t,{ns_map:e.ns_map})}})}}(this)})},_maybeShowLegacySharedLinkModalIfQargPresent:function(){var e,t;return this.props["share-link"]&&1===this.state.selectedFiles.count()?(e=this.state.selectedFiles.toArray()[0].fq_path,t=this.state.user,require(["dropbox"],function(s){var r;return r=s.SharingModals,r.show_share_existing_modal(e,t)})):void 0},_ensureFileViewerIsOpenedOrClosedIfNeeded:function(e){var t,s;if(null==e&&(e={}),t=q.isShown(),e.preview&&!t){if(s=K.getFileByFilename(e.preview))return O.navigateToFileOrFolder({file:s})}else if(t&&!e.preview)return O.closeFileViewer()},handleFileLocationChange:function(e,t){return e="undefined"!=typeof RUNNING_IN_REACTSERVER&&null!==RUNNING_IN_REACTSERVER?this.props["init-fq-path"]||"/":"/"+N.decode(e),this._ensureFileViewerIsOpenedOrClosedIfNeeded(t),e!==this.previousHistoryCallbackPath?(this.previousHistoryCallbackPath=e,e!==K.path()?this.navigateToPath(e):void 0):void 0},handleSearchLocationChange:function(e,t){var s,r,n;if(t&&(s=t.query||t.query_unnormalized,e=t.path||t.last_fq_path||"/",s&&(e!==this.state.path||s!==w.latestQuery())))return n=null!=(r=this.state.user)?r:I.get_viewer().get_user_by_id(this.props["user-id"]),this.previousHistoryCallbackPath=e,e!==K.path()&&O.setPath({path:e}),v.runSearch({user:n,path:e,query:s})},navigateToPath:function(e){var t;return t=function(e){return function(){return e.hasTTIBeenLogged?void 0:(D.mark_time_to_view(),D.mark_time_to_interactive(),e.hasTTIBeenLogged=!0,e._preloadLargeModules(),e._maybeShowLegacySharedLinkModalIfQargPresent())}}(this),O.setPath({path:e,onPathLoaded:t})},handleFileListUpdated:function(){var e,t;return q.isShown()?this.state.files.isEmpty()?O.closeFileViewer():O.updatePreview({files:this.state.files.toJS()}):(e=null!=(t=u.deconstruct_url())?t.qargs:void 0,this._ensureFileViewerIsOpenedOrClosedIfNeeded(e))},render:function(){var e,t;return e=this.props["sync-vars"],e.sync_user_role=this.state.user.role,t=r.extend({},{syncVars:e,limitedTeamBannerUpsell:this.props["limited-team-banner-upsell"],trademarkBusiness:this.props["trademark-business"]},this.state),fe(Y,t)}}),Q=s.createClass({displayName:"BrowseView",mixins:[s.addons.PureRenderMixin],propTypes:{context:s.PropTypes.instanceOf(W).isRequired,files:s.PropTypes.instanceOf(t.List).isRequired,path:s.PropTypes.string.isRequired,shouldShowDeletedFiles:s.PropTypes.bool.isRequired,isUploadModalOpen:s.PropTypes.bool.isRequired,isTextSelectable:s.PropTypes.bool.isRequired,inCopyMode:s.PropTypes.bool.isRequired,user:s.PropTypes.object.isRequired,selection:s.PropTypes.object,loadingState:s.PropTypes.oneOf(r.values(re)),selectedFiles:s.PropTypes.instanceOf(t.OrderedSet),isDraggingInternalFiles:s.PropTypes.bool,isDraggingExternalFiles:s.PropTypes.bool,activeDropTarget:s.PropTypes.instanceOf(Z),isSearchMode:s.PropTypes.bool,syncVars:s.PropTypes.object,limitedTeamBannerUpsell:s.PropTypes.bool,trademarkBusiness:s.PropTypes.string},getDefaultProps:function(){return{selectedFiles:t.OrderedSet(),selection:void 0}},componentDidMount:function(){return this._maybeRenderSyncFolderModal()},componentWillUnmount:function(){return this._unmountFileViewerTarget(),E.ALLOW_STATUS_IN_BROWSE?x.teardown():void 0},_maybeRenderSyncFolderModal:function(){var e;return(null!=(e=this.props.syncVars)?e.sync_ns_id:void 0)?require(["dropbox"],function(e){return function(t){var s;return s=t.SharingModel,s.show_shared_content_sync_modal("can_edit",e.props.syncVars.sync_ns_id,e.props.syncVars.sync_folder_name,e.props.syncVars.sync_folder_size,e.props.syncVars.sync_user_role,e.props.syncVars.sync_out_of_quota)}}(this)):void 0},_unmountFileViewerTarget:function(){var e;return e=document.getElementById(le),e?document.body.removeChild(e):void 0},_getCurrentDropTargetHighlightMode:function(){var e;return!this.props.context.isInsideSharedFolder||(e=this.props.context.currentSharedFolderPermissionRole)!==ne.ACCESS_NO_ACCESS&&e!==ne.ACCESS_READER?this.props.isDraggingInternalFiles?this.props.selectedFiles.count(function(e){return e.isDeleted})?J.NONE:this.props.selectedFiles.count(function(e){return e.type===ee.TEAM_SHARED_FOLDER})?J.NONSELECTED_NONSHARED_NONTEAM_FOLDERS:this.props.selectedFiles.count(function(e){return e.type===ee.SHARED_FOLDER})?J.NONSELECTED_NONSHARED_FOLDERS:J.NONSELECTED_FOLDERS:this.props.isDraggingExternalFiles&&!this.props.isUploadModalOpen?J.ALL_FOLDERS:J.NONE:J.NONE},showFileUploader:function(){var e;return this.refs.contextMenu.closeMenu(),null!=(e=this.refs.fileUploader)?e.showModal():void 0},openContextMenuAtPosition:function(e,t,s){return null==s&&(s=null),this.refs.contextMenu.openMenuAtPosition(e,t,s)},handleSelectionChange:function(e){return O.setSelection({selection:e})},_handleSearch:function(e){return e?O.setUrl({prefix:ue,qargs:{path:K.path(),query:e}}):O.setUrl({path:K.path()})},_handleSearchSuggestionOpen:function(e){return O.navigateToFileOrFolder({file:e})},_renderSearchResults:function(e){return fe(H,{path:this.props.path,user:this.props.user,searchBarElement:e,limitedTeamBannerUpsell:this.props.limitedTeamBannerUpsell,trademarkBusiness:this.props.trademarkBusiness,onFullSearch:function(e){var t;return e.preventDefault(),t={path:"/",query:w.latestQuery()},O.setUrl({prefix:ue,qargs:t})}})},render:function(){var e,t,s,r,o;return o=fe(T,{user:this.props.user,currentPath:this.props.path,isSearchActive:this.props.isSearchMode,onSearch:this._handleSearch,onFileOrFolderOpen:this._handleSearchSuggestionOpen,limitedTeamBannerUpsell:this.props.limitedTeamBannerUpsell,trademarkBusiness:this.props.trademarkBusiness}),this.props.isSearchMode?this._renderSearchResults(o):(r=this.props.context.isInFolderMode&&this.props.context.isInsideSharedFolder&&!this.props.context.isInsideDeletedFolder&&this.props.loadingState!==re.LOADING_FIRST_PAGE,t=this.props.context.showSharedFolderCreateTeamPromo,e={"browse-box":!0,list_view:!0,"file-browse":!0,"has-preview-sf-members":r,"has-preview-sf-members--with-team-promo":r&&t},me.div({id:"browse-box",className:n(e)},me.div({id:"browse-header",className:"browse-header"},me.div({id:"browse-global-actions-bar",className:"browse__global-actions clearfix u-mar-bottom-m"},fe(A,{path:this.props.path,user:this.props.user,selectedFiles:this.props.selectedFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,shouldHighlightDropTargets:this.props.isDraggingInternalFiles||this.props.isDraggingExternalFiles&&!this.props.isUploadModalOpen}),o,me.div({id:"browse-rightmenu",className:"u-l-fr"},s=null!=this.props.context.currentFQPath,this.props.user&&s?[fe(se,{shouldShowDeletedFiles:this.props.shouldShowDeletedFiles,isActionsBarDisabled:this.props.loadingState===re.LOADING_FIRST_PAGE,context:this.props.context,user:this.props.user,onFileUpload:this.showFileUploader,key:0}),fe(te,{ref:"fileUploader",key:1})]:void 0)),r?fe(ae,{context:this.props.context,user:this.props.user}):void 0),fe(z,{onActionButtonClick:function(e){return function(){return e.refs.fileListController.getWrappedComponent().focusSelectedRow()}}(this),selectedFiles:this.props.selectedFiles,user:this.props.user,context:this.props.context}),fe($,{ref:"fileListController",files:this.props.files,selection:this.props.selection,selectedFiles:this.props.selectedFiles,onSelectionChange:this.handleSelectionChange,fileRename:this.props.fileRename,user:this.props.user,path:this.props.path,context:this.props.context,loadingState:this.props.loadingState,isShortcutsMenuVisible:this.props.isShortcutsMenuVisible,isTextSelectable:this.props.isTextSelectable,shouldShowDeletedFiles:this.props.shouldShowDeletedFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isDraggingExternalFiles:this.props.isDraggingExternalFiles,activeDropTarget:this.props.activeDropTarget,dropTargetHighlightMode:this._getCurrentDropTargetHighlightMode(),createNewFolderState:this.props.createNewFolderState,openContextMenuAtPosition:this.openContextMenuAtPosition}),fe(j,{user:this.props.user,selectedFiles:this.props.selectedFiles,context:this.props.context,shouldShowDeletedFiles:this.props.shouldShowDeletedFiles,onFileUpload:this.showFileUploader,ref:"contextMenu"})))}}),Y=_(Q,["/static/css/browse/browse-vflRY5wc2.css"]),{BrowseApp:V,BrowseView:Q}})}.call(this),function(){define("modules/dirty/react/browse/browse_location",["jquery","external/immutable","external/react","modules/clean/react/sprite","modules/clean/react/sprite_div","modules/clean/filepath","modules/clean/viewer","modules/clean/react/browse/store","modules/dirty/react/browse/actions","modules/clean/em_string","modules/clean/react/bubble_menu","modules/core/i18n","modules/clean/react/file_uploader/actions"],function(e,t,s,r,n,o,i,a,l,u,c,d,p){var h,f,m,_,g,y,S,b,v,T,w,F,I,D,E,P,C;return g=a.BrowseStore,y=c.BubbleMenu,S=c.BubbleMenuItem,D=d._,I=p.UploaderActions,C=s.DOM,E=s.createElement,P=s.addons.classSet,v=2.625,T=20,b=1.64,w=37,_=s.createClass({displayName:"BrowseLocation",mixins:[s.addons.PureRenderMixin],propTypes:{path:s.PropTypes.string,user:s.PropTypes.object,selectedFiles:s.PropTypes.instanceOf(t.OrderedSet),isDraggingInternalFiles:s.PropTypes.bool,
shouldHighlightDropTargets:s.PropTypes.bool},getDefaultProps:function(){return{path:"/",selectedFiles:t.OrderedSet(),isDraggingInternalFiles:!1,shouldHighlightDropTargets:!1}},_generateBreadcrumbData:function(){var e,t,s,r,n,a,l,c,d,p,h,f,m,_,g,y,S;for(s=function(){var e,s,r,n;for(r=this.props.path.split("/"),n=[],e=0,s=r.length;s>e;e++)t=r[e],t.length>0&&n.push(t);return n}.call(this),e=[{path:"",folderName:o.filename("",i.get_root_name(this.props.user)),icon:"work"===this.props.user.role?"work_icon":"personal_icon",alt:D("work"===this.props.user.role?"Work":"Personal")}],r=n=0,h=s.length;h>=0?h>n:n>h;r=h>=0?++n:--n)p="/"+s.slice(0,r+1).join("/"),e.push({path:p,folderName:o.filename(p),icon:"folder_32",alt:D("Folder")});if(e.length<3)return{dropdownCrumbs:[],inlineCrumbs:e,root:e[0]};for(g=null!=(f=null!=(m=e[0])?m.folderName:void 0)?f:"",l=this._getMaxBreadcrumbWidth(g,!1),S=function(){var s,r,n,o;for(o=[],s=0,r=e.length;r>s;s++)t=e[s],o.push(new u(null!=(n=t.folderName)?n:"").length);return o}(),d=1,y=S[e.length-1],r=a=_=e.length-2;(1>=_?1>=a:a>=1)&&(y+=b,y+=S[r],!(y>l));r=1>=_?++a:--a)d+=1;return e.length===d+1&&(d+=1),c=e.length-d,{dropdownCrumbs:e.slice(0,c),inlineCrumbs:e.slice(c),root:e[0]}},_getMaxBreadcrumbWidth:function(e,t){var s;return s=t?v:new u(e).length,T-s},render:function(){var t,s,r,n,i,a,l,u,c;return l=this._generateBreadcrumbData(),r=l.dropdownCrumbs,i=l.inlineCrumbs,c=l.root,a=this._getMaxBreadcrumbWidth(null!=(u=null!=c?c.folderName:void 0)?u:"",r.length>0),t="page-header-text u-l-fl",i.length>1||r.length>0?C.span({},C.h1({className:"ax-visually-hidden"},o.filename(this.props.path)),C.nav({className:t,id:"browse-location","aria-label":D("Folder hierarchy"),role:"navigation"},r.length>0?E(h,{crumbs:r,currentPath:this.props.path,selectedFiles:this.props.selectedFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,shouldHighlightDropTargets:this.props.shouldHighlightDropTargets}):void 0,function(){var t,o,l;for(l=[],n=t=0,o=i.length;o>t;n=++t)s=i[n],l.push(E(m,e.extend({},s,{key:encodeURI(s.path),isOnlyCrumb:0===n&&1===i.length&&0===r.length,isLastCrumb:n===i.length-1,maxWidth:a,currentPath:this.props.path,selectedFiles:this.props.selectedFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isHighlightedDropTarget:this.props.shouldHighlightDropTargets})));return l}.call(this))):C.h1({className:t},o.filename(this.props.path))}}),F=s.createClass({displayName:"Spacer",render:function(){return C.span({}," ",E(r,{group:"web",name:"chevron",className:"breadcrumb__spacer",alt:""})," ")}}),m=s.createClass({displayName:"BreadCrumbSegment",propTypes:{path:s.PropTypes.string.isRequired,folderName:s.PropTypes.string.isRequired,isLastCrumb:s.PropTypes.bool.isRequired,isOnlyCrumb:s.PropTypes.bool,maxWidth:s.PropTypes.number.isRequired,currentPath:s.PropTypes.string.isRequired,selectedFiles:s.PropTypes.instanceOf(t.OrderedSet),isDraggingInternalFiles:s.PropTypes.bool,isHighlightedDropTarget:s.PropTypes.bool},getDefaultProps:function(){return{isOnlyCrumb:!1,isDraggingInternalFiles:!1,isHighlightedDropTarget:!1,selectedFiles:t.OrderedSet()}},getInitialState:function(){return{isDraggedOver:!1}},handleMouseEnter:function(e){return this.props.isDraggingInternalFiles?this.setState({isDraggedOver:!0}):void 0},handleMouseLeave:function(e){return this.state.isDraggedOver?this.setState({isDraggedOver:!1}):void 0},handleMouseUp:function(e){return this.state.isDraggedOver?this.setState({isDraggedOver:!1}):void 0},componentDidMount:function(){var t,s;return t=0,s=null,e(this.getDOMNode()).on("dragenter.breadcrumb",function(e){return function(r){return r.preventDefault(),r.target!==s?(s=r.target,t+=1,e.setState({isDraggedOver:!0}),e.props.isLastCrumb?void 0:I.setPath({path:e.props.path})):void 0}}(this)).on("dragleave.breadcrumb",function(e){return function(r){return r.preventDefault(),s=null,t-=1,1>t&&(t=0,e.state.isDraggedOver)?(I.setPath({path:e.props.currentPath}),e.setState({isDraggedOver:!1})):void 0}}(this)).on("drop.breadcrumb",function(e){return function(t){return e.setState({isDraggedOver:!1})}}(this)).on("dragover.breadcrumb",function(e){return e.preventDefault(),e.stopPropagation()}).on("mouseenter.breadcrumb",this.handleMouseEnter).on("mouseleave.breadcrumb",this.handleMouseLeave).on("mouseup.breadcrumb",this.handleMouseUp)},componentWillUnmount:function(){return e(this.getDOMNode()).off(".breadcrumb")},render:function(){var e,t;return t=this.props.isOnlyCrumb?this.props.folderName:u.em_snippet(this.props.folderName,this.props.maxWidth),e={"breadcrumb-segment--is-drop-target":!this.props.isLastCrumb&&this.props.isHighlightedDropTarget,"breadcrumb-segment--file-dragged-over":!this.props.isLastCrumb&&this.state.isDraggedOver},this.props.isLastCrumb?C.span({},t):C.span({},C.a({href:this.props.path,onClick:this.navigateToFolder,className:P(e)},t),E(F))},navigateToFolder:function(e){return e.preventDefault(),l.setUrl({path:this.props.path})}}),f=s.createClass({displayName:"BreadCrumbDropdownMenuItem",propTypes:{path:s.PropTypes.string.isRequired,icon:s.PropTypes.string.isRequired,folderName:s.PropTypes.string.isRequired,alt:s.PropTypes.string,isHighlightedDropTarget:s.PropTypes.bool,closeFunc:s.PropTypes.func,isDraggingInternalFiles:s.PropTypes.bool,selectedFiles:s.PropTypes.instanceOf(t.OrderedSet),currentPath:s.PropTypes.string.isRequired},getDefaultProps:function(){return{isHighlightedDropTarget:!1,closeFunc:function(){},alt:"",isDraggingInternalFiles:!1,selectedFiles:t.OrderedSet()}},getInitialState:function(){return{isDraggedOver:!1}},handleMouseEnter:function(e){return this.props.isDraggingInternalFiles?this.setState({isDraggedOver:!0}):void 0},handleMouseLeave:function(e){return this.state.isDraggedOver?this.setState({isDraggedOver:!1}):void 0},handleMouseUp:function(e){return this.state.isDraggedOver&&this.setState({isDraggedOver:!1}),this.props.isDraggingInternalFiles&&!this.props.isLastCrumb?this.props.closeFunc():void 0},componentDidMount:function(){var t,s;return t=0,s=null,e(this.getDOMNode()).on("dragenter.breadcrumbMenuItem",function(e){return function(r){return r.preventDefault(),r.target!==s?(s=r.target,t+=1,e.setState({isDraggedOver:!0}),I.setPath({path:e.props.path})):void 0}}(this)).on("dragleave.breadcrumbMenuItem",function(e){return function(r){return r.preventDefault(),s=null,t-=1,1>t&&(t=0,e.state.isDraggedOver)?(I.setPath({path:e.props.currentPath}),e.setState({isDraggedOver:!1})):void 0}}(this)).on("drop.breadcrumbMenuItem",function(e){return function(t){return e.setState({isDraggedOver:!1})}}(this)).on("dragover.breadcrumbMenuItem",function(e){return e.preventDefault(),e.stopPropagation()}).on("mouseenter.breadcrumbMenuItem",this.handleMouseEnter).on("mouseleave.breadcrumbMenuItem",this.handleMouseLeave).on("mouseup.breadcrumbMenuItem",this.handleMouseUp)},componentWillUnmount:function(){return e(this.getDOMNode()).off(".breadcrumbMenuItem")},handleCrumbClick:function(e){return e.preventDefault(),l.setUrl({path:this.props.path})},render:function(){var e;return e={"breadcrumb-menu-item":!0,"breadcrumb-menu-item--is-drop-target":this.props.isHighlightedDropTarget,"breadcrumb-menu-item--file-dragged-over":this.state.isDraggedOver},E(S,{onClick:this.handleCrumbClick,closeFunc:this.props.closeFunc,className:P(e)},C.span({className:"force-no-break"},E(n,{group:"web",name:this.props.icon,alt:this.props.alt,text:u.em_snippet(this.props.folderName,w)})))}}),h=s.createClass({displayName:"BreadCrumbDropdown",propTypes:{crumbs:s.PropTypes.array.isRequired,currentPath:s.PropTypes.string.isRequired,shouldHighlightDropTargets:s.PropTypes.bool,selectedFiles:s.PropTypes.instanceOf(t.OrderedSet),isDraggingInternalFiles:s.PropTypes.bool},getDefaultProps:function(){return{shouldHighlightDropTargets:!1,selectedFiles:t.OrderedSet(),isDraggingInternalFiles:!1}},componentDidMount:function(){return e(this.getDOMNode()).on("dragenter.breadcrumbDropdown",function(e){return function(t){return t.preventDefault(),e.refs.bubbleMenu.show()}}(this)).on("mouseenter.breadcrumbDropdown",function(e){return function(t){return e.props.isDraggingInternalFiles?(t.preventDefault(),e.refs.bubbleMenu.show()):void 0}}(this))},componentWillUnmount:function(){return e(this.getDOMNode()).off(".breadcrumbDropdown")},render:function(){var e,t,s,n;return t=this.props.crumbs,t.reverse(),n=C.button({className:"u-unbutton breadcrumb-overflow-button u-l-fl"},E(r,{group:"web",name:"folder_arrow_32",alt:D("Show parent folders (descending)")})),s=function(){var s,r,n;for(n=[],s=0,r=t.length;r>s;s++)e=t[s],n.push(E(f,{key:encodeURI(e.path),path:e.path,icon:e.icon,alt:e.alt,folderName:e.folderName,currentPath:this.props.currentPath,isHighlightedDropTarget:this.props.shouldHighlightDropTargets,isDraggingInternalFiles:this.props.isDraggingInternalFiles,selectedFiles:this.props.selectedFiles}));return n}.call(this),C.span({},E(y,{ref:"bubbleMenu",arrow_position:"top-left",targetButton:n,items:s}),E(F))}}),_})}.call(this),function(){define("modules/dirty/react/browse/comment_status",["modules/clean/activity/activity","modules/clean/comments/utils","modules/clean/file_activity/api","modules/clean/flux/dispatcher","modules/clean/react/browse/constants","modules/clean/react/browse/store","modules/dirty/react/browse/actions"],function(e,t,s,r,n,o,i){var a,l,u,c,d,p,h,f,m,_,g,y,S,b,v,T,w;return a=e.ActivityContext,l=n.BrowseActionTypes,c=n.FileTypes,u=o.BrowseStore,T={},d=function(e){var t;return s.fetchCommentStatusBatch({actorId:null!=(t=u.user())?t.id:void 0,context:a.BROWSE_FILE_VIEWER,contextDataList:e,isBackgroundRequest:!0})},h=function(e){return null==e.feedback_off&&null==e.comment_count&&null==e.unresolved_comment_count},f=function(e){return e.type===c.FILE},m=function(e){return null!=e.after},p=function(e){var t,s;return t=e.files,s=t.filter(f).filter(h).map(function(e){return e.fq_path}),s.length>0?d(s).then(function(e){return i.addCommentStatusBatch({commentStatusByFqPath:e})}):void 0},b=p,y=p,g=p,S=function(e){var t,s,r;return t=e.fileDeltas,r=e.path,s=t.filter(m).map(function(e){var t;return t=e.after}),p({files:s})},_=function(e){var t;switch(t=e.action,t.type){case l.LOAD_PATH:return b(t.data);case l.ADD_FILES:return y(t.data);case l.INITIALIZE_EVERYTHING:return g(t.data);case l.CHANGE_FILES:return S(t.data)}},v=function(e){return null==e&&(e=r),T={dispatcher:e,dispatchToken:e.register(_)},p({files:u.files().toArray()})},w=function(){return T.dispatcher.unregister(T.dispatchToken),T={}},{setup:v,teardown:w}})}.call(this),function(){define("modules/dirty/react/browse/context_menu",["external/immutable","external/react","external/underscore","modules/dirty/react/browse/file_actions","modules/dirty/react/browse/global_actions","modules/clean/react/browse/store","modules/clean/react/context_menu_v2"],function(e,t,s,r,n,o,i){var a,l,u,c,d,p,h;return p=r.getActionsForFileCollection,h=n.getGlobalActions,a=o.BrowseContext,c=i.GlobalContextMenu,u=i.ContextMenuItem,d=t.createElement,l=t.createClass({displayName:"BrowseContextMenu",propTypes:{context:t.PropTypes.instanceOf(a).isRequired,selectedFiles:t.PropTypes.instanceOf(e.OrderedSet).isRequired,shouldShowDeletedFiles:t.PropTypes.bool,shouldShowGlobalActions:t.PropTypes.bool,user:t.PropTypes.object.isRequired,onFileUpload:t.PropTypes.func},getDefaultProps:function(){return{onFileUpload:function(){},shouldShowDeletedFiles:!1,shouldShowGlobalActions:!0}},openMenuAtPosition:function(e,t,s){return null==s&&(s=null),this.refs.contextMenu.openMenuAtPosition(e,t),null!=s?this.elemToFocusAfterClose=s:void 0},closeMenu:function(){return this.refs.contextMenu.closeMenu()},toggleMenu:function(e){return this.refs.contextMenu.toggleMenu(e)},render:function(){var e,t,r,n,o,i,a,l,f,m;if(n=[],this.props.shouldShowGlobalActions&&this.props.selectedFiles.isEmpty())r=h({context:this.props.context,user:this.props.user,showDeletedFiles:this.props.shouldShowDeletedFiles,onFileUpload:this.props.onFileUpload});else{if(this.props.selectedFiles.isEmpty())return null;r=p({files:this.props.selectedFiles,context:this.props.context,user:this.props.user})}for(e=function(e){return u({text:e.label,icon:{group:"web",name:e.spriteName},onClick:e.performAction,href:e.href,isDisabled:e.disabled})},o=0,a=r.length;a>o;o++)t=r[o],l=e(t),(null!=(f=t.subItems)?f.length:void 0)&&(m=s.map(t.subItems,e),l=l.set("subMenuItems",m)),n.push(l);return i=["a:not(.filename-link)","input","button","textarea","select","#notify-wrapper",".db-modal-wrapper",".react-file-viewer",".bubble-dropdown"],d(c,{alwaysOpenOnCapture:!0,ignoreSelectors:i.join(),items:n,onMenuClose:function(e){return function(t){var s;return null!=e.elemToFocusAfterClose?("function"==typeof(s=e.elemToFocusAfterClose).focus&&s.focus(),e.elemToFocusAfterClose=null):void 0}}(this),ref:"contextMenu"},this.props.children)}}),{BrowseContextMenu:l}})}.call(this),function(){define("modules/dirty/react/browse/file_actions",["external/underscore","modules/clean/filepath","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/util","modules/clean/react/file_modal_controller","modules/clean/sharing/ui_util","modules/clean/unity/check_file_cache","modules/clean/unity/features","modules/clean/viewer","modules/constants/viewer","modules/core/browser","modules/core/i18n","modules/dirty/react/browse/actions","modules/dirty/react/browse/sharing_shims","modules/dirty/sharing/browse_ui_util"],function(e,t,s,r,n,o,i,a,l,u,c,d,p,h,f,m){var _,g,y,S,b,v,T,w,F,I,D,E,P;return y=r.FileTypes,I=n.getRevisionsUri,g=o.FileModalController,S=i.GoldenGate,b=p._,D=f.hasMultipleSharingOptions,E=f.showShareFolderModal,P=f.showShareLinkModal,_={showTiburonShare:!1,showLegacyShareFolder:!1,showLegacyShareLink:!1,showCopyPublicFolderFileLink:!1,showOpen:!1,showDownload:!1,showComment:!1,showDelete:!1,showRemove:!1,showRename:!1,showMove:!1,showCopy:!1,showCreateAlbum:!1,showPhotos:!1,showVersions:!1,showRestore:!1,showReadd:!1,showPermanentDelete:!1,showRemoveAccess:!1},F=function(t){var s,r,n,o,i,a;return a=t.user,r=t.context,n=t.files,s=e.clone(_),i=n.every(function(e){return!e.isDeleted}),o=!i&&n.every(function(e){return e.isDeleted}),i?T({actions:s,files:n,context:r,user:a}):o?v({actions:s,files:n,context:r}):s},T=function(e){var t,s,r,n,o,i,c,d,p,h,f,_,g,b,v,T;return t=e.actions,n=e.files,s=e.context,T=e.user,h=1===n.count(),f=h&&n.first().is_dir,_=h&&!n.first().is_dir,p=n.some(function(e){return e.type===y.SHARED_FOLDER||e.type===y.TEAM_SHARED_FOLDER}),g=n.some(function(e){return e.type===y.TEAM_SHARED_FOLDER}),i=n.every(function(e){return e.in_root_coll}),d=T.id===(null!=(v=u.get_viewer().photos_user)?v.id:void 0),b=!1,S.canUseRecursiveCopy(T.id)?t.showCopy=!g:t.showCopy=!p,g||(h&&p?t.showRemove=!0:t.showDelete=!0,t.showRename=s.isInFolderMode&&h,t.showMove=s.isInFolderMode),h&&(r=n.first(),c=m.fileIsInPublicFolder(s,r),c||(m.isTiburonUIAllowed(T,r,s.isInFolderMode?s:null)?t.showTiburonShare=!0:(o=D(T,r,s),t.showLegacyShareLink=!g,t.showLegacyShareFolder=g||o)),b=null!=l&&(null!=a?a.is_cached_and_locally_available(r.ns_id,r.ns_path):void 0),b&&(t.showOpen=!0)),_&&(t.showComment=!0,t.showVersions=!0,s.isInFolderMode?t.showCopyPublicFolderFileLink=c:t.showCopyPublicFolderFileLink=!1),f&&(t.showCreateAlbum=!0),t.showPhotos=i&&d,b||(t.showDownload=s.isInFolderMode||_),t},v=function(e){var t,s,r,n,o,i,a,l;return t=e.actions,o=e.files,s=e.context,a=1===o.count()&&o.first().is_dir,l=a?(r=o.first(),s.inactiveNSIDByFQPath[r.fq_path.toLowerCase()]&&!r.is_in_team_folder_tree):!1,l?t.showReadd=!0:t.showRestore=!0,s.isInFolderMode?i=s.permanentDeletionDisabledStateByNSID[s.currentNSID]:(n=o.map(function(e){return e.ns_id}),i=n.some(function(e){return s.permanentDeletionDisabledStateByNSID[e]})),s.isInFolderMode&&!i&&(l?t.showRemoveAccess=!0:t.showPermanentDelete=!0),t},w=function(r){var n,o,i,a,u,c,p,f,_,y,S,v,T,w,D,C,R,N,O,A,x,M,L,U,k,B,q,H,G;return u=r.files,i=r.context,G=r.user,H=null!=(k=r.skipSharing)?k:!1,N=function(){return E(G,u.first(),i)},O=function(){return P(G,u.first(),i,"file_row_sharing_menu")},A=function(){return m.showTiburonUIIfAllowed(G,u.first(),{browseContext:i,origin:"BROWSE_FILE_ROW"})},w=function(){var e;return e=m.getLegacyPublicFolderShareURI(G,u.first(),i),e?require(["dropbox"],function(t){var s;return s=t.BrowseActions,s.showCopyPublicUrlModal(e)}):void 0},v=function(){var e;return e=u.first(),l.open_file(e.ns_id,e.ns_path,G.id,l.standard_open_file_handler,function(e){return l.standard_open_file_handler(!1)})},y=function(){return h.downloadFiles({files:u,context:i,user:G})},c=function(){return h.navigateToFileOrFolder({file:u.first(),shouldFocusComment:!0})},_=function(){return g.showDelete(G,u.toArray(),i,function(){return h.selectRowsFromNotServer(u.toArray())})},C=function(){return h.showFileRename({file:u.first()})},S=function(){return g.showMove(G,u.toArray(),i.currentFQPath,{onSuccess:null,onUndo:function(){return h.selectRowsFromNotServer(u.toArray())},onRequestNotSent:function(){var e;return h.selectFilesByFqPath({fqPathsToSelect:function(){var t,s,r,n;for(r=u.toArray(),n=[],t=0,s=r.length;s>t;t++)e=r[t],n.push(e.fq_path);return n}()})}})},p=function(){return g.showCopy(G,u.toArray(),{onSuccess:function(e){var t;return t=e.files,h.selectRowsFromNotServer(t)},onUndo:function(){return h.selectRowsFromNotServer(u.toArray())},onRequestNotSent:function(){var e;return h.selectFilesByFqPath({fqPathsToSelect:function(){var t,s,r,n;for(r=u.toArray(),n=[],t=0,s=r.length;s>t;t++)e=r[t],n.push(e.fq_path);return n}()})}})},f=function(){return h.createAlbum({file:u.first(),user:G})},R=function(){var e,t;return e=1===u.count()&&u.first().is_dir,e?(t=s.getRestoreFileUrl({fqPath:u.first().fq_path,userId:G.id}),d.redirect(t)):g.showRestore(G,u.toArray())},D=function(){var e,s,r,n;return e=u.first(),r=e.fq_path.toLowerCase(),n=i.inactiveNSIDByFQPath[r],s=t.filename(e.fq_path),n?require(["dropbox"],function(e){var t;return t=e.SharingModel,t.sync_shared_folder(n,G.role,"BROWSE_FILE_ACTIONS")}):void 0},T=function(){var e;return e=function(){return h.reloadCurrentPath()},g.showPermanentlyDelete(G,u.toArray(),e)},x=function(){return h.viewInPhotos({files:u,user:G})},a=!i.isCurrentPathWriteable(),B=!i.isCurrentPathWriteable(),L=!i.isCurrentPathWriteable(),o=F({files:u,context:i,user:G}),M=[],n=function(t,s,r,n){var o;return o={label:t,spriteName:s,performAction:r},e.extend(o,n)},H||(o.showTiburonShare?M.push(n(b("Share…"),"s_rainbow",A)):(o.showLegacyShareFolder||o.showLegacyShareLink)&&(q=[],o.showLegacyShareFolder&&q.push(n(b("Invite people to collaborate…"),"user_add",N)),o.showLegacyShareLink&&q.push(n(b("Send link…"),"s_link",O)),M.push(n(b("Sharing…"),"s_rainbow",null,{subItems:q})))),o.showCopyPublicFolderFileLink&&M.push(n(b("Copy public link…"),"world_link",w)),o.showOpen&&M.push(n(b("Open"),"open",v)),o.showDownload&&M.push(n(b("Download"),"download",y)),o.showComment&&M.push(n(b("Comment"),"s_file_comment",c)),o.showDelete&&(U={disabled:a},M.push(n(b("Delete..."),"delete_16",_,U))),o.showRemove&&(U={disabled:a},M.push(n(b("Remove..."),"delete_16",_,U))),o.showRename&&(U={ref:"rename",disabled:B},M.push(n(b("Rename"),"rename",C,U))),o.showMove&&(U={disabled:L},M.push(n(b("Move..."),"move_16",S,U))),o.showCopy&&M.push(n(b("Copy..."),"copy",p)),o.showCreateAlbum&&M.push(n(b("Create album"),"create-album",f)),o.showPhotos&&M.push(n(b("View in Photos"),"s_photo",x)),o.showVersions&&(U={href:I(u.first().fq_path,G).toString()},M.push(n(b("Previous versions"),"previous_versions",null,U))),o.showRestore&&M.push(n(b("Restore…"),"restore",R)),o.showReadd&&M.push(n(b("Re-add shared folder"),"restore",D)),o.showPermanentDelete&&M.push(n(b("Permanently delete…"),"cancel",T)),o.showRemoveAccess&&M.push(n(b("Remove my access"),"cancel",T)),M},{getActionsForFileCollection:w}})}.call(this),function(){define("modules/dirty/react/browse/file_list",["jquery","external/immutable","external/keymaster","external/react","external/underscore","modules/clean/components/loading_indicator","modules/clean/filepath","modules/clean/keycode","modules/clean/react/browse/constants","modules/clean/react/browse/file_list_empty_folder","modules/clean/react/browse/internal_drag_status","modules/clean/react/browse/keyboard_shortcuts","modules/clean/react/browse/models","modules/clean/react/columnheader","modules/clean/react/css","modules/clean/react/file_modal_controller","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/store","modules/clean/react/helpers","modules/clean/react/outside_event","modules/clean/react/selectable_list","modules/clean/react/sprite","modules/clean/search/actions","modules/clean/undo","modules/clean/viewer","modules/core/accessible_announce","modules/core/browser","modules/core/i18n","modules/core/notify","modules/dirty/react/browse/actions","modules/dirty/react/browse/file_list_row","modules/dirty/react/browse/folder_list_row","modules/dirty/react/file_viewer/controller","modules/clean/react/browse/file_jump","modules/clean/unity_browse_interface"],function(e,t,s,r,n,o,i,a,l,u,c,d,p,h,f,m,_,g,y,S,b,v,T,w,F,I,D,E,P,C,R,N,O,A,x){var M,L,U,k,B,q,H,G,V,W,j,z,K,Q,Y,J,X,Z,$,ee,te,se,re,ne,oe,ie,ae,le,ue,ce;return B=l.Direction,L=l.BrowseSortField,q=l.DropTargetHighlightMode,K=l.FileTypes,J=l.LoadingStates,X=l.NewFolderCreationState,Y=c.InternalDragStatus,G=p.File,M=p.BrowseContext,z=p.FileRename,U=h.ColumnHeader,k=h.ColumnTypes,j=m.FileModalController,ee=_.UploaderActions,Q=g.INTERNAL_FILE_DATA_TRANSFER_TYPE,ue=y.shallowCompareStateAndProps,se=S.addOutsideEventHandling,ne=b.createSelectableList,oe=b.createSelection,te=E._,ae=r.DOM,ie=r.addons.classSet,re=r.createElement,H="FileList",$="KeyboardShortcutsMenu",Z="",V=ne(r.createClass({displayName:"FileList",propTypes:{user:r.PropTypes.object.isRequired,context:r.PropTypes.instanceOf(M).isRequired,path:r.PropTypes.string.isRequired,selectedFiles:r.PropTypes.instanceOf(t.OrderedSet),isBrowseInContentManager:r.PropTypes.bool,isSharedWithColumnVisible:r.PropTypes.bool,isKindColumnVisible:r.PropTypes.bool,isExtensionColumnVisible:r.PropTypes.bool,isSizeColumnVisible:r.PropTypes.bool,isRenaming:r.PropTypes.bool,openContextMenuAtPosition:r.PropTypes.func,onFocus:r.PropTypes.func,focusSelectedRow:r.PropTypes.func},getInitialState:function(){return{isShortcutsMenuVisible:!1}},getDefaultProps:function(){return{selectedFiles:t.OrderedSet(),isDraggingExternalFiles:!1,activeDropTarget:!1,isRenaming:!1,onFocus:n.noop,isBrowseInContentManager:!1}},componentWillMount:function(){return this.isFocused=!1},componentDidMount:function(){return e(document).on("keydown.FileList",this.handleKeyDown).on("keypress.FileList",this.handleKeyPress).on("keyup.FileList",this.handleKeyUp),this._setupFocusHandler(),this._setupExternalDragHandler(),this._setupKeyboardShortcuts()},componentWillUnmount:function(){return key.clearScope(H),key.setScope(Z),e(document).off(".FileList"),e(this.getDOMNode()).off(".FileList")},_setupFocusHandler:function(){var t;return t=e(this.getDOMNode()),t.on("focusin.FileList",function(e){return function(){return e.isFocused=!0,e.props.onFocus(),!0}}(this)),t.on("focusout.FileList",function(e){return function(){return e.isFocused=!1,!0}}(this))},_setupExternalDragHandler:function(){return e(document).on("dragenter.FileList",function(t){return function(s){return(t.props.isDraggingExternalFiles||t.props.isDraggingInternalFiles)&&!e(s.target).closest(".browse-file-row").length&&t.props.activeDropTarget?(C.setDropTarget({target:null}),ee.setPath({path:t.props.path,hasPermissionToUploadToFolder:t.props.context.isCurrentPathWriteable()})):void 0}}(this))},_setupKeyboardShortcuts:function(){var t,s,r,n,o,i,a,l,u,c,d,p,h,f,m;return Z=key.getScope(),key.setScope(H),i=function(e){return function(t){return e.isFocused&&"BUTTON"!==t.target.tagName}}(this),a=function(e){return function(t){return!document.activeElement||document.activeElement===document.body||e.getDOMNode().contains(t.target)}}(this),o=function(e,t){var s;return s=function(s){return e(s)?(s.preventDefault(),t(s)):void 0}},c=function(e){return function(){return 1===e.props.selectedFiles.size&&e.props.selectedFiles.first().is_dir?C.navigateToFileOrFolder({file:e.props.selectedFiles.first()}):void 0}}(this),u=function(e){return function(){return 1===e.props.selectedFiles.size?C.navigateToFileOrFolder({file:e.props.selectedFiles.first(),onFileViewerUnmount:e.props.focusSelectedRow}):void 0}}(this),p=function(e){return function(){return 1===e.props.selectedFiles.size?e.props.context.isCurrentPathWriteable()?C.showFileRename({file:e.props.selectedFiles.first()}):P.warning(te("You don’t have permission to rename files in this folder.")):void 0}}(this),t=function(){return C.copySelectedFilesToClipboard()},d=function(){return C.pasteClipboardFilesToCurrentPath()},s=function(e){return function(){var t;return e.props.context.isCurrentPathWriteable()?(t=e.props.selectedFiles.toArray(),j.showDelete(e.props.user,t,e.props.context,function(){return C.selectRowsFromNotServer(t)})):P.warning(te("You don’t have permission to delete files in this folder."))}}(this),m=function(){return w.perform_undo()},f=function(e){return function(){return e.state.isShortcutsMenuVisible?void 0:(e.setState({isShortcutsMenuVisible:!0}),key.setScope($))}}(this),n=function(e){return function(){return e.state.isShortcutsMenuVisible?(e.setState({isShortcutsMenuVisible:!1}),key.setScope(H)):void 0}}(this),l=function(){return C.navigateToParentFolder()},h=function(t){return function(s){var r,n,o,i,a;return t.props.selectedFiles.size&&(a=e(s.target).closest(".browse-file-row--is-selected").first(),a.length)?(o=a[0].offsetLeft+200,i=a[0].offsetTop+5,n=a.get(0),"function"==typeof(r=t.props).openContextMenuAtPosition?r.openContextMenuAtPosition(o,i,n):void 0):void 0}}(this),r=function(){return e(".search-bar__text-input").focus()},key("right",H,o(i,c)),key("enter",H,o(i,u)),key("f2",H,o(i,p)),key("left",H,o(a,l)),key("/",H,o(a,r)),key("alt+a",H,o(a,h)),key("shift+/",H,o(a,f)),key("shift+/, escape",$,n),D.mac?(key("command+c",H,o(i,t)),key("backspace",H,o(i,s)),key("command+v",H,o(a,d)),key("command+z",H,o(a,m))):(key("ctrl+c",H,o(i,t)),key("delete",H,o(i,s)),key("ctrl+v",H,o(a,d)),key("ctrl+z",H,o(a,m)))},handleKeyDown:function(e){var t,s;return t=null!=(s=e.which)?s:e.keyCode,t===a.CONTROL||t===a.ALT?C.setCopyMode({copyMode:!0}):void 0},handleKeyPress:function(e){return key.getScope()===H?A.handleKeyPress(e):void 0},handleKeyUp:function(e){var t,s;return t=null!=(s=e.which)?s:e.keyCode,t===a.CONTROL||t===a.ALT?C.setCopyMode({copyMode:!1}):void 0},getFocusHandler:function(e){return function(t){return function(){return t.isFocused=e,!0}}(this)},render:function(){var e;return e={"browse-files o-list-ui":!this.props.isBrowseInContentManager,"browse-files__content-manager":this.props.isBrowseInContentManager,"browse-files--single-selection":1===this.props.selectedFiles.size,"is-sharedwith-column-visible":this.props.isSharedWithColumnVisible,"is-kind-column-visible":this.props.isKindColumnVisible,"is-extension-column-visible":this.props.isExtensionColumnVisible,"is-size-column-visible":this.props.isSizeColumnVisible},ae.div({},this.state.isShortcutsMenuVisible?re(d):void 0,ae.ul({className:ie(e),role:"presentation",onMouseMove:this.handleMouseMove},this.props.children))}})),W=r.createClass({displayName:"FileListController",propTypes:{context:r.PropTypes.instanceOf(M).isRequired,files:r.PropTypes.instanceOf(t.List).isRequired,user:r.PropTypes.object.isRequired,path:r.PropTypes.string.isRequired,selection:r.PropTypes.shape({selected:r.PropTypes.instanceOf(t.OrderedSet),anchor:r.PropTypes.string}),selectedFiles:r.PropTypes.instanceOf(t.OrderedSet),createNewFolderState:r.PropTypes.oneOf(n.values(X)),customEmptyFolderView:r.PropTypes.func,dropTargetHighlightMode:r.PropTypes.oneOf(function(){var e;e=[];for(le in q)ce=q[le],e.push(ce);return e}()),fileRename:z.propTypes,isArchiveState:r.PropTypes.bool,isColumnHeaderVisible:r.PropTypes.bool,isModifiedColumnVisible:r.PropTypes.bool,isMultiColumnGroupVisible:r.PropTypes.bool,isBrowseInContentManager:r.PropTypes.bool,isShortcutsMenuVisible:r.PropTypes.bool,isSyncColumnVisible:r.PropTypes.bool,isTextSelectable:r.PropTypes.bool,loadingState:r.PropTypes.oneOf(n.values(J)),mostRecentlyDraggedOverFile:r.PropTypes.instanceOf(G),openContextMenuAtPosition:r.PropTypes.func,isDraggingExternalFiles:r.PropTypes.bool,isDraggingInternalFiles:r.PropTypes.bool,activeDropTarget:r.PropTypes.object,onSelectionChange:r.PropTypes.func,showFilenameHighlights:r.PropTypes.bool,disableColumnDetail:r.PropTypes.bool,enableDoubleClickTraversal:r.PropTypes.bool,onFocus:r.PropTypes.func,settingsGearMenuAlt:r.PropTypes.string,settingsGearMenuItems:r.PropTypes.arrayOf(r.PropTypes.shape({label:r.PropTypes.string,action:r.PropTypes.func}))},getDefaultProps:function(){return{selection:oe(),selectedFiles:t.OrderedSet(),createNewFolderState:X.CREATE_FOLDER_INACTIVE,customEmptyFolderView:null,dropTargetHighlightMode:q.NONE,fileRename:null,isArchiveState:!1,isColumnHeaderVisible:!0,isMultiColumnGroupVisible:!0,isBrowseInContentManager:!1,isPaginating:!1,isSyncColumnVisible:!1,isShortcutsMenuVisible:!1,isTextSelectable:!0,mostRecentlyDraggedOverFile:null,shouldHighlightDropTargets:!1,shouldHighlightNonselectedDropTargets:!1,showFilenameHighlights:!1,disableColumnDetails:!1,enableDoubleClickTraversal:!0,isDraggingExternalFiles:!1,isDraggingInternalFiles:!1,onFocus:n.noop}},getInitialState:function(){return{activeMultiColumn:0}},componentDidMount:function(){var e,t;return this.props.selection.selected.size&&!O.isShown()?(e=this.props.selection.selected.first(),t=this.getIndexOfFile(e),this.scrollFileRowsIntoView([t])):void 0},shouldComponentUpdate:ue,componentDidUpdate:function(e){var t;return x.browse_visible_change_callback(this.props.files.toArray(),this.props.user.id,0,this.props.files.size-1),t=this.props.selection.selected.subtract(e.selection.selected),t.size&&!O.isShown()&&this.scrollFileRowsIntoView(t.map(this.getIndexOfFile).toArray()),this.props.createNewFolderState!==X.CREATE_FOLDER_INACTIVE&&this.scrollFileRowsIntoView([0]),e.loadingState!==this.props.loadingState&&this.props.loadingState===J.LOADED?I.polite(te("Finished loading files")):void 0},focusSelectedRow:function(){var t,s,r;return s=this.props.selectedFiles.first(),s&&(r=this.getIndexOfFile(s.fq_path),t=e(this.getDOMNode()).find(".browse-files .browse-file-row:eq("+r+")"),!t.is(":focus"))?t.focus():void 0},getIndexOfFile:function(e){var t;return t=this.props.files.findIndex(function(t){return i.paths_are_equal(t.fq_path,e)})},scrollFileRowsIntoView:function(t){var s,r,n,o,i,a;if(0!==t.length&&(s=e(this.getDOMNode()).find(".browse-files"),o="fixed"===e(".browse-header").css("position"),a=o?parseInt(s.css("paddingTop"))||142:0,r=e(window),n=r.height(),i=t.map(function(t){return function(s){var o,i,l,u,c;return o=e(t.getDOMNode()).find(".browse-file-row:eq("+s+")"),c=r.scrollTop(),u=o.offset().top-c,l=o.height(),i=u+l,a>u?c-(a-u):i>n?c+(i-n):0}}(this)),!(i.indexOf(0)>-1)))return r.scrollTop(i[0])},getSharedWithTitle:function(){return te(this.props.context.isInsideSharedFolder?"Additional sharing":"Shared with")},_getColumns:function(){return[{type:k.STATIC,label:te("Row selection"),headerClassName:"ax-visually-hidden"},{type:k.SINGLE,label:te("Name"),headerClassName:"o-grid__col o-grid__col--6-of-12",sortCallback:function(e){return C.sortFiles({sortField:L.FILENAME,direction:e})}},{type:k.SINGLE,label:te("Modified"),headerClassName:"o-grid__col o-grid__col--3-of-12",sortCallback:function(e){return C.sortFiles({sortField:L.MODIFIED,direction:e})}},{type:k.MULTI,switchColumnCallback:function(e){return function(t){return e.setState({activeMultiColumn:t})}}(this),columns:[{label:this.getSharedWithTitle(),headerClassName:"o-grid__col o-grid__col--3-of-12",sortCallback:function(e){return C.sortFiles({sortField:L.FILENAME,direction:e})}},{label:te("Kind"),headerClassName:"o-grid__col o-grid__col--3-of-12",
sortCallback:function(e){return C.sortFiles({sortField:L.CATEGORY,direction:e})}},{label:te("Extension"),headerClassName:"o-grid__col o-grid__col--3-of-12",sortCallback:function(e){return C.sortFiles({sortField:L.EXTENSION,direction:e})}},{label:te("Size"),headerClassName:"o-grid__col o-grid__col--3-of-12",sortCallback:function(e){return C.sortFiles({sortField:L.SIZE,direction:e})}}]},{type:k.STATIC,label:te("Actions"),headerClassName:"ax-visually-hidden"}]},_shouldFileBeHighlightedDropTarget:function(e){var t,s,r;if(t=e.file,s=e.isSelected,this.props.dropTargetHighlightMode===q.NONE)return!1;if(!t.is_dir)return!1;if(t.is_read_only_mount)return!1;if(t.isDeleted)return!1;switch(this.props.dropTargetHighlightMode){case q.ALL_FOLDERS:return!0;case q.NONSELECTED_FOLDERS:return!s;case q.NONSELECTED_NONSHARED_FOLDERS:return!s&&t.type!==K.SHARED_FOLDER;case q.NONSELECTED_NONSHARED_NONTEAM_FOLDERS:return!s&&(r=t.type)!==K.SHARED_FOLDER&&r!==K.TEAM_SHARED_FOLDER}return!1},handleDragStart:function(e,t){var s,r,n,o;return o=null!=t?t:this.props.selectedFiles.toArray(),r={userId:this.props.user.id,fromPath:this.props.path,filePaths:function(){var e,t,s;for(s=[],e=0,t=o.length;t>e;e++)n=o[e],s.push(n.fq_path);return s}()},null!=e.dataTransfer?("function"==typeof(s=e.dataTransfer).setDragImage&&s.setDragImage(this.refs.dragIcon.getDOMNode(),-10,-10),e.dataTransfer.setData(Q,JSON.stringify(r)),e.dataTransfer.effectAllowed="copyMove"):void 0},renderFileRow:function(e,t){var s,r;return s=this._shouldFileBeHighlightedDropTarget({file:e,isSelected:this.props.selection.selected.has(e.fq_path)}),re(R,{selectableListId:e.fq_path,key:encodeURI(e.fq_path),file:e,user:this.props.user,shouldFocus:this.props.selection.selected.last()===e.fq_path||!this.props.selection.selected.size&&0===t,enableDoubleClickTraversal:this.props.enableDoubleClickTraversal,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isAvailableDropTarget:s,isActiveDropTarget:e===this.props.activeDropTarget,isArchiveState:this.props.isArchiveState,isModifiedColumnVisible:this.props.isModifiedColumnVisible,isSyncColumnVisible:this.props.isSyncColumnVisible,isMultiColumnGroupVisible:this.props.isMultiColumnGroupVisible,isTextSelectable:this.props.isTextSelectable,context:this.props.context,renameState:(null!=(r=this.props.fileRename)?r.file:void 0)===e?this.props.fileRename.state:void 0,settingsGearMenuAlt:this.props.settingsGearMenuAlt,settingsGearMenuItems:this.props.settingsGearMenuItems,showColumnDetail:!this.props.isColumnHeaderVisible&&!this.props.disableColumnDetails,showFilenameHighlights:this.props.showFilenameHighlights,onDragStart:this.handleDragStart})},_renderLoadingIndicator:function(e){return ae.div({className:"u-font-center u-pad-top-m",key:"loadingIndicator"},re(o,{style:o.LoadingIndicatorStyle.BLUE_SPINNER,startMessage:e}))},_renderEmptyFolder:function(){var e;return e=this.props.context.isInsideAutoTeamFolder&&1===this.props.path.match(/\//g).length,re(u,{currentSharedFolderPermissionRole:this.props.context.currentSharedFolderPermissionRole,isArchiveState:this.props.isArchiveState,isBrowseInContentManager:this.props.isBrowseInContentManager,isInsideSharedFolder:this.props.context.isInsideSharedFolder,isViewingTeamFolder:e,userId:this.props.user.id})},_renderFileList:function(e,t){var s,r;return re(V,{ref:"fileList",user:this.props.user,path:this.props.path,context:this.props.context,selectedFiles:this.props.selectedFiles,isSharedWithColumnVisible:0===this.state.activeMultiColumn,isKindColumnVisible:1===this.state.activeMultiColumn,isExtensionColumnVisible:2===this.state.activeMultiColumn,isSizeColumnVisible:3===this.state.activeMultiColumn,isShortcutsMenuVisible:this.props.isShortcutsMenuVisible,isBrowseInContentManager:this.props.isBrowseInContentManager,isRenaming:!!this.props.fileRename,openContextMenuAtPosition:this.props.openContextMenuAtPosition,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,activeDropTarget:this.props.activeDropTarget,keyScope:H,linkedOutsideClasses:[".bubble-menu-item-wrapper",".browse-menu",".context-menu",".react-file-viewer",".db-modal"],selection:this.props.selection,onFocus:this.props.onFocus,onSelectionChange:this.props.onSelectionChange,focusSelectedRow:this.focusSelectedRow},t?re(N,{newFolderState:this.props.createNewFolderState,context:this.props.context,user:this.props.user}):void 0,[function(){var t,n,o;for(o=[],r=t=0,n=e.length;n>t;r=++t)s=e[r],o.push(this.renderFileRow(s,r));return o}.call(this)])},render:function(){var e,t,s,r,n;return t={"browse-file-list-header o-grid o-grid--no-gutter":!0,"ax-visually-hidden":this.props.selection.selected.size},s=this.props.files.toArray(),r=this.props.createNewFolderState!==X.CREATE_FOLDER_INACTIVE,ae.div({role:"grid","aria-readonly":"true"},this.props.isColumnHeaderVisible?re(U,{columns:this._getColumns(),className:ie(t),tabbable:!this.props.selection.selected.size,disabled:this.props.loadingState!==J.LOADED}):void 0,this._renderFileList(s,r),(n=this.props.loadingState)===J.LOADING_FIRST_PAGE||n===J.LOADING_REMAINING_PAGES?this._renderLoadingIndicator(te("Loading files…")):s.length||r?void 0:("function"==typeof(e=this.props).customEmptyFolderView?e.customEmptyFolderView():void 0)||this._renderEmptyFolder(),ae.div({className:"offscreen-drag-icon",ref:"dragIcon"},this.props.selectedFiles.count()?re(Y,{files:this.props.selectedFiles.toArray()}):void 0))}}),{FileListController:f(W,["/static/css/scooter/scooter-scoped-vfljb_RbQ.css","/static/css/components/loading_indicator-vflbadB1S.css","/static/css/browse/browse-vflRY5wc2.css"]),FileList:V}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/dirty/react/browse/file_list_row",["jquery","external/underscore","external/classnames","external/immutable","external/react","modules/clean/analytics","modules/clean/browse_interface","modules/clean/css","modules/clean/filepath","modules/clean/react/browse/constants","modules/clean/react/browse/name_input","modules/clean/react/browse/settings_gear_menu","modules/clean/react/browse/store","modules/clean/react/browse/render_partials","modules/clean/react/file_uploader/actions","modules/clean/react/react_i18n","modules/clean/react/selectable_list","modules/clean/react/sprite","modules/clean/search/search_helpers","modules/clean/teams/constants","modules/core/browser","modules/core/i18n","modules/dirty/react/browse/actions","modules/dirty/react/browse/share_button","modules/dirty/react/browse/shared_with","modules/dirty/sharing/browse_ui_util","modules/clean/react/flag","modules/clean/react/helpers"],function(t,s,r,n,o,i,a,l,u,c,d,p,h,f,m,_,g,y,S,b,v,T,w,F,I,D,E,P){var C,R,N,O,A,x,M,L,U,k,B,q,H,G,V,W,j,z,K,Q,Y,J,X;return G=i.TeamsWebActionsLogger,j=a.browse_uri_for_fq_path,Y=a.get_browse_root_name,U=c.RenameStates,M=c.MouseEventButton,x=c.FileTypes,k=p.SettingsGearMenuBubble,R=h.BrowseStore,N=h.File,C=h.BrowseContext,O=f.FileIcon,V=m.UploaderActions,L=_.R_,K=g.createSelection,H=b.TEAM_GETTING_STARTED_GUIDE_FILENAMES,W=T._,B=F.ShareButton,q=I.SharedWithController,J=D.isShareButtonEnabled,X=P.shallowCompareStateAndProps,Q=o.DOM,z=o.createElement,A=o.createClass({displayName:"FileListRow",propTypes:{context:o.PropTypes.instanceOf(C).isRequired,file:o.PropTypes.instanceOf(N).isRequired,user:o.PropTypes.object,columnClasses:o.PropTypes.string,shouldFocus:o.PropTypes.bool,enableDoubleClickTraversal:o.PropTypes.bool,isSelected:o.PropTypes.bool,isDraggingInternalFiles:o.PropTypes.bool,isDraggingExternalFiles:o.PropTypes.bool,isAvailableDropTarget:o.PropTypes.bool,isActiveDropTarget:o.PropTypes.bool,isArchiveState:o.PropTypes.bool,isTextSelectable:o.PropTypes.bool,isMultiColumnGroupVisible:o.PropTypes.bool,isSyncColumnVisible:o.PropTypes.bool,renameState:o.PropTypes.oneOf(s.values(U)),showColumnDetail:o.PropTypes.bool,showFilenameHighlights:o.PropTypes.bool,settingsGearMenuAlt:o.PropTypes.string,settingsGearMenuItems:o.PropTypes.arrayOf(o.PropTypes.shape({label:o.PropTypes.string,action:o.PropTypes.func})),onMouseEnter:o.PropTypes.func,onMouseDown:o.PropTypes.func,onMouseUp:o.PropTypes.func,onDragStart:o.PropTypes.func},getDefaultProps:function(){return{columnClasses:"browse-file-row__column o-grid__col o-grid__col--am",isSelected:!1,shouldFocus:!1,enableDoubleClickTraversal:!0,isDraggingInternalFiles:!1,isDraggingExternalFiles:!1,isAvailableDropTarget:!1,isActiveDropTarget:!1,isArchiveState:!1,isTextSelectable:!0,renameState:null,isMultiColumnGroupVisible:!0,isSyncColumnVisible:!1,showColumnDetail:!1,showFilenameHighlights:!1,onMouseEnter:null,onMouseDown:null,onMouseUp:null,onDragStart:function(){}}},getInitialState:function(){return{hasThumbErrored:!1,wasSelectedBeforeMostRecentMouseDown:!1,shouldShowSettingsBubble:!1}},componentDidMount:function(){return l.require_css("/static/css/scooter/scooter-scoped-vfljb_RbQ.css"),this.focusIfSelected(),t(this.getDOMNode()).on("dragenter.fileRow",function(e){return function(t){var s;if(e.props.isDraggingExternalFiles||e.props.isDraggingInternalFiles){if(s=e.props.file.is_dir&&!(e.props.isSelected&&e.props.isDraggingInternalFiles)){if(e.props.isActiveDropTarget)return;return w.setDropTarget({target:e.props.file}),V.setPath({path:e.props.file.fq_path,hasPermissionToUploadToFolder:!e.props.file.is_read_only_mount&&e.props.context.isCurrentPathWriteable()})}return w.setDropTarget({target:null}),V.setPath({path:R.path(),hasPermissionToUploadToFolder:e.props.context.isCurrentPathWriteable()})}}}(this)).on("focusin.fileRow",function(e){return function(t){return e.state.focusedIn?void 0:e.setState({focusedIn:!0})}}(this)).on("focusout.fileRow",function(e){return function(t){return e.setState({focusedIn:!1})}}(this)).on("mouseup.fileRow",this.handleMouseUp),this._logIfIsTeamGettingStartedGuide("team_folder_gs_guide_displayed")},componentWillReceiveProps:function(e){return this.props.isSelected&&!e.isSelected?this.setState({wasSelectedBeforeMostRecentMouseDown:!1}):void 0},shouldComponentUpdate:X,componentDidUpdate:function(e){var t,s,r;return r=this.props.isSelected!==e.isSelected,t=this.props.shouldFocus!==e.shouldFocus,s=this.props.renameState!==e.renameState,r||t||s?this.focusIfSelected():void 0},componentWillUnmount:function(){return t(this.getDOMNode()).off(".fileRow")},focusIfSelected:function(){return this.props.isSelected&&this.props.shouldFocus&&!this.props.renameState?this.getDOMNode().focus():void 0},handleMouseEnter:function(e){return this.props.isDraggingInternalFiles||this.props.isDraggingExternalFiles?void w.setDropTarget({target:this.props.file}):this.props.onMouseEnter(e)},handleMouseLeave:function(e){return this.props.isDraggingInternalFiles||this.props.isDraggingExternalFiles?w.setDropTarget({target:null}):void 0},handleMouseDown:function(e){return this.setState({wasSelectedBeforeMostRecentMouseDown:this.props.isSelected}),this.props.onMouseDown(e)},handleMouseUp:function(e){return this.handleSettingsGearMenuMouseUp(e),this.props.onMouseUp(e)},handleSettingsGearMenuMouseUp:function(e){if(null!=this.props.settingsGearMenuItems){if(this.state.shouldShowSettingsBubble)return this.setState({shouldShowSettingsBubble:!1});if(t.contains(this.refs.settings.getDOMNode(),e.target))return this.setState({shouldShowSettingsBubble:!0})}},handleFilenameClick:function(e){return this._logIfIsTeamGettingStartedGuide("team_folder_gs_guide_clicked"),this.props.isTextSelectable?void 0:(e.preventDefault(),e.stopPropagation(),w.navigateToFileOrFolder({file:this.props.file,onFileViewerUnmount:function(e){return function(){var t;return null!=(t=e.getDOMNode())?t.focus():void 0}}(this)}))},handleDoubleClick:function(e){return this.props.enableDoubleClickTraversal?this.handleFilenameClick(e):void 0},handleRenameSubmit:function(e){return w.renameFile({file:this.props.file,newName:e})},handleRenameCancel:function(){return w.cancelFileRename({file:this.props.file})},handleDragStart:function(e){return this.props.onDragStart(e)},_logIfIsTeamGettingStartedGuide:function(t){var s;return this.props.context.isInsideAutoTeamFolder&&(s=u.filename(this.props.file.fq_path),e.call(H,s)>=0)?G.log(t,null,null,null,!1,G.LOG_CATEGORY.TEAM_INFO):void 0},_renderSelectionToggleColumn:function(){return Q.div({className:"ax-visually-hidden",role:"gridcell"},Q.input({type:"checkbox","aria-label":W("Select row"),tabIndex:-1,checked:this.props.isSelected,onChange:function(e){return function(){return w.toggleFqPathSelected({path:e.file.fq_path})}}(this)}))},_renderPlaceholder:function(){return Q.span({"aria-hidden":"true"},"--")},_renderScreenReaderExtraInfo:function(){var e,t;return e=[],this.props.file.isDeleted&&e.push(W("Deleted")),this.props.isSelected&&e.push(W("Selected")),this.props.file.is_dir&&(this.props.file.type===x.SHARED_FOLDER?this.props.file.is_read_only_mount?e.push(W("Read-only shared folder")):e.push(W("Shared folder")):this.props.file.type===x.TEAM_SHARED_FOLDER?this.props.file.is_read_only_mount?e.push(W("Read-only team shared folder")):e.push(W("Team shared folder")):e.push(W("Folder"))),e.length>0?(t=" "+e.join(" "),Q.span({className:"ax-visually-hidden"},t)):void 0},_renderFilename:function(){var e,t,r,n,o,i,a;return e=this.props.file,t=u.filename(e.fq_path),r=this.props.showFilenameHighlights?S.highlightMatchString(t,e.filename_highlights):s.escape(t),o=u.parent_dir(e.fq_path),i=j(this.props.user,o),a="/"===o?Y(this.props.user):o,this.props.renameState===U.PENDING_INPUT?(n=W(e.is_dir?"Rename directory…":"Rename file…"),z(d,{ref:"nameInput",label:n,defaultValue:u.filename(e.fq_path),onSubmit:this.handleRenameSubmit,onCancel:this.handleRenameCancel,className:"browse-file-row__input"})):this.props.renameState===U.SAVING_INPUT?Q.span({ref:"renameStatus",role:"status"},W("Renaming…")):Q.div({className:"browse-file-row__name-location"},Q.a({ref:"filenameLabel",className:"filename-link u-ellip browse-file-row__name",href:e.href,onDragStart:function(e){return function(t){return t.stopPropagation(),w.setSelection({selection:K([e.props.file.fq_path])}),e.props.onDragStart(t,[e.props.file])}}(this),onMouseDown:function(e){return function(t){return e.props.file.is_dir?t.stopPropagation():void 0}}(this),onClick:this.handleFilenameClick},Q.span({dangerouslySetInnerHTML:{__html:r}}),this._renderScreenReaderExtraInfo()),this.props.showColumnDetail?Q.div({className:"u-ellip browse-file-row__location"},Q.a({href:i,onClick:function(e){return w.setUrl({path:o}),e.preventDefault()}},L({comment:"Describes the parent directory of a file in a list of search results.",location:a},"in <strong>%(location)s</strong>"))):void 0)},_renderFilenameColumn:function(e){var t,s;return t=z(O,{className:"u-pad-right-xs",ref:"icon",file:this.props.file,onClick:this.handleFilenameClick,onDragStart:function(e){return function(t){return t.stopPropagation(),w.setSelection({selection:K([e.props.file.fq_path])}),e.props.onDragStart(t,[e.props.file])}}(this),onMouseDown:function(e){return function(t){return e.props.file.is_dir?t.stopPropagation():void 0}}(this)}),s=this._renderFilename(),Q.div({ref:"filenameColumn",className:r(""+this.props.columnClasses,"column--filename","u-ellip","o-grid__col--6-of-12"),role:"rowheader"},z(E,{leftAttachment:t},s))},_renderModifiedColumn:function(){var e,t,s;return e=this.props.file.last_modified_fname||"",t=this.props.file.ago||this._renderPlaceholder(),this.props.showColumnDetail&&(t=this.props.file.ago?W("Modified %(ago)s").format({ago:this.props.file.ago}):""),Q.div({className:r((s={},s[""+this.props.columnClasses]=!0,s["u-ellip"]=!0,s["o-grid__col--3-of-12"]=this.props.isMultiColumnGroupVisible,s["o-grid__col--6-of-12"]=!this.props.isMultiColumnGroupVisible,s)),role:"gridcell"},t,e.length?Q.span({className:"browse-file-row__modifier u-font-meta"},e):void 0)},_renderSyncColumn:function(){var e;return Q.div({className:r((e={},e[""+this.props.columnClasses]=!0,e["u-ellip"]=!0,e["o-grid__col--3-of-12"]=this.props.isMultiColumnGroupVisible,e["o-grid__col--6-of-12"]=!this.props.isMultiColumnGroupVisible,e)),role:"gridcell"},"Don't sync")},_renderMultiColumnGroup:function(){var e;return e=function(e){return function(t,s){return Q.div({className:"column--multi "+e.props.columnClasses+" column--"+t+" o-grid__col--3-of-12",role:"gridcell",key:t},s)}}(this),[e("sharedwith",z(q,{file:this.props.file,browseContext:this.props.context})),e("kind",N.getCategoryDescription(this.props.file)),e("extension",N.getExtension(this.props.file)||this._renderPlaceholder()),e("size",this.props.file.size||this._renderPlaceholder())]},_renderActionsColumn:function(){return Q.div({className:"sharing__actions",role:"gridcell"},J(this.props.user,this.props.file,this.props.context)?z(B,{ref:"shareButton",browseContext:this.props.context,file:this.props.file,user:this.props.user}):void 0)},_renderSettingsGearColumn:function(){return Q.div({className:"settings-gear-button",role:"gridcell"},z(k,{ref:"settings",alt:this.props.settingsGearMenuAlt,isShowing:this.state.shouldShowSettingsBubble,menuItems:this.props.settingsGearMenuItems}))},_renderEmptyColumns:function(){return Q.div({className:r(""+this.props.columnClasses,"u-ellip","o-grid__col--3-of-12"),role:"gridcell"})},render:function(){var e,t;return e={"browse-file-row":!0,"browse-file-row--focused-in":this.state.focusedIn,"browse-file-row--is-selected":this.props.isSelected,"browse-file-row--is-archived":this.props.isArchiveState,"browse-file-row--is-deleted":this.props.file.isDeleted,"browse-file-row--is-drop-target":this.props.isAvailableDropTarget,"browse-file-row--file-dragged-over":this.props.isAvailableDropTarget&&this.props.isActiveDropTarget,"o-grid":!0,"o-grid--no-gutter":!0},Q.li({className:r(e),"data-filename":this.props.file.fq_path.split("/").slice(-1),role:"row",tabIndex:"-1",draggable:this.props.isSelected&&this.state.wasSelectedBeforeMostRecentMouseDown,onContextMenuCapture:this.handleContextMenu,onMouseEnter:this.handleMouseEnter,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onMouseLeave:this.handleMouseLeave,onClick:this.props.onClick,onDoubleClick:this.handleDoubleClick,onDragStart:this.handleDragStart},this._renderSelectionToggleColumn(),this._renderFilenameColumn(),this.props.isArchiveState?this._renderEmptyColumns():this.props.isSyncColumnVisible?this._renderSyncColumn():this._renderModifiedColumn(),this.props.isMultiColumnGroupVisible?function(){var e,s,r,n;for(r=this._renderMultiColumnGroup(),n=[],e=0,s=r.length;s>e;e++)t=r[e],n.push(t);return n}.call(this):void 0,null!=this.props.settingsGearMenuItems?this._renderSettingsGearColumn():this._renderActionsColumn())}})})}.call(this),function(){define("modules/dirty/react/browse/folder_list_row",["jquery","external/classnames","external/immutable","external/react","external/underscore","modules/clean/filepath","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/sprite","modules/core/i18n","modules/dirty/react/browse/actions","modules/clean/react/browse/name_input","modules/clean/react/flag","modules/clean/sharing/ui_util","modules/clean/static_urls"],function(e,t,s,r,n,o,i,a,l,u,c,d,p,h,f){var m,_,g,y,S,b,v,T;return y=i.NewFolderCreationState,m=a.BrowseContext,S=u._,_=h.GoldenGate,T=f.static_url,v=r.DOM,b=r.createElement,g=r.createClass({displayName:"NewFolderCreationListRow",mixins:[r.addons.PureRenderMixin],propTypes:{newFolderState:r.PropTypes.oneOf(n.values(y)),context:r.PropTypes.instanceOf(m),user:r.PropTypes.object},_handleCancel:function(){return c.cancelCreateFolder()},_handleSubmit:function(e){return c.createFolder({pathName:this.props.context.currentFQPath,folderName:e})},_renderIcon:function(){var e,t;return e=null!=this.props.user&&_.hasGoldenGateIconography(this.props.user.id),t=o.new_folder_icon(this.props.context.isInsideTeamFolderTree,e),b(l,{group:"web",name:T("/static/images/icons/icon_spacer-vflN3BYt2.gif"),className:"u-pad-right-xs sprite sprite_web browse-file-row__accessory "+t,alt:""})},_renderNewFolderCreationColumn:function(){var e,t;return e=this._renderIcon(),t=v.div({}),this.props.newFolderState===y.PENDING_INPUT?t=b(d,{defaultValue:"",label:S("Folder name"),onSubmit:this._handleSubmit,onCancel:this._handleCancel,className:"browse-file-row__input"}):this.props.newFolderState===y.SAVING_INPUT&&(t=v.div({className:"creating_folder_text",role:"status","aria-live":"polite"},S("Creating new folder…"))),v.div({className:"o-grid__col--1-of-2",role:"gridcell"},b(p,{leftAttachment:e},t))},_renderPlaceholder:function(){return v.div({role:"gridcell"})},render:function(){var e;return e={"browse-file-row":!0,"o-grid":!0,"o-grid--no-gutter":!0,"browse-file-row--is-selected":!0},v.li({className:t(e),role:"row"},this._renderPlaceholder(),this._renderNewFolderCreationColumn(),this._renderPlaceholder(),this._renderPlaceholder(),this._renderPlaceholder())}})})}.call(this),function(){define("modules/dirty/react/browse/global_actions",["external/classnames","external/react","modules/clean/components/title_bubble","modules/clean/payments/pro_trial_onboarding_tour","modules/clean/css","modules/clean/filepath","modules/dirty/react/browse/actions","modules/dirty/sharing/browse_ui_util","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/store","modules/clean/react/sprite","modules/clean/sharing/ui_util","modules/clean/user","modules/constants/browse","modules/core/i18n"],function(e,t,s,r,n,o,i,a,l,u,c,d,p,h,f,m){var _,g,y,S,b,v,T,w,F,I,D;return S=r.ProOnboardingTooltips,D=a.showTiburonUIIfAllowed,y=u.NameSpaceAccess,_=c.BrowseContext,b=p.Tiburon,v=m._,F=t.DOM,T=t.createElement,w=e,I=function(e){return function(e){var t,s,r,n,a,u,c,d,p,h,m,_,g,T,w,F,I,E,P,C;return t=e.context,C=e.user,P=e.showDeletedFiles,I=e.onFileUpload,T="/"===t.currentFQPath,g=t.isInsideSharedFolder&&t.currentSharedFolderPermissionRole===y.ACCESS_READER,E=v(t.isInsideAutoTeamFolder?"Team folder options…":t.isInsideSharedFolder?"Shared folder options…":T?"Share a folder…":"Share this folder…"),F=f.SUBGROWTH_PRO_ONBOARDING_LAST_SEEN_STEP,r="V1"===f.SUBGROWTH_PRO_ONBOARDING_UPLOAD&&0===F,s="V1"===f.SUBGROWTH_PRO_ONBOARDING_SHARING&&1===F,a=v("Getting started?\nClick here to upload your files to Dropbox"),n=v("Have you tried using Dropbox to collaborate with others?\nClick here to share a project folder"),u=function(e){return e.preventDefault(),r&&S.setUserOnboardingAttribute(e.currentTarget,F+1),I(e)},c=function(e){return e.preventDefault(),i.nameNewFolder()},m=function(e){return e.preventDefault(),s&&S.setUserOnboardingAttribute(e.currentTarget,F+1),D(C,t,{origin:"BROWSE_GLOBAL_ACTIONS"})?void 0:require(["dropbox"],function(e){var s;return s=e.SharingModals,t.isInsideSharedFolder?s.show_shared_folder_options_modal(t.currentFQPath,C):T?s.show_shared_folder_wizard(C):s.show_share_existing_modal(t.currentFQPath,C)})},h=function(e){return e.preventDefault(),D(C,t,{origin:"BROWSE_GLOBAL_ACTIONS"})?void 0:require(["dropbox"],function(e){var s,r;return r=e.SharingShmodel,s=e.Browse,null==s.active_user&&(s.active_user=C),r.shmodel(t.currentFQPath,"global_actions_basic_global_token_share")})},_=function(e){return e.preventDefault(),i.setShouldShowDeletedFiles({shouldShowDeletedFiles:!P})},p=function(e){return e.preventDefault(),l.redirectToFolderRestore({fqPath:t.currentFQPath,userId:C.id})},d=function(e){var s,r,n;return e.preventDefault(),r=t.currentFQPath.toLowerCase(),n=t.inactiveNSIDByFQPath[r],s=o.filename(t.currentFQPath),n?require(["dropbox"],function(e){var t;return t=e.SharingModel,t.sync_shared_folder(n,C.role,"BROWSE_GLOBAL_ACTIONS")}):void 0},w=[],t.isInsideDeletedSharedFolder?w.push({label:v("Re-add shared folder"),spriteName:"restore",performAction:d}):t.isInsideDeletedFolder||t.isInsideDeletedNestedSharedFolder?w.push({label:v("Restore folder"),spriteName:"restore",performAction:p}):(w.push({label:v("Upload…"),tooltip:r?a:void 0,spriteName:"upload_16",performAction:u,disabled:g,active_onboarding_step:r}),w.push({label:v("New folder"),spriteName:"folder_add",performAction:c,disabled:g}),w.push({label:E,tooltip:s?n:void 0,spriteName:"rainbow_16",performAction:m,active_onboarding_step:s}),T||b.foldersUI(C)||w.push({label:v("Share link…"),spriteName:"s_link",performAction:h}),f.HIDE_TRASH_CAN_BUTTON||w.push({label:v(P?"Hide deleted files":"Show deleted files"),spriteName:P?"trash-can-open":"trash-can",performAction:_})),w}}(this),g=t.createClass({displayName:"GlobalActions",propTypes:{shouldShowDeletedFiles:t.PropTypes.bool.isRequired,context:t.PropTypes.instanceOf(_).isRequired,user:t.PropTypes.instanceOf(h).isRequired,onFileUpload:t.PropTypes.func.isRequired,isActionsBarDisabled:t.PropTypes.bool.isRequired},_renderButton:function(e){var t,r,n,o,i,a,l,u;return i=e.message,u=e.spriteName,a=e.onClick,n=e.disabled,t=e.active_onboarding_step,o=e.index,r=w({"global-actions__button":!0,"sprite-button":!0,"global-actions__button--onboarding":t}),l=F.button({className:r,disabled:n,onClick:a},T(d,{className:"global-actions__button-sprite",group:"web",name:u,alt:i})),F.li({className:"global-actions__action",key:o},n?l:T(s,{text:i,direction:"south",respectLineBreaks:!0},l))},render:function(){var e,t,s;return s=I({context:this.props.context,user:this.props.user,showDeletedFiles:this.props.shouldShowDeletedFiles,onFileUpload:this.props.onFileUpload}),F.div({className:"global-actions u-mar-top-xs"},F.ul({className:"horizontal"},function(){var r,n,o;for(o=[],e=r=0,n=s.length;n>r;e=++r)t=s[e],o.push(this._renderButton({message:t.tooltip||t.label,spriteName:t.spriteName,onClick:t.performAction,disabled:t.disabled||this.props.isActionsBarDisabled,active_onboarding_step:t.active_onboarding_step,index:e}));return o}.call(this)))}}),{getGlobalActions:I,GlobalActions:g}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/dirty/react/browse/preview_sf_members",["jquery","external/react","modules/clean/ajax","modules/clean/analytics","modules/clean/avatar/photo_avatar","modules/clean/avatar/size","modules/clean/react/browse/constants","modules/clean/react/browse/store","modules/clean/browse_events","modules/clean/css","modules/clean/components/loading_indicator","modules/clean/components/title_bubble","modules/clean/em_string","modules/clean/flux/dispatcher","modules/clean/gandalf_util","modules/clean/react/button","modules/clean/react/flag","modules/clean/react/image","modules/clean/react/sprite","modules/clean/viewer","modules/core/browser","modules/core/i18n","modules/clean/react/react_i18n","modules/clean/sharing/member_avatars","modules/clean/static_urls","modules/clean/filepath","modules/clean/sharing/api","modules/clean/sharing/ui_util","modules/dirty/sharing/browse_ui_util"],function(t,s,r,n,o,i,a,l,u,c,d,p,h,f,m,_,g,y,S,b,v,T,w,F,I,D,E,P,C){var R,N,O,A,x,M,L,U,k,B,q,H,G,V,W,j,z,K,Q,Y;return B=n.SharedFolderActivityLogger,O=i.AVATAR_DIMENSION_BY_SIZE,q=a.SharedWithActionTypes,A=l.BrowseContext,W=T._,Y=T.ungettext,k=w.R_,Q=I.static_url,H=E.SharingApi,V=P.Tiburon,K=C.showTiburonUIIfAllowed,j=s.createElement,z=s.DOM,M=15,N=O.MEDIUM,G="south",R=!0,L=s.createClass({displayName:"PreviewSFMembersPanel",propTypes:{context:s.PropTypes.instanceOf(A).isRequired,user:s.PropTypes.object.isRequired},getInitialState:function(){return{viewProps:{}}},componentDidMount:function(){return this._fetchSharedFolderMembers(),this._log_event("preview_sf_members_shown"),t(document).on(H.REQUEST_SUCCEEDED_EVENT,this._sharing_api_request_handler),this._dispatchToken=f.register(this.onEventDispatched)},componentWillUnmount:function(){var e;return null!=(e=this._currentRequest)&&e.abort(),t(document).off(H.REQUEST_SUCCEEDED_EVENT,this._sharing_api_request_handler),this._dispatchToken?f.unregister(this._dispatchToken):void 0},componentDidUpdate:function(e){var t,s;return(null!=(t=e.context)?t.currentFQPath:void 0)!==(null!=(s=this.props.context)?s.currentFQPath:void 0)?(this._fetchSharedFolderMembers(),this._log_event("preview_sf_members_shown")):void 0},onEventDispatched:function(t){var s,r,n;return s=null!=t&&null!=(r=t.action)?r.type:void 0,n=[q.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE,q.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE,q.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE],s&&e.call(n,s)>=0?this._fetchSharedFolderMembers():void 0},_canShareAsNestedSharedFolder:function(){return this.props.context.currentNSPath&&this.props.context.currentNSAllowsNesting},_sharing_api_request_handler:function(e,t){var s;return s=t.request_url,s.indexOf("/share_ajax/leave")>-1||s.indexOf("/share_ajax/unshare")>-1||!this.props.context.isInFolderMode||t.ns_id!==this.props.context.currentNSID?void 0:this._fetchSharedFolderMembers()},_fetchSharedFolderMembers:function(){var e;return e="/share_ajax/preview_members/"+this.props.context.currentNSID,this._currentRequest=r.WebRequest({url:e,subject_user:this.props.user,data:{max_results:M},success:function(e){return function(t){var s;return t=JSON.parse(t),t.ns_id===e.props.context.currentNSID?(s={numUndisplayableUsersAndInvites:t.num_avatars_not_shown,numUsersAndInvites:t.num_users_and_invites,numUsersAndInvitesOutsideTeam:t.num_users_and_invites_outside_team,groups:t.groups,invitations:t.invitations,joinedMembers:t.joined_members},t.user_can_invite&&(e.props.context.isInsideSharedFolder&&!e.props.context.isInsideAutoTeamFolder||e._canShareAsNestedSharedFolder())&&(s.inviteButton=j(x,{onClick:e.invite_button_click_handler})),e.setState({viewProps:s})):void 0}}(this),complete:function(e){return function(){return e._currentRequest=null}}(this)})},settings_button_click_handler:function(){return this._log_event("preview_sf_members_settings_button_clicked"),K(this.props.user,this.props.context,{origin:"BROWSE_SHARED_FOLDER_BANNER"})?void 0:this._show_shared_folder_members_modal()},invite_button_click_handler:function(){return this._log_event("preview_sf_members_invite_button_clicked"),this._show_add_people_modal()},avatar_click_handler:function(){return this._log_event("preview_sf_members_avatar_clicked"),document.activeElement!==document.body&&document.activeElement.blur(),K(this.props.user,this.props.context,{origin:"BROWSE_SHARED_FOLDER_BANNER"})},overflow_click_handler:function(){return this._log_event("preview_sf_members_overflow_number_clicked"),K(this.props.user,this.props.context,{origin:"BROWSE_SHARED_FOLDER_BANNER"})?void 0:this._show_shared_folder_members_modal()},focus_sharing_options_modal_invite_form:function(){return require(["dropbox","modules/clean/dbmodal"],function(e){return function(s,r){var n,o;return o=s.ExistingSharedFolderOptionsContent,n=r.DBModalStack,n.unregister(o.CONTENT_LOADED_EVENT,e.focus_sharing_options_modal_invite_form),t("#sharing-options-new-collab-input").focus()}}(this))},_show_shared_folder_members_modal:function(){return require(["dropbox"],function(e){return function(t){var s;return s=t.SharingModals,e._canShareAsNestedSharedFolder()?s.show_share_existing_modal(e.props.context.currentFQPath,e.props.user):s.show_shared_folder_options_modal(e.props.context.currentMountPoint,e.props.user,!e.props.context.config.isSimpleSharingEnabled)}}(this))},_show_add_people_modal:function(){return require(["dropbox","modules/clean/dbmodal"],function(e){return function(t,s){var r,n,o;return n=t.ExistingSharedFolderOptionsContent,o=t.SharingModals,r=s.DBModalStack,e._canShareAsNestedSharedFolder()?o.show_share_existing_modal(e.props.context.currentFQPath,e.props.user):e.props.context.config.isSimpleSharingEnabled?o.show_share_inband_modal(e.props.context.currentMountPoint,e.props.user,e.props.context.currentNSID,e.props.context.currentSharedFolderPermissionRole):(r.register(n.CONTENT_LOADED_EVENT,e.focus_sharing_options_modal_invite_form),o.show_shared_folder_options_modal(e.props.context.currentMountPoint,e.props.user))}}(this))},_log_event:function(e,t){return null==t&&(t={}),t.ns_id=this.props.context.currentNSID,B.log("web",e,this.props.user,t);
},getNameOfTargetFolder:function(){var e;return e=this.props.context.currentMountPoint,!e||this._canShareAsNestedSharedFolder()?D.filename(this.props.context.currentFQPath):e.split("/").pop()},render:function(){var e,s;return e={folderName:this.getNameOfTargetFolder(),user:this.props.user,onSettingsButtonClick:this.settings_button_click_handler,onOverflowCountClick:this.overflow_click_handler,onAvatarClick:this.avatar_click_handler,folderType:this.props.context.isInsideAutoTeamFolder?"TEAM":"SHARED",showCreateTeamPromo:this.props.context.showSharedFolderCreateTeamPromo},s=t.extend(e,this.state.viewProps),z.div({className:"PreviewSFMembersPanel"},j(U,s))}}),U=s.createClass({displayName:"PreviewSFMembersView",mixins:[F],propTypes:{folderName:s.PropTypes.string.isRequired,folderType:s.PropTypes.oneOf(["SHARED","TEAM"]).isRequired,user:s.PropTypes.object.isRequired,onSettingsButtonClick:s.PropTypes.func.isRequired,onOverflowCountClick:s.PropTypes.func,onAvatarClick:s.PropTypes.func,inviteButton:s.PropTypes.element,numUndisplayableUsersAndInvites:s.PropTypes.number,numUsersAndInvites:s.PropTypes.number,numUsersAndInvitesOutsideTeam:s.PropTypes.number,groups:s.PropTypes.array,invitations:s.PropTypes.array,joinedMembers:s.PropTypes.array,avatarDimension:s.PropTypes.number,titleButtonDirection:s.PropTypes.string,showCreateTeamPromo:s.PropTypes.bool},getDefaultProps:function(){return{titleButtonDirection:G,avatarDimension:N,maxVisibleAvatars:M,animation:R}},componentDidMount:function(){return c.require_css("/static/css/avatar_list-vflRVLzmw.css"),c.require_css("/static/css/components/loading_indicator-vflbadB1S.css"),c.require_css("/static/css/scooter/scooter-scoped-vfljb_RbQ.css"),c.require_css("/static/css/shared_folder_members_preview/team_promo-vflu998jd.css")},renderCreateTeamPromo:function(){var e,t,s;return t="",s=b.get_viewer().personal_email,null!=this.props.joinedMembers&&(t=function(){var t,r,n,o;for(n=this.props.joinedMembers,o=[],t=0,r=n.length;r>t;t++)e=n[t],e.email!==s&&o.push(e.email);return o}.call(this).join()),z.div({className:"team-upsell-banner c-card c-card--arrow c-card--arrow-sw"},k({user_emails:t},'<a href="/team?tk=sf_upsell&_camp=sf&invite_members=%(user_emails)s">Create a Team Dropbox</a> with the people in this folder'),z.span({className:"u-mar-left-xxs"},j(p,{text:W("With teams you get access to a shared team folder, a separate work Dropbox, groups, and other tools and features."),direction:"north"},j(S,{className:"team-upsell-banner__info-sprite",group:"web",name:"info",alt:W("More information about teams")}))))},render:function(){return z.div({className:"sf-member-preview-container"},this.props.showCreateTeamPromo?this.renderCreateTeamPromo():void 0,z.div({className:this.getClassName()},j(g,{rightAttachment:this.renderButtons()},this.renderFolderInfo(),this.props.numUsersAndInvites?"SHARED"===this.props.folderType?this.renderAvatars():this.renderTeamFolder():z.div({className:"loading-indicator-container"},j(d)))))},getClassName:function(){return s.addons.classSet({"preview-sf-members--with-team-promo":this.props.showCreateTeamPromo,"c-banner c-banner--unpinned u-pad-s":!0,"team-folder":"TEAM"===this.props.folderType})},renderTeamFolder:function(){var e,t;return e=null,this.props.groups&&(t=this.props.groups[0],t&&t.is_automatic&&(e=W("editor"===t.access_type?"%(group_name)s can edit":"%(group_name)s can view"),e=e.format({group_name:t.name}))),e||(e=W("Shared with all members of %(team_name)s").format({team_name:b.get_viewer().team_name})),z.div({className:"team-folder-member-entry"},o({dimension:24,photoUrl:Q("/static/images/icons/team_24-vflGwWtBj.png"),shape:"SQUARE",optionalClass:"u-mar-right-xs"}),z.span({className:"u-l-ib u-l-ib--m"},e))},renderButtons:function(){return z.div(null,V.foldersUI(this.props.user)?void 0:this.props.inviteButton,z.button({className:"c-btn c-btn--secondary settings-button",onClick:this.props.onSettingsButtonClick,title:W("Settings")},W(V.foldersUI(this.props.user)?"Share":"Settings")))},renderFolderInfo:function(){return z.div({className:"shared-folder-info u-mar-bottom-xs"},z.strong({className:"shared-folder-name"},h.em_snippet(this.props.folderName,18)),this.props.numUsersAndInvites?z.span({className:"u-mar-horizontal-xs"},"•"):void 0,this.props.numUsersAndInvites?this.renderNumberOfMembers():void 0)},renderNumberOfMembers:function(){var e,t;return t=Y("%(num_total)s member","%(num_total)s members",this.props.numUsersAndInvites,{comment:'Another pluralized string MAY be concatenated to this to make a string like: "15 members (4 outside of TechCorp Inc.)"'}),this.props.numUsersAndInvitesOutsideTeam?(t+=Y(" (%(num_outside)s outside of %(team_name)s)"," (%(num_outside)s outside of %(team_name)s)",this.props.numUsersAndInvitesOutsideTeam,{comment:'This will be concatenated to another string to make a string like: "15 members (4 outside of TechCorp Inc.)"'}),e=t.format({num_total:this.props.numUsersAndInvites,num_outside:this.props.numUsersAndInvitesOutsideTeam,team_name:h.em_snippet(b.get_viewer().team_name,16)})):e=t.format({num_total:this.props.numUsersAndInvites}),z.span({className:"members-string u-font-meta"},e)},renderAvatars:function(){var e,t,s,r,n;return e=[],n=[],this.props.numUsersAndInvites&&(r=this.findOwnerAndMeInJoinedMembers(this.props.joinedMembers),s=r[0],t=r[1],null!=s&&(e.push(this.renderJoinedMember(s)),n.push(s.user_id)),null!=t&&t!==s&&(e.push(this.renderJoinedMember(t)),n.push(t.user_id)),this.addGroupsMembersInvitations(e,this.props.groups,this.props.joinedMembers,this.props.invitations,n)),this.renderAvatarList(e)}}),x=s.createClass({displayName:"InviteButton",propTypes:{onClick:s.PropTypes.func.isRequired},render:function(){return z.button({className:"c-btn c-btn--secondary u-mar-right-xs",onClick:this.props.onClick,title:W("Add members")},j(y,{alt:W("Add members"),src:Q("/static/images/account_photo/icon-add-people-vfl6PECU8.png"),srcHiRes:Q("/static/images/account_photo/icon-add-people@2x-vflNPmgwH.png")}))}}),{PreviewSFMembersPanel:L}})}.call(this),function(){define("modules/dirty/react/browse/selection_actions",["external/immutable","external/react","modules/clean/filepath","modules/clean/react/browse/store","modules/clean/react/browse/util","modules/clean/react/bubble_menu","modules/clean/react/sprite","modules/core/i18n","modules/dirty/react/browse/file_actions"],function(e,t,s,r,n,o,i,a,l){var u,c,d,p,h,f,m,_,g,y;return u=r.BrowseContext,g=n.describeFiles,d=o.BubbleMenu,p=o.BubbleMenuItem,h=a._,y=l.getActionsForFileCollection,_=t.DOM,m=t.addons.classSet,f=t.createElement,c=t.createClass({displayName:"BrowseSelectionMenu",mixins:[t.addons.PureRenderMixin],propTypes:{context:t.PropTypes.instanceOf(u).isRequired,selectedFiles:t.PropTypes.instanceOf(e.OrderedSet).isRequired,user:t.PropTypes.object.isRequired,onActionButtonClick:t.PropTypes.func},getDefaultProps:function(){return{onActionButtonClick:function(){}}},componentDidUpdate:function(){var e;return null!=(e=this.refs.moreActionsBubbleMenu)?e.hideIfShown():void 0},_renderMenuButton:function(e){var t,s,r,n,o,a,l,u,c,d;return n=e.label,d=e.spriteName,a=e.performAction,r=e.href,l=e.ref,s=null!=(u=e.disabled)?u:!1,null!=a?(t={ref:l,className:"button-as-link browse-menu__action-button",onClick:function(e){return function(t){return s?void 0:(e.props.onActionButtonClick(),a(t))}}(this)},s&&(t.disabled=!0),c=_.button(t,f(i,{group:"web",name:d,alt:"",className:"browse-menu__action-button-sprite"}),_.span({className:"browse-menu__action-button-label"},n))):null!=r&&(c=_.a({ref:l,className:"browse-menu__action-button",href:r},f(i,{group:"web",name:d,alt:"",className:"browse-menu__action-button-sprite"}),_.span({className:"browse-menu__action-button-label"},n))),o={"browse-menu__action":!0,"browse-menu__action--disabled":s},_.li({key:n,className:m(o)},c)},_renderMoreActionsDropdown:function(e){var t,s;return s=_.button({className:"button-as-link browse-menu__action-button"},h("More")," ",f(i,{group:"web",name:"arrow-down-blue",alt:"",className:"browse-menu__more-dropdown-arrow"})),t=e.map(function(e){var t,s,r,n,o,a;return r=e.label,a=e.spriteName,n=e.performAction,s=e.href,t=null!=(o=e.disabled)?o:!1,f(p,{href:s,onClick:function(){return"function"==typeof n?n():void 0},disabled:t},f(i,{group:"web",name:a,alt:"",className:"browse-menu__action-button-sprite"}),_.span({className:"browse-menu__action-button-label"},r))}),_.li({className:"browse-menu__action"},f(d,{ref:"moreActionsBubbleMenu",targetButton:s,arrow_position:"top-right",items:t}))},render:function(){var e,t,s,r,n;return this.props.selectedFiles.isEmpty()?null:(e=g(this.props.selectedFiles),t=1!==this.props.selectedFiles.count()||this.props.selectedFiles.first().is_dir?"":this.props.selectedFiles.first().size,r=y({files:this.props.selectedFiles,context:this.props.context,user:this.props.user,skipSharing:!0}),r.length>6&&(n=r.slice(5),r=r.slice(0,5)),_.div({className:"c-column-header browse-menu browse-file-list-header"},_.span({className:"browse-menu__description"},e),_.ul({className:"browse-menu__actions"},function(){var e,t,n;for(n=[],e=0,t=r.length;t>e;e++)s=r[e],n.push(this._renderMenuButton(s));return n}.call(this),n?this._renderMoreActionsDropdown(n):void 0),_.span({className:"browse-menu__filesize-label"},t)))}}),{BrowseSelectionMenu:c}})}.call(this),function(){define("modules/dirty/react/browse/share_button",["require","external/classnames","external/react","modules/clean/css","modules/clean/keycode","modules/clean/react/button","modules/clean/react/browse/store","modules/clean/react/sprite","modules/clean/sharing/models/file","modules/core/i18n","modules/dirty/react/browse/sharing_shims","modules/dirty/sharing/browse_ui_util"],function(e,t,s,r,n,o,i,a,l,u,c,d){var p,h,f,m,_,g,y,S,b,v,T,w;return _=o.button,p=i.BrowseContext,h=i.File,g=l.canConvertToSharedFolder,m=u._,v=c.initiateSharingFromUIElement,b=c.hasMultipleSharingOptions,w=d.showTiburonUIIfAllowed,T=d.isTiburonUIAllowed,S=s.DOM,y=s.createElement,f=s.createClass({displayName:"ShareButton",mixins:[s.addons.PureRenderMixin],propTypes:{browseContext:s.PropTypes.instanceOf(p).isRequired,file:s.PropTypes.instanceOf(h).isRequired,user:s.PropTypes.object.isRequired},handleClick:function(){var e,t,s,r,n;return s=this.props,n=s.user,t=s.file,e=s.browseContext,r=this.refs.button.getDOMNode(),v(r,n,t,e,"BROWSE_FILE_ROW")},handleDoubleClick:function(e){return e.stopPropagation(),this.handleClick()},render:function(){var e,s;return s=b(this.props.user,this.props.file,this.props.browseContext),e={"c-btn c-btn--tertiary":!0,"inline-button":!0,"inline-share-button":!0,"variant-DROPDOWN":!0,"extra-padding":!s},y(_,{className:t(e),onClick:this.handleClick,onDoubleClick:this.handleDoubleClick,ref:"button",importance:"secondary"},S.span({className:"inline-share-button-label"},m("Share")),s?y(a,{group:"web",name:"arrow-down-blue",alt:""}):void 0)}}),{ShareButton:f}})}.call(this),function(){var e=function(e,s){function r(){this.constructor=e}for(var n in s)t.call(s,n)&&(e[n]=s[n]);return r.prototype=s.prototype,e.prototype=new r,e.__super__=s.prototype,e},t={}.hasOwnProperty,s=[].indexOf||function(e){for(var t=0,s=this.length;s>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/dirty/react/browse/shared_with",["jquery","external/react","external/underscore","modules/core/user_i18n","modules/clean/account/email","modules/clean/ajax","modules/clean/flux/base_store","modules/clean/flux/dispatcher","modules/clean/flux/store_mixin","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/sharing/shared_with_view","modules/clean/sharing/api","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/ui_util","modules/clean/file_events","modules/dirty/sharing/browse_ui_util"],function(t,r,n,o,i,a,l,u,c,d,p,h,f,m,_,g,y,S,b){var v,T,w,F,I,D,E,P,C,R,N,O,A,x,M,L,U,k,B,q,H,G,V;return F=i.EmailVerification,v=d.BrowseActionTypes,E=d.FileTypes,x=d.SharedWithActionTypes,T=p.BrowseContext,I=p.File,w=h.BrowseStore,B=f.SharedWithView,q=m.SharingApi,D=_.FileShareApiClient,P=_.FolderShareApiClient,O=g.MemberCounts,V=b.showTiburonUIIfAllowed,G=r.DOM,H=r.createElement,N=5,C=100,A=100,R="file_row_sharing_menu",k=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,t),s.prototype._init=function(){return this._sharedFolderDataByTargetNs={},this._sharedFolderMemberCountsByTargetNs={},this._sharedLinkDataMapsByFolderFQPath={},this._filesWeHaveSharedLinkDataFor={},this._sharedFileDataByFileId={}},s.prototype.hasLinkDataForFile=function(e){return e.fq_path in this._filesWeHaveSharedLinkDataFor},s.prototype.clearSharedLinkDataCache=function(){return this._filesWeHaveSharedLinkDataFor={}},s.prototype.getDataForFile=function(e){var t,s,r,n,o;return s=null,null!=e.target_ns&&(s=this._sharedFolderDataByTargetNs[e.target_ns]),this._canBeSharedFile(e)&&(s=this._sharedFileDataByFileId[null!=(r=e.file_id)?r:e.fq_path]),t=w.path(),o=this._sharedLinkDataMapsByFolderFQPath[t],o&&(n=o[this._sharedLinkKey(e)],n?(s||(s={}),s.sharedLinkInfo=n):null!=s&&delete s.sharedLinkInfo),s||(s={}),s.inheritedMemberCounts=this._getMemberCounts(),s},s.prototype._sharedLinkKey=function(e){return e.fq_path+"_"+e.ns_id+"_"+e.sjid},s.prototype._new_payload=function(e){switch(e.action.type){case v.LOAD_PATH:return this._pathLoaded(e.action.data);case v.ADD_FILES:return this._filesAdded(e.action.data);case v.INITIALIZE_EVERYTHING:return this._browseInitializeEverything(e.action.data);case v.CHANGE_FILES:return this._filesChanged(e.action.data);case x.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE:return this._signalSharedFileDataOutOfDate(e.action.data);case x.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE:return this._signalSharedFolderDataOutOfDate(e.action.data);case x.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE:return this._signalSharedLinkDataOutOfDate(e.action.data);case x.SET_SHARED_FOLDER_DATA:return this._setNSSharedWithData(e.action.data);case x.SET_MEMBER_COUNTS_FOR_NS:return this._setMemberCountsForNs(e.action.data);case x.SET_SHARED_LINK_DATA:return this._setSharedLinkData(e.action.data);case x.SET_SHARED_FILE_DATA:return this._setSharedFileData(e.action.data);case x.CLEAR_SHARED_FOLDER_DATA_FOR_NS:return this._clearSharedFolderDataForNs(e.action.data);case x.REMOVE_SHARED_LINK_DATA:return this._removeSharedLinkData(e.action.data)}},s.prototype._fillInMissingSharedLinkData=function(e){var t,s,r,n,o,i,a;for(a=e.parentPath,r=e.files,n=[],o=0,i=r.length;i>o;o++)s=r[o],this.hasLinkDataForFile(s)||(this._filesWeHaveSharedLinkDataFor[s.fq_path]=!0,n.push(s));return M.loadLinkDataForFiles({parentPath:a,fileFqPaths:function(){var e,s,r;for(r=[],e=0,s=n.length;s>e;e++)t=n[e],r.push(t.fq_path);return r}()})},s.prototype._getMemberCounts=function(){var e;return e=w.context().currentNSID,e in this._sharedFolderMemberCountsByTargetNs?this._sharedFolderMemberCountsByTargetNs[e]:new O},s.prototype._canBeSharedFile=function(e){return!(e.is_dir||e.isDeleted)},s.prototype._loadSharedFileData=function(e){var t,s,r,n,o,i,a;if(n=(null!=e?e:{invalidateCache:!1}).invalidateCache,a=w.user(),y.Tiburon.filesFacesUI(a.id)){for(n&&(this._sharedFileDataByFileId={}),s=[],i=w.files().toArray(),r=0,o=i.length;o>r;r++)t=i[r],!this._canBeSharedFile(t)||t.file_id in this._sharedFileDataByFileId||s.push(t.file_id);return M.loadSharedFileDataForFiles({fileIds:s})}},s.prototype._pathLoaded=function(e){var t,s;return t=e.files,s=e.path,M.loadMemberCountsForContainingNs(),M.loadSFDataForPath({parentPath:s}),this._loadSharedFileData({invalidateCache:!0}),this._filesAdded({files:t,path:s})},s.prototype._filesAdded=function(e){var t,s;return t=e.files,s=e.path,this._fillInMissingSharedLinkData({parentPath:s,files:t}),this._loadSharedFileData()},s.prototype._filesChanged=function(e){var t,s,r;return r=e.path,s=e.fileDeltas,r===w.path()&&null!=s&&s.length?(u.waitFor([w.dispatchToken]),M.loadSFDataForPath({parentPath:r}),this.clearSharedLinkDataCache(),t=w.files().toArray(),this._fillInMissingSharedLinkData({parentPath:r,files:t}),this._loadSharedFileData({invalidateCache:!0})):void 0},s.prototype._signalSharedFileDataOutOfDate=function(e){var t;return t=e.fileIds,M.loadSharedFileDataForFiles({fileIds:t})},s.prototype._signalSharedFolderDataOutOfDate=function(e){var t;return t=e.parentPath,null==t&&(t=w.path()),M.loadMemberCountsForContainingNs(),M.loadSFDataForPath({parentPath:t})},s.prototype._signalSharedLinkDataOutOfDate=function(e){var t,s;return s=e.parentPath,t=e.fileFqPaths,null==s&&(s=w.path()),M.loadLinkDataForFiles({parentPath:s,fileFqPaths:t})},s.prototype._setNSSharedWithData=function(e){var t;return t=e.sharedFolderData,this._sharedFolderDataByTargetNs=t,this.emit_change()},s.prototype._setMemberCountsForNs=function(e){var t,s;return s=e.targetNs,t=e.memberCounts,this._sharedFolderMemberCountsByTargetNs[s]=t,this.emit_change()},s.prototype._setSharedLinkData=function(e){var t,s,r,n,o,i,a,l;for(n=e.parentPath,i=e.sharedLinkData,l=this._sharedLinkDataMapsByFolderFQPath[n]||{},s=0,r=i.length;r>s;s++)o=i[s],t=o.file,a=o.sharedLinkToken,l[this._sharedLinkKey(t)]=a;return this._sharedLinkDataMapsByFolderFQPath[n]=l,this.emit_change()},s.prototype._setSharedFileData=function(e){var t;return t=e.sharedFileData,n.extend(this._sharedFileDataByFileId,t),this.emit_change()},s.prototype._clearSharedFolderDataForNs=function(e){var t;return t=e.targetNs,this._sharedFolderDataByTargetNs[t]=void 0,this.emit_change()},s.prototype._browseInitializeEverything=function(e){var t,s;return s=e.path,t=e.files,M.loadMemberCountsForContainingNs(),M.loadSFDataForPath({parentPath:s}),this._filesAdded({path:s,files:t})},s.prototype._removeSharedLinkData=function(e){var t,s,r,n,o,i;for(o=e.parentPath,s=e.files,i=this._sharedLinkDataMapsByFolderFQPath[o]||{},r=0,n=s.length;n>r;r++)t=s[r],i[this._sharedLinkKey(t)]=void 0;return this._sharedLinkDataMapsByFolderFQPath[o]=i,this.emit_change()},s}(l),U=new k,t(document).on(q.REQUEST_SUCCEEDED_EVENT,function(e,t){var s;return s=t.request_url,s.indexOf("/share_ajax/leave")>-1||s.indexOf("/share_ajax/unshare")>-1?u.dispatch({type:x.CLEAR_SHARED_FOLDER_DATA_FOR_NS,data:{targetNs:t.ns_id}}):u.dispatch({type:x.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE,data:{parentPath:w.path()}})}).on(S.LINKS_REMOVE,function(e,t){return u.dispatch({type:x.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE,data:{parentPath:w.path(),fileFqPaths:[t.fq_path]}})}).on(S.LINKS_ADD,function(e,t){return u.dispatch({type:x.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE,data:{parentPath:w.path(),fileFqPaths:[t.fq_path]}})}),M=function(){function e(){}return e.loadSFDataForPath=function(e){var t,s;return t=e.parentPath,s=w.user(),a.WebRequest({url:"/share_ajax/shared_with",dataType:"json",subject_user:s,data:{max_results:N,fq_path_prefix:t,include_inherited:!w.context().isInsideSharedFolder},success:function(e){var t,s,r,n,o;for(o={},t=0,s=e.length;s>t;t++)n=e[t],r={numUndisplayableUsersAndInvites:n.num_avatars_not_shown,groups:n.groups,invitations:n.invitations,joinedMembers:n.joined_members,includeInherited:!w.context().isInsideSharedFolder},o[n.ns_id]=r;return u.dispatch({type:x.SET_SHARED_FOLDER_DATA,data:{sharedFolderData:o}})}})},e.loadMemberCountsForContainingNs=function(){var e,t,s;return s=w.user(),t=w.context().isInsideSharedFolder?w.context().currentNSID:void 0,s.is_email_verified&&t?(e=new P({userId:s.id}),e.getMemberCounts({contentId:t}).then(function(e){return u.dispatch({type:x.SET_MEMBER_COUNTS_FOR_NS,data:{memberCounts:e,targetNs:t}})})):void 0},e.loadSharedFileDataForFiles=function(e){var t,s,r,n;return s=e.fileIds,n=w.user(),n.is_email_verified?(t=new D({userId:n.id}),(r=function(e){var s,n,o;if(0!==e.length)return o=e.slice(0,A),s=e.slice(A),n=t.listMembersBatch({contentIds:o,limit:N}),n.then(function(e){var t;return t={},e.forEach(function(e,s){return t[s]={numUndisplayableUsersAndInvites:0,groups:e.groups.valueSeq().map(y.apiGroupMemberToAvatarInfo).toArray(),invitations:e.invitees.valueSeq().map(y.apiInviteeMemberToAvatarInfo).toArray(),joinedMembers:e.users.valueSeq().map(y.apiUserMemberToAvatarInfo).toArray()}}),u.dispatch({type:x.SET_SHARED_FILE_DATA,data:{sharedFileData:t}}),s?r(s):void 0})})(s)):void 0},e.loadLinkDataForFiles=function(e){var t,r,n,o;return r=e.parentPath,t=e.fileFqPaths,o=w.user(),(n=function(e){var t,i;if(0!==e.length)return i=e.slice(0,C),t=e.slice(C),a.SilentBackgroundRequest({url:"/sm/get_token_info",dataType:"json",data:{paths:JSON.stringify(i)},subject_user:o,success:function(e){var o,a,l,c,d,p,h,f,m,_,g;for(l=w.filesMap(),m=[],h=e.shmodels,c=0,d=h.length;d>c;c++)g=h[c],g.disabled||(o=l.get(g.path),o&&m.push({file:o,sharedLinkToken:g}));return m.length&&u.dispatch({type:x.SET_SHARED_LINK_DATA,data:{parentPath:r,sharedLinkData:m}}),_=function(){var t,s,r,n;for(r=e.shmodels,n=[],t=0,s=r.length;s>t;t++)f=r[t],n.push(f.path);return n}(),a=function(){var e,t,r;for(r=[],e=0,t=i.length;t>e;e++)p=i[e],s.call(_,p)>=0||r.push(l.get(p));return r}().filter(function(e){return null!=e}),a.length&&u.dispatch({type:x.REMOVE_SHARED_LINK_DATA,data:{parentPath:r,files:a}}),t?n(t):void 0}})})(t)},e}(),L=r.createClass({displayName:"SharedWithController",mixins:[c(U)],propTypes:{browseContext:r.PropTypes.instanceOf(T).isRequired,file:r.PropTypes.instanceOf(I).isRequired},_get_state_from_stores:function(e){var t,s,r,n,o,i,a,l;return t=U.getDataForFile(e.file),{numUndisplayableUsersAndInvites:null!=(s=null!=t?t.numUndisplayableUsersAndInvites:void 0)?s:0,numInheritedMembers:null!=(r=null!=t&&null!=(n=t.inheritedMemberCounts)?n.total_unique_users:void 0)?r:0,groups:null!=(o=null!=t?t.groups:void 0)?o:[],invitations:null!=(i=null!=t?t.invitations:void 0)?i:[],joinedMembers:null!=(a=null!=t?t.joinedMembers:void 0)?a:[],sharedLinkInfo:null!=(l=null!=t?t.sharedLinkInfo:void 0)?l:null}},componentWillReceiveProps:function(e){return this.setState(this._get_state_from_stores(e))},_showSharingModal:function(){var e,t,s;return t=[w.user(),this.props.file],s=t[0],e=t[1],V(s,e,{browseContext:this.props.browseContext,origin:"BROWSE_FILE_ROW"})?void 0:require(["dropbox"],function(t){var r;return r=t.ExistingSharedFolderOptionsModal,e.is_dir?new r(s,e.fq_path).show():void 0})},handleOverflowCountClick:function(){return this._showSharingModal()},handleAvatarClick:function(){return this._showSharingModal()},handleSharedLinkClick:function(){var e;return e=w.user(),F.get_for_user(e).verified_or_show()&&!V(e,this.props.file,{browseContext:this.props.browseContext,origin:"BROWSE_FILE_ROW"})?require(["dropbox"],function(t){return function(s){var r,n;return n=s.SharingShmodel,r=s.Browse,null==r.active_user&&(r.active_user=e),n.shmodel(t.props.file.fq_path,R)}}(this)):void 0},render:function(){return H(B,{user:w.user(),file:this.props.file,numUndisplayableUsersAndInvites:this.state.numUndisplayableUsersAndInvites,numInheritedMembers:this.state.numInheritedMembers,groups:this.state.groups,invitations:this.state.invitations,joinedMembers:this.state.joinedMembers,sharedLinkInfo:this.state.sharedLinkInfo,animation:!1,onOverflowCountClick:this.handleOverflowCountClick,onAvatarClick:this.handleAvatarClick,onSharedLinkClick:this.handleSharedLinkClick,maxVisibleAvatars:N})}}),{SharedWithActions:M,SharedWithController:L,SharedWithStore:U}})}.call(this),function(){define("modules/dirty/react/browse/sharing_shims",["modules/clean/analytics","modules/clean/react/browse/constants","modules/clean/sharing/models/file","modules/dirty/sharing/browse_ui_util"],function(e,t,s,r){var n,o,i,a,l,u,c,d,p,h,f,m;return i=e.ShmodelUILogger,o=t.NameSpaceAccess,n=t.FileTypes,l=s.canConvertToSharedFolder,m=r.showTiburonUIIfAllowed,p=r.isTiburonUIAllowed,d=function(e){return e.type===n.SHARED_FOLDER||e.type===n.TEAM_SHARED_FOLDER},a=function(e,t){var s;return s=i.TARGET_ITEMS,e.is_dir?d(e)?s.FOLDER_IS_SF:l(e,t)?s.FOLDER_CAN_SF:s.FOLDER_NO_SF:s.FILE},h=function(e,t,s){return m(e,t,{browseContext:s})?void 0:require(["dropbox"],function(r){var n,i,l,u,c;return n=r.Browse,i=r.BrowseSelection,null==n.active_user&&(n.active_user=e),u=a(t,s),s.isInsideSharedFolder?(c=s.currentSharedFolderPermissionRole,l=c===o.ACCESS_OWNER):l=!0,i.show_share_modal_if_email_verified(e,d(t),u,t.fq_path,l)})},f=function(e,t,s,r){return m(e,t,{browseContext:s})?void 0:require(["dropbox"],function(n){var o,l,u;return o=n.Browse,l=n.SharingShmodel,null==o.active_user&&(o.active_user=e),u=a(t,s),i.log("token_share",r,u),l.shmodel(t.fq_path,r)})},u=function(e,t,s){var r;return r=t.type===n.TEAM_SHARED_FOLDER,p(e,t,s)||r?!1:d(t)||l(t,s)},c=function(e,t,s,r,o){return require(["dropbox"],function(i){var l,c,p,h,_,g;return l=i.Browse,p=i.SharingGrowthExperimentsDropdown,c=i.ExistingSharedFolderOptionsModal,m(t,s,{browseContext:r,origin:o})?void 0:(null==l.active_user&&(l.active_user=t),h=s.type===n.TEAM_SHARED_FOLDER,_=a(s,r),u(t,s,r)?p.open(s.fq_path,d(s),e,t,_):h?(g=new c(t,s.fq_path),g.show()):f(t,s,r,"browse_file_row"))})},{hasMultipleSharingOptions:u,initiateSharingFromUIElement:c,showShareFolderModal:h,showShareLinkModal:f}})}.call(this),function(){define("modules/dirty/search/search_results",["external/immutable","external/react","external/underscore","modules/clean/flux/store_mixin","modules/clean/react/css","modules/clean/search/actions","modules/clean/search/store","modules/dirty/search/search_results_view"],function(e,t,s,r,n,o,i,a){var l,u,c;return c=t.DOM,u=t.createElement,l=t.createClass({displayName:"SearchResultsController",mixins:[r(i)],_get_state_from_stores:function(){return{context:i.browseContext(),hasMoreResults:i.hasMoreResults(),loadingState:i.loadingState(),latestQuery:i.latestQuery(),numDeletedResults:i.numDeletedResults(),searchResults:i.searchResults(),selection:i.selection(),selectedFiles:i.selectedFiles()}},propTypes:{limitedTeamBannerUpsell:t.PropTypes.bool,onFullSearch:t.PropTypes.func,onPathOpen:t.PropTypes.func,path:t.PropTypes.string,searchBarElement:t.PropTypes.element.isRequired,trademarkBusiness:t.PropTypes.string,user:t.PropTypes.object},_handleScroll:function(){var e;return e=this.getDOMNode().getBoundingClientRect(),e.bottom<=window.innerHeight?o.loadMoreResults({path:this.props.path,user:this.props.user}):void 0},handleSelectionChange:function(e){return o.setSearchSelection({selection:e})},render:function(){return u(a,s.extend({},{limitedTeamBannerUpsell:this.props.limitedTeamBannerUpsell,onFullSearch:this.props.onFullSearch,onScroll:s.throttle(this._handleScroll,200),onSelectionChange:this.handleSelectionChange,path:this.props.path,searchBarElement:this.props.searchBarElement,trademarkBusiness:this.props.trademarkBusiness,user:this.props.user},this.state))}}),l=n(l,["/static/css/browse/browse-vflRY5wc2.css","/static/css/scooter/scooter-scoped-vfljb_RbQ.css"])})}.call(this),function(){define("modules/dirty/search/search_results_view",["jquery","external/classnames","external/immutable","external/react","external/underscore","modules/clean/analytics","modules/clean/browse_interface","modules/clean/filepath","modules/clean/react/browse/constants","modules/clean/react/image","modules/clean/react/sprite","modules/clean/search/constants","modules/clean/search/search_helpers","modules/clean/teams/team_promo_banner","modules/clean/static_urls","modules/constants/viewer","modules/core/browser","modules/core/i18n","modules/core/uri","modules/dirty/react/browse/actions","modules/dirty/react/browse/context_menu","modules/dirty/react/browse/file_list","modules/dirty/react/browse/selection_actions"],function(e,t,s,r,n,o,i,a,l,u,c,d,p,h,f,m,_,g,y,S,b,v,T){var w,F,I,D,E,P,C,R,N,O,A,x,M,L,U;return O=o.TeamsWebActionsLogger,I=l.DropTargetHighlightMode,E=l.LoadingStates,P=l.NewFolderCreationState,R=d.SearchLoadingStates,L=f.static_url,C=m.ROLE_WORK,A=g._,U=g.ungettext,w=b.BrowseContextMenu,D=v.FileListController,F=T.BrowseSelectionMenu,M=r.DOM,x=r.createElement,N=r.createClass({displayName:"SearchResultsView",propTypes:{hasMoreResults:r.PropTypes.bool,loadingState:r.PropTypes.oneOf(n.values(R)),latestQuery:r.PropTypes.string,limitedTeamBannerUpsell:r.PropTypes.bool,onFullSearch:r.PropTypes.func,onScroll:r.PropTypes.func,path:r.PropTypes.string,searchBarElement:r.PropTypes.element,searchResults:r.PropTypes.instanceOf(s.List),selection:r.PropTypes.object,selectedFiles:r.PropTypes.instanceOf(s.OrderedSet),trademarkBusiness:r.PropTypes.string,user:r.PropTypes.object},componentDidMount:function(){return e(window).on("scroll.SearchResults",this.props.onScroll)},componentWillUnmount:function(){return e(window).off("scroll.SearchResults")},renderFullSearchLink:function(){var e,t;return t=this.props.user.role===C?i.WORK_ROOT:i.PERSONAL_ROOT,e=y.parse("/search"+t).setQuery({path:"/",query:this.props.latestQuery}).toString(),M.a({href:e,onClick:this.props.onFullSearch},A("Search all of my Dropbox instead"))},renderEmptyFolderView:function(){return M.div({className:"u-font-center u-pad-top-xl"},x(u,{src:L("/static/images/empty_states/search-vfl6DaX2I.png"),srcHiRes:L("/static/images/empty_states/search@2x-vflBsUhDE.png"),alt:""}),M.h2({className:"u-pad-top-l"},A("No results found")),M.div({},"/"===this.props.path?A("Please update your search and try again"):this.renderFullSearchLink()))},renderUpsellPromoBanner:function(){return this.props.loadingState!==E.LOADED||this.props.hasMoreResults||this._banner_view_logged||(this._banner_view_logged=!0,O.log("banner_search_displayed",{location:"search_results",item_count:this.props.searchResults.size})),x(h,{description:[A("Search through file contents in addition to file names with %(trademark_business)s").format({trademark_business:this.props.trademarkBusiness}),M.a({className:"upsell_info u-pad-xxs",href:"/help/6635",target:"_blank",key:"info-link"},x(c,{group:"web",name:"info",alt:"more info"}))],buttons:[{text:A("Upgrade"),handler:function(){return _.redirect(y({path:"/team/upgrade",query:{tk:"search_upsell_results",camp:"web"}}))}}]})},render:function(){var e;return e=this.props.loadingState===R.LOADING_FIRST_PAGE?E.LOADING_FIRST_PAGE:this.props.loadingState===R.LOADING_ADDITIONAL_PAGE?E.LOADING_REMAINING_PAGES:E.LOADED,M.div({className:t({"search-results":!0,promo:this.props.limitedTeamBannerUpsell}),id:"browse-box"},M.div({className:"search-results__header",id:"browse-header"},M.h1({className:"search-results__title"},this.props.loadingState!==R.LOADED?A("Searching…"):"/"===this.props.path?A("Results for ‘%(query)s’").format({query:this.props.latestQuery}):A("Results for ‘%(query)s’ in ‘%(path)s’",{comment:"Path is a folder name in the user's Dropbox"}).format({query:this.props.latestQuery,path:a.filename(this.props.path)})),this.props.searchBarElement,this.props.limitedTeamBannerUpsell?this.renderUpsellPromoBanner():void 0,this.props.loadingState!==R.LOADING_FIRST_PAGE&&this.props.searchResults.size?M.div({className:"search-results__info"},this.props.hasMoreResults?U("%(num_results)d result in files, folders, and content.","%(num_results)d results in files, folders, and content.",this.props.searchResults.size).format({num_results:this.props.searchResults.size}):M.span({},U("%(num_results)d result in files, folders, and content.","%(num_results)d results in files, folders, and content.",this.props.searchResults.size).format({num_results:this.props.searchResults.size}),"/"!==this.props.path?M.span({className:"u-pad-horizontal-xs"},this.renderFullSearchLink()):void 0)):void 0),x(w,{user:this.props.user,selectedFiles:this.props.selectedFiles,context:this.props.context,shouldShowGlobalActions:!1}),x(F,{user:this.props.user,selectedFiles:this.props.selectedFiles,context:this.props.context}),x(D,{context:this.props.context,files:this.props.searchResults,loadingState:e,isColumnHeaderVisible:!1,isMultiColumnGroupVisible:!1,isPaginating:!1,isShortcutsMenuVisible:!1,isTextSelectable:!1,isDragAndDropEnabled:!1,shouldShowDeletedFiles:!1,showContainingPaths:!0,showFilenameHighlights:!0,user:this.props.user,selection:this.props.selection,selectedFiles:this.props.selectedFiles,onSelectionChange:this.props.onSelectionChange,customEmptyFolderView:this.renderEmptyFolderView
}))}})})}.call(this);
//# sourceMappingURL=pkg-ag.min.js-vfl6tuos7.map