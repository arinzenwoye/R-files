(function(){define("modules/clean/accessibility/utils",[],function(){var e;return e=["#006AFF","#0073E1","#007BC3","#007F9B","#008578","#008750","#008928","#008800","#0573EB","#0579C3","#0580A0","#05857D","#058655","#058932","#05890A","#0A71F0","#0A78CD","#0A7FAA","#0A8487","#0A855F","#0A8737","#0A880F","#0F6EF5","#0F76D7","#0F7DB4","#0F818C","#0F8669","#0F8741","#0F8819","#146DFF","#1475DC","#147BBE","#14819B","#148473","#14864B","#148723","#1969FF","#1972E1","#1979C3","#1980A0","#198278","#198550","#198728","#198700","#1E70E6","#1E79C8","#1E7FA5","#1E837D","#1E8555","#1E8832","#1E880A","#236EEB","#2376D2","#237CAF","#238187","#23845F","#23883C","#238914","#286DF5","#2876D7","#287CB4","#28808C","#288469","#288541","#288619","#2D6AFA","#2D73DC","#2D7BB9","#2D8096","#2D836E","#2D8446","#2D8823","#3267FF","#3271E1","#3279C3","#327D9B","#328378","#328550","#328528","#328600","#376EE6","#3777C8","#377DA5","#37807D","#37855A","#378632","#37860A","#3C6CEB","#3C74CD","#3C7BAA","#3C8087","#3C835F","#3C8437","#3C8614","#416AF5","#4173D7","#4179B9","#417E91","#418069","#418341","#418419","#4667FA","#466FDC","#4676BE","#467B9B","#468073","#46824B","#468423","#4B63FF","#4B6DE1","#4B75BE","#4B7B9B","#4B8078","#4B8150","#4B8228","#4B8300","#5069E6","#5072C8","#5079A5","#507C7D","#50815A","#508232","#50830A","#5567F0","#556FD2","#5575AA","#557A87","#557E5F","#55823C","#558314","#5A65F5","#5A6DD7","#5A75B4","#5A7A91","#5A7D69","#5A7F41","#5A821E","#5F61FA","#5F69DC","#5F71BE","#5F779B","#5F7E50","#5F7F28","#5F8100","#6466E6","#646DC3","#6475A5","#647D55","#647E2D","#648005","#6964EB","#696BC8","#6972A5","#697C55","#697E2D","#697F05","#6E62EB","#6E6AC8","#6E71A5","#6E7C46","#6E7E1E","#7358FF","#7363E1","#736ABE","#7372A0","#785CEB","#7864CD","#786DAF","#7D53FF","#7D5EE1","#7D66C3","#7D6EA0","#8255F5","#825FD7","#8268B9","#826D91","#8756F0","#8760D2","#8766AA","#8C4AFF","#8C56E6","#8C60C8","#8C66A0","#914BF5","#9157DC","#9160BE","#916596","#964BEB","#9655D2","#965EAF","#966691","#9B47F0","#9B51D2","#9B5CB4","#9B6191","#A041F5","#A04EDC","#A058B9","#A06196","#A53BF5","#A548DC","#A553BE","#A55A96","#AA34FA","#AA42E6","#AA4FC8","#AA58A0","#AA5F78","#AA614B","#AA6623","#AF29FF","#AF38E6","#AF47D2","#AF52AF","#AF5782","#AF5E5A","#AF622D","#AF6400","#B42CF0","#B43CD7","#B447B4","#B45291","#B45864","#B45D37","#B45D05","#B919FF","#B92CE6","#B93BC8","#B94AAA","#B9547D","#B95B4B","#B95A14","#BE0CF0","#BE1FEB","#BE31CD","#BE41B4","#BE4C87","#BE5455","#BE561E","#C307EB","#C31AE1","#C32CC8","#C33DB4","#C3488C","#C34F5A","#C35428","#C803E1","#C816E1","#C826C3","#C836AF","#C8428C","#C8495F","#C84F32","#C85200","#CD11C8","#CD22C8","#CD31AF","#CD3B87","#CD4664","#CD4B37","#CD4D0A","#D20CC3","#D21CB4","#D229A0","#D23587","#D23E64","#D23F37","#D2430F","#D708AF","#D716A0","#D72291","#D73087","#D7355F","#D73A3C","#D73A14","#DC0596","#DC119B","#DC1D91","#DC256E","#DC2E5A","#DC343C","#DC3419","#E1027D","#E10C87","#E11882","#E11B5A","#E12755","#E12A37","#E12919","#E13200","#E6075F","#E60C4B","#E61655","#E61D46","#E62132","#E61B14","#E61A00","#EB0232","#EB0214","#EB0D30"],{accessibleColorPalette:e}})}).call(this),function(){define("modules/clean/account/change_email_modals",["jquery","external/react","modules/core/notify","modules/core/i18n","modules/clean/form","modules/clean/account/email_verify","modules/clean/react/bubble_dropdown","modules/clean/react/input","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/viewer","modules/clean/ajax","modules/constants/viewer"],function(e,t,n,i,o,r,s,a,l,u,c,d,p){var _,h,m,f,v,g,y,b,w,E;return y=i._,w=i.render_sentences,E=i.ungettext,g=l.Modal,b=t.DOM,v=t.createClass({displayName:"ChangeEmailWarningModal",propTypes:{user:t.PropTypes.object,inboxCount:t.PropTypes.number,onContinue:t.PropTypes.func},render:function(){return g({title:y("Warning!"),acceptButtonText:y("Continue anyway"),dismissButtonText:y("Cancel"),onAccept:this.showChange,ref:"modal"},this.getSSOWarning(),this.getInboxWarning())},getSSOWarning:function(){var e,t,n;return e=c.get_viewer().is_paired,n=e&&this.props.user.role===p.ROLE_WORK,t=this.props.user.sso_required,n&&t?b.div({},y("Your %(team)s Dropbox uses single sign-on. If you change your email address you may not be able to sign in.").format({team:c.get_viewer().team_name})):null},getInboxWarning:function(){var e;return e=c.get_viewer().is_paired,0===this.props.inboxCount?null:e&&this.props.user.role===p.ROLE_PERSONAL?E("Your %(num)d existing shared folder invitation in your personal Dropbox will be removed if you change your email address.","Your %(num)d existing shared folder invitations in your personal Dropbox will be removed if you change your email address.",this.props.inboxCount).format({num:this.props.inboxCount}):e&&this.props.user.role===p.ROLE_WORK?E("Your %(num)d existing shared folder invitation in your %(team)s Dropbox will be removed if you change your email address.","Your %(num)d existing shared folder invitations in your %(team)s Dropbox will be removed if you change your email address.",this.props.inboxCount).format({num:this.props.inboxCount,team:c.get_viewer().team_name}):E("Your %(num)d existing shared folder invitation will be removed if you change your email address.","Your %(num)d existing shared folder invitations will be removed if you change your email address.",this.props.inboxCount).format({num:this.props.inboxCount})},showChange:function(e){var t,n;return e.preventDefault(),n=this.refs.modal,n.close(),"function"==typeof(t=this.props).onContinue?t.onContinue():void 0}}),h=t.createClass({displayName:"ChangeEmailModal",propTypes:{user:t.PropTypes.object,onChange:t.PropTypes.func,onVerificationCheck:t.PropTypes.func},getInitialState:function(){return{submitting:!1,errors:{}}},render:function(){return g({title:y("Update '%(email)s'").format({email:this.props.user.email}),className:"change-email-modal",acceptButtonText:y("Update email"),dismissButtonText:y("Cancel"),onAccept:this.handleSubmit,submitting:this.state.submitting,ref:"modal"},b.form({action:"/account/change_email",className:"change-email-form",onSubmit:this.handleSubmit,onKeyDown:this.handleKey,ref:"form"},b.div({},this.getPrompt()),b.div({className:"change-email-inputs"},a.text({name:"email",label:y("New email",{comment:"'email' refers to the email address"}),error:this.state.errors.email,autoComplete:"off"}),a.text({name:"confirm_email",label:y("Confirm email",{comment:"'email' refers to the email address"}),error:this.state.errors.confirm_email,autoComplete:"off"}),a.password({name:"password",label:y("Dropbox password"),error:this.state.errors.password,autoComplete:"off"}),b.input({type:"hidden",name:p.UID_PARAM_NAME,value:this.props.user.id}))))},handleKey:function(e){var t;return 13===e.keyCode&&"INPUT"===(null!=(t=e.target)?t.tagName:void 0)?this.handleSubmit(e):void 0},handleSubmit:function(e){return e.preventDefault(),this.state.submitting?void 0:this.submit()},submit:function(t){var n;return this.setState({submitting:!0,errors:{}}),n=e(this.refs.form.getDOMNode()),o.submit(n,this._success,this._error,this._complete)},_success:function(t){var n,i,o,r,s,a;return s=this.refs.modal,r=this.refs.form,o=e(r.getDOMNode()).find('input[name="email"]').val(),a="NEEDS_VERIFICATION"===t,s.close(),a?"function"==typeof(n=this.props).onVerificationCheck?n.onVerificationCheck(o):void 0:"function"==typeof(i=this.props).onChange?i.onChange(o):void 0},_error:function(e){return"string"==typeof e?n.error(e):e?this.setState({errors:e}):n.error()},_complete:function(){return this.isMounted()?this.setState({submitting:!1}):void 0},getPrompt:function(){var e,t,n;return e=c.get_viewer().is_paired,n=this.props.user.email_verified,t=[],e&&this.props.user.role===p.ROLE_PERSONAL?(t.push(y("Enter a new email address for your personal Dropbox.")),n&&t.push(y("You’ll need to verify your new email address in order to finish updating your personal email."))):e&&this.props.user.role===p.ROLE_WORK?(t.push(y("Enter a new email address for your %(team)s Dropbox.").format({team:c.get_viewer().team_name})),n&&t.push(y("You’ll need to verify your new email address in order to finish updating your %(team)s email.").format({team:c.get_viewer().team_name}))):n&&t.push(y("You’ll need to verify your new email address in order to finish updating your email.")),t.length?w(t):""}}),m=t.createClass({displayName:"ChangeEmailOptionsEntry",propTypes:{name:t.PropTypes.string.isRequired,type:t.PropTypes.string.isRequired,address:t.PropTypes.string,verified:t.PropTypes.bool,doChangeAddress:t.PropTypes.func,doMakePrimary:t.PropTypes.func,doCreateAlias:t.PropTypes.func,doDeleteAlias:t.PropTypes.func},render:function(){var e;return e=this.props.verified?"address verified":"address pending",b.div({className:"email-row bs-row clearfix clear","data-type":this.props.type},b.span({className:"type"},this.props.name),null!=this.props.address?b.span({className:e},this.props.address):void 0,null!=this.props.address?s({targetButton:b.button({className:"sprite-button"},u({group:"web",name:"gear",alt:y("Options")})),arrow_position:"top-right",ref:"dropdown"},b.div({className:"list-menu list-menu-hover"},this.props.verified?void 0:b.div({className:"list-item",onClick:function(e){return function(){return e.refs.dropdown.hide(),n.info(y("Sending verification email...")),r.send_verification_email(e.props.user,e.props.email,"generic",function(){return n.success(y("Verification email sent to %(email)s").format({email:e.props.address}))})}}(this)},y("Resend verification")),"primary"===this.props.type?b.div({className:"list-item",onClick:this.props.doChangeAddress},y("Change email address")):(b.div({className:"list-item",onClick:this.props.doMakePrimary},y("Make primary",{comment:"Make [this email address] primary"})),b.div({className:"list-item",onClick:function(e){return function(){return e.props.doDeleteAlias(e.props.address)}}(this)},y("Delete email",{comment:"'email' refers to the email address"}))))):b.a({className:"address prompt",onClick:this.props.doCreateAlias},y("Add %(type_of_email)s email",{comment:"'email' refers to the email address"}).format({type_of_email:this.props.name.toLowerCase()})))}}),_=t.createClass({displayName:"AddRecoveryEmailModal",propTypes:{user:t.PropTypes.object,onSuccess:t.PropTypes.func},getInitialState:function(){return{submitting:!1,errors:{}}},render:function(){return g({title:y("Add recovery email"),className:"change-email-modal",acceptButtonText:y("Add recovery email"),onAccept:this.handleSubmit,submitting:this.state.submitting,ref:"modal"},b.form({action:"/account/alias/add/recovery_email",className:"change-email-form",onSubmit:this.handleSubmit,onKeyDown:this.handleKey,ref:"form"},b.div({},y("If you request a password reset, we’ll send a link to both your primary and recovery emails.")),b.div({className:"change-email-inputs"},a.text({name:"email_alias",label:y("New email"),error:this.state.errors.email_alias,autoComplete:"off",onChange:function(e){return function(t){return e.newAddress=t.target.value}}(this)}),a.password({name:"password",label:y("Dropbox password"),error:this.state.errors.password,autoComplete:"off"}),b.input({type:"hidden",name:p.UID_PARAM_NAME,value:this.props.user.id}))))},handleKey:function(e){var t;return 13===e.keyCode&&"INPUT"===(null!=(t=e.target)?t.tagName:void 0)?this.handleSubmit(e):void 0},handleSubmit:function(e){return e.preventDefault(),this.state.submitting?void 0:this.submit()},submit:function(t){var n;return this.setState({submitting:!0,errors:{}}),n=e(this.refs.form.getDOMNode()),o.submit(n,this._success,this._error,this._complete)},_success:function(e){var t,i,o,r;return o=this.refs.modal,i=this.refs.form,t=this.newAddress,r="ok:NEEDS_VERIFICATION"===e,r&&n.success(y("Please check your email to verify your recovery email.")),o.close(),this.props.onSuccess(t,!r)},_error:function(e){return"string"==typeof e?n.error(e):e?this.setState({errors:e}):n.error()},_complete:function(){return this.isMounted()?this.setState({submitting:!1}):void 0},getPrompt:function(){var e,t,n;return e=c.get_viewer().is_paired,n=this.props.user.email_verified,t=[],e&&this.props.user.role===p.ROLE_PERSONAL?(t.push(y("Enter a new email address for your personal Dropbox.")),n&&t.push(y("You'll need to verify your new email address in order to finish updating your personal email."))):e&&this.props.user.role===p.ROLE_WORK?(t.push(y("Enter a new email address for your %(team)s Dropbox.").format({team:c.get_viewer().team_name})),n&&t.push(y("You'll need to verify your new email address in order to finish updating your %(team)s email.").format({team:c.get_viewer().team_name}))):n&&t.push(y("You'll need to verify your new email address in order to finish updating your email.")),t.length?w(t):""}}),f=t.createClass({displayName:"ChangeEmailOptionsModal",propTypes:{initialAliases:t.PropTypes.array,user:t.PropTypes.object,onAliasChange:t.PropTypes.func,startChangePrimaryFlow:t.PropTypes.func},getInitialState:function(){return{aliases:this.props.initialAliases}},deleteAlias:function(e){return new d.WebRequest({url:"/account/alias/remove",type:"POST",subject_user:this.props.user,data:{alias_type:"recovery_email",alias:e},success:function(t){return function(n){var i,o,r;r=t.state.aliases.slice();for(o in r)if(i=r[o],i.alias===e){r.splice(o,1);break}return t.setState({aliases:r}),t.props.onAliasChange(r)}}(this)})},createAlias:function(){return g.showInstance(new _({user:this.props.user,onSuccess:function(e){return function(t,n){var i;return i=e.state.aliases.slice(),i.push({alias:t,type:"recovery_email",verified:n}),e.props.onAliasChange(i)}}(this)}))},render:function(){var e;return g({title:y("Change %(role)s emails",{comment:"email refers to an email address"}).format({role:"personal"}),className:"change-email-options-modal",acceptButtonText:y("Close"),ref:"modal"},b.div({className:"email-list-container"},m({user:this.props.user,name:y("Primary",{comment:"Primary email address"}),type:"primary",address:this.props.user.email,verified:this.props.user.is_email_verified,doChangeAddress:function(e){return function(){return e.props.startChangePrimaryFlow()}}(this)}),function(){var t,n,i,o;for(i=this.state.aliases,o=[],t=0,n=i.length;n>t;t++)e=i[t],"recovery_email"===e.type&&o.push(m({user:this.props.user,name:y("Recovery",{comment:"Recovery email address; 'backup'"}),type:"recovery",address:e.alias,verified:e.verified,doDeleteAlias:this.deleteAlias}));return o}.call(this),0===this.state.aliases.length?m({user:this.props.user,name:y("Recovery",{comment:"Recovery email address; 'backup'"}),type:"recovery",doCreateAlias:this.createAlias}):void 0))}}),{ChangeEmailWarningModal:v,ChangeEmailModal:h,ChangeEmailOptionsModal:f,AddRecoveryEmailModal:_}})}.call(this),function(){define("modules/clean/account/email",["jquery","external/classnames","external/react","modules/core/browser","modules/core/notify","modules/core/i18n","modules/core/uri","modules/clean/ajax","modules/clean/account/change_email_modals","modules/clean/account/email_verify","modules/clean/account/verify_email_modals","modules/clean/react/modal","modules/clean/react/react_i18n","modules/clean/viewer","modules/constants/viewer"],function(e,t,n,i,o,r,s,a,l,u,c,d,p,_,h){var m,f,v,g,y,b,w,E,T,C,S,k,I,A,P;return A=r._,g=l.ChangeEmailModal,y=l.ChangeEmailOptionsModal,b=l.ChangeEmailWarningModal,f=l.AddRecoveryEmailModal,k=c.VerifyEmailModal,S=c.ResendVerifyEmailModal,I=c.VerifyEmailSentModal,T=c.EmailVerifiedModal,w=c.ChangedEmailVerifiedModal,C=d.Modal,E=function(){function e(e){var t;this.role=e,this.role?this.user=_.get_viewer().get_user_by_role(this.role,!0):this.user=_.get_viewer().deprecated_first_user_in_the_cookie,this.email_to_verify=null!=(t=this.user)?t.email:void 0,this.verify_for_change=!1}return e.prototype.polling=!1,e.prototype.show_resend=!1,e.shouldUseSimpleUI=!1,e.getForRole=function(t){return this.initalized||(this.legacy=new e(null),this.personal=new e("personal"),this.work=new e("work"),this.initalized=!0),"personal"===t?this.personal:"work"===t?this.work:this.legacy},e.get_for_user=function(e){return this.getForRole(e.role)},e.set_should_use_simple_ui=function(e){return this.shouldUseSimpleUI=e},e.reset=function(){return this.shouldUseSimpleUI=!1,this.initalized=!1},e.prototype.set_email_to_verify=function(e){return this.email_to_verify=e,this.verify_for_change=this.email_to_verify!==this.user.email},e.prototype.send_email=function(e,t){return u.send_verification_email(this.user,this.email_to_verify,e,t)},e.prototype.flash_email_sent_notification=function(){return o.success(A("Verification email sent to %(email)s").format({email:this.email_to_verify}))},e.prototype.ensure_polling=function(e){return u.listen_for_verification(this.user,this.email_to_verify,function(t){return function(){return null!=e?(t.user.is_email_verified=!0,e()):i.reload()}}(this))},e.prototype.email_sent=function(e,t){return this.show_resend=!0,this.show(null,t),this.flash_email_sent_notification(),this.ensure_polling(e)},e.prototype.show=function(e,t){return this.show_resend?this.show_resend_verify_modal(t):this.show_verify_modal(e,t)},e.prototype.show_verify_modal=function(t,n){return null==n&&(n=this.verify_for_change?"change_email":e.REASON),C.showInstance(new k({user:this.user,reason:n,email:this.email_to_verify,onShowChange:function(e){return function(){return v.show(e.user)}}(this),onEmailSent:function(n){return function(){var i;return i=e.get_for_user(n.user),i.email_sent(t)}}(this),shouldUseSimpleUI:e.shouldUseSimpleUI}))},e.prototype.show_resend_verify_modal=function(t){return null==t&&(t=this.verify_for_change?"change_email":e.REASON),C.showInstance(new S({user:this.user,email:this.email_to_verify,reason:t,onShowChange:function(e){return function(){return v.show(e.user)}}(this),onEmailSent:function(t){return function(){var n;return n=e.get_for_user(t.user),n.email_sent()}}(this),shouldUseSimpleUI:e.shouldUseSimpleUI}))},e.prototype.verified_or_send_and_show=function(e,t){return this.user.is_email_verified?("function"==typeof t&&t(),!0):(this.send_email(e,function(n){return function(){return n.email_sent(function(){return n.close(),"function"==typeof t?t():void 0},e)}}(this)),!1)},e.prototype.verified_or_show=function(e){return this.user.is_email_verified?!0:(this.show(null,e),!1)},e.prototype.show_sent_modal=function(){return C.showInstance(new I({email:this.email_to_verify,shouldUseSimpleUI:e.shouldUseSimpleUI}))},e.prototype.show_verified_modal=function(){return C.showInstance(new T({reason:e.REASON,email:this.email_to_verify,shouldUseSimpleUI:e.shouldUseSimpleUI}))},e.prototype.show_verified_and_changed_modal=function(){return C.showInstance(new w({user:this.user,email:this.email_to_verify}))},e.prototype.close=function(){return C.close()},e}(),v={inbox_counts:{},set_inbox_counts:function(t){return e.extend(this.inbox_counts,t)},show_options:function(e){var t,n,i,o;return o=e.user_id,t=e.aliases,n=e.on_alias_change,i=_.get_viewer().get_user_by_id(o),i.role===h.ROLE_WORK?v.show(o):C.showInstance(new y({user:i,initialAliases:t,onAliasChange:n,startChangePrimaryFlow:function(e){return function(){return v.show(o)}}(this)}))},show:function(e){var t;return t=_.get_viewer().get_user_by_id(e),this._should_show_warning(t)?this._show_warning_modal(t):this._show_change_modal(t)},_should_show_warning:function(e){var t,n,i,o;return n=_.get_viewer().is_paired,o=n&&e.role===h.ROLE_WORK,i=o&&e.sso_required,t=this.inbox_counts[e.id]>0,i||t},_show_change_modal:function(e){return function(e){return C.showInstance(new g({user:e,onChange:function(t){return v.trigger_change(e,t),"/account"!==s.parse(i.get_href()).path?i.redirect("/home?send_verification_email=1"):t!==e.email?i.reload():void 0},onVerificationCheck:function(t){var n;return v.trigger_change(e,t,e.is_email_verified),n=E.get_for_user(e),n.set_email_to_verify(t),n.email_sent()}}))}}(this),_show_warning_modal:function(e){return C.showInstance(new b({user:e,inboxCount:this.inbox_counts[e.id],onContinue:function(t){return function(){return t._show_change_modal(e)}}(this)}))},listen_for_change:function(t,n){var i;return i=this._email_change_event_for_user(t),e(document).on(i,n)},trigger_change:function(t,n,i){var o;return o=this._email_change_event_for_user(t),e(document).trigger(o,[n,i])},_email_change_event_for_user:function(e){return"db:email_changed:"+e.id}},P=n.DOM,m=n.createClass({displayName:"AccountPageEmailBlock",propTypes:{userId:n.PropTypes.number,emailName:n.PropTypes.string,emailIsInvalid:n.PropTypes.bool,initialPendingEmail:n.PropTypes.string,initialAliases:n.PropTypes.array,openChangeEmailModal:n.PropTypes.bool,showRecoveryEmailsGui:n.PropTypes.bool,showAliasGui:n.PropTypes.bool,showChangeEmail:n.PropTypes.bool},getInitialState:function(){return{pendingEmail:this.props.initialPendingEmail,aliases:void 0!==this.props.initialAliases?this.props.initialAliases:[]}},pendingVerifyLinkClick:function(e){return e.preventDefault(),E.get_for_user(this.user).show(),!1},pendingVerifyCancelClick:function(e){return e.preventDefault(),a.AuthenticatedRequest({url:"/cancelpendingemailchange",success:function(e){return function(){return e.setState({pendingEmail:void 0})}}(this),subject_user:this.user.id}),!1},onAliasChange:function(e){return this.setState({aliases:e})},onUserAddressChange:function(e,t,n){return n?this.setState({pendingEmail:t}):(this.user.email=t,this.forceUpdate())},componentWillMount:function(){return this.user=_.get_viewer().get_user_by_id(this.props.userId),this.props.initialPendingEmail?E.get_for_user(this.user).set_email_to_verify(this.props.initialPendingEmail):void 0},componentDidMount:function(){return v.listen_for_change(this.user,this.onUserAddressChange),this.props.emailIsInvalid&&this.props.openChangeEmailModal?v.show(this.props.userId,this.state.aliases):void 0},render:function(){var e;return P.div({className:"fieldset user-info"},P.div({},P.h3({},this.props.emailName,this.props.showRecoveryEmailsGui&&this.props.showChangeEmail&&this.user.is_email_verified?P.button({className:"button-as-link inline-change",onClick:function(e){return function(t){return t.preventDefault(),v.show_options({user_id:e.props.userId,aliases:e.state.aliases,on_alias_change:e.onAliasChange}),!1}}(this)},A("Change",{comment:"Change the user's contact methods (primary email, recovery email, maybe phone?)"})):void 0),this.props.showRecoveryEmailsGui?P.h4({className:"email-type-header"},A("Primary",{comment:"Primary email address"})):void 0,P.div({className:t({"invalid-email":this.props.emailIsInvalid})},this.user.email),this.user.is_email_verified||this.props.emailIsInvalid?this.props.showChangeEmail?!this.props.showRecoveryEmailsGui||this.props.emailIsInvalid?P.button({className:"button-as-link",onClick:function(e){return function(t){return t.preventDefault(),v.show(e.props.userId,e.state.aliases),!1}}(this)},A("Change email")):void 0:P.a({href:"/account#work"},A("Contact your team admin to change email")):P.div({},P.button({className:"button-as-link",onClick:function(e){return function(t){return t.preventDefault(),"work"===e.user.role?E.getForRole(h.ROLE_WORK).verified_or_show():E.getForRole(h.ROLE_PERSONAL).verified_or_show(),!1}}(this)},A("Verify email"))),this.props.showAliasGui&&"work"!==this.user.role?P.div({},P.button({className:"button-as-link",onClick:function(e){return!1}},A("Other ways to contact you"))):void 0),this.state.pendingEmail?P.div({className:"pending-unverified-email-container"},P.br({}),P.div({}),"work"===this.user.role?P.h3({},A("Pending %(team_name)s email change").format({team_name:_.get_viewer().team_name})):"personal"===this.user.role?P.h3({},A("Pending personal email change")):P.h3({},A("Pending email change")),P.div({className:"pending-unverified-email"},this.state.pendingEmail),P.div({},P.button({className:"button-as-link",onClick:this.pendingVerifyLinkClick},A("Verify email"))),P.div({}),P.button({className:"button-as-link",onClick:this.pendingVerifyCancelClick},A("Cancel"))):void 0,this.props.showRecoveryEmailsGui&&"work"!==this.user.role&&this.user.is_email_verified?P.div({},P.br({}),P.h4({className:"email-type-header"},A("Recovery",{comment:"Recovery email address; 'backup email'"})),function(){var t,n,i,o;if(0!==this.state.aliases.length){for(i=this.state.aliases,o=[],t=0,n=i.length;n>t;t++)e=i[t],"recovery_email"===e.type&&o.push(P.div({},P.span({},e.alias),e.verified?void 0:P.span({},A(" (pending)"))));return o}return P.button({className:"button-as-link",onClick:function(e){return function(t){return t.preventDefault(),C.showInstance(new f({user:e.user,onSuccess:function(t,n){var i;return i=e.state.aliases.slice(),i.push({alias:t,type:"recovery_email",verified:n}),e.setState({aliases:i})}})),!1}}(this)},A("Add a recovery email"))}.call(this)):void 0)}}),{EmailVerification:E,ChangeEmail:v,AccountPageEmailBlock:m}})}.call(this),function(){define("modules/clean/account/email_verify",["jquery","modules/clean/ajax","modules/core/exception"],function(e,t,n){var i;return i={_POLLING:{},send_verification_email:function(e,i,o,r){return null==o&&n.raiseAndReport("Debugging T53160: reason should not be null",{severity:n.SEVERITY.NONCRITICAL,tags:["email_verify:null_reason"]}),t.WebRequest({url:"/sendverifyemail",data:{email:i,reason:o},success:function(){return r()},subject_user:e})},check_verification:function(e,n,i,o){return t.AuthenticatedRequest({url:"/isemailverified",data:{email:n},success:function(e){return"ok"===e?i():o()},subject_user:e})},listen_for_verification:function(e,t,n){var i;return i=e.id+":"+t,this._POLLING[i]?void 0:(this._POLLING[i]=!0,this._poll_for_verification(e,t,n))},_poll_for_verification:function(e,t,n){var i;return i=4e3,this.check_verification(e,t,n,function(o){return function(){return setTimeout(function(){return o._poll_for_verification(e,t,n)},i)}}(this))}}})}.call(this),function(){define("modules/clean/account/email_verify_reasons",[],function(){var e;return e={SHARE_FOLDER:"share_folder",CREATE_API_APP:"create_api_app",PUBLIC_FOLDER:"public_folder",GENERIC:"generic",SHMODAL:"shmodal",MOBILE_SHARE_FOLDER:"mobile_share_folder",EMAIL_ALIAS:"email_alias",CAROUSEL:"carousel",CHANGE_EMAIL:"change_email",CAROUSEL_EMAIL_ALIAS:"carousel_email_alias",PROMPT_CAMPAIGN:"prompt_campaign",ADD_COMMENT:"add_comment",SUBSCRIBE_TO_COMMENTS:"subscribe_to_comments",CREATE_FILE_COLLECTOR:"create_file_collector",JOIN_DISCOVERED_TEAM:"join_discovery",NEW_DFB_TEAM_TRY:"new_dfb_team_try",NEW_DFB_TEAM_BUY:"new_dfb_team_buy",GIFT_BUY:"gift_buy",REFER_FRIENDS:"refer_friends"}})}.call(this),function(){define("modules/clean/account/verify_email_modals",["external/react","modules/core/i18n","modules/clean/account/email_verify","modules/clean/account/email_verify_reasons","modules/clean/analytics","modules/clean/react/button","modules/clean/react/modal","modules/clean/viewer","modules/clean/react/react_i18n","modules/constants/viewer"],function(e,t,n,i,o,r,s,a,l,u){var c,d,p,_,h,m,f,v,g,y,b,w;return y=t._,m=o.UserActivityLogger,p=s.Modal,b=e.createElement,w=e.DOM,_=l.R_,v={getStyle:function(){return this.props.shouldUseSimpleUI?"simple":"default"},renderChangeEmail:function(){return this.props.shouldUseSimpleUI?void 0:w.a({href:"#",className:"change-email-before-verify",onClick:this.showChangeEmail},y("Update email address"))}},f=e.createClass({displayName:"VerifyEmailModal",mixins:[v],propTypes:{user:e.PropTypes.object,reason:e.PropTypes.string,email:e.PropTypes.string,onEmailSent:e.PropTypes.func,onShowChange:e.PropTypes.func,shouldUseSimpleUI:e.PropTypes.bool},render:function(){var e;return e={reason:this.props.reason},m.log("web","email_verify_shown",e),b(p,{title:y("Verify your email address"),className:"verify-email",acceptButtonText:y("Send email"),dismissButtonText:y("Cancel"),onAccept:this.sendEmail,ref:"modal",style:this.getStyle()},w.div({},w.div({},this.getPrompt()),this.renderChangeEmail()))},sendEmail:function(e){return e.preventDefault(),n.send_verification_email(this.props.user,this.props.email,this.props.reason,this.emailSent)},close:function(){var e;return null!=(e=this.refs.modal)?e.close():void 0},emailSent:function(){var e;return this.close(),"function"==typeof(e=this.props).onEmailSent?e.onEmailSent():void 0},showChangeEmail:function(e){var t,n;return n={reason:this.props.reason},m.log("web","email_verify_change_first",n),e.preventDefault(),this.close(),"function"==typeof(t=this.props).onShowChange?t.onShowChange():void 0},getPrompt:function(){var e;switch(this.props.reason){case i.ADD_COMMENT:return _({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> before you can add comments. It’s as simple as clicking the link in the verification email we send to you.");case i.SUBSCRIBE_TO_COMMENTS:return _({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> before you can subscribe. It’s as simple as clicking the link in the verification email we send to you.");case i.SHARE_FOLDER:return _({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> to share folders. It’s as simple as clicking the link in the verification email we send to you.");case i.NEW_DFB_TEAM:return _({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> to add members to your team. It’s as simple as clicking the link in the verification email we send to you.");case i.SHMODAL:return _({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> to share links. It’s as simple as clicking the link in the verification email we send to you.");case i.CREATE_API_APP:return _({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> before you can register an API app. It’s as simple as clicking the link in the verification email we send to you.");case i.PUBLIC_FOLDER:return _({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> to enable your Public folder. It’s as simple as clicking the link in the verification email we send to you.");case i.CHANGE_EMAIL:return e=a.get_viewer().is_paired,e&&this.props.user.role===u.ROLE_PERSONAL?_({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> to finish updating your personal email. It’s as simple as clicking the link in the verification email we send to you."):e&&this.props.user.role===u.ROLE_WORK?_({email:this.props.email,team:a.get_viewer().team_name},"Dropbox needs to verify your email address <strong>%(email)s</strong> to finish updating your %(team)s email. It’s as simple as clicking the link in the verification email we send to you."):_({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> to finish updating your email. It’s as simple as clicking the link in the verification email we send to you.");case i.CREATE_FILE_COLLECTOR:return _({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> to create file requests. It’s as simple as clicking the link in the verification email we send to you.");case i.GIFT_BUY:return _({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> before you can send gifts to your friends. It’s as simple as clicking the link in the verification email we send to you.");case i.REFER_FRIENDS:return _({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> before you can invite friends. It’s as simple as clicking the link in the verification email we send to you.");case i.JOIN_DISCOVERED_TEAM:return _({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> before you can create or join a team. It’s as simple as clicking the link in the verification email we send to you.");default:return _({email:this.props.email},"Verify your email address at <strong>%(email)s</strong> to share folders and ensure your account can be recovered.");
}}}),h=e.createClass({displayName:"ResendVerifyEmailModal",mixins:[v],propTypes:{user:e.PropTypes.object,email:e.PropTypes.string,reason:e.PropTypes.string,onEmailSent:e.PropTypes.func,onShowChange:e.PropTypes.func,shouldUseSimpleUI:e.PropTypes.bool},render:function(){var e;return e={reason:this.props.reason},m.log("web","email_verify_resend_shown",e),b(p,{title:y("Verify your email address"),buttonComponent:this.renderButtons(),ref:"modal",style:this.getStyle()},w.div({},w.div({},this.getPrompt()),this.renderChangeEmail()))},renderButtons:function(){return w.div({className:"db-modal-buttons"},r.link_button({className:"dbmodal-button",importance:"primary",onClick:this.close},y("Done")),r.link_button({className:"dbmodal-button",importance:"tertiary",onClick:this.sendEmail},y("Resend email")))},close:function(){var e;return null!=(e=this.refs.modal)?e.close():void 0},showChangeEmail:function(e){var t,n;return n={reason:this.props.reason},m.log("web","email_verify_resend_change_first",n),e.preventDefault(),this.close(),"function"==typeof(t=this.props).onShowChange?t.onShowChange():void 0},sendEmail:function(e){return e.preventDefault(),n.send_verification_email(this.props.user,this.props.email,this.props.reason,this.emailSent)},emailSent:function(){var e;return this.close(),"function"==typeof(e=this.props).onEmailSent?e.onEmailSent():void 0},getPrompt:function(){var e;return e=a.get_viewer().is_paired,this.props.reason===i.REFER_FRIENDS?_({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> before you can invite friends. Check your inbox and click the link in the email to verify your address. If you can’t find it, check your spam folder."):this.props.reason!==i.CHANGE_EMAIL?_({email:this.props.email},"Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to verify your address. If you can't find it, check your spam folder or click the button to resend the email."):e&&this.props.user.role===u.ROLE_PERSONAL?_({email:this.props.email},"Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to finish updating your personal email. If you can't find it, check your spam folder or click the button to resend the email."):e&&this.props.user.role===u.ROLE_WORK?_({email:this.props.email,team:a.get_viewer().team_name},"Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to finish updating your %(team)s email. If you can't find it, check your spam folder or click the button to resend the email."):_({email:this.props.email},"Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to finish updating your email. If you can't find it, check your spam folder or click the button to resend the email.")}}),g=e.createClass({displayName:"VerifyEmailSentModal",propTypes:{email:e.PropTypes.string},render:function(){var e;return e=_({email:this.props.email},"Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to verify your address. If you can't find it, check your spam folder or click the button to resend the email."),b(p,{title:y("Verification email sent!"),acceptButtonText:y("Done")},w.div({},e))}}),d=e.createClass({displayName:"EmailVerifiedModal",propTypes:{reason:e.PropTypes.string,email:e.PropTypes.string},render:function(){return b(p,{title:y("Your email address is now verified"),acceptButtonText:y("Done")},w.div({},this.getPrompt()))},getPrompt:function(){switch(this.props.reason){case i.NEW_DFB_TEAM:return _({email:this.props.email},"Thanks for verifying your email address: <strong>%(email)s</strong>. Now you can invite members to your team.");case i.SHARE_FOLDER:return _({email:this.props.email},"Thanks for verifying your email address: <strong>%(email)s</strong>. You can now share and receive files on Dropbox.");case i.CREATE_API_APP:return _({email:this.props.email},"Thanks for verifying your email address: <strong>%(email)s</strong>. You can now register API apps.");case i.PUBLIC_FOLDER:return _({email:this.props.email},"Thanks for verifying your email address. You can now enable the Public folder for your <strong>%(email)s</strong> Dropbox.")}return""}}),c=e.createClass({displayName:"ChangedEmailVerifiedModal",propTypes:{email:e.PropTypes.string,user:e.PropTypes.object},render:function(){return b(p,{title:y("Your email address is now verified"),acceptButtonText:y("Done")},w.div({},this.getPrompt()))},getPrompt:function(){var e;return e=a.get_viewer().is_paired,e&&this.props.user.role===u.ROLE_PERSONAL?_({email:this.props.email},"Thanks for verifying your email address <strong>%(email)s</strong>. Your personal account has successfully been changed."):e&&this.props.user.role===u.ROLE_WORK?_({email:this.props.email,team:a.get_viewer().team_name},"Thanks for verifying your email address <strong>%(email)s</strong>. Your %(team)s account has successfully been changed."):_({email:this.props.email},"Thanks for verifying your email address <strong>%(email)s</strong>. Your account has successfully been changed.")}}),{VerifyEmailModal:f,ResendVerifyEmailModal:h,VerifyEmailSentModal:g,EmailVerifiedModal:d,ChangedEmailVerifiedModal:c}})}.call(this),function(){define("modules/clean/account_photo_modal/account_header",["jquery"],function(e){var t;return t=function(){function t(){}return t.init=function(t,n,i){return e(t).add(n).on("click",function(e){return e.preventDefault(),require(["modules/clean/account_photo_modal/controller"],function(e){return e.show()})}),e(document).on("db:account_photo:photo_set",function(t){return e(n).addClass(i)}),e(document).on("db:account_photo:photo_deleted",function(t){return e(n).removeClass(i)})},t}()})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/activity/activity",["external/underscore","modules/clean/activity/activity_user","modules/clean/activity/like","modules/clean/comments/models/comment","modules/clean/datetime","modules/clean/viewer","modules/core/exception"],function(t,n,i,o,r,s,a){var l,u,c,d,p,_,h;return d=o.Comment,c={ADD:0,EDIT:1,POST:2,FILE:3,COMMENT:4,NS_RELATED_EVENT:5},u={SHARED_LINK_VIEW:1,SHARED_LINK_LIGHTBOX:2,BROWSE_FILE_VIEWER:3,BROWSE_LIGHTBOX:4,SONOMA:5,EMAIL_REPLY:6,SHARED_CONTENT_LINK_VIEW:7},h=function(e){return e===c.FILE?_:e===c.COMMENT?p:a.assert(!1,"Invalid activity type")},l=function(){function e(e){var t,o,r,s,a;this.activity_key=e.activity_key,this.activity_type=e.activity_type,this.activity_data=e.activity_data,this.when=e.when,this.feedback_off=e.feedback_off,this.can_edit_feedback=e.can_edit_feedback,this.seen_comment_count=e.seen_comment_count,this.isDeleted=e.isDeleted,o=e.comment_activity_dicts,s=e.like_dicts,a=e.owner,null!=a&&(this.owner=n.fromUser(a)),this.when_mses=1e3*this.when,this.comment_activities=function(){var e,n,i;for(i=[],e=0,n=o.length;n>e;e++)t=o[e],i.push(new p(t));return i}(),this.likes=function(){var e,t,n;for(n=[],e=0,t=s.length;t>e;e++)r=s[e],n.push(new i(r));return n}()}return e.prototype.when_pretty=function(){return r.ago(new Date(this.when_mses))},e.prototype.commentCount=function(){return this.comment_activities.length},e.prototype.resolvedCommentCount=function(){return t.filter(this.comment_activities,function(e){return e.comment.resolved}).length},e.prototype.unresolvedCommentCount=function(){return this.commentCount()-this.resolvedCommentCount()},e.prototype.unseenCommentCount=function(){return this.commentCount()-this.seen_comment_count},e.prototype.getPendingCommentActivities=function(){return this.comment_activities.filter(function(e){return null!=e.isPending})},e.prototype.findCommentActivityBatch=function(e){var n,i,o,r;for(r=(null!=(o=this.comment_activities)?o:[]).slice(0),i={};r.length>0;)n=r.pop(),t.contains(e,n.activity_key)&&(i[n.activity_key]=n),r.push.apply(r,n.comment_activities);return t.values(i)},e.prototype._remove_comment_activity=function(e){return this.comment_activities=this.comment_activities.filter(function(t){return t.activity_key!==e.activity_key})},e.prototype.findCommentActivityByKey=function(e){return t.findWhere(this.comment_activities,{activity_key:e})},e.prototype._add_comment_activity=function(e){return t.findWhere(this.comment_activities,{activity_key:e.activity_key})?void 0:this.comment_activities.push(e)},e.prototype._update_like=function(e,t){var n;return n=new i({liker_dict:e,when_mses:Date.now()}),t?this._add_like(n):this._remove_like(n)},e.prototype._remove_like=function(e){return this.likes=this.likes.filter(function(t){return t.liker.id!==e.liker.id})},e.prototype._add_like=function(e){return this.likes.push(e)},e.prototype.isLikedBy=function(e){return t.some(this.likes,function(t){return t.liker.id===e})},e.prototype._markCommentsSeen=function(e){var n;return n=t.findWhere(this.comment_activities,{activity_key:e}),this.seen_comment_count=1+n},e}(),p=function(t){function i(e){i.__super__.constructor.call(this,e),this.comment=d.fromDict(e.comment),this.is_seen=Boolean(e.is_seen),this.highlight_as_unread=Boolean(e.highlight_as_unread),null!=e.users_to_notify&&(this.users_to_notify=(e.users_to_notify||[]).map(n.fromUser)),this.permissions={user_ids_who_can_delete:e.permissions.user_ids_who_can_delete}}return e(i,t),i}(l),_=function(t){function i(e){i.__super__.constructor.call(this,e),this.ns_path=e.ns_path,this.latestRevision=e.latest_revision,this.file_icon=e.file_icon,this.seen_states=e.seen_states,this.users_to_notify=(e.users_to_notify||[]).map(n.fromUser)}return e(i,t),i}(l),{ActivityType:c,ActivityContext:u,get_activity_class_by_type:h,Activity:l,CommentActivity:p,FileActivity:_}})}.call(this),function(){define("modules/clean/activity/activity_user",["external/immutable","modules/core/i18n","modules/core/user_i18n"],function(e,t,n){var i,o;return o=t._,i=e.Record({id:null,fname:null,lname:null,display_name:null,email:null,photo_url:null,photo_circle_url:null,initials:null,is_email_verified:!1,is_signed_in:!1}),i.fromUser=function(e){return i({id:e.id,fname:e.fname,lname:e.lname,display_name:e.display_name,email:e.email,photo_url:e.photo_url,photo_circle_url:e.photo_circle_url,initials:n.getInitials(e.display_name),is_email_verified:e.is_email_verified,is_signed_in:!0})},i.fromDict=function(e){return i(e).set("is_signed_in",null!=e.id)},i.fromEmail=function(e){return i({email:e})},Object.defineProperty(i,"anonymous",{value:i(),writable:!1,enumerable:!1,configurable:!1}),i.prototype.getDisplayIdentity=function(){return null!=this.display_name?this.display_name:null!=this.email?this.email:o("Anonymous User")},i})}.call(this),function(){define("modules/clean/activity/like",["modules/clean/activity/activity_user","modules/clean/datetime"],function(e,t){var n;return n=function(){function n(t){var n;n=t.liker_dict,this.when_mses=t.when_mses,this.liker=e.fromUser(n)}return n.prototype.when_pretty=function(){return t.ago(new Date(this.when_mses))},n}()})}.call(this),function(){define("modules/clean/annotations/annotation",["external/underscore"],function(e){var t,n,i;return i={MARKER:0,HIGHLIGHT:1,REGION:2},n={MARKER:{CIRCLE:0},REGION:{RECTANGLE:0},HIGHLIGHT:{HIGHLIGHT:0}},t=function(){function e(e,t,n){null==e&&(e=null),null==t&&(t=null),null==n&&(n=null),this.type=e,this.subtype=t,this.pdf_coordinates=null,this.image_coordinates=null,this.text_highlight=null,this.viewportCoordinates=[],this.BUBBLE_WIDTH=320,this.annotationSize=n}return e.createAnnotationFromDict=function(t){var n,i;return n=new e,n.revision=t.revision,n.zoom=t.zoom,n.type=t.type,n.subtype=t.subtype,n.pdf_coordinates=t.pdf_coordinates,n.image_coordinates=t.image_coordinates,n.text_highlight=t.text_highlight,n.viewportCoordinates=null!=(i=t.viewportCoordinates)?i:[],n.annotationSize=28,n},e.prototype.toMetadataDict=function(){var e;return e={type:this.type,subtype:this.subtype},this.pdf_coordinates?e.pdf_coordinates=this.pdf_coordinates:this.image_coordinates&&(e.image_coordinates=this.image_coordinates),this.type===i.HIGHLIGHT&&(e.text_highlight=this.text_highlight),e},e.getCenterPosition=function(e){return{x:(e.left+e.right)/2,y:(e.top+e.bottom)/2}},e.prototype.getBoundingBox=function(){var e;switch(this.type){case i.MARKER:return e=this.getFirstViewportCoordinates(),{top:e.y-this.annotationSize/2,right:e.x+this.annotationSize/2,bottom:e.y+this.annotationSize/2,left:e.x-this.annotationSize/2};case i.HIGHLIGHT:return this._getViewportBoundingRectangle();case i.REGION:return this._getViewportBoundingRectangle()}},e.prototype.getClampedBoundingBox=function(e,t,n,i){var o;return null==n&&(n=0),null==i&&(i=0),o=this.getBoundingBox(),o.left=o.left-n,o.right=o.right-n,o.top=o.top-i,o.bottom=o.bottom-i,o.top=Math.min(Math.max(o.top,0),t-1),o.right=Math.min(Math.max(o.right,0),e-1),o.bottom=Math.min(Math.max(o.bottom,0),t-1),o.left=Math.min(Math.max(o.left,0),e-1),o},e.prototype._getViewportBoundingRectangle=function(){var e,t,n,i,o,r,s,a,l,u,c;for(l=s=this.getFirstViewportCoordinates().x,u=a=this.getFirstViewportCoordinates().y,c=this.viewportCoordinates,n=0,o=c.length;o>n;n++)for(e=c[n],i=0,r=e.length;r>i;i++)t=e[i],l=Math.min(l,t.x),s=Math.max(s,t.x),u=Math.min(u,t.y),a=Math.max(a,t.y);return{top:u,right:s,bottom:a,left:l}},e.prototype.isPdfAnnotation=function(){return null!=this.pdf_coordinates},e.prototype.isImageAnnotation=function(){return null!=this.image_coordinates},e.prototype.getFirstCoordindates=function(){return this.isPdfAnnotation()?this.getFirstPdfCoordinates():this.isImageAnnotation()?this.getFirstImageCoordinates():void 0},e.prototype.getFirstViewportCoordinates=function(){return this.viewportCoordinates[0][0]},e.prototype.getFirstImageCoordinates=function(){var e,t;return null!=(e=this.image_coordinates)&&null!=(t=e[0].coordinates)?t[0]:void 0},e.prototype.getFirstPdfCoordinates=function(){var e;return this.isOldCoordinatesFormat()?this.pdf_coordinates:null!=(e=this.pdf_coordinates[0].coordinates)?e[0]:void 0},e.prototype.getFirstPdfPage=function(){var e;return this.isOldCoordinatesFormat()?null!=(e=this.pdf_coordinates)?e.page:void 0:this.pdf_coordinates[0].page},e.prototype.isOldCoordinatesFormat=function(){return!(null!=this.pdf_coordinates&&null!=this.pdf_coordinates[0])},e.prototype.getSize=function(){return this.type===i.MARKER?this.annotationSize:null},e}(),{Annotation:t,AnnotationTypes:i,AnnotationSubtypes:n}})}.call(this),function(){define("modules/clean/annotations/annotation_controller",["external/react","modules/clean/annotations/annotation","modules/clean/annotations/annotation_marker","modules/clean/annotations/annotation_highlight","modules/clean/annotations/annotation_region","jquery"],function(e,t,n,i,o,r){var s,a,l,u,c,d,p;return a=t.Annotation,c=t.AnnotationTypes,u=t.AnnotationSubtypes,p=e.DOM,d=e.addons.CSSTransitionGroup,s="annotation-container",l=e.createClass({displayName:"AnnotationController",propTypes:{controllerEventHandlers:e.PropTypes.object,onAnnotationPlacedCallback:e.PropTypes.func,onAnnotationHiddenCallback:e.PropTypes.func,onAnnotationStartDragCallback:e.PropTypes.func,onAnnotationEndDragCallback:e.PropTypes.func,onAnnotationScrollCallback:e.PropTypes.func,onAnnotationScaleChangeCallback:e.PropTypes.func,onAnnotationEnterCallback:e.PropTypes.func,onAnnotationLeaveCallback:e.PropTypes.func,isAnnotationMarkerEnabled:e.PropTypes.bool,isAnnotationHighlightEnabled:e.PropTypes.bool,isAnnotationRegionEnabled:e.PropTypes.bool,isAnnotationCreationEnabled:e.PropTypes.bool,parentContainerOffset:e.PropTypes.object},getInitialState:function(){return{activeAnnotationType:null}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},hasVisibleActiveAnnotation:function(){var e;return null!=(e=this.refs.activeAnnotationType)?e.state.isToolVisible:void 0},componentWillMount:function(){return this.allowAnnotationTypeSwitch=!0,this.isMouseDown=!1,this.positionAtLastMouseDown={}},componentDidMount:function(){var e,t,n,i,o,r;return null!=(e=this.props.controllerEventHandlers)&&(e.onHideAnnotation=this.onHideAnnotation),null!=(t=this.props.controllerEventHandlers)&&(t.onMouseMoveCallback=this.onMouseMoveCallback),null!=(n=this.props.controllerEventHandlers)&&(n.onMouseDownCallback=this.onMouseDownCallback),null!=(i=this.props.controllerEventHandlers)&&(i.onMouseUpCallback=this.onMouseUpCallback),null!=(o=this.props.controllerEventHandlers)&&(o.onScrollCallback=this.onScrollCallback),null!=(r=this.props.controllerEventHandlers)?r.onScaleChangeCallback=this.onScaleChangeCallback:void 0},_getViewerX:function(){var e;return(null!=(e=this.state.currentMouseEvent)?e.pageX:void 0)||0},_getViewerY:function(){var e;return(null!=(e=this.state.currentMouseEvent)?e.pageY:void 0)||0},_getEventPosition:function(e){return{x:e.pageX,y:e.pageY}},_allowAnnotationTypeSwitch:function(){return this.allowAnnotationTypeSwitch=!0},_disallowAnnotationTypeSwitch:function(){return this.allowAnnotationTypeSwitch=!1},_trySetActiveAnnotationType:function(e,t){return e!==this.state.activeAnnotationType&&this._isAnnotationTypeCreationEnabled(e)?(this.setState({activeAnnotationType:e},function(e){return function(){return"function"==typeof t?t():void 0}}(this)),!0):("function"==typeof t&&t(),!1)},_isOnRegion:function(e){var t,n;return t=null!=(n=this.refs.activeAnnotation)?n.getDOMNode():void 0,null!=t&&(e.target===t||r.contains(t,e.target))},_isAnnotationTypeCreationEnabled:function(e){if(!this.props.isAnnotationCreationEnabled)return!1;switch(e){case c.MARKER:return this.props.isAnnotationMarkerEnabled;case c.HIGHLIGHT:return this.props.isAnnotationHighlightEnabled;case c.REGION:return this.props.isAnnotationRegionEnabled;default:return!1}},_isOnText:function(e){var t,n,i,o,s,a,l,u;if(i=r(e.target),t=i.contents(),n=(null!=(u=i.css("cursor"))?u:"").split(","),n=n[n.length-1].trim(),"text"===n||"vertical-text"===n||i.is("a")&&0===t.length)return!0;if("auto"!==n)return!1;for(s=!1,a=0,l=t.length;l>a;a++)o=t[a],o.nodeType===Node.TEXT_NODE&&(s=!0);return s},_deselectAllText:function(){var e,t;return null!=(t=document.selection)&&"function"==typeof t.empty&&t.empty(),"function"==typeof window.getSelection&&"function"==typeof(e=window.getSelection()).removeAllRanges?e.removeAllRanges():void 0},onHideAnnotation:function(){var e;return null!=(e=this.refs.activeAnnotation)?e.hideAnnotation():void 0},onMouseDownCallback:function(e){var t,n;if(!this.isMouseDown)return this.isMouseDown=!0,this.positionAtLastMouseDown={x:e.pageX,y:e.pageY},this.allowAnnotationTypeSwitch?(t=this.state.activeAnnotationType,!this._isOnRegion(e)&&this._isOnText(e)?(t=c.HIGHLIGHT,this._trySetActiveAnnotationType(t,function(t){return function(){var n;return null!=(n=t.refs.activeAnnotation)?n.onMouseDownCallback(e):void 0}}(this))):void 0):null!=(n=this.refs.activeAnnotation)?n.onMouseDownCallback(e):void 0},onMouseMoveCallback:function(e){var t,n;if(this.isMouseDown)return null===this.state.activeAnnotationType&&this.props.isAnnotationCreationEnabled&&this._deselectAllText(),this.allowAnnotationTypeSwitch?(t=this.state.activeAnnotationType,this.isMouseDown&&null===t&&(t=c.REGION),this._trySetActiveAnnotationType(t,function(t){return function(){var n;return null!=(n=t.refs.activeAnnotation)?n.onMouseMoveCallback(e):void 0}}(this))):null!=(n=this.refs.activeAnnotation)?n.onMouseMoveCallback(e):void 0},onMouseUpCallback:function(e){var t,n,i,o,r,s;if(this.isMouseDown){if(this.isMouseDown=!1,this.allowAnnotationTypeSwitch){if(r=this.state.activeAnnotationType,null===r){if(this._isAnnotationTypeCreationEnabled(c.MARKER))r=c.MARKER;else if(this._isAnnotationTypeCreationEnabled(c.REGION))return void this._trySetActiveAnnotationType(c.REGION,function(t){return function(){var n;return null!=(n=t.refs.activeAnnotation)&&"function"==typeof n.createDefaultRegion?n.createDefaultRegion(e):void 0}}(this))}else r===c.REGION&&this._isAnnotationTypeCreationEnabled(c.MARKER)&&(t={x:e.pageX,y:e.pageY},n=t.x-this.positionAtLastMouseDown.x,i=t.y-this.positionAtLastMouseDown.y,o=Math.sqrt(n*n+i*i),34>=o&&(r=c.MARKER));return this._trySetActiveAnnotationType(r,function(t){return function(){var n;return null!=(n=t.refs.activeAnnotation)?n.onMouseUpCallback(e):void 0}}(this))}return null!=(s=this.refs.activeAnnotation)?s.onMouseUpCallback(e):void 0}},onScrollCallback:function(e){var t;return null!=(t=this.refs.activeAnnotation)?t.onScrollCallback(e):void 0},onScaleChangeCallback:function(e){var t;return null!=(t=this.refs.activeAnnotation)?t.onScaleChangeCallback(e):void 0},onAnnotationHiddenCallback:function(){var e;return this.setState({activeAnnotationType:null}),this._allowAnnotationTypeSwitch(),"function"==typeof(e=this.props).onAnnotationHiddenCallback?e.onAnnotationHiddenCallback():void 0},onAnnotationPlacedCallback:function(e){var t;return this._disallowAnnotationTypeSwitch(),"function"==typeof(t=this.props).onAnnotationPlacedCallback?t.onAnnotationPlacedCallback(e):void 0},onAnnotationStartDragCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationStartDragCallback?t.onAnnotationStartDragCallback(e):void 0},onAnnotationEndDragCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationEndDragCallback?t.onAnnotationEndDragCallback(e):void 0},onAnnotationScrollCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationScrollCallback?t.onAnnotationScrollCallback(e):void 0},onAnnotationScaleChangeCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationScaleChangeCallback?t.onAnnotationScaleChangeCallback(e):void 0},onAnnotationEnterCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationEnterCallback?t.onAnnotationEnterCallback(e):void 0},onAnnotationLeaveCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback(e):void 0},_renderActiveAnnotation:function(){if(null!=this.state.activeAnnotationType&&this._isAnnotationTypeCreationEnabled(this.state.activeAnnotationType))switch(this.state.activeAnnotationType){case c.MARKER:return e.createElement(n,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback});case c.HIGHLIGHT:return e.createElement(i,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback});case c.REGION:return e.createElement(o,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback})}return""},render:function(){return p.div({className:""+s},this._renderActiveAnnotation())}})})}.call(this),function(){define("modules/clean/annotations/annotation_highlight",["jquery","external/react","external/underscore","modules/clean/annotations/annotation"],function(e,t,n,i){var o,r,s,a,l;return o=i.Annotation,a=i.AnnotationTypes,s=i.AnnotationSubtypes,l=t.DOM,r=t.createClass({displayName:"AnnotationHighlight",propTypes:{onAnnotationPlacedCallback:t.PropTypes.func,onAnnotationHiddenCallback:t.PropTypes.func,onAnnotationStartDragCallback:t.PropTypes.func,onAnnotationEndDragCallback:t.PropTypes.func,onAnnotationOverCallback:t.PropTypes.func,onAnnotationScrollCallback:t.PropTypes.func,onAnnotationScaleChangeCallback:t.PropTypes.func,onAnnotationEnterCallback:t.PropTypes.func,onAnnotationLeaveCallback:t.PropTypes.func,parentContainerOffset:t.PropTypes.object},getInitialState:function(){return{isShown:!1}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},componentWillMount:function(){return this.type=a.HIGHLIGHT,this.subtype=s.HIGHLIGHT.HIGHLIGHT,this.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER=8,this.CONSOLIDATE_RECTANGLE_HORIZONTAL_BUFFER=30},hideAnnotation:function(){return this._hideAnnotation()},_updateViewportBoundaries:function(){var e,t,n;return e=window.getSelection(),e.rangeCount>0?(t=this._isBrowserIE()?this._extractViewportClientRectanglesIEHack(e.getRangeAt(0)):this._extractViewportClientRectangles(e.getRangeAt(0)),n=this._consolidateClientRectangles(t),this._setViewportCoordinatesFromRectangles(n)):void 0},_extractViewportClientRectangles:function(e){var t,n,i,o;for(t=[],n=e.endContainer,i=e.endOffset,o=e.cloneRange();n!==e.commonAncestorContainer;)o.setStart(n,0),o.setEnd(n,i),Array.prototype.push.apply(t,o.getClientRects()),i=Array.prototype.indexOf.call(n.parentNode.childNodes,n),n=n.parentNode;return o=e.cloneRange(),o.setEnd(n,i),Array.prototype.push.apply(t,o.getClientRects()),t},_extractViewportClientRectanglesIEHack:function(e){var t,n,i;if("canvasWrapper"===e.startContainer.className&&e.setStart(e.startContainer.nextSibling.children[0].childNodes[0],0),e.startContainer===e.commonAncestorContainer)return e.getClientRects();for(t=[],i=e.cloneRange(),i.setEnd(e.startContainer,e.startContainer.length),Array.prototype.push.apply(t,i.getClientRects()),n=e.startContainer.parentNode.nextSibling;n!==e.endContainer.parentNode;)Array.prototype.push.apply(t,n.getClientRects()),n=n.nextSibling;return i.setStart(e.endContainer,0),i.setEnd(e.endContainer,e.endOffset),Array.prototype.push.apply(t,i.getClientRects()),t},_isBrowserIE:function(){var e,t,n;return n=window.navigator.userAgent,t=n.indexOf("Trident/"),e=n.indexOf("Edge/"),t>0||e>0},_consolidateClientRectangles:function(e){var t,n,i,o,r,s;for(n=[],i=0,o=e.length;o>i;i++)s=e[i],0!==s.width&&0!==s.height&&(n.length>0&&(r=n[n.length-1],this._isWithinConsolidationVerticalBuffer(r,s)&&this._isWithinConsolidationHorizontalBuffer(r,s))?(t=this._calculateBoundingBox(r,s),r.top=t.top,r.right=t.right,r.bottom=t.bottom,r.left=t.left):n.push({top:s.top,right:s.right,bottom:s.bottom,left:s.left}));return n},_isWithinConsolidationVerticalBuffer:function(e,t){return Math.abs(e.top-t.top)<this.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER&&Math.abs(e.bottom-t.bottom)<this.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER},_isWithinConsolidationHorizontalBuffer:function(e,t){var n,i,o;return n=this._calculateBoundingBox(e,t),i=n.right-n.left,o=t.width+(e.right-e.left),i-o<this.CONSOLIDATE_RECTANGLE_HORIZONTAL_BUFFER},_calculateBoundingBox:function(e,t){return{top:Math.min(e.top,t.top),right:Math.max(e.right,t.right),bottom:Math.max(e.bottom,t.bottom),left:Math.min(e.left,t.left)}},_setViewportCoordinatesFromRectangles:function(e){var t,n,i,o,r;for(r=[],n=0,i=e.length;i>n;n++)o=e[n],t=[],t.push({x:o.left,y:o.top}),t.push({x:o.right,y:o.bottom}),r.push(t);return this.annotation.viewportCoordinates=r},_getPositionRelativeToParentContainer:function(e){return{x:e.x-this.props.parentContainerOffset.left,y:e.y-this.props.parentContainerOffset.top}},_updateHighlightedText:function(){return this.annotation.text_highlight={snippet_before:this._getTextBeforeHighlight(),text:this._getHighlightedText(),snippet_after:this._getTextAfterHighlight()}},_generateAnnotation:function(){return this.annotation=new o(this.type,this.subtype),this._updateViewportBoundaries(),this._updateHighlightedText()},_hideAnnotation:function(){return this._isBrowserIE()&&this.state.isShown&&this.setState({isShown:!1,viewportCoordinates:null}),this.annotation=null,this.props.onAnnotationHiddenCallback()},_updateViewportCoordinatesFromUI:function(){var t,n,i,o,r,s,a,l;if(this.state.isShown){for(r=[],l=e(".annotation-highlight"),i=0,o=l.length;o>i;i++)s=l[i],n=[],t=e(s),a=t.offset(),n.push({x:a.left,y:a.top}),n.push({x:a.left+t.width(),y:a.top+t.height()}),r.push(n);return this.annotation.viewportCoordinates=r}},_getHighlightedText:function(){var e;return e=window.getSelection().toString().trim(),e=e.replace(/\s+/g," ")},_getTextBeforeHighlight:function(){return""},_getTextAfterHighlight:function(){return""},_isTextSelected:function(){return""!==this._getHighlightedText()},onMouseDownCallback:function(e){return{}},onMouseMoveCallback:function(e){return{}},onMouseUpCallback:function(e){return setTimeout(function(e){return function(){var t,n,i,o,r,s,a,l;if(!e._isTextSelected())return e._hideAnnotation();if(e._generateAnnotation(),e.props.onAnnotationPlacedCallback(e.annotation),e._isBrowserIE()){for(l=[],s=e.annotation.viewportCoordinates,i=0,r=s.length;r>i;i++)t=s[i],n=[],o=e._getPositionRelativeToParentContainer(t[0]),a=e._getPositionRelativeToParentContainer(t[1]),n.push({x:o.x,y:o.y}),n.push({x:a.x,y:a.y}),l.push(n);return e.setState({isShown:!0,viewportCoordinates:l})}}}(this),0)},onScrollCallback:function(){var e;return null!=this.annotation?(this._isBrowserIE()?this._updateViewportCoordinatesFromUI():this._updateViewportBoundaries(),"function"==typeof(e=this.props).onAnnotationScrollCallback?e.onAnnotationScrollCallback(this.annotation):void 0):void 0},onScaleChangeCallback:function(){var e;return null!=this.annotation?(this._updateViewportBoundaries(),"function"==typeof(e=this.props).onAnnotationScaleChangeCallback?e.onAnnotationScaleChangeCallback(this.annotation):void 0):void 0},_onMarkerMouseDown:function(e){return{}},_onMarkerMouseOver:function(e){return{}},_onMarkerMouseUp:function(e){return{}},render:function(){var e,t,n,i,o,r,s;return l.div({className:"annotation-highlight-container",ref:"highlightContainer"},function(){var a,u,c;if(this.state.isShown){for(t=[],c=this.state.viewportCoordinates,a=0,u=c.length;u>a;a++)i=c[a],n=i[0].x,s=i[0].y,o=i[1].x,e=i[1].y,r={left:n,top:s,width:o-n,height:e-s},t.push(l.div({className:"annotation-highlight",style:r}));return t}}.call(this))}})})}.call(this),function(){define("modules/clean/annotations/annotation_highlight_ui",["jquery","external/react","modules/clean/annotations/annotation"],function(e,t,n){var i,o,r,s,a,l;return i=n.Annotation,s=n.AnnotationTypes,r=n.AnnotationSubtypes,l=t.DOM,a=t.addons.classSet,o=t.createClass({displayName:"AnnotationHighlightUI",propTypes:{annotation:t.PropTypes.object,commentActivity:t.PropTypes.object,options:t.PropTypes.shape({isGhostAnnotation:t.PropTypes.bool,isAnnotationNumberingEnabled:t.PropTypes.bool,annotationNumber:t.PropTypes.number}),onAnnotationEnterCallback:t.PropTypes.func,onAnnotationOverCallback:t.PropTypes.func,onAnnotationLeaveCallback:t.PropTypes.func,onAnnotationClickCallback:t.PropTypes.func},getInitialState:function(){return{isHover:!1}},componentWillMount:function(){return this.initialViewport=this.props.annotation.viewportCoordinates,this.annotation=i.createAnnotationFromDict(this.props.annotation)},_isGhostAnnotation:function(){return this.props.options.isGhostAnnotation||!1},_onHighlightClick:function(e){var t;return"function"==typeof(t=this.props).onAnnotationClickCallback?t.onAnnotationClickCallback({
commentActivity:this.props.commentActivity}):void 0},_onHighlightMouseEnter:function(e){var t;return this.setState({isHover:!0}),clearTimeout(this.mouseLeaveTimeout),this._updateViewportCoordinates(),"function"==typeof(t=this.props).onAnnotationEnterCallback?t.onAnnotationEnterCallback({annotation:this.annotation,commentActivity:this.props.commentActivity}):void 0},_onHighlightMouseOver:function(e){return{}},_onHighlightMouseLeave:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback&&t.onAnnotationLeaveCallback({annotation:this.annotation,commentActivity:this.props.commentActivity}),this.mouseLeaveTimeout=setTimeout(function(e){return function(){return e.setState({isHover:!1})}}(this),100)},_updateViewportCoordinates:function(){var t,n,i,o,r,s,a,l;for(t=e(this.refs.highlightContainer.getDOMNode()),a=[],o=t.children(),r=0,s=o.length;s>r;r++)i=o[r],n=[],l=e(i).offset(),n.push({x:l.left,y:l.top}),n.push({x:l.left+e(i).width(),y:l.top+e(i).height()}),a.push(n);return this.annotation.viewportCoordinates=a},render:function(){var e,t,n,i,o,r,s,u,c,d,p,_,h,m,f,v,g,y,b;for(u=[],d=null!=(m=this.props.commentActivity)&&null!=(f=m.comment)?f.resolved:void 0,t={"annotation-highlight":!0,"annotation-highlight--ui":!0,"annotation-highlight--resolved":d,"highlight-hover":this.state.isHover,"annotation-highlight--ghost":this._isGhostAnnotation()},r=-1,v=this.initialViewport,c=0,_=v.length;_>c;c++)h=v[c],p=h[0].x,b=h[0].y,g=h[1].x,s=h[1].y,(-1===r||r>b)&&(i=p,r=b),y={left:p,top:b,width:g-p,height:s-b},u.push(l.div({className:a(t),style:y,onClick:this._onHighlightClick,onMouseEnter:this._onHighlightMouseEnter,onMouseOver:this._onHighlightMouseOver,onMouseLeave:this._onHighlightMouseLeave}));return l.div({className:"annotation-highlight-container",ref:"highlightContainer"},u,this.props.options.isAnnotationNumberingEnabled?(e=29,o={left:i-e/2,top:r-e/2},n={"annotation-number":!0,"annotation-number--resolved":d,"annotation-number--hover":this.state.isHover},l.div({className:a(n),style:o},this.props.options.annotationNumber)):void 0)}})})}.call(this),function(){define("modules/clean/annotations/annotation_marker",["jquery","external/react","external/underscore","modules/clean/annotations/annotation"],function(e,t,n,i){var o,r,s,a,l,u;return o=i.Annotation,a=i.AnnotationTypes,s=i.AnnotationSubtypes,u=t.DOM,l=t.addons.CSSTransitionGroup,r=t.createClass({displayName:"AnnotationMarker",propTypes:{onAnnotationPlacedCallback:t.PropTypes.func,onAnnotationHiddenCallback:t.PropTypes.func,onAnnotationStartDragCallback:t.PropTypes.func,onAnnotationEndDragCallback:t.PropTypes.func,onAnnotationOverCallback:t.PropTypes.func,onAnnotationScrollCallback:t.PropTypes.func,onAnnotationScaleChangeCallback:t.PropTypes.func,onAnnotationEnterCallback:t.PropTypes.func,onAnnotationLeaveCallback:t.PropTypes.func,parentContainerOffset:t.PropTypes.object},getInitialState:function(){return this.type=a.MARKER,this.subtype=s.MARKER.CIRCLE,this.size=28,this.isInDragMode=!1,this._resetPositionDelta(),{isToolVisible:!1,viewerX:0,viewerY:0}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},componentWillMount:function(){return{}},hideAnnotation:function(){return this._hideAnnotation()},_getSelectionText:function(){var e;return e="",window.getSelection&&(e=window.getSelection().toString()),e},_hasSelectedText:function(){return""!==this._getSelectionText()},_resetPositionDelta:function(){return this.positionDelta={x:0,y:0}},_getOffsetPosition:function(e){var t,n,i,o,r,s,a,l;return t=e.offsetX||(null!=(i=e.nativeEvent)?i.offsetX:void 0)||(null!=(o=e.nativeEvent)&&null!=(r=o.originalEvent)?r.layerX:void 0),n=e.offsetY||(null!=(s=e.nativeEvent)?s.offsetY:void 0)||(null!=(a=e.nativeEvent)&&null!=(l=a.originalEvent)?l.layerY:void 0),{x:t-this.annotation.getSize()/2,y:n-this.annotation.getSize()/2}},_getPositionRelativeToParentContainer:function(e){return{x:e.pageX-this.props.parentContainerOffset.left,y:e.pageY-this.props.parentContainerOffset.top}},_calculateMarkerPos:function(e){var t,n;return n=this._getPositionRelativeToParentContainer(e),t=this.size/2,{x:n.x-t-this.positionDelta.x,y:n.y-t-this.positionDelta.y}},_generateAnnotation:function(e){return this.annotation=new o(this.type,this.subtype,this.size),this._updateViewportCoordinatesFromEvent(e),this.annotation},_updateViewportCoordinatesFromEvent:function(e){var t;return t={x:e.clientX-this.positionDelta.x,y:e.clientY-this.positionDelta.y},this.annotation.viewportCoordinates[0]=[t]},_hideAnnotation:function(e){var t;return this.annotation=null,this.setState({isToolVisible:!1,viewerX:null!=e?e.pageX:void 0,viewerY:null!=e?e.pageY:void 0}),"function"==typeof(t=this.props).onAnnotationHiddenCallback?t.onAnnotationHiddenCallback():void 0},_placeAnnotation:function(e){return this.setState({isToolVisible:!0,viewerX:this._calculateMarkerPos(e).x,viewerY:this._calculateMarkerPos(e).y},function(t){return function(){var n;return t._generateAnnotation(e),"function"==typeof(n=t.props).onAnnotationPlacedCallback?n.onAnnotationPlacedCallback(t.annotation):void 0}}(this))},updateViewportCoordinatesFromMarker:function(){var t,n,i,o,r;return this.state.isToolVisible&&(o=(null!=(r=this.refs.annotationMarker)?r.getDOMNode():void 0)||null,o&&(t=e(o),n=t.offset(),i={x:n.left+this.annotation.getSize()/2,y:n.top+this.annotation.getSize()/2},this.annotation.viewportCoordinates[0]=[i])),null},_startAnnotationDrag:function(e){var t;return e.preventDefault(),this.isInDragMode=!0,this.positionDelta=this._getOffsetPosition(e),this._updateViewportCoordinatesFromEvent(e),"function"==typeof(t=this.props).onAnnotationStartDragCallback?t.onAnnotationStartDragCallback(this.annotation):void 0},_endAnnotationDrag:function(e){var t;return e.preventDefault(),this.isInDragMode=!1,this._updateViewportCoordinatesFromEvent(e),this._resetPositionDelta(),"function"==typeof(t=this.props).onAnnotationEndDragCallback?t.onAnnotationEndDragCallback(this.annotation):void 0},_isOnMarker:function(t){var n,i;return this.state.isToolVisible?(n=(null!=(i=this.refs.annotationMarker)?i.getDOMNode():void 0)||null,null!=n?t.target===n||e.contains(n,t.target):!1):void 0},onMouseDownCallback:function(e){return this.state.isToolVisible&&this._isOnMarker(e)?(this._startAnnotationDrag(e),e.preventDefault()):void 0},onMouseMoveCallback:function(e){return this.isInDragMode&&this.state.isToolVisible?(this.setState({viewerX:this._calculateMarkerPos(e).x,viewerY:this._calculateMarkerPos(e).y}),e.preventDefault()):void 0},onMouseUpCallback:function(e){return this.state.isToolVisible?this.isInDragMode?this._endAnnotationDrag(e):this._hideAnnotation(e):this._hasSelectedText()?void 0:(this._placeAnnotation(e),e.preventDefault())},onScrollCallback:function(){var e;return this.state.isToolVisible?(this.updateViewportCoordinatesFromMarker(),"function"==typeof(e=this.props).onAnnotationScrollCallback?e.onAnnotationScrollCallback(this.annotation):void 0):void 0},onScaleChangeCallback:function(){var e;return this.updateViewportCoordinatesFromMarker(),"function"==typeof(e=this.props).onAnnotationScaleChangeCallback?e.onAnnotationScaleChangeCallback(this.annotation):void 0},_onMarkerMouseDown:function(e){return{}},_onMarkerMouseOver:function(e){var t;return"function"==typeof(t=this.props).onAnnotationOverCallback?t.onAnnotationOverCallback(this.annotation):void 0},_onMarkerMouseUp:function(e){return{}},_onMarkerMouseEnter:function(e){var t;return"function"==typeof(t=this.props).onAnnotationEnterCallback?t.onAnnotationEnterCallback(this.annotation):void 0},_onMarkerMouseLeave:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback(this.annotation):void 0},render:function(){var e;return e=[],this.state.isToolVisible&&(e=[u.div({key:"annotationMarker",ref:"annotationMarker",className:"annotation-marker annotation-marker--blue",onMouseDown:this._onMarkerMouseDown,onMouseUp:this._onMarkerMouseUp,onMouseOver:this._onMarkerMouseOver,onMouseEnter:this._onMarkerMouseEnter,onMouseLeave:this._onMarkerMouseLeave,style:{left:this.state.viewerX,top:this.state.viewerY}},u.div({className:"annotation-maker-inner"}))]),u.div({className:"annotation-marker-container"},this.state.isToolVisible?e:void 0)}})})}.call(this),function(){define("modules/clean/annotations/annotation_marker_ui",["jquery","external/react"],function(e,t){var n,i,o;return o=t.DOM,i=t.addons.classSet,n=t.createClass({displayName:"AnnotationMarkerUI",propTypes:{annotation:t.PropTypes.object,commentActivity:t.PropTypes.object,options:t.PropTypes.shape({isGhostAnnotation:t.PropTypes.bool}),onAnnotationEnterCallback:t.PropTypes.func,onAnnotationOverCallback:t.PropTypes.func,onAnnotationLeaveCallback:t.PropTypes.func,onAnnotationClickCallback:t.PropTypes.func},getInitialState:function(){return{}},getDefaultProps:function(){return{options:{}}},componentWillMount:function(){return this.initialViewport=this.props.annotation.getFirstViewportCoordinates()},_isGhostAnnotation:function(){return this.props.options.isGhostAnnotation||!1},_onMarkerClick:function(e){var t;return"function"==typeof(t=this.props).onAnnotationClickCallback?t.onAnnotationClickCallback({commentActivity:this.props.commentActivity}):void 0},_onMarkerMouseEnter:function(t){var n,i,o,r;return n=e(null!=(r=this.refs.annotationMarker)?r.getDOMNode():void 0),i=this.props.annotation,null==i.viewportCoordinates&&(i.viewportCoordinates=[]),i.viewportCoordinates[0]=[{x:n.offset().left+i.annotationSize/2,y:n.offset().top+i.annotationSize/2}],"function"==typeof(o=this.props).onAnnotationEnterCallback?o.onAnnotationEnterCallback({annotation:i,commentActivity:this.props.commentActivity}):void 0},_onMarkerMouseOver:function(e){return{}},_onMarkerMouseLeave:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback({annotation:this.props.annotation,commentActivity:this.props.commentActivity}):void 0},render:function(){var e,t,n,r;return t=null!=(n=this.props.commentActivity)&&null!=(r=n.comment)?r.resolved:void 0,e={"annotation-marker":!0,"annotation-marker--ui":!0,"annotation-marker--blue":!t,"annotation-marker--resolved":t,"annotation-marker--ghost":this._isGhostAnnotation()},o.div({className:"annotation-marker-container",ref:"markerContainer"},o.div({key:"annotationMarker",ref:"annotationMarker",style:{left:this.initialViewport.x-this.props.annotation.annotationSize/2,top:this.initialViewport.y-this.props.annotation.annotationSize/2},className:i(e),onClick:this._onMarkerClick,onMouseEnter:this._onMarkerMouseEnter,onMouseOver:this._onMarkerMouseOver,onMouseLeave:this._onMarkerMouseLeave},o.div({className:"annotation-maker-inner"})))}})})}.call(this),function(){define("modules/clean/annotations/annotation_region",["jquery","external/react","external/underscore","modules/clean/annotations/annotation"],function(e,t,n,i){var o,r,s,a,l,u,c;return o=i.Annotation,a=i.AnnotationTypes,s=i.AnnotationSubtypes,c=t.DOM,u=t.addons.classSet,l=t.addons.CSSTransitionGroup,r=t.createClass({displayName:"AnnotationRegion",propTypes:{onAnnotationPlacedCallback:t.PropTypes.func,onAnnotationHiddenCallback:t.PropTypes.func,onAnnotationStartDragCallback:t.PropTypes.func,onAnnotationEndDragCallback:t.PropTypes.func,onAnnotationOverCallback:t.PropTypes.func,onAnnotationScrollCallback:t.PropTypes.func,onAnnotationScaleChangeCallback:t.PropTypes.func,onAnnotationEnterCallback:t.PropTypes.func,onAnnotationLeaveCallback:t.PropTypes.func,parentContainerOffset:t.PropTypes.object},TYPE:a.REGION,SUBTYPE:s.REGION.RECTANGLE,DEFAULT_REGION_SIZE:60,Directions:{TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left"},getInitialState:function(){return{isInDragMode:!1,resizeDirections:[],isToolVisible:!1,isInitialCreation:!1,rectangle:{top:0,right:0,bottom:0,left:0},anchorRectangle:{top:0,right:0,bottom:0,left:0},anchorMouse:{x:0,y:0}}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},_getPositionRelativeToParentContainer:function(e){return{x:e.pageX-this.props.parentContainerOffset.left,y:e.pageY-this.props.parentContainerOffset.top}},_updateAnnotationFromState:function(){var e,t,n,i;return i=this.state.rectangle.top+this.props.parentContainerOffset.top,n=this.state.rectangle.right+this.props.parentContainerOffset.left,e=this.state.rectangle.bottom+this.props.parentContainerOffset.top,t=this.state.rectangle.left+this.props.parentContainerOffset.left,this.annotation.viewportCoordinates[0]=[{x:t,y:i},{x:t,y:e},{x:n,y:e},{x:n,y:i}]},_isOnRegion:function(t){var n,i;return this.state.isToolVisible&&(n=(null!=(i=this.refs.annotationRegion)?i.getDOMNode():void 0)||null,null!=n)?t.target===n||e.contains(n,t.target):!1},_isInResizingMode:function(){return!n.isEmpty(this.state.resizeDirections)},_isModifying:function(){return this.state.isInDragMode||this._isInResizingMode()},_showNewRectangle:function(e){return this.setState({isInDragMode:!1,resizeDirections:[this.Directions.TOP,this.Directions.LEFT],isToolVisible:!0,isInitialCreation:!0,rectangle:{top:e.y,right:e.x,bottom:e.y,left:e.x},anchorRectangle:{top:e.y,right:e.x,bottom:e.y,left:e.x},anchorMouse:e})},_startDragging:function(e){return this.setState({isInDragMode:!0,resizeDirections:[],anchorRectangle:n.clone(this.state.rectangle),anchorMouse:e})},_startResizing:function(e,t){return this.setState({isInDragMode:!1,resizeDirections:n.clone(t),anchorRectangle:n.clone(this.state.rectangle),anchorMouse:e})},componentWillMount:function(){return this.annotation=new o(this.TYPE,this.SUBTYPE)},hideAnnotation:function(){var e;return this.setState({isToolVisible:!1,isInDragMode:!1,resizeDirections:[]}),"function"==typeof(e=this.props).onAnnotationHiddenCallback?e.onAnnotationHiddenCallback(this.annotation):void 0},getDimensions:function(){return{width:this.state.rectangle.right-this.state.rectangle.left,height:this.state.rectangle.bottom-this.state.rectangle.top}},createDefaultRegion:function(e){var t,n,i,o;return e.preventDefault(),n=this._getPositionRelativeToParentContainer(e),i=n.x,o=n.y,t=this.DEFAULT_REGION_SIZE/2,this.setState({isHovering:!0,isToolVisible:!0,isInDragMode:!1,resizeDirections:[],isInitialCreation:!1,rectangle:{top:o-t,right:i+t,bottom:o+t,left:i-t}},function(e){return function(){var t;return e._updateAnnotationFromState(),"function"==typeof(t=e.props).onAnnotationPlacedCallback?t.onAnnotationPlacedCallback(e.annotation):void 0}}(this))},onMouseDownCallback:function(e){var t,n;return e.preventDefault(),n=this._getPositionRelativeToParentContainer(e),this.state.isToolVisible?this._isOnRegion(e)&&!this._isInResizingMode()?(this._updateAnnotationFromState(),"function"==typeof(t=this.props).onAnnotationStartDragCallback&&t.onAnnotationStartDragCallback(this.annotation),this._startDragging(n)):void 0:this._showNewRectangle(n)},onMouseMoveCallback:function(e){var t,i,o;return e.preventDefault(),this.state.isToolVisible?this._isModifying()?(o=this._getPositionRelativeToParentContainer(e),t={x:o.x-this.state.anchorMouse.x,y:o.y-this.state.anchorMouse.y},i=n.clone(this.state.anchorRectangle),this.state.isInDragMode?i={top:this.state.anchorRectangle.top+t.y,right:this.state.anchorRectangle.right+t.x,bottom:this.state.anchorRectangle.bottom+t.y,left:this.state.anchorRectangle.left+t.x}:this._isInResizingMode()&&(this.state.resizeDirections.indexOf(this.Directions.TOP)>=0?i.top=this.state.anchorRectangle.top+t.y:this.state.resizeDirections.indexOf(this.Directions.BOTTOM)>=0&&(i.bottom=this.state.anchorRectangle.bottom+t.y),this.state.resizeDirections.indexOf(this.Directions.LEFT)>=0?i.left=this.state.anchorRectangle.left+t.x:this.state.resizeDirections.indexOf(this.Directions.RIGHT)>=0&&(i.right=this.state.anchorRectangle.right+t.x)),i={top:Math.min(i.top,i.bottom),right:Math.max(i.left,i.right),bottom:Math.max(i.top,i.bottom),left:Math.min(i.left,i.right)},this.setState({rectangle:i})):void 0:(o=this._getPositionRelativeToParentContainer(e),void this._showNewRectangle(o))},onMouseUpCallback:function(e){var t,n;return e.preventDefault(),this.state.isToolVisible?this._isModifying()?(this._updateAnnotationFromState(),this.state.isInitialCreation?"function"==typeof(t=this.props).onAnnotationPlacedCallback&&t.onAnnotationPlacedCallback(this.annotation):"function"==typeof(n=this.props).onAnnotationEndDragCallback&&n.onAnnotationEndDragCallback(this.annotation),this.setState({isInDragMode:!1,resizeDirections:[],isInitialCreation:!1})):this.hideAnnotation(e):void 0},onScrollCallback:function(){var e;return this.state.isToolVisible?(this._updateAnnotationFromState(),"function"==typeof(e=this.props).onAnnotationScrollCallback?e.onAnnotationScrollCallback(this.annotation):void 0):void 0},onScaleChangeCallback:function(){var e;return this._updateAnnotationFromState(),"function"==typeof(e=this.props).onAnnotationScaleChangeCallback?e.onAnnotationScaleChangeCallback(this.annotation):void 0},_onRegionMouseDown:function(e){},_onRegionMouseOver:function(e){var t;return"function"==typeof(t=this.props).onAnnotationOverCallback?t.onAnnotationOverCallback(this.annotation):void 0},_onRegionMouseUp:function(e){},_onRegionMouseEnter:function(e){var t;return this.setState({isHovering:!0}),"function"==typeof(t=this.props).onAnnotationEnterCallback?t.onAnnotationEnterCallback(this.annotation):void 0},_onRegionMouseLeave:function(e){var t;return this.setState({isHovering:!1}),"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback(this.annotation):void 0},_onHandleMouseDown:function(e,t){var n,i;return e.preventDefault(),i=this._getPositionRelativeToParentContainer(e),this._updateAnnotationFromState(),"function"==typeof(n=this.props).onAnnotationStartDragCallback&&n.onAnnotationStartDragCallback(this.annotation),this._startResizing(i,t)},_renderSideHandles:function(){var e;return c.div({ref:"side-handle-wrapper",className:"annotation-region-side-handle--wrapper"},function(){var t,i,o,r;for(o=n.values(this.Directions),r=[],t=0,i=o.length;i>t;t++)e=o[t],r.push(function(e){return function(t){return c.div({ref:"side-handle-"+t,className:"annotation-region-side-handle annotation-region-side-handle--"+t,onMouseDown:function(n){return e._onHandleMouseDown(n,[t])}})}}(this)(e));return r}.call(this))},_renderCornerHandles:function(){var e,t,n,i,o,r;for(i=[this.Directions.TOP,this.Directions.BOTTOM],o=[],t=0,n=i.length;n>t;t++)r=i[t],o.push(function(){var t,n,i,o;for(i=[this.Directions.LEFT,this.Directions.RIGHT],o=[],t=0,n=i.length;n>t;t++)e=i[t],o.push(function(e){return function(t,n){return c.div({ref:"corner-handle-"+t+"-"+n,className:"annotation-region-corner-handle annotation-region-corner-handle--"+t+"-"+n,onMouseDown:function(i){return e._onHandleMouseDown(i,[t,n])}},c.div({ref:"corner-handle-"+t+"-"+n+"-dot",className:"annotation-region-corner-handle--dot annotation-region-corner-handle--dot--"+t+"-"+n}))}}(this)(r,e));return o}.call(this));return o},render:function(){var e,t;return t=[],this.state.isToolVisible&&(e={"annotation-region":!0,"annotation-region--blue":!0,"is-modifying":this._isModifying(),hover:this.state.isHovering},t=[c.div({key:"annotationRegion",ref:"annotationRegion",className:u(e),onMouseDown:this._onRegionMouseDown,onMouseUp:this._onRegionMouseUp,onMouseOver:this._onRegionMouseOver,onMouseOut:this._onRegionMouseOut,onMouseEnter:this._onRegionMouseEnter,onMouseLeave:this._onRegionMouseLeave,style:{left:this.state.rectangle.left,top:this.state.rectangle.top,width:this.state.rectangle.right-this.state.rectangle.left,height:this.state.rectangle.bottom-this.state.rectangle.top}},this._renderSideHandles(),this._renderCornerHandles())]),c.div({className:"annotation-region-container"},this.state.isToolVisible?t:void 0)}})})}.call(this),function(){define("modules/clean/annotations/annotation_region_ui",["jquery","external/react"],function(e,t){var n,i,o;return o=t.DOM,i=t.addons.classSet,n=t.createClass({displayName:"AnnotationRegionUI",propTypes:{annotation:t.PropTypes.object,commentActivity:t.PropTypes.object,options:t.PropTypes.shape({isGhostAnnotation:t.PropTypes.bool,isAnnotationNumberingEnabled:t.PropTypes.bool,annotationNumber:t.PropTypes.number}),onAnnotationEnterCallback:t.PropTypes.func,onAnnotationOverCallback:t.PropTypes.func,onAnnotationLeaveCallback:t.PropTypes.func,onAnnotationClickCallback:t.PropTypes.func},getInitialState:function(){return{}},_isGhostAnnotation:function(){return this.props.options.isGhostAnnotation||!1},_onRegionClick:function(e){var t;return"function"==typeof(t=this.props).onAnnotationClickCallback?t.onAnnotationClickCallback({annotation:this.props.annotation,commentActivity:this.props.commentActivity}):void 0},_onRegionMouseEnter:function(t){var n,i,o,r,s,a,l,u;return n=e(null!=(a=this.refs.annotationRegion)?a.getDOMNode():void 0),i=this.props.annotation,null==i.viewportCoordinates&&(i.viewportCoordinates=[]),u=n.offset().top,s=n.offset().left,r=u+n.height(),l=s+n.width(),i.viewportCoordinates[0]=[{x:s,y:u},{x:s,y:r},{x:l,y:r},{x:l,y:u}],"function"==typeof(o=this.props).onAnnotationEnterCallback?o.onAnnotationEnterCallback({annotation:i,commentActivity:this.props.commentActivity}):void 0},_onRegionMouseOver:function(e){return{}},_onRegionMouseLeave:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback({annotation:this.props.annotation,commentActivity:this.props.commentActivity}):void 0},render:function(){var e,t,n,r,s,a;return n=null!=(s=this.props.commentActivity)&&null!=(a=s.comment)?a.resolved:void 0,r=this.props.annotation.getBoundingBox(),e={"annotation-region":!0,"annotation-region--ui":!0,"annotation-region--resolved":n,"annotation-region--ui--resolved":n,"annotation-region--ghost":this._isGhostAnnotation()},o.div({className:"annotation-region-container"},o.div({key:"annotationRegion",ref:"annotationRegion",className:i(e),onClick:this._onRegionClick,onMouseEnter:this._onRegionMouseEnter,onMouseOver:this._onRegionMouseOver,onMouseLeave:this._onRegionMouseLeave,style:{left:r.left,top:r.top,width:r.right-r.left,height:r.bottom-r.top}},o.div({className:"annotation-region-inner"}),this.props.options.isAnnotationNumberingEnabled?(t={"annotation-number":!0,"annotation-number--resolved":n},o.div({className:i(t)},this.props.options.annotationNumber)):void 0))}})})}.call(this),function(){define("modules/clean/annotations/annotation_renderer_utils",["jquery","external/react","modules/clean/annotations/annotation","modules/clean/annotations/annotation_highlight_ui","modules/clean/annotations/annotation_marker_ui","modules/clean/annotations/annotation_region_ui","external/underscore"],function(e,t,n,i,o,r,s){var a,l,u;return a=n.Annotation,u=n.AnnotationTypes,l=function(){function e(){}return e.prototype.shouldUpdateAnnotations=function(e,t){var n,i,o,r,a,l,u;if((null!=(a=e.annotations)?a.length:void 0)!==(null!=(l=s.keys(t))?l.length:void 0))return!0;for(u=e.annotations,o=0,r=u.length;r>o;o++)if(i=u[o],n=i.commentActivity.activity_key,!s.isEqual(t[n],i))return!0;return!1},e.prototype.renderAnnotation=function(e,t,n){var s,l,c,d;if(null==e.annotation||null==e.commentActivity)return null;if(s=a.createAnnotationFromDict(e.annotation),c=e.commentActivity,null==(null!=s?s.type:void 0)||t(c.activity_key))return null;switch(l=null,s.type){case u.MARKER:l=o;break;case u.HIGHLIGHT:l=i;break;case u.REGION:l=r}return null==l?null:(d=null!=e.options?e.options:{},n(l,s,c,d))},e}()})}.call(this),function(){define("modules/clean/annotations/preview_image_annotations_toolbar",["external/react","external/underscore","jquery","modules/core/dom","modules/core/i18n","modules/clean/components/title_bubble","modules/clean/keycode","modules/clean/react/sprite"],function(e,t,n,i,o,r,s,a){var l,u,c,d,p;return d=e.addons.classSet,p=e.DOM,c=o._,u=3e3,l=e.createClass({displayName:"PreviewImageAnnotationsToolbar",propTypes:{index:e.PropTypes.number.isRequired,count:e.PropTypes.number.isRequired,zoomPercent:e.PropTypes.number,minimumZoomPercent:e.PropTypes.number,maximumZoomPercent:e.PropTypes.number,onPrevious:e.PropTypes.func,onNext:e.PropTypes.func,onFullscreen:e.PropTypes.func,onZoomIn:e.PropTypes.func,onZoomOut:e.PropTypes.func,onZoomOriginalOrFit:e.PropTypes.func},getInitialState:function(){return{isToolbarVisible:!1}},componentDidMount:function(){return window.addEventListener("mousemove",this._onMouseMove),n(document).bind("keydown",this._handleKeyPress)},componentWillUnmount:function(){return window.removeEventListener("mousemove",this._onMouseMove),clearTimeout(this.hideToolbarTimeout),n(document).unbind("keydown",this._handleKeyPress)},_onMouseMove:function(e){return this.state.isToolbarVisible||this.setState({isToolbarVisible:!0}),this.state.isToolbarVisible?(clearTimeout(this.hideToolbarTimeout),this.hideToolbarTimeout=setTimeout(function(t){return function(){return t._maybeHideToolbar(e)}}(this),u)):void 0},_handleKeyPress:function(e){var t,n,o,r;return i.focus_in_input()||i.is_input(e.target)?!0:(r=e.keyCode,r===s.EQUALS||r===s.PLUS_EQUALS_FF||r===s.PLUS_CHROME||r===s.PLUS_EQUALS_FF_GERMAN?("function"==typeof(t=this.props).onZoomIn&&t.onZoomIn(),o=!0):r!==s.MINUS_FF_MAC&&r!==s.MINUS_FF&&r!==s.MINUS_CHROME||("function"==typeof(n=this.props).onZoomOut&&n.onZoomOut(),o=!0),o&&null!=e.preventDefault&&e.preventDefault(),!o)},_maybeHideToolbar:function(e){var t;return 0===n(e.target).closest(null!=(t=this.refs.previewToolbar)?t.getDOMNode():void 0).length?this.setState({isToolbarVisible:!1}):void 0},_flipLabelText:function(){return c("%(cur_file_num)s of %(num_total_files)s").format({cur_file_num:this.props.index+1,num_total_files:this.props.count})},_zoomToolTipText:function(){return c(1===this.props.zoomPercent?"Zoom to fit":"View actual size")},_getZoomLabel:function(){return this.props.zoomPercent?c("%(zoom_percent)s%").format({zoom_percent:Math.round(100*this.props.zoomPercent)}):""},_onZoomMouseDown:function(e){return this.isZooming=!0,this._keepZooming(e,400)},_keepZooming:function(e,t){return this.isZooming?(e(),setTimeout(function(t){return function(){return t._keepZooming(e,75)}}(this),t)):void 0},_onZoomMouseUp:function(){return this.isZooming=!1},render:function(){var e,n;return this.state.isToolbarVisible?this.props.count<=1&&null==this.props.onZoomOut&&null==this.props.onZoomIn&&null==this.props.onFullscreen?!1:(n={"zoom-out":!0,disabled:null!=this.props.minimumZoomPercent&&this.props.zoomPercent<=this.props.minimumZoomPercent},e={"zoom-in":!0,disabled:null!=this.props.maximumZoomPercent&&this.props.zoomPercent>=this.props.maximumZoomPercent},p.div({className:"preview-toolbar-overlay-container"},p.div({className:"preview-toolbar-overlay",ref:"previewToolbar"},p.div({className:"preview-toolbar-content"},this.props.count>1&&null!=this.props.onPrevious&&null!=this.props.onNext?p.span({className:"flip-buttons"},p.div({className:"flip-button flip-button--previous",onClick:this.props.onPrevious},a({group:"web",name:"s_flip_left",alt:c("Previous")})),p.div({className:"flip-label"},this._flipLabelText()),p.div({className:"flip-button flip-button--next",onClick:this.props.onNext},a({group:"web",name:"s_flip_right",alt:c("Next")}))):void 0,null!=this.props.onZoomOut||null!=this.props.onZoomIn?p.span({className:"flip-buttons"},null!=this.props.onZoomOut?p.div({className:d(n),onMouseDown:t.partial(this._onZoomMouseDown,this.props.onZoomOut),onMouseUp:this._onZoomMouseUp},a({group:"web",name:"zoomout",alt:c("Zoom Out")})):void 0,null!=this.props.onZoomOriginalOrFit?r({text:this._zoomToolTipText(),direction:"north"},p.div({ref:"zoomLabel",className:"zoom-label",onClick:this.props.onZoomOriginalOrFit},this._getZoomLabel())):void 0,null!=this.props.onZoomIn?p.div({className:d(e),onMouseDown:t.partial(this._onZoomMouseDown,this.props.onZoomIn),onMouseUp:this._onZoomMouseUp},a({group:"web",name:"zoom",alt:c("Zoom In")})):void 0):void 0,null!=this.props.onFullscreen?p.div({className:"fullscreen",onClick:this.props.onFullscreen},a({group:"web",name:"fullscreen",alt:c("Fullscreen")}),p.span({className:"fullscreen-label"},c("Fullscreen"))):void 0)))):!1}})})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/api_v2/client",["jquery","external/underscore","modules/clean/api_v2/error","external/rsvp","modules/constants/env","modules/constants/request","modules/core/cookies","modules/core/notify","modules/core/uri"],function(t,n,i,o,r,s,a,l,u){var c,d,p,_,h,m,f;return c=i.ApiError,_=o.Promise,f=r.WEBSERVER,p=s.JS_CSRF_COOKIE,d=function(){function e(){}return e.prototype.rpc=function(e,n,i){var o;return null==i&&(i=null),o=a.read(p)||"",new _(function(r,s){return t.ajax({type:"POST",url:u({scheme:"https",authority:f,path:"/2/"+n}).toString(),contentType:"application/json",headers:{"X-Dropbox-Subject-User":e,"X-CSRF-Token":o},data:JSON.stringify(i)}).done(function(e,t,n){return r(null!=n.responseText?JSON.parse(n.responseText):null)}).fail(function(e){return s(c.parseResponse(e.status,e.getAllResponseHeaders(),e.responseText))})})},e}(),m=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.rpc=function(e,t,i,o){var r;return null==i&&(i=null),null==o&&(o=!0),r=n.__super__.rpc.apply(this,arguments),r.catch(function(e){return o&&l.error(e.message||l.DEFAULT_ERROR),_.reject(e)})},n}(d),h=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.rpc=function(e,t,i,o){var r;return null==i&&(i=null),null==o&&(o=!0),r=n.__super__.rpc.apply(this,arguments),r.catch(function(e){var t,n;return t=null!=(n=e.error)?n.admin_console_error:void 0,t||(t=e.message||l.DEFAULT_ERROR),o&&l.error(t),_.reject(e)})},n}(d),{ApiV2Client:d,UserActionClient:m,TeamActionsClient:h}})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/api_v2/error",[],function(){var n,i,o,r,s,a;return n=function(n){function l(){return l.__super__.constructor.apply(this,arguments)}return e(l,n),l.parseResponse=function(e,n,u,c){var d,p,_,h,m,f,v,g,y,b,w,E,T,C,S,k;null==c&&(c=null),null==c&&(c=function(){switch(e){case 400:return r;case 401:return o;case 409:return i;case 429:return s;default:return e>=500?a:l}}()),w={raw:{status:e,headerString:n,responseBody:u}};try{f=JSON.parse(u)||{},w.error=f.error,w.summary=f.error_summary,b=(null!=(E=f.user_message)?E.text:void 0)||""}catch(e){d=e,w.error=null,w.summary=null,b=""}if(w.headers={},null!=n)for(T=n.split("\n"),m=0,y=T.length;y>m;m++)p=T[m],p.length>0&&(C=p.split(": "),g=C[0],k=C[1],w.headers[g]=k);_=new c(b);for(v in w)t.call(w,v)&&(S=w[v],_[v]=S);return _},l}(Error),r=function(){function e(e){this.message=e}return e}(),o=function(){function e(e){this.message=e}return e}(),i=function(){function e(e){this.message=e}return e}(),s=function(){function e(e){this.message=e}return e.prototype.getRetryAfter=function(){var e;return null!=(e=this.headers)?e["retry-after"]:void 0},e}(),a=function(){function e(e){this.message=e}return e}(),{ApiError:n,AppError:i,AuthError:o,BadRequestError:r,RateLimitError:s,ServerError:a}})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/api_v2/types",["external/underscore"],function(t){var n,i,o;return n=function(){function e(e,t){this.type=e,this.value=t}return e.parse=function(e){var t;return t=e[".tag"],2===Object.keys(e).length&&null!=e[t]?new i(t,e[t]):new o(t,e)},e}(),i=function(t){function n(e,t){this.type=e,this.value=null!=t?t:null,this.isScalar=!0}return e(n,t),n.prototype.toJSON=function(){var e;return e={".tag":this.type},null!=this.value&&(e[this.type]=this.value),
e},n}(n),o=function(n){function i(e,t){this.type=e,this.value=null!=t?t:{},this.isScalar=!1}return e(i,n),i.prototype.toJSON=function(){var e;return e={".tag":this.type},t.extend(e,this.value),e},i}(n),{Union:n,UnionScalar:i,UnionStruct:o}})}.call(this),function(){define("modules/clean/avatar/avatar_with_default",["external/react","modules/clean/avatar/photo_avatar","modules/clean/avatar/size","modules/clean/css"],function(e,t,n,i){var o,r,s,a;return s=n.VALID_AVATAR_DIMENSIONS,a=e.DOM,r=e.createFactory(t),o=e.createClass({displayName:"AvatarWithDefault",propTypes:{alt:e.PropTypes.string,dimension:e.PropTypes.oneOf(s).isRequired,defaultAvatar:e.PropTypes.element.isRequired,onPhotoClick:e.PropTypes.func,photoUrl:e.PropTypes.string,optionalClass:e.PropTypes.string,shape:e.PropTypes.oneOf(["CIRCLE","SQUARE"]).isRequired},getDefaultProps:function(){return{shape:"CIRCLE"}},componentDidMount:function(){return i.require_css("/static/css/scooter/scooter-scoped-vfljb_RbQ.css")},render:function(){return null!=this.props.photoUrl?r({alt:this.props.alt,dimension:this.props.dimension,onClick:this.props.onPhotoClick,photoUrl:this.props.photoUrl,optionalClass:this.props.optionalClass,shape:this.props.shape}):this.props.defaultAvatar}})})}.call(this),function(){define("modules/clean/avatar/contact_avatar",["external/react","modules/core/i18n","modules/core/user_i18n","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/size","modules/clean/contacts/data","modules/clean/contacts/types"],function(e,t,n,i,o,r,s,a){var l,u,c,d,p,_;return p=t._,l=r.AVATAR_DIMENSION_BY_SIZE,d=r.VALID_AVATAR_DIMENSIONS,u=s.Contact,_=e.createElement,c=e.createClass({displayName:"ContactAvatar",propTypes:{dimension:e.PropTypes.oneOf(d).isRequired,contact:e.PropTypes.instanceOf(u).isRequired,optionalClass:e.PropTypes.string},render:function(){var e,t,r,s,u,c,d;return r=this.props.contact,u=r.name||r.email,c=r.photo_url,r.type===a.FB&&(c="https://graph.facebook.com/"+r.fb_id+"/picture"),s="",this.props.dimension!==l.XSMALL&&(s=n.getInitials(u)),r.type===a.NEW_STYLE_GROUP?(e=p("Group"),d="SQUARE"):(e=p("User"),d="CIRCLE"),t={alt:e,dimension:this.props.dimension,photoUrl:c,optionalClass:this.props.optionalClass,defaultAvatar:_(o,{alt:e,dimension:this.props.dimension,name:u,initials:s,shape:d,optionalClass:this.props.optionalClass})},_(i,t)}})})}.call(this),function(){define("modules/clean/avatar/faceholder",["external/react","modules/clean/avatar/size","modules/clean/avatar/style","modules/clean/css","modules/clean/react/image","modules/clean/static_urls"],function(e,t,n,i,o,r){var s,a,l,u,c;return a=t.VALID_AVATAR_DIMENSIONS,u=n.getClassName,c=r.static_url,l=e.DOM,s=e.createClass({displayName:"Faceholder",propTypes:{alt:e.PropTypes.string,dimension:e.PropTypes.oneOf(a).isRequired,onClick:e.PropTypes.func,optionalClass:e.PropTypes.string},statics:{SRC_MAP:{16:c("/static/images/avatar/faceholder-16-vflzvFMED.png"),24:c("/static/images/avatar/faceholder-24-vflpqFBTK.png"),32:c("/static/images/avatar/faceholder-32-vflKWtuU5.png"),48:c("/static/images/avatar/faceholder-48-vfll8Voom.png"),64:c("/static/images/avatar/faceholder-64-vflHTEplh.png")},SRC_HI_RES_MAP:{16:c("/static/images/avatar/faceholder-16@2x-vflBZ7FgU.png"),24:c("/static/images/avatar/faceholder-24@2x-vflVegRLu.png"),32:c("/static/images/avatar/faceholder-32@2x-vflYmh947.png"),48:c("/static/images/avatar/faceholder-48@2x-vflUglZDR.png"),64:c("/static/images/avatar/faceholder-64@2x-vfl8eFSM8.png")}},componentDidMount:function(){return i.require_css("/static/css/scooter/scooter-scoped-vfljb_RbQ.css")},render:function(){var t,n;return t=["c-avatar--circle"],this.props.optionalClass&&t.push(this.props.optionalClass),n=e.createElement(o,{alt:this.props.alt||"",src:s.SRC_MAP[this.props.dimension],srcHiRes:s.SRC_HI_RES_MAP[this.props.dimension]}),null!=this.props.onClick&&this.props.alt?(t.push("u-unbutton"),l.button({className:u(this.props.dimension,t),onClick:this.props.onClick},n)):l.div({className:u(this.props.dimension,t),onClick:this.props.onClick},n)}})})}.call(this),function(){define("modules/clean/avatar/initials_avatar",["external/react","modules/clean/avatar/size","modules/clean/avatar/style","modules/clean/css"],function(e,t,n,i){var o,r,s,a;return r=t.VALID_AVATAR_DIMENSIONS,a=n.getClassName,s=e.DOM,o=e.createClass({displayName:"InitialsAvatar",propTypes:{alt:e.PropTypes.string,dimension:e.PropTypes.oneOf(r).isRequired,initials:e.PropTypes.string.isRequired,shape:e.PropTypes.oneOf(["CIRCLE","SQUARE"]).isRequired,color:e.PropTypes.string,onClick:e.PropTypes.func,optionalClass:e.PropTypes.string},componentDidMount:function(){return i.require_css("/static/css/scooter/scooter-scoped-vfljb_RbQ.css")},render:function(){var e;return e=["c-avatar--no-img","c-avatar--"+this.props.shape.toLowerCase()],null!=this.props.optionalClass&&e.push(this.props.optionalClass),null!=this.props.onClick&&this.props.alt?(e.push("u-unbutton"),s.button({className:a(this.props.dimension,e),onClick:this.props.onClick,style:this.getContainerStyle()},s.span({"aria-hidden":!0},this.props.initials),s.span({className:"ax-visually-hidden"},this.props.alt))):s.div({className:a(this.props.dimension,e),onClick:this.props.onClick,style:this.getContainerStyle()},this.props.alt?[s.span({"aria-hidden":!0},this.props.initials),s.span({className:"ax-visually-hidden"},this.props.alt)]:this.props.initials)},getContainerStyle:function(){var e;return e={},this.props.color&&(e.backgroundColor=this.props.color),e}})})}.call(this),function(){define("modules/clean/avatar/initials_avatar_with_color",["jquery","external/react","modules/clean/avatar/initials_avatar","modules/clean/avatar/style"],function(e,t,n,i){var o,r,s;return s=i.colorValueForAvatarName,r=t.createElement,o=t.createClass({displayName:"InitialsAvatarWithColorDerivedFromName",propTypes:{name:t.PropTypes.string.isRequired},render:function(){var t;return t=e.extend({color:s(this.props.name)},this.props),delete t.name,r(n,t)}})})}.call(this),function(){define("modules/clean/avatar/list",["external/react","modules/clean/avatar/overflow_count_pill","modules/clean/avatar/size"],function(e,t,n){var i,o,r,s;return o=n.VALID_AVATAR_DIMENSIONS,r=e.createElement,s=e.DOM,i=e.createClass({displayName:"HorizontalAvatarList",propTypes:{avatars:e.PropTypes.array.isRequired,avatarDimension:e.PropTypes.oneOf(o).isRequired,maxVisible:e.PropTypes.number.isRequired,undisplayableCount:e.PropTypes.number.isRequired,onOverflowCountClick:e.PropTypes.func,animation:e.PropTypes.bool},render:function(){var e,n,i;return e=this.props.avatars,n=this.props.maxVisible,i=0,this.props.undisplayableCount&&(i+=this.props.undisplayableCount),(this.props.undisplayableCount||e.length>n)&&(n--,i+=e.length-n,e=e.slice(0,n)),i&&e.push(r(t,{count:i,dimension:this.props.avatarDimension,key:"overflow_pill:"+i,onClick:this.props.onOverflowCountClick})),s.div({className:this.getClassName()},e)},getClassName:function(){return e.addons.classSet({"horizontal-avatar-list":!0,animation:this.props.animation,"is-animated":this.props.animation,"c-facepile":!0})}})})}.call(this),function(){define("modules/clean/avatar/overflow_count_pill",["external/react","modules/clean/avatar/size","modules/clean/avatar/style","modules/clean/css","modules/core/i18n"],function(e,t,n,i,o){var r,s,a,l,u;return s=t.VALID_AVATAR_DIMENSIONS,l=n.getClassName,u=o.ungettext,a=e.DOM,r=e.createClass({displayName:"OverflowCountPill",propTypes:{dimension:e.PropTypes.oneOf(s).isRequired,count:e.PropTypes.number.isRequired,onClick:e.PropTypes.func},componentDidMount:function(){return i.require_css("/static/css/scooter/scooter-scoped-vfljb_RbQ.css")},render:function(){var e,t;return t=" +"+this.props.count+" ",e=u("%(count)s more member","%(count)s more members",this.props.count).format({count:this.props.count}),null!=this.props.onClick?a.button({className:l(this.props.dimension,["overflow-pill c-avatar--meta u-unbutton"]),onClick:this.props.onClick},a.span({"aria-hidden":!0},t),a.span({className:"ax-visually-hidden"},e)):a.div({className:l(this.props.dimension,["overflow-pill c-avatar--meta"])},a.span({"aria-hidden":!0},t),a.span({className:"ax-visually-hidden"},e))}})})}.call(this),function(){define("modules/clean/avatar/photo_avatar",["external/react","modules/clean/avatar/size","modules/clean/avatar/style"],function(e,t,n){var i,o,r,s,a;return o=t.VALID_AVATAR_DIMENSIONS,s=n.dynamicInlineStyle,a=n.getClassName,r=e.DOM,i=e.createClass({displayName:"PhotoAvatar",propTypes:{alt:e.PropTypes.string,dimension:e.PropTypes.oneOf(o).isRequired,photoUrl:e.PropTypes.string.isRequired,onClick:e.PropTypes.func,optionalClass:e.PropTypes.string,shape:e.PropTypes.oneOf(["CIRCLE","SQUARE"])},getDefaultProps:function(){return{shape:"CIRCLE"}},render:function(){var e,t;return e=["c-avatar--"+this.props.shape.toLowerCase()],null!=this.props.optionalClass&&e.push(this.props.optionalClass),t=r.img({alt:this.props.alt||"",src:this.props.photoUrl,width:this.props.dimension,height:this.props.dimension}),null!=this.props.onClick&&this.props.alt?(e.push("u-unbutton"),r.button({className:a(this.props.dimension,e),onClick:this.props.onClick},t)):r.div({className:a(this.props.dimension,e),onClick:this.props.onClick},t)}})})}.call(this),function(){define("modules/clean/avatar/shared_link_avatar",["external/react","modules/clean/avatar/size","modules/clean/avatar/style","modules/clean/css","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,i,o,r){var s,a,l,u,c,d;return a=t.VALID_AVATAR_DIMENSIONS,c=n.getClassName,d=o.static_url,l=r._,u=e.DOM,s=e.createClass({displayName:"SharedLinkAvatar",propTypes:{alt:e.PropTypes.string,dimension:e.PropTypes.oneOf(a).isRequired,onClick:e.PropTypes.func},componentDidMount:function(){return i.require_css("/static/css/scooter/scooter-scoped-vfljb_RbQ.css")},render:function(){var e,t;return t=u.img({src:d("/static/images/avatar/shared-link-icon-vflHCU_m6.svg"),alt:this.props.alt||l("Shared link"),width:12}),null!=this.props.onClick?(e=c(this.props.dimension,["c-avatar--meta u-unbutton"]),u.button({className:e,onClick:this.props.onClick},t)):(e=c(this.props.dimension,["c-avatar--meta"]),u.div({className:e,onClick:this.props.onClick},t))}})})}.call(this),function(){define("modules/clean/avatar/size",[],function(){var e,t,n;return e={XSMALL:16,SMALL:24,MEDIUM:32,LARGE:48,XLARGE:64},t=function(){var t;t=[];for(n in e)t.push(e[n]);return t}(),{AVATAR_DIMENSION_BY_SIZE:e,VALID_AVATAR_DIMENSIONS:t}})}.call(this),function(){define("modules/clean/avatar/stacked_avatars",["external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/size","modules/clean/css","modules/core/user_i18n"],function(e,t,n,i,o,r){var s,a,l,u,c;return a=i.VALID_AVATAR_DIMENSIONS,u=e.DOM,c=e.PropTypes,l=e.createElement,s=e.createClass({displayName:"StackedAvatars",propTypes:{user_front:c.object.isRequired,user_back:c.object.isRequired,dimension:c.oneOf(a).isRequired,optionalClass:c.string,shape:c.oneOf(["CIRCLE","SQUARE"]).isRequired},getDefaultProps:function(){return{shape:"CIRCLE"}},componentDidMount:function(){return o.require_css("/static/css/scooter/scooter-scoped-vfljb_RbQ.css")},render:function(){var e,i;return e="stacked-avatar-bottom",i="stacked-avatar-top",this.props.optionalClass&&(e+=" "+this.props.optionalClass,i+=" "+this.props.optionalClass),u.div({className:"stacked-avatars-section u-l-ib"},l(t,{dimension:this.props.dimension,photoUrl:this.props.user_back.avatar_url,optionalClass:e,defaultAvatar:l(n,{dimension:this.props.dimension,name:this.props.user_back.display_name||this.props.user_back.email,initials:r.getInitials(this.props.user_back.display_name||this.props.user_back.email),shape:this.props.shape,optionalClass:e})}),l(t,{dimension:this.props.dimension,photoUrl:this.props.user_front.avatar_url,optionalClass:i,defaultAvatar:l(n,{dimension:this.props.dimension,name:this.props.user_front.display_name||this.props.user_front.email,initials:r.getInitials(this.props.user_front.display_name||this.props.user_front.email),shape:this.props.shape,optionalClass:i})}))}})})}.call(this),function(){define("modules/clean/avatar/style",["external/react","modules/clean/accessibility/utils"],function(e,t){var n,i,o,r;return i=t.accessibleColorPalette,n={16:"c-avatar--xs",24:"c-avatar--s",32:"c-avatar--m",48:"c-avatar--l",64:"c-avatar--xl"},o=function(e){var t,n;for(t=5381*e.length,n=0;n<e.length;)t=e.charCodeAt(n)+((t<<6)+(t<<16)-t),n++;return t=Math.abs(t),i[t%(i.length-1)]},r=function(t,i){var o;return null==t&&(t=32),null==i&&(i=[]),o=["c-avatar",n[t]],i=i.concat(o),e.addons.classSet.apply(this,i)},{colorValueForAvatarName:o,getClassName:r}})}.call(this),function(){define("modules/clean/avatar/viewer_avatar",["jquery","external/react","modules/clean/avatar/photo_avatar","modules/clean/avatar/size","modules/clean/css","modules/core/uri"],function(e,t,n,i,o,r){var s,a,l,u,c;return a=i.VALID_AVATAR_DIMENSIONS,u=t.createElement,c=t.DOM,s=t.createFactory(n),l=t.createClass({displayName:"ViewerAvatar",propTypes:{alt:t.PropTypes.string,dimension:t.PropTypes.oneOf(a).isRequired,defaultAvatar:t.PropTypes.element.isRequired,onPhotoClick:t.PropTypes.func,photoUrl:t.PropTypes.string,optionalClass:t.PropTypes.string},getInitialState:function(){return{photoUrl:this.props.photoUrl}},componentDidMount:function(){return o.require_css("/static/css/scooter/scooter-scoped-vfljb_RbQ.css"),e(document).on("db:account_photo:photo_set",function(e){return function(t,n){var i,o,s;return i=2*e.props.dimension,s=i+"x"+i,o=r.parse(n.saved_photo_url).updateQuery({size:s}).toString(),e.setState({photoUrl:o})}}(this)),e(document).on("db:account_photo:photo_deleted",function(e){return function(t){return e.setState({photoUrl:null})}}(this))},render:function(){return null!=this.state.photoUrl?s({alt:this.props.alt,dimension:this.props.dimension,onClick:this.props.onPhotoClick,photoUrl:this.state.photoUrl,optionalClass:this.props.optionalClass}):this.props.defaultAvatar}})})}.call(this),function(){define("modules/clean/average_counter",[],function(){var e;return e=function(){function e(){this.average=0,this.count=0}return e.prototype.getAverage=function(){return this.average},e.prototype.add=function(e){return this.average=(this.average*this.count+e)/(this.count+1),this.count++},e.prototype.addArray=function(e){var t,n;return t=e.reduce(function(e,t){return e+t}),n=this.count+e.length,this.average=(this.average*this.count+t)/n,this.count=n},e}()})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/bolt",["jquery","external/underscore","modules/clean/bolt_nodeps","modules/constants/env","modules/core/exception"],function(t,n,i,o,r){var s,a;return s=function(i){function s(e,i,a){s.__super__.constructor.call(this,e,i,a,o.BOLT_SERVER,t.ajax,n,r)}return e(s,i),s}(i.BoltClient),a=function(i){function s(e,i,a){s.__super__.constructor.call(this,e,i,a,o.THUNDER_SERVER,t.ajax,n,r)}return e(s,i),s}(i.ThunderClient),{BoltClient:s,ThunderClient:a,ChannelId:i.ChannelId,SignedChannelState:i.SignedChannelState,Payload:i.Payload,ChannelPayloads:i.ChannelPayloads}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function i(){this.constructor=e}for(var o in t)n.call(t,o)&&(e[o]=t[o]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},n={}.hasOwnProperty;define("modules/clean/bolt_nodeps",[],function(){var n,i,o,r,s,a,l,u,c,d,p;return n=1e3,i=3e5,l="/2/notify/subscribe",u="/2/payloads/subscribe",s=function(){function e(e,t){this.app_id=e,this.unique_id=t}return e}(),d=function(){function e(e,t,n,i){this.app_id=e,this.unique_id=t,this.revision=n,this.token=i}return e}(),c=function(){function e(e,t){this.revision=e,this.payload=t}return e}(),a=function(){function e(e,t){this.channel_state=e,this.payloads=t}return e}(),o=function(){function t(t,i,o,r,s,a,l){this._update_callback=i,this._refresh_callback=o,this._hostname=r,this._ajax=s,this._u=a,this._exclog=null!=l?l:null,this._handle_poll_error=e(this._handle_poll_error,this),this._handle_poll_success=e(this._handle_poll_success,this),this._must_find_state=e(this._must_find_state,this),this._long_poll=e(this._long_poll,this),this._find_state=e(this._find_state,this),this._signed_channel_states=[],this._started=!1,this._backoff_window=n,this._additional_headers={},this.update_states(t)}return t.prototype._encode_channel_state=function(e){return{channel_id:{app_id:e.app_id,unique_id:e.unique_id},revision:e.revision,token:e.token}},t.prototype._decode_channel_state=function(e){return new d(e.channel_id.app_id,e.channel_id.unique_id,e.revision,e.token)},t.prototype._decode_channel_id=function(e){return new s(e.app_id,e.unique_id)},t.prototype._compare_revisions=function(e,t){var n,i,o;return n=Math.max(e.length,t.length),i=Array(n-e.length+1).join("0")+e,o=Array(n-t.length+1).join("0")+t,o>i?-1:i>o?1:0},t.prototype._find_state=function(e){return this._u.find(this._signed_channel_states,function(t){return function(n){return t._u.isEqual(e,n.channel_id)}}(this))},t.prototype.update_states=function(e){var t,n,i,o,r;for(r=[],t=0,n=e.length;n>t;t++)o=e[t],o=this._encode_channel_state(o),i=this._find_state(o.channel_id),null==i?r.push(this._signed_channel_states.push(o)):this._compare_revisions(o.revision,i.revision)>=0?(i.revision=o.revision,r.push(i.token=o.token)):r.push(void 0);return r},t.prototype.start=function(){return this._started?void 0:(this._started=!0,this._long_poll())},t.prototype.unsubscribe=function(){return this._started=!1,null!=this._long_poll_xhr?this._long_poll_xhr.abort():void 0},t.prototype._long_poll=function(){return this._long_poll_xhr=this._ajax({url:this._subscribe_url(),type:"POST",data:JSON.stringify({channel_states:this._signed_channel_states}),contentType:"application/json; charset=utf-8",headers:this._additional_headers,dataType:"json",timeout:12e4,success:this._handle_poll_success,error:this._handle_poll_error,xhrFields:{withCredentials:!0}})},t.prototype._must_find_state=function(e){var t,n,i;return n=this._find_state(e),null==n&&(t="Bolt returned unknown channel id "+e,null!=(i=this._exclog)&&i.raiseAndReport(t)),n},t.prototype._handle_poll_data=function(){var e,t;return e="Method must be implemented.",null!=(t=this._exclog)?t.raiseAndReport(e):void 0},t.prototype._subscribe_url=function(){return"https://"+this._hostname+this._subscribe_endpoint()},t.prototype._subscribe_endpoint=function(){var e,t;return e="Method must be implemented.",null!=(t=this._exclog)?t.raiseAndReport(e):void 0},t.prototype._handle_poll_success=function(e,t,i){var o,r,s;return this._long_poll_xhr=null,this._started?(s=this._handle_poll_data(e,t,i),s.length>0&&this._u.defer(this._update_callback,s),(null!=(r=e.invalid_channels)?r.length:void 0)>0?void this._u.defer(this._refresh_callback,function(){var t,n,i,r;for(i=e.invalid_channels,r=[],t=0,n=i.length;n>t;t++)o=i[t],r.push(this._decode_channel_id(o));return r}.call(this)):(this._backoff_window=n,this._u.defer(this._long_poll))):void 0},t.prototype._handle_poll_error=function(e,t){var n;return this._long_poll_xhr=null,this._started?(n=Math.random()*this._backoff_window,this._backoff_window=Math.min(2*this._backoff_window,i),window.setTimeout(this._long_poll,n)):void 0},t}(),r=function(n){function i(t,n,o,r,s,a,l){null==l&&(l=null),this._handle_poll_data=e(this._handle_poll_data,this),i.__super__.constructor.call(this,t,n,o,r,s,a,l)}return t(i,n),i.prototype._subscribe_endpoint=function(){return l},i.prototype._handle_poll_data=function(e,t,n){var i,o,r,s,a,l;if(l=[],null!=e.channel_states)for(a=e.channel_states,i=0,o=a.length;o>i;i++)s=a[i],r=this._must_find_state(s.channel_id),this._compare_revisions(s.revision,r.revision)>0&&(r.revision=s.revision,r.token=s.token,l.push(this._decode_channel_state(s)));return l},i}(o),p=function(n){function i(t,n,o,r,s,a,l){null==l&&(l=null),this._handle_poll_data=e(this._handle_poll_data,this),i.__super__.constructor.call(this,t,n,o,r,s,a,l)}var o;return t(i,n),o="X-Bolt-Session",i.prototype.unsubscribe=function(){return this._additional_headers[o]=null,i.__super__.unsubscribe.call(this)},i.prototype._subscribe_endpoint=function(){return u},i.prototype._handle_poll_data=function(e,t,n){var i,r,s,l,u,d,p,_,h,m,f,v,g;if(g=[],this._additional_headers={},this._additional_headers[o]=n.getResponseHeader(o),null!=e.channel_payloads)for(f=e.channel_payloads,s=0,u=f.length;u>s;s++){for(i=f[s],_=i.channel_state,p=this._must_find_state(_.channel_id),r=this._decode_channel_state(i.channel_state),m=[],v=i.payloads,l=0,d=v.length;d>l;l++)h=v[l],this._compare_revisions(h.revision,p.revision)>0&&m.push(new c(h.revision,h.payload));m.length>0&&g.push(new a(r,m)),this._compare_revisions(_.revision,p.revision)>0&&(p.revision=_.revision,p.token=_.token)}return g},i}(o),{BoltClient:r,ThunderClient:p,ChannelId:s,SignedChannelState:d,Payload:c,ChannelPayloads:a}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/browse/browse_drag_utils",["jquery"],function(t){var n;return n={_dragEnabledChecks:[],getDraggedLink:function(n){var i,o,r,s,a,l,u,c;if(null==n)return null;if(a=e.call(n.types,"Files")>=0,i=e.call(n.types,"text/html")>=0&&t(n.getData("text/html")).attr("draggable")||e.call(n.types,"text/uri-list")>=0&&"about:blank"===n.getData("text/uri-list")||e.call(n.types,"Url")>=0&&"about:blank"===n.getData("Url"),a||i)return null;c=null;try{l=n.getData("text/x-moz-url")}catch(e){o=e}if(null!=l&&(u=l.split("\n"),u.length>=1&&(c=u[0])),!c)try{c=n.getData("text/uri-list")}catch(e){o=e}if(!c)try{c=n.getData("Url")}catch(e){}return c||(c=null),c},buildUrlLinkfileContents:function(e){return"[InternetShortcut]\r\nURL="+e+"\r\n"},isFileDragEnabled:function(){var e,t,n,i;for(i=this._dragEnabledChecks,t=0,n=i.length;n>t;t++)if(e=i[t],!e())return!1;return!0},addFileDragEnabledCheck:function(e){return this._dragEnabledChecks.push(e)},removeFileDragEnabledCheck:function(e){var t;return t=this._dragEnabledChecks.indexOf(e),t>=0?this._dragEnabledChecks.splice(t,1):void 0},removeAllFileDragEnabledChecks:function(){return this._dragEnabledChecks=[]}}})}.call(this),function(){define("modules/clean/browse_events",[],function(){var e;return e={RENDER:"db:browse:render",BEFORE_UPDATE:"db:browse:before_update",UPDATE:"db:browse:update",NEW_PAGE:"db:browse:new_page",UPDATE_RENDERED:"db:browse:update_rendered",GA_RENDERED:"db:browse:ga_rendered"}})}.call(this),function(){define("modules/clean/browse_interface",["modules/clean/viewer","modules/constants/env","modules/constants/viewer","modules/core/i18n","modules/core/uri"],function(e,t,n,i,o){var r,s,a,l,u,c,d,p,_,h;return p=t.WEBSERVER,d=n.ROLE_PERSONAL,h=i._,s="/home",_="/work",c="/personal",a="/metronome_home",u="/metronome_work",l="/metronome_personal",r={HOME_ROOT:s,WORK_ROOT:_,PERSONAL_ROOT:c,MAESTRO_HOME_ROOT:a,MAESTRO_WORK_ROOT:u,MAESTRO_PERSONAL_ROOT:l,base_prefix:"",get_browse_root:function(t,n){var i,o,r;return null==n&&(n=!1),o=n?l:c,r=n?u:_,i=n?a:s,e.get_viewer().is_paired?t.role===d?this.base_prefix+o:this.base_prefix+r:this.base_prefix+i},get_browse_root_name:function(t){return e.get_viewer().is_paired?e.get_root_name(t):h("Files")},get_all_browse_roots:function(){return e.get_viewer().get_users().map(function(e){return{name:r.get_browse_root_name(e),path:r.get_browse_root(e)}})},browse_uri_for_fq_path:function(e,t){return o({scheme:"https",authority:p,path:""+r.get_browse_root(e)+t})},set_base_prefix:function(e){return this.base_prefix=e}}})}.call(this),function(){define("modules/clean/clipboard",["jquery","modules/clean/static_urls","modules/core/dom","external/swfobject"],function(e,t,n,i){var o,r,s,a,l,u;return u=t.static_url,s=function(){var e,t;return e=(new Date).getTime(),t=("00000"+Math.floor(1e6*Math.random())).slice(-6),"swf_"+e+"_"+t},a=function(e,t){return e.on("mouseover",function(){return t.addClass("hovered")}),e.on("mousedown",function(){return t.addClass("pressed")}),e.on("mouseout",function(){return t.removeClass("hovered pressed")}),e.on("mouseup",function(){return t.removeClass("pressed")})},l=function(e,t){return window.ClipboardSWFRegister=window.ClipboardSWFRegister||{},window.ClipboardSWFRegister[e]=function(){return t()},"ClipboardSWFRegister."+e},o=function(t,o,r,c){var d,p,_;return null==r&&(r=null),null==c&&(c=null),c=c||e(document.body),_=s(),d=e("<div />",{id:"flash_copy_container"}).append(e("<div />",{id:_})).css({position:"absolute",zIndex:1}),a(d,o),c.append(d),n.clone_position(d,o,{}),p=l(_,r),window.copyLoaded=function(n){return function(){var n;return n=e("#"+_)[0],n.setCopyText(t),n.setCallbackFunction(p)}}(this),i.embedSWF(u("/static/swf/copy_clipboard-vflvMcZTC.swf"),_,"100%","100%","6.0.65",!1,!1,{wmode:"transparent",scale:"exactfit",allowScriptAccess:"always"}),d},r={clipboard_overlay:o}})}.call(this),function(){var e=[].slice;define("modules/clean/comments/action_creators",["external/underscore","external/react","modules/clean/account/email","modules/clean/account/email_verify_reasons","modules/clean/activity/activity","modules/clean/annotations/annotation","modules/clean/comments/actions","modules/clean/comments/events","modules/clean/comments/logged_out_utils","modules/clean/comments/models/immutable_file_activity","modules/clean/comments/models/pending_comment_activity","modules/clean/comments/store","modules/clean/comments/utils","modules/clean/file_activity/api","modules/clean/file_activity/clients/file_activity_data_source","external/rsvp","modules/clean/react/file_comments/onboarding","modules/clean/react/file_comments/shared_link_signup_modals","modules/clean/react/modal","modules/clean/storage","modules/constants/legacy","modules/core/exception","modules/core/i18n","modules/core/notify"],function(t,n,i,o,r,s,a,l,u,c,d,p,_,h,m,f,v,g,y,b,w,E,T,C){var S,k,I,A,P,N,R,O,D,x,L,M,F,U,B,q,W,V,H,j,G,z,K,$,Y,Z,Q,X,J;return I=i.EmailVerification,S=r.Activity,k=s.Annotation,N=f.Promise,P=y.Modal,A=b.LocalStorage,U=E.assert,R=T._,W=function(e,t,n){return null==n&&(n=!1),c.prototype.findActivityByKey.call(e,t,n)},V=function(e,n){var i,o,r,s;if(i=W(e,n,!0),null!=i)return i;for(s=e.comment_activities,o=0,r=s.length;r>o;o++)if(i=s[o],t.findWhere(i.comment_activities,{activity_key:n}))return i;return null},j=function(e){var t,n,i,o,r,s,a,l,u;return u=e.targetActivityKey,r=e.pendingCommentActivity,n=p.state.activity.activity_key,i=u===n?null:u,l=r.comment,a=l.raw_comment_text,t=l.comment_metadata,s=h.addComment({actorId:p.state.actorId,context:p.state.viewing.context,contextData:p.state.viewing.contextData,commentActivityKey:i,text:a,metadata:null!=t?t.toDict():void 0,oref:p.state.oref}),o=r.activity_key,"PENDING"!==r.status&&m.getInstance().modify(function(e){return e.updateActivityStatus(o,"PENDING")}),s.then(function(e){return m.getInstance().modify(function(t){return t.purgeActivity(o).appendActivity(u,e)})}).catch(function(e){return m.getInstance().modify(function(e){return e.updateActivityStatus(o,"FAILED")}),N.reject(e)})},O=function(t){var n,i,r,s,a,c,h,f,v,y;return v=t.targetActivityKey,y=t.text,c=t.metadata,n=_.getActivityUser(p.state.actorId),r=p.state.activity,s=r.activity_key,a=v===s?null:v,n.is_signed_in?n.is_email_verified?(h=d.build({activityUser:n,text:y,metadata:c}),f=j({targetActivityKey:v,pendingCommentActivity:h}),m.getInstance().modify(function(e){return e.appendActivity(v,h)}),h):(i=I.get_for_user(n),I.set_should_use_simple_ui(!1),void i.show_verify_modal(null,o.ADD_COMMENT)):(u.saveActionCreator({name:"addComment",fileActivityKey:s,args:e.call(arguments)}),l.emit("show-sign-up-modal",{fileActivityKey:s,variant:g.POST_COMMENT_VARIANT}),u.logSignUpModal({fileActivityKey:s,commentActivityKey:a,originType:w.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.POST_BUTTON}),void A.set("tmp-file-comment",null))},M=function(e){var t,n,i,o;return i=e.targetActivityKey,o=e.text,t=null!=(n=e.metadata)?n:null,O({targetActivityKey:i,text:o,metadata:t})},L=function(e){var t,n,i,o,r;return r=e.text,t=null!=(i=p.state.createAnnotation)?i.annotation:void 0,o=p.state.activity,U(null!=t,"Cannot add comment with annotation because no annotation is in creation."),a.stopAnnotationCreation(),n=O({targetActivityKey:o.activity_key,text:r,metadata:{annotation:t.toMetadataDict(),revision:o.latestRevision}}),K(n.activity_key)},F=function(e){var t,n;return n=e.targetActivityKey,t=e.stickerId,O({targetActivityKey:n,text:null,metadata:{stickers:{id:t}}})},B=function(e){var t,n;return t=e.commentActivityKey,U(null!=W(p.state.activity,t),"Comment activity to delete does not exist: "+t),n=h.deleteComment({actorId:p.state.actorId,context:p.state.viewing.context,contextData:p.state.viewing.contextData,commentActivityKey:t,oref:p.state.oref}),m.getInstance().modify(function(e){return e.updateDeleteActivity(t,!0)}),n.catch(function(e){return m.getInstance().modify(function(e){return e.updateDeleteActivity(t,!1)}),N.reject(e)})},Y=function(e){var t,n,i,o,r;return n=e.commentActivityKey,r=e.resolved,t=W(p.state.activity,n),U(null!=t,"Comment activity to resolve/unresolve does not exist: "+n),o=h.updateResolveComment({actorId:p.state.actorId,context:p.state.viewing.context,contextData:p.state.viewing.contextData,commentActivityKey:n,resolved:r,oref:p.state.oref}),i=t.comment.resolved,m.getInstance().modify(function(e){return e.updateResolveActivity(n,r)}),o.catch(function(e){return m.getInstance().modify(function(e){return e.updateResolveActivity(n,i)}),N.reject(e)})},$=function(t){var n,i,o,r,s,a,c,d;return o=t.commentActivityKey,a=t.liked,n=_.getActivityUser(p.state.actorId),r=p.state.activity,s=r.activity_key,i=W(r,o),U(null!=i,"Comment activity to like/unlike does not exist: "+o),n.is_signed_in?(d=h.updateLikeComment({actorId:p.state.actorId,context:p.state.viewing.context,contextData:p.state.viewing.contextData,commentActivityKey:o,liked:a,oref:p.state.oref}),c=S.prototype.isLikedBy.call(i,p.state.actorId),m.getInstance().modify(function(e){return e.updateLikeActivity(o,a,n)}),d.catch(function(e){return m.getInstance().modify(function(e){return e.updateLikeActivity(o,c,n)}),N.reject(e)})):(u.saveActionCreator({name:"setCommentLiked",fileActivityKey:s,args:e.call(arguments)}),l.emit("show-sign-up-modal",{fileActivityKey:s,variant:g.LIKE_COMMENT_VARIANT}),void u.logSignUpModal({fileActivityKey:s,commentActivityKey:o,originType:w.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.LIKE_BUTTON}))},Q=function(e){var t,n,i;return t=e.enabled,i=h.updateCommentSetting({actorId:p.state.actorId,context:p.state.viewing.context,contextData:p.state.viewing.contextData,enableComment:t,oref:p.state.oref}),n=p.state.activity.feedback_off,m.getInstance().modify(function(e){return e.updateEnableActivity(t)}),i.catch(function(e){return m.getInstance().modify(function(e){return e.updateEnableActivity(n)}),N.reject(e)})},Z=function(t){var n,i,r,s,a;return a=t.subscribed,n=_.getActivityUser(p.state.actorId),r=p.state.activity.activity_key,n.is_signed_in?n.is_email_verified?(s=h.updateFileActivitySubscription({actorId:p.state.actorId,context:p.state.viewing.context,contextData:p.state.viewing.contextData,targetUserEmail:null,subscribed:a,oref:p.state.oref}),a?s.then(function(){return C.success(R("You have been subscribed."))}).catch(function(e){return C.error(R("We failed to unsubscribe you.")),N.reject(e)}):s.then(function(){return C.success(R("You have been unsubscribed."))}).catch(function(e){return C.error(R("We failed to unsubscribe you.")),N.reject(e)})):(i=I.get_for_user(n),I.set_should_use_simple_ui(!1),void i.show_verify_modal(null,o.SUBSCRIBE_TO_COMMENTS)):(u.saveActionCreator({name:"setCommentSubscribed",fileActivityKey:r,args:e.call(arguments)}),l.emit("show-sign-up-modal",{fileActivityKey:r,variant:g.SUBSCRIBE_VARIANT}),void u.logSignUpModal({fileActivityKey:r,originType:w.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.SUBSCRIBE_BUTTON}))},H=function(e){var n,i,o,r,s,a;
return r=p.state.activity,i=r.findActivityByKey(e),null!=i&&(s=function(e){return!(e.isDeleted||e.isPending||e.is_seen)},o=i.comment_activities.filter(s),s(i)&&o.push(i),o.length>0)?(n=_.getActivityUser(p.state.actorId),a=t.pluck(o,"activity_key"),m.getInstance().modify(function(e){try{return e.setCommentSeenBatch(a,{is_seen:!0,highlight_as_unread:!1})}catch(t){return e}}),h.markCommentSeenBatch({isBackgroundRequest:!0,actorId:p.state.actorId,context:p.state.viewing.context,contextData:p.state.viewing.contextData,commentActivityKeys:a})):void 0},z=function(e){return K(e),G(e)},K=function(e){return a.highlightComment({activityKey:e})},G=function(e){var t,n,i,o,r,s,u;return o=p.state.activity,null!=o&&(i=V(o,e),null!=i&&null!=(r=i.comment.comment_metadata)?r.annotation:void 0)?(s=i.comment.comment_metadata,n=s.annotation,u=s.revision,t=k.createAnnotationFromDict(n),null!=u&&a.switchRevision({revision:u,commentActivity:i}),l.emit("reveal-annotation",{page:t.getFirstPdfPage(),commentActivity:i})):void 0},D=function(e){var t,n;return n=p.state.activity,t=_.getActivityUser(p.state.actorId),a.receiveFileActivity(e),t.is_signed_in&&null==n&&null!=e&&u.replayActionCreators({actionCreators:q,fileActivityKey:e.activity_key}),p.state.isPreviewReady&&null==n?l.emit("preview-and-comments-ready"):void 0},x=function(){var e,t;return e=p.state.actorId,t=n.createElement(v,{onOpen:function(){return a.setShouldShowOnboarding(!1),h.markCommentingOnboardingSeen({actorId:e}).catch(function(){})}}),P.showInstance(t)},J=function(){var e,t,n,i,o,r;if(e=p.state.actorId,r=p.state.shouldShowOnboarding,o=p.state.viewing,t=o.context,n=o.file,i=_.getPreviewType(t,null!=n?n.preview_type:void 0),null!=e&&null!=i){if(null==r)return h.shouldShowCommentingOnboarding({actorId:e}).then(function(e){return a.setShouldShowOnboarding(e),e?x():void 0}).catch(function(){});if(r===!0)return x()}},X=function(e){return h.setCommentingPaneVisibility({actorId:p.state.actorId,shouldShow:e})},m.getInstance(),l.on("file-activity-updated",D),q=t.extend({},a,{addComment:M,addAnnotationComment:L,addStickerComment:F,postPendingComment:j,deleteComment:B,setCommentLiked:$,setCommentResolved:Y,setCommentSubscribed:Z,setCommentsEnabled:Q,markConversationSeen:H,showOnboardingIfNecessary:J,revealComment:z,revealCommentInPane:K,revealAnnotationInPreview:G,setShowCommentsPanePref:X})})}.call(this),function(){define("modules/clean/comments/actions",["external/underscore","external/reflux"],function(e,t){return t.createActions(e.object(e.map(["stopViewingComments","showResolvedComments","hideResolvedComments","showAnnotationConversation","hideAnnotationConversation","cancelHideAnnotationConversationDelayed","showAnnotationInput","hideAnnotationInput","updateAnnotationText","updateAnnotationReplyText","startAnnotationCreation","stopAnnotationCreation","notifyPreviewReady","switchRevision","startViewingComments","hideAnnotationConversationDelayed","revealAnnotation","receiveFileActivity","showComments","hideComments","highlightComment","switchTabs","setShouldShowOnboarding","updateAnnotationReplyFocused"],function(e){return[e,{sync:!0}]})))})}.call(this),function(){define("modules/clean/comments/events",["modules/clean/event_emitter"],function(e){return new e})}.call(this),function(){define("modules/clean/comments/logged_out_utils",["modules/clean/react/file_comments/logger","modules/clean/storage","modules/constants/legacy"],function(e,t,n){var i,o,r,s,a,l,u,c;return a=t.SessionStorage,i=n.FILE_ACTIVITY_LOG_EVENT_TYPE,o="commenting_actions",s="v1",r=o+":"+s,l=function(t){var n,o,r,s;return o=t.fileActivityKey,n=null!=(s=t.commentActivityKey)?s:null,r=t.originType,e.log_event(i.CLIENT_SIGN_UP_MODAL,o,n,r)},c=function(e){var t,n,i,o,s,l,u,c;l=e.name,s=e.fileActivityKey,n=e.args;try{return c=r+":"+s,t=null!=(u=a.get(c))?u:[],t.push({name:l,args:n}),a.set(c,t)}catch(e){i=e,console.error(i)}},u=function(e){var t,n,i,o,s,l,u;t=e.actionCreators,s=e.fileActivityKey;try{return u=r+":"+s,n=null!=(l=a.get(u))?l:[],a.set(u,null),n.forEach(function(e){var n,i;return i=e.name,n=e.args,t[i].apply(t,n)})}catch(e){i=e,console.error(i)}},{logSignUpModal:l,saveActionCreator:c,replayActionCreators:u}})}.call(this);var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("modules/clean/comments/models/comment",["require","exports","modules/clean/activity/activity_user","modules/clean/datetime","external/underscore","external/immutable"],function(e,t,n,i,o,r){"use strict";var s=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.fromDict=function(e){var n=e.stickers;return new t({revision:e.revision,annotation:e.annotation,sticker_id:n?n.id:null,thumbnail_url:e.thumbnail_url})},t.prototype.toDict=function(){return o.pick({revision:this.revision,annotation:this.annotation,stickers:this.sticker_id?{id:this.sticker_id}:null,thumbnail_url:this.thumbnail_url},function(e){return null!=e})},t.prototype.hasRevisionData=function(){return null!=this.revision},t.prototype.hasAnnotationData=function(){return null!=this.annotation},t.prototype.hasStickerData=function(){return null!=this.sticker_id},t.prototype.getStickerId=function(){return this.sticker_id},t}(r.Record({revision:null,annotation:null,sticker_id:null,thumbnail_url:null}));t.CommentMetadata=s;var a=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.fromDict=function(e){var i=e.comment_meta_json;return new t({comment_gid:e.comment_gid,commenter:n.fromDict(e.commenter_dict),comment_text:e.comment_text,raw_comment_text:e.raw_comment_text,when_mses:e.when_mses,resolved:e.resolved,revision:e.revision,comment_metadata:i?s.fromDict(i):null})},t.prototype.whenPretty=function(){return i.ago(new Date(this.when_mses))},t.prototype.hasMetadata=function(){return null!=this.comment_metadata},t}(r.Record({comment_gid:null,commenter:n.anonymous,comment_text:"",raw_comment_text:"",when_mses:0,resolved:!1,comment_metadata:null}));t.Comment=a}),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/comments/models/immutable_comment_activity",["external/underscore","modules/clean/activity/activity"],function(t,n){var i,o;return i=n.CommentActivity,o=function(n){function i(){}return e(i,n),i.fromMutable=function(e){var n;return n=t.create(i.prototype,e),n.comment_activities=n.comment_activities.map(i.fromMutable),n},i.prototype.shouldHighlightAsUnread=function(){return this.highlight_as_unread?!0:this.comment_activities.some(function(e){return e.shouldHighlightAsUnread()})},i}(i)})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/comments/models/immutable_file_activity",["external/underscore","modules/core/exception","modules/clean/activity/activity","modules/clean/activity/like","modules/clean/comments/models/immutable_comment_activity","modules/clean/immutability_helper"],function(t,n,i,o,r,s){var a,l,u,c,d,p,_,h,m,f,v,g,y,b;return u=n.assert,a=i.FileActivity,g=s.updateIn,p=s.getIn,v=s.splice,f=s.push,h=s.merge,y=function(e){return t.matcher({activity_key:e})},b=t.compose(t.negate,y),_=function(e){return function(t){var n;return n=t.liker,n.id===e}},m=t.compose(t.negate,_),c=function(e,t,n){var i,o,r,s,a,l,u,c,d,p,_;if(null==n&&(n=!1),(a=y(t))(e))return[];for(d=e.comment_activities,r=o=0,u=d.length;u>o;r=++o){if(i=d[r],a(i))return["comment_activities",r];if(!n)for(p=i.comment_activities,s=l=0,c=p.length;c>l;s=++l)if(_=p[s],a(_))return["comment_activities",r,"comment_activities",s]}return null},d=function(e,t,n){var i;if(i=c(e,t,n),null==i)throw Error("Cannot find activity with the key: "+t);return i},l=function(n){function i(){}return e(i,n),i.fromMutable=function(e){var n;return n=t.create(i.prototype,e),n.comment_activities=n.comment_activities.map(r.fromMutable),n},i.prototype.findActivityByKey=function(e,t){var n;return null==t&&(t=!1),n=c(this,e,t),null!=n?p(this,n):null},i.prototype.purgeActivity=function(e){var n,i;return i=c(this,e),null==i?this:(u(i.length>0,"Cannot purge root activity"),n=i.pop(),g(this,i,t.partial(v,t,[[n,1]])))},i.prototype.updateDeleteActivity=function(e,n){var i;return i=c(this,e),null==i?this:g(this,i,t.partial(h,t,{isDeleted:n}))},i.prototype.appendActivity=function(e,n){var i;return i=d(this,e,!0),i.push("comment_activities"),g(this,i,t.partial(f,t,[n]))},i.prototype.updateResolveActivity=function(e,t){var n;return n=d(this,e),n.push("comment"),g(this,n,function(e){return e.set("resolved",t)})},i.prototype.updateLikeActivity=function(e,t,n){var i;return i=d(this,e),i.push("likes"),g(this,i,function(e){var i;return t?(i=new o({liker_dict:n,when_mses:Date.now()}),f(e,[i])):e.filter(m(n.id))})},i.prototype.updateActivityStatus=function(e,n){var i;return i=d(this,e),g(this,i,t.partial(h,t,{status:n}))},i.prototype.updateEnableActivity=function(e){return h(this,{feedback_off:!e})},i.prototype.findCommentActivities=function(e){var n,i,o,r,s,a,l,u,c;for(i={},l=this.comment_activities,o=0,s=l.length;s>o;o++)for(n=l[o],t.contains(e,n.activity_key)&&(i[n.activity_key]=n),u=n.comment_activities,r=0,a=u.length;a>r;r++)c=u[r],t.contains(e,c.activity_key)&&(i[c.activity_key]=c);return i},i.prototype.setCommentSeenBatch=function(e,t){var n,i,o,r,s,a,l;for(r=t.is_seen,i=t.highlight_as_unread,n=this,o=0,a=e.length;a>o;o++)s=e[o],l=c(this,s),null!=l&&(n=g(n,l,function(e){return h(e,{is_seen:r,highlight_as_unread:i})}));return n},i.prototype.union=function(e){var n;return n=t.indexBy(e.comment_activities,"activity_key"),e.lastSeenActivityKey=this.lastSeenActivityKey,this.comment_activities.forEach(function(t){var i,o,r;return null!=t.isPending?e.comment_activities.push(t):(i=n[t.activity_key],o=t.getPendingCommentActivities(),o.length&&null!=i?(r=i.comment_activities).push.apply(r,o):void 0)}),e},i}(a)})}.call(this),function(){define("modules/clean/comments/models/loading_spinner",[],function(){return function(e,t){return null==t||t.comment_activities.length>0?e:!1}})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/comments/models/pending_comment_activity",["external/underscore","modules/clean/activity/activity","modules/clean/comments/models/comment"],function(t,n,i){var o,r,s,a,l;return o=n.ActivityType,s=n.CommentActivity,r=i.Comment,a=i.CommentMetadata,l=function(n){function i(){}return e(i,n),i.prototype.isPending=!0,i.build=function(e){var n,s,l,u,c;return n=e.activityUser,c=e.text,u=e.metadata,s=new r({commenter:n,raw_comment_text:c,resolved:!1,when_mses:(new Date).getTime(),comment_metadata:u?a.fromDict(u):null}),l=t.extend(new i,{activity_key:t.uniqueId("pending-activity-"),status:"PENDING",activity_type:o.COMMENT,comment_activities:[],feedback_off:!1,likes:[],owner:n,comment:s,is_seen:!0,highlight_as_unread:!1})},i.prototype.shouldHighlightAsUnread=function(){return!1},i}(s)})}.call(this),function(){define("modules/clean/comments/models/preview_types",[],function(){return{PDFJS:0,IMAGE:1}})}.call(this),function(){define("modules/clean/comments/revisions",["external/underscore"],function(e){var t;return t=function(t,n){var i;return null!=t.set?(null!=t.thumbnail_url_tmpl&&(t=t.set("thumbnail_url_tmpl",n.direct_blockserver_link)),t.merge({direct_blockserver_link:n.direct_blockserver_link,sjid:null})):(i=e.clone(t),i.direct_blockserver_link=n.direct_blockserver_link,null!=i.thumbnail_url_tmpl&&(i.thumbnail_url_tmpl=n.direct_blockserver_link),i.sjid=null,i)},{getFileWithRevision:t}})}.call(this),function(){define("modules/clean/comments/store",["external/underscore","external/react","external/reflux","modules/constants/legacy","modules/core/exception","modules/core/i18n","modules/clean/activity/activity","modules/clean/annotations/annotation","modules/clean/gandalf_util","external/rsvp","modules/clean/comments/actions","modules/clean/comments/events","modules/clean/comments/models/loading_spinner","modules/clean/comments/revisions","modules/clean/comments/utils","modules/clean/react/file_viewer/actions","modules/clean/react/file_comments/logger","modules/clean/react/file_comments/comment_tab_nav"],function(e,t,n,i,o,r,s,a,l,u,c,d,p,_,h,m,f,v){var g,y,b,w,E,T,C,S;return C=o.assert,T=r._,y=s.CommentActivity,g=a.Annotation,b=u.Promise,E=v.TAB_NAV_COMMENTS,w=v.TAB_NAV_ANNOTATIONS,S=t.addons.update,n.createStore({listenables:c,init:function(){return this.state=this.getInitialState()},getInitialState:function(){var e;return e={actorId:null,viewing:{context:null,contextData:null,revision:null,file:null},activity:null,showLoadingSpinner:!0,oref:null,showResolvedComments:!1,isPreviewReady:!1,isCommentsHidden:!1,shouldTrackCollapsedState:!0,viewAnnotation:null,createAnnotation:null,annotationText:null,annotationReplyTextByKey:{},highlightedActivityKey:null,selectedTab:E,shouldShowOnboarding:void 0}},setState:function(t,n){return e.extend(this.state,t),this.trigger(this.state),"function"==typeof n?n():void 0},replaceState:function(e,t){return this.state=e,this.forceUpdate()},forceUpdate:function(){return this.trigger(this.state)},isUserSubscribed:function(e){var t,n,i,o,r;if(null!=(i=this.state.activity)?i.users_to_notify:void 0)for(o=this.state.activity.users_to_notify,t=0,n=o.length;n>t;t++)if(r=o[t],r.id===e)return!0;return!1},isCommentingEnabled:function(){return this.state.activity?!this.state.activity.feedback_off:!1},isFileActivityReady:function(){return null!=this.state.activity},canEnableComments:function(){var e;return null!=(e=this.state.activity)?e.can_edit_feedback:void 0},isStoreInitialized:function(){return!!this.state.viewing.context},onReceiveFileActivity:function(e){return null!=e&&null==this.state.viewing.revision&&(this.state.viewing.revision=e.latestRevision),this.setState({activity:e,viewAnnotation:null,createAnnotation:null})},onStartViewingComments:function(e){var t,n,i,o,r,s,a,l;return t=e.actorId,n=e.context,i=e.contextData,r=e.oref,o=e.file,s=e.previewSelector,a=e.shouldTrackCollapsedState,l=null!==this.state.contextData?p(this.state.showLoadingSpinner,this.state.activity):!0,this.setState({actorId:t,viewing:{context:n,contextData:i,file:o,revision:null},oref:r,viewAnnotation:null,createAnnotation:null,isPreviewReady:!1,showLoadingSpinner:l,isReactViewer:(null!=s?s.indexOf("react"):void 0)>=0,annotationText:null,annotationReplyTextByKey:{},shouldTrackCollapsedState:a})},onStopViewingComments:function(){return this.setState({actorId:null,activity:null,viewing:{context:null,contextData:null,revision:null,file:null},showLoadingSpinner:!0,oref:null,viewAnnotation:null,createAnnotation:null,isPreviewReady:!1,isReactViewer:!1,annotationText:null,annotationReplyTextByKey:{},shouldTrackCollapsedState:!0})},onShowResolvedComments:function(){return this.setState({showResolvedComments:!0})},onHideResolvedComments:function(){return this.setState({showResolvedComments:!1})},onHighlightComment:function(e){var t;return t=e.activityKey,this.setState({highlightedActivityKey:t,selectedTab:w},function(e){return function(){return e.setState({highlightedActivityKey:null})}}(this))},onSwitchTabs:function(e){var t;return t=e.selectedTab,this.setState({selectedTab:t})},onNotifyPreviewReady:function(){return this.setState({isPreviewReady:!0}),null!=this.state.activity?d.emit("preview-and-comments-ready"):void 0},onShowAnnotationConversation:function(e){var t,n;return n=e.annotation,t=e.activityKey,C(null!=this.state.activity,"Cannot show annotation when file activity is not ready!"),C(null!=n,"Invalid annotation to show"),C(null!=this.state.activity.findActivityByKey(t),"Invalid inline comment to show: "+t),this.onCancelHideAnnotationConversationDelayed(),this.setState({viewAnnotation:{annotation:n,activityKey:t,replyFocused:!1}})},onHideAnnotationConversation:function(){return this.onCancelHideAnnotationConversationDelayed(),this.setState({viewAnnotation:null})},onHideAnnotationConversationDelayed:function(e){var t;if(null!=this.state.viewAnnotation)return t=function(e){return function(){return e.onHideAnnotationConversation()}}(this),this.state.viewAnnotation.hideTimerId=window.setTimeout(t,e)},onCancelHideAnnotationConversationDelayed:function(){var e,t;return t=null!=(e=this.state.viewAnnotation)?e.hideTimerId:void 0,null!=t?(window.clearTimeout(t),this.state.viewAnnotation.hideTimerId=null):void 0},onUpdateAnnotationReplyFocused:function(t){var n;return null!=this.state.viewAnnotation?(n=e.extend({},this.state.viewAnnotation,{replyFocused:t}),this.setState({viewAnnotation:n})):void 0},onStartAnnotationCreation:function(e){var t;return t=e.annotation,this.setState({viewAnnotation:null,createAnnotation:{annotation:t,showBubble:!0}})},onStopAnnotationCreation:function(){return this.setState({createAnnotation:null})},onUpdateAnnotationText:function(e){return this.setState({annotationText:e})},onUpdateAnnotationReplyText:function(t){var n,i,o,r;return n=t.activityKey,r=t.text,n in this.state.annotationReplyTextByKey&&!r?(i=e.omit(this.state.annotationReplyTextByKey,n),this.setState({annotationReplyTextByKey:i})):(i=e.extend({},this.state.annotationReplyTextByKey,(o={},o[""+n]=r,o)),this.setState({annotationReplyTextByKey:i}))},onShowAnnotationInput:function(){return null!=this.state.createAnnotation?this.setState({createAnnotation:{annotation:this.state.createAnnotation.annotation,showBubble:!0}}):void 0},onHideAnnotationInput:function(){return null!=this.state.createAnnotation?this.setState({createAnnotation:{annotation:this.state.createAnnotation.annotation,showBubble:!1}}):void 0},onSwitchRevision:function(e){var t,n,o,r,s;return s=e.revision,t=e.commentActivity,C(null!=s,"Revision to switch to must not be null!"),C(null!=this.state.activity,"Cannot switch revision when file activity is not ready!"),h.isRevisionEqual(s,this.state.viewing.revision)?void 0:(h.isRevisionEqual(s,this.state.activity.latestRevision)?(this.state.isReactViewer?m.restoreRevision():d.emit("switch-revision",{revision:s,commentActivity:t}),n=i.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SWITCH_TO_LATEST_REVISION):(this.state.isReactViewer?(o=_.getFileWithRevision(this.state.viewing.file,s),m.switchRevision(o)):d.emit("switch-revision",{revision:s,commentActivity:t}),n=i.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SWITCH_TO_OLD_REVISION),this.setState({viewing:S(this.state.viewing,{revision:{$set:s}}),isPreviewReady:!1}),d.emit("revision-did-change"),f.log_annotation_event(n,this.state.activity.activity_key,null!=t?t.activity_key:void 0,this.state.actorId,this.state.viewing.context,null!=t&&null!=(r=t.comment.comment_metadata)?r.annotation:void 0))},onShowComments:function(){return this.state.shouldTrackCollapsedState?this.setState({isCommentsHidden:!1}):m.openComments()},onHideComments:function(){var t;return t={viewAnnotation:null,createAnnotation:null},this.state.shouldTrackCollapsedState?e.extend(t,{isCommentsHidden:!0}):m.closeComments(),this.setState(t)},onSetShouldShowOnboarding:function(e){return this.setState({shouldShowOnboarding:e})}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/comments/utils",["modules/clean/annotations/annotation","modules/clean/activity/activity","modules/clean/activity/activity_user","modules/clean/comments/models/preview_types","modules/clean/datetime","modules/clean/gandalf_util","modules/clean/viewer","modules/core/exception","modules/core/i18n"],function(t,n,i,o,r,s,a,l,u){var c,d,p,_,h,m,f,v,g,y,b;return d=t.Annotation,c=n.ActivityContext,p=u._,_=function(){return!0},m=function(e){var t;return t=a.get_viewer(),null!=e?i.fromUser(t.get_user_by_id(e)):t.work_user||t.personal_user?i.fromUser(t.work_user||t.personal_user):t.is_signed_in?void 0:new i},f=function(t,n){var i;if(i=[c.BROWSE_FILE_VIEWER,c.SHARED_LINK_VIEW,c.SHARED_CONTENT_LINK_VIEW],e.call(i,t)>=0&&null!=n){if("photo"===n)return o.IMAGE;if("doc"===n||"adobecs"===n)return o.PDFJS}return null},h=function(e,t){return l.assert(null!=e&&null!=t,"Revision object to compare with cannot be null!"),t.when-e.when},y=function(e,t){return h(e,t)<0},g=function(e,t){return h(e,t)>0},v=function(e,t){return 0===h(e,t)},b=function(){return this.keyCode||this.which||this.charCode},{normalizedKeyCode:b,canAnnotate:_,getActivityUser:m,getPreviewType:f,compareRevision:h,isRevisionOlderThan:y,isRevisionNewerThan:g,isRevisionEqual:v}})}.call(this),function(){define("modules/clean/components/animation",["jquery"],function(e){var t;return t=function(){function t(t){this.id=t.id,this.animationQueue=t.animationQueue,this.$el=e("#"+this.id),this.$strip=this.$el.find(".animator-strip"),this.implementationWidth=null,this.imageLoadCount=0,this.animationQueue=function(){return e.grep(arguments[0],function(e){return""!==e&&null!==e})}(this.animationQueue),this.imagesInit(),this.$strip.on("webkitAnimationEnd mozAnimationEnd MSAnimationEnd OAnimationEnd animationend",this.onAnimationEnd)}var n;return t.prototype.onAnimationEnd=function(t){return n(),e(this).removeClass("intro-animation").addClass("loop-animation"),!0},n=function(){var t,n,i;return t=e(".animator-poster").width(),n=e(".animator-frame--intro").width(),i=n-t,e(".animator-frame--intro").css("transform","translateX(-"+i+"px)")},t.prototype.setAnimationLoadClass=function(){var e;return this.imageLoadCount++,e="loop-animation",2===this.animationQueue.length&&(e="intro-animation"),this.imageLoadCount===this.animationQueue.length?this.$strip.addClass("loaded "+e):void 0},t.prototype.rescale=function(){var e,t;return this.implementationWidth||(this.implementationWidth=parseInt(this.$el.data("implementation-width"))),e=this.$el.parent().innerWidth(),e<this.implementationWidth?(t=e/this.implementationWidth,this.$el.css({transform:"scale("+t+") translateY(-"+10*t+"%)","-webkit-transform":"scale("+t+") translateY(-"+10*t+"%)","transform-origin":"bottom left"})):void 0},t.prototype.imagesInit=function(){var t,n;return n=this,t=this.$strip,this.$el.data("scale-down")===!0&&(e(window).resize(function(){return n.rescale()}),n.rescale()),t.find("img").each(function(t,i){return e(i).data("src")&&(e(i).on("load",function(){return n.setAnimationLoadClass()}),e(i).attr("src",e(i).data("src")),e(i).prop("complete"))?n.setAnimationLoadClass():void 0})},t}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function i(){this.constructor=e}for(var o in t)n.call(t,o)&&(e[o]=t[o]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},n={}.hasOwnProperty;define("modules/clean/components/bubble_menu",["jquery","modules/clean/keycode","modules/clean/components/bubble_dropdown"],function(n,i,o){var r;return r=function(o){function r(t,n,i,o){this.$root=t,this.arrow_direction=n,this.show_on_hover=i,this.top_adjustment=null!=o?o:0,this.onKeyDown=e(this.onKeyDown,this),this.onMouseEnter=e(this.onMouseEnter,this),this.$target=this.$root.find(".bubble-dropdown-target"),this.$target.on("keydown",this.onKeyDown),this.$menu=this.$root.find('*[role="menu"]'),this.$menuitems=this.$root.find('*[role="menuitem"]'),this.$menuitems.attr("role","menuitem"),this.$menuitems.on("keydown",this.onKeyDown),this.$menuitems.on("mouseenter",this.onMouseEnter),r.__super__.constructor.apply(this,arguments)}return t(r,o),r.prototype.focusPrevious=function(e){var t;return t=this.$menuitems.index(e),t=-1===t||0===t?this.$menuitems.length-1:t-1,this.$menuitems.get(t).focus()},r.prototype.focusNext=function(e){var t;return t=this.$menuitems.index(e),t=-1===t||t===this.$menuitems.length-1?0:t+1,this.$menuitems.get(t).focus()},r.prototype.onMouseEnter=function(e){return n(this.$menu).removeClass("bubble-menu--keyboard")},r.prototype.onKeyDown=function(e){return n(this.$menu).addClass("bubble-menu--keyboard"),e.keyCode===i.DOWN?(this.focusNext(e.target),e.stopPropagation(),e.preventDefault()):e.keyCode===i.UP?(this.focusPrevious(e.target),e.stopPropagation(),e.preventDefault()):void 0},r}(o)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/components/bubble_picker",["jquery","modules/clean/keycode"],function(t,n){var i;return i=function(){function i(t){this.$bubble_picker=t,this._on_button_keydown=e(this._on_button_keydown,this),this._on_option_keydown=e(this._on_option_keydown,this),this._on_option_mouseenter=e(this._on_option_mouseenter,this),this.enable_option=e(this.enable_option,this),this.disable_option=e(this.disable_option,this),this.show_dropdown=e(this.show_dropdown,this),this.hide_dropdown=e(this.hide_dropdown,this),this.set_value=e(this.set_value,this),this._listen=e(this._listen,this),this.$label_wrapper=this.$bubble_picker.find(".bubble-picker-label-wrapper"),this.$label_wrapper.on("keydown",this._on_button_keydown),this.$label=this.$bubble_picker.find(".bubble-picker-label"),this.$dropdown=this.$bubble_picker.find(".bubble-picker-dropdown"),this.$options=this.$bubble_picker.find("*[role='option']"),this.$options.on("mouseenter",this._on_option_mouseenter),this.$options.on("keydown",this._on_option_keydown),this._dropdown_shown=!1,this._listen()}return i.CHANGED="db:bubblepicker:changed",i.prototype._listen=function(){return t(document).click(function(e){return function(n){var i,o;return o=t(n.target).closest(e.$label_wrapper).length>0,i=t(n.target).closest(e.$dropdown).length>0,e._dropdown_shown&&!i?e.hide_dropdown():o?e.show_dropdown():void 0}}(this)),this.$dropdown.find(".bubble-picker-option:not('.disabled')").click(function(e){return function(n){var o,r;return n.preventDefault(),o=t(n.currentTarget),o.hasClass("disabled")?void 0:(r=e.get_value(),e.set_value(o.data("value")),e.$bubble_picker.trigger(i.CHANGED,{clicked_val:o.data("value"),old_val:r}),e.hide_dropdown(),e.$label_wrapper.focus())}}(this))},i.prototype.get_value=function(){return this.$bubble_picker.attr("data-selected-value")},i.prototype.set_value=function(e){var t;return this.$bubble_picker.attr("data-selected-value",e),this.$label.empty(),this.$bubble_picker.find(".bubble-picker-option--selected").removeClass("bubble-picker-option--selected"),t=this.$bubble_picker.find("[data-value='"+e+"']").addClass("bubble-picker-option--selected"),this.$label.html(t.clone().html())},i.prototype.hide_dropdown=function(){return this.$dropdown.hide(),this.$label_wrapper.attr("aria-expanded",!1),this._dropdown_shown=!1},i.prototype.show_dropdown=function(){var e,n;return this.$dropdown.show(),this.$label_wrapper.attr("aria-expanded",!0),this._dropdown_shown=!0,this.$options.attr({tabindex:-1,"aria-selected":!1}),n=this.$bubble_picker.attr("data-selected-value"),e=n?this.$bubble_picker.find(".bubble-picker-option[data-value='"+n+"']")[0]:this.$bubble_picker.find(".bubble-picker-option")[0],t(e).attr({tabindex:0,"aria-selected":!0}).focus()},i.prototype.disable_option=function(e,n){var i,o;return o=this.$bubble_picker.find(".bubble-picker-option[data-value="+e+"]:not('.disabled')"),o.length>0&&(i=t(o.find(".role-option")),i.attr("saved-title",i.attr("title")),i.attr("title",n),i.attr("aria-disabled",!0)),o.addClass("disabled")},i.prototype.enable_option=function(e){var n,i;return i=this.$bubble_picker.find(".bubble-picker-option.disabled[data-value="+e+"]"),n=t(i.find(".role-option")),n.attr("saved-title")&&(n.attr("title",n.attr("saved-title")),n.removeAttr("saved-title")),n.attr("aria-disabled",!1),i.removeClass("disabled")},i.prototype._change_focus=function(e,n){return t(e).attr({tabindex:-1,"aria-selected":!1}),t(n).attr({tabindex:0,"aria-selected":!0}).focus()},i.prototype._focus_previous=function(e){var t;return t=this.$options.index(e),t>0?this._change_focus(e,this.$options.get(t-1)):void 0},i.prototype._focus_next=function(e){var t;return t=this.$options.index(e),t<this.$options.length-1?this._change_focus(e,this.$options.get(t+1)):void 0},i.prototype._on_option_mouseenter=function(e){return this.$dropdown.removeClass("bubble-picker-dropdown--keyboard")},i.prototype._on_option_keydown=function(e){this.$dropdown.addClass("bubble-picker-dropdown--keyboard"),e.keyCode===n.ESC?(this.hide_dropdown(),this.$label_wrapper.focus()):e.keyCode===n.DOWN?(this._focus_next(e.target),e.preventDefault()):e.keyCode===n.UP?(this._focus_previous(e.target),e.preventDefault()):e.keyCode!==n.TAB||e.shiftKey||this.hide_dropdown()},i.prototype._on_button_keydown=function(e){e.keyCode===n.ENTER?this.$dropdown.addClass("bubble-picker-dropdown--keyboard"):e.keyCode===n.TAB&&e.shiftKey&&this.hide_dropdown()},i}()})}.call(this),function(){define("modules/clean/components/expanding_section",["jquery","modules/clean/analytics"],function(e,t){var n;return n=function(){function n(t,n,i,o,r){this.$parent=e("#"+t),n&&(this.$scrollElement=e(""+n)),this.scrollElementOffset=i||0,this.expandingSectionAnalyticsId=o,this.defaultOffset=95,this.toggledState=!1,r?this.$toggleButton=e(r):this.$toggleButton=this.$parent.find(".expanding-section__button"),this.closeButton=this.$parent.find(".expanding-section__button-close"),this._setupClickHandlers()}return n.prototype._setupClickHandlers=function(){var e,t;return e=function(e){return function(t){return t.preventDefault(),e._scrollToSection(),e._expandSection(),e.expandingSectionAnalyticsId&&e._logAnalyticsTracking(),!0}}(this),t=function(e){return function(t){return t.preventDefault(),e._expandSection(),!0}}(this),this.$toggleButton.on("click",e),this.closeButton.length>0&&this.closeButton.on("click",t),!0},n.prototype._scrollToSection=function(){var t;return t=this.$parent.offset().top-this.scrollElementOffset-this.defaultOffset,this.$scrollElement&&(t=this.$parent.find(this.$scrollElement).offset().top-this.scrollElementOffset+"px"),this.toggledState||e("html, body").animate({scrollTop:t}),t},n.prototype._expandSection=function(){var e;return e=0,this.toggledState?(e=0,this.toggledState=!1):(e=this.$parent.find(".expanding-section__content-container").outerHeight(!0),this.toggledState=!0),this.$parent.find(".expanding-section__content").css("max-height",e),this.$toggleButton.blur().toggleClass("button-toggled"),this},n.prototype._logAnalyticsTracking=function(){t.TeamsWebActionsLogger.log(this.expandingSectionAnalyticsId)},n}()})}.call(this),function(){define("modules/clean/components/loading_indicator",["external/underscore","external/react","modules/core/accessible_announce","modules/core/i18n"],function(e,t,n,i){var o,r,s,a,l;return s=i._,l=t.DOM,a=t.addons.classSet,r={DOTS:"dots",SPINNER:"spinner",BLUE_SPINNER:"blue_spinner"},o=t.createClass({displayName:"LoadingIndicator",statics:{LoadingIndicatorStyle:r},propTypes:{style:t.PropTypes.oneOf(e.values(r)),className:t.PropTypes.string,startMessage:t.PropTypes.string,finishMessage:t.PropTypes.string,shouldAnnounceMessage:t.PropTypes.bool},getDefaultProps:function(){return{style:r.DOTS,className:"",startMessage:s("Loading…"),finishMessage:null,shouldAnnounceMessage:!0}},componentDidMount:function(){return this.props.shouldAnnounceMessage?n.polite(this.props.startMessage):void 0},componentWillUnmount:function(){return this.props.finishMessage&&this.props.shouldAnnounceMessage?n.polite(this.props.finishMessage):void 0},render:function(){var t;return t={},this.props.className&&(t=e.object(this.props.className.split(" ").map(function(e){return[e,!0]}))),t=e.extend(t,{"c-loader":!0,"c-loader--spinner":this.props.style===r.SPINNER,"c-loader--spinner--blue":this.props.style===r.BLUE_SPINNER}),l.div({className:a(t)},this.props.startMessage)}})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments);
}};define("modules/clean/components/locale_selector",["jquery","modules/constants/request","modules/core/cookies","modules/core/dom"],function(t,n,i,o){var r;return r=function(){function r(n,i,o,r){var s;null==o&&(o=!1),null==r&&(r=!1),this._localeSelected=e(this._localeSelected,this),this._keydownHandler=e(this._keydownHandler,this),this._hideModal=e(this._hideModal,this),this._showModal=e(this._showModal,this),this._showInline=e(this._showInline,this),this.$document=t(document),this.$container=t(n),s=t(i),this.is_inline=o,this.action=r?"/team/admin/set_locale":"/set_locale",this.is_inline?(this.$locale_table=this.$container.find(".locale-selector__table"),s.on("click",this._showInline),this.$locale_links=this.$locale_table.find(".locale-option"),this.$locale_links.one("click",this._localeSelected)):(this.$modal_holder=this.$container.find("#db-modal-locale-selector-modal"),this.$db_modal_x=this.$modal_holder.find(".db-modal-x"),this.$db_modal_overlay=this.$modal_holder.find(".db-modal-overlay"),this.$modal=this.$modal_holder.find(".db-modal"),s.on("click",this._showModal),this.$locale_links=this.$modal.find(".locale-option"))}return r.prototype._showInline=function(e){return e.preventDefault(),this.$locale_table.show(),this.$container.find(".locale-link__link").addClass("active")},r.prototype._showModal=function(e){return e.preventDefault(),this.$db_modal_x.one("click",this._hideModal),this.$db_modal_overlay.one("click",this._hideModal),this.$document.one("keydown",this._keydownHandler),this.$modal_holder.show(),this.$locale_links.one("click",this._localeSelected),o.scroll_lock_document()},r.prototype._hideModal=function(e){return e.preventDefault(),this.$modal_holder.hide(),o.scroll_unlock_document()},r.prototype._keydownHandler=function(e){return 27===e.keyCode?this._hideModal(e):void 0},r.prototype._localeSelected=function(e){return this.is_inline||this._hideModal(e),t("<form/>",{action:this.action,method:"POST"}).append(this._hiddenField("locale",t(e.target).data("locale"))).append(this._hiddenField("locale_cont",window.location.pathname)).append(this._hiddenField("t",i.read(n.JS_CSRF_COOKIE))).appendTo("body").submit(),!1},r.prototype._hiddenField=function(e,n){return t("<input/>",{type:"hidden",name:e,value:n})},r}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},n=function(e,t){function n(){this.constructor=e}for(var o in t)i.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},i={}.hasOwnProperty;define("modules/clean/components/role_picker",["external/underscore","modules/constants/viewer","modules/core/controller_helpers","modules/core/exception","modules/clean/multiaccount_login","modules/clean/page_role_observer","modules/clean/viewer"],function(i,o,r,s,a,l,u){var c,d,p,_,h,m,f,v;return d=o.ROLE_PERSONAL,p=o.ROLE_PHOTOS,_=o.ROLE_WORK,v=s.assert,m={ALL:"all",PERSONAL:d,WORK:_},h=function(){function n(n){var o,r,s,a,l,c;null==n&&(n={}),this._actually_set_state=e(this._actually_set_state,this),this._do_login=e(this._do_login,this),this.is_user_visible=e(this.is_user_visible,this),this.is_role_visible=e(this.is_role_visible,this),this.ensure_role_is_visible=e(this.ensure_role_is_visible,this),this.set_state=e(this.set_state,this),this.get_state=e(this.get_state,this),this._allow_merged_state=null!=n.allow_merged_state?n.allow_merged_state:!0,this._limit_to_role=null!=n.limit_to_role?n.limit_to_role:null,c=u.get_viewer(),r=c.is_role_signed_in(m.PERSONAL)&&c.is_role_signed_in(m.WORK),n.initial_state?(a=i.values(m),v((s=n.initial_state,t.call(a,s)>=0),"RolePicker requires initial_state to be one of: "+a),this.set_state(n.initial_state)):this._allow_merged_state&&r?this.set_state(m.ALL):(o=c.get_users(),v(o.length,"tried to use RolePicker on a page with no users"),l=o[0],this.set_state(l.role))}return n.prototype.get_state=function(){return this._state},n.prototype.set_state=function(e){var t,n,i,o;if(v(this._allow_merged_state||e!==m.ALL,"tried to set merged state in non-merged picker"),null!=this._limit_to_role&&v(e===m.ALL||e===this._limit_to_role),e===m.ALL){for(i=[d,_,p],t=0,n=i.length;n>t;t++)if(o=i[t],!u.get_viewer().is_role_signed_in(o))return void this._do_login(o,e)}else if(o=e,!u.get_viewer().is_role_signed_in(o))return void this._do_login(o,e);return this._actually_set_state(e)},n.prototype.update_picker_ui=function(){},n.prototype.ensure_role_is_visible=function(e){return this.is_role_visible(e)?void 0:this._allow_merged_state?this.set_state(m.ALL):this.set_state(e)},n.prototype.is_role_visible=function(e){return this._state===m.ALL||this._state===e},n.prototype.is_user_visible=function(e){return this.is_role_visible(e.role)},n.prototype._do_login=function(e,t){return a.show_modal({role:e,on_success:function(e){return function(){return e._actually_set_state(t)}}(this)})},n.prototype._actually_set_state=function(e){return e!==this._state?(this._state=e,this.update_picker_ui(),"function"==typeof this.on_state_change?this.on_state_change(e):void 0):void 0},n}(),f=function(t){function i(t,n){this.$container=t,null==n&&(n={}),this.limit_to_role=e(this.limit_to_role,this),this.update_picker_ui=e(this.update_picker_ui,this),this.on_ui_change=e(this.on_ui_change,this),this.$bubble_picker=this.$container.find(".bubble-picker"),this.$bubble_picker.on("db:bubblepicker:changed",this.on_ui_change),i.__super__.constructor.call(this,n)}return n(i,t),i.prototype.on_ui_change=function(e,t){var n;return n=t.clicked_val,n!==this._state?(r.get_controller(this.$bubble_picker).set_value(this._state),this.set_state(n)):void 0},i.prototype.update_picker_ui=function(){return r.get_controller(this.$bubble_picker).set_value(this._state)},i.prototype.limit_to_role=function(e,t){var n,i;if(null!=e){this.ensure_role_is_visible(e);for(n in m)i=m[n],i!==e&&i!==m.ALL&&r.get_controller(this.$bubble_picker).disable_option(i,t)}else for(n in m)i=m[n],r.get_controller(this.$bubble_picker).enable_option(i);return this._limit_to_role=e},i}(h),c=function(e){function t(e,n){null==n&&(n={}),n.allow_merged_state=!1,t.__super__.constructor.call(this,e,n)}return n(t,e),t.prototype.on_state_change=function(e){var t;return t=function(){switch(e){case m.PERSONAL:return d;case m.WORK:return _}}(),l.emit(t)},t}(f),{RolePickerState:m,RolePicker:h,RoleSelect:f,PageRoleSelect:c}})}.call(this),function(){define("modules/clean/components/scooter/badge",["external/classnames","external/react","external/underscore"],function(e,t,n){var i,o;return o={TOP_RIGHT:"TOP_RIGHT"},i=t.createClass({statics:{POSITIONS:o},displayName:"Badge",propTypes:{count:t.PropTypes.number.isRequired,position:t.PropTypes.oneOf(n.values(o))},render:function(){var n,i;return 0===this.props.count?null:(i=t.DOM.div,n=e({"c-badge":!0,"c-badge--top-right":this.props.position===o.TOP_RIGHT}),i({className:n,"aria-hidden":!0},this.props.count))}})})}.call(this),function(){define("modules/clean/components/title_bubble",["jquery","external/classnames","external/react","modules/clean/react/css"],function(e,t,n,i){var o,r;return r=n.DOM,o=n.createClass({displayName:"TitleBubble",propTypes:{text:n.PropTypes.string.isRequired,direction:n.PropTypes.oneOf(["north","south","east","west"]).isRequired,onMouseEnter:n.PropTypes.func,respectLineBreaks:n.PropTypes.bool,className:n.PropTypes.string},getInitialState:function(){return{isChildFocused:!1}},componentDidMount:function(){return e(this.getDOMNode()).on("focusin.title-bubble",function(e){return function(t){return e.setState({isChildFocused:!0})}}(this)).on("focusout.title-bubble",function(e){return function(t){return e.setState({isChildFocused:!1})}}(this)).on("mouseenter.title-bubble",function(e){return function(){var t;return"function"==typeof(t=e.props).onMouseEnter?t.onMouseEnter():void 0}}(this))},componentWillUnmount:function(){return e(this.getDOMNode()).off("focusin.title-bubble").off("focusout.title-bubble").off("mouseenter.title-bubble")},render:function(){var e;return e={"c-title-bubble":!0,"is-child-focused":this.state.isChildFocused,"c-title-bubble--respect-line-break":this.props.respectLineBreaks},e["c-title-bubble--"+this.props.direction.slice(0,1)]=!0,r.div({className:t([e,this.props.className]),"data-title":this.props.text,onClick:function(e){return function(t){return t.detail>0?e.setState({isChildFocused:!1}):void 0}}(this)},n.Children.only(this.props.children))}}),o=i(o,["/static/css/scooter/scooter-scoped-vfljb_RbQ.css"])})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/contacts/bloodhound_contacts",["jquery","external/typeahead.bundle","external/underscore","modules/clean/ajax","modules/clean/contacts/cache","modules/clean/contacts/list","modules/clean/profile_services/profile_services_link","modules/clean/viewer","modules/constants/contacts","modules/constants/request","modules/core/cookies","modules/core/exception","modules/core/uri"],function(t,n,i,o,r,s,a,l,u,c,d,p,_){var h,m,f,v,g;return m=r.DefaultContactsCache,f=r.LimitedContactsCache,v=a.LinkedProfileServices,g=p.assert,h=function(){function t(t,n,i){var o,r,s,a,p,h;for(this.contacts_filter=null!=t?t:null,this.for_user=null!=n?n:null,this.limit=null!=i?i:10,this._get=e(this._get,this),this.server_search=u.SERVER_SEARCH_ALLOWED,p=null,this.server_search&&(p={url:"/contacts/search",replace:function(e,t){return g(!e.startsWith("//")&&e.startsWith("/"),"Request to non dropbox domain."),t.query=JSON.stringify(t.query),_({path:e,query:t}).toString()},rateLimitWait:300,ajax:{type:"post",headers:{"X-CSRF-Token":d.read(c.JS_CSRF_COOKIE)}},filter:function(e){return e.contacts}}),this.contacts=new Bloodhound({datumTokenizer:function(e){return[e.name,e.email,e.fname,e.lname].concat(e.name_tokens)},queryTokenizer:function(e){return e.query},dupDetector:function(e,t){return e.unique_key===t.unique_key},limit:this.limit,sorter:this._contacts_sorter,local:[],sufficient:15,remote:p}),this.contacts.initialize(),this.sortedContacts=[],this.extraContacts=[],this._batchGetQueue=[],this._getRequest=null,this._updatedCallbacks=[],this.server_search?this.contacts_cache=f:this.contacts_cache=m,l.get_viewer().is_signed_in&&this.contacts_cache.load_contacts(!1,function(e){return function(t){return e._init_contacts(t)}}(this)),a=l.get_viewer().get_users(),o=0,r=a.length;r>o;o++)h=a[o],s=v.get_linked_profile_services_for_user(h.id),s.register_for_service_changes("bloodhound_contacts",function(e){return function(t){return e.contacts.clearRemoteCache()}}(this))}return t.prototype._contacts_sorter=function(e,t){return e.priority>t.priority?-1:e.priority<t.priority?1:0},t.prototype._init_contacts=function(e){return this._update_contacts(e),this.contacts_cache.register_for_updates("bloodhound_contacts",function(e){return function(t){return e._update_contacts(t)}}(this))},t.prototype._filter_contacts=function(e){var t;return t=null!=this.for_user&&l.get_viewer().is_user_signed_in(this.for_user)?e.includeForUser(this.for_user.id):e.excludePairedUserDuplicates(),this.contacts_filter&&(t=t.filterContacts(this.contacts_filter)),t.contacts},t.prototype._update_contacts=function(e){var t,n,i,o,r,s,a,l;for(this.contacts.clearRemoteCache(),this.contacts.clear(),i=this._filter_contacts(e),this.contacts.add(i),s=this._dedupe_extra_contacts(),this.contacts.add(s),n=i.concat(s),n.sort(function(e){return function(t,n){return e._contacts_sorter(t,n)}}(this)),this.sortedContacts=n.slice(0,this.limit),a=this._updatedCallbacks,l=[],o=0,r=a.length;r>o;o++)t=a[o],l.push("function"==typeof t?t():void 0);return l},t.prototype.setExtraContacts=function(e){return this.extraContacts=e},t.prototype._dedupe_extra_contacts=function(){var e,t,n,i,o,r;for(t=this.contacts.index.datums,i={},n={},o=0,r=t.length;r>o;o++)e=t[o],i[e.email]=!0,n[e.dbx_account_id]=!0;return this.extraContacts.filter(function(e){return!n[e.dbx_account_id]&&!i[e.email]})},t.prototype._add_request=function(e,t){var n,i,o;return o=Boolean(0===this._batchGetQueue.length&&null===this._getRequest),i=Array.isArray(e),n={query:i?e:e.trim().split(/\s+/),callback:t,match_any:i,blocking:!0},n.match_any?this._batchGetQueue.push(n):this._getRequest=n,o},t.prototype._next_get_request=function(){var e;return e=null,null!=this._getRequest?(e=this._getRequest,this._getRequest=null):this._batchGetQueue.length>0&&(e=this._batchGetQueue[0],this._batchGetQueue.splice(0,1)),e},t.prototype._get=function(){var e,t,n,o,r,a,l;if(t=this._next_get_request()){if(e=function(e){return function(n){var i;return i=s.create_contacts_list(n),"function"==typeof t.callback&&t.callback(e._filter_contacts(i)),e._get()}}(this),this.server_search||!t.match_any)return this.contacts.get(i.omit(t,"callback"),e);for(r=[],l=t.query,n=0,o=l.length;o>n;n++)a=l[n],this.contacts.get({query:[a]},function(e){return r.push.apply(r,e)});return e(r)}},t.prototype.get=function(e,t){var n;return g(Array.isArray(e)||i.isString(e)),n=this._add_request(e,t),n?this.server_search||this.contacts_cache.is_loaded()?this._get():this.contacts_cache.load_contacts(!1,this._get):void 0},t.prototype.registerForUpdates=function(e){return this._updatedCallbacks.push(e)},t}()})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/contacts/cache",["jquery","modules/core/exception","modules/clean/ajax","modules/clean/contacts/list","modules/clean/profile_services/profile_services_constants","modules/clean/viewer","modules/constants/contacts"],function(t,n,i,o,r,s,a){var l,u,c,d,p,_,h,m,f;return f=n.assert,u=1e3,l=function(){function t(){this.callbacks={},this.one_time_callbacks=[]}return t.prototype.add_one_time_callback=function(t){return null!=t&&e.call(this.one_time_callbacks,t)<0?this.one_time_callbacks.push(t):void 0},t.prototype.register_for_updates=function(e,t){return this.callbacks[e]=t},t.prototype.unregister_for_updates=function(e){return null!=this.callbacks[e]?delete this.callbacks[e]:void 0},t.prototype.invoke_all_callbacks=function(e){return this._invoke_callbacks(this.one_time_callbacks,e,!0),this._invoke_callbacks(this.callbacks,e,!1)},t.prototype.invoke_one_time_callbacks=function(e){return this._invoke_callbacks(this.one_time_callbacks,e,!0)},t.prototype._invoke_callbacks=function(e,t,n){var i,o,r,s,a;for(s=Object.keys(e),a=[],i=0,r=s.length;r>i;i++)o=s[i],e[o](t),n?a.push(delete e[o]):a.push(void 0);return a},t}(),m=function(){function e(n,i){this.limit=null!=n?n:null,this.max_polls=null!=i?i:u,this.loading_state=e.HAVENT_LOADED,this.callback_manager=new l,this.digest=null,this.poll_counter=0,t(document).on("db:profile_service:auth_complete",function(e){return function(){return e.load_contacts(!0)}}(this)),t(document).on("db:profile_service:deauth_complete",function(e){return function(){return e.load_contacts(!0)}}(this))}return e.HAVENT_LOADED=0,e.LOADING_NONE_AVAILABLE=1,e.LOADED=2,e.prototype.register_for_updates=function(e,t){return this.callback_manager.register_for_updates(e,t)},e.prototype.unregister_for_updates=function(e){return this.callback_manager.unregister_for_updates(e)},e.prototype.is_loaded=function(){return this.loading_state===e.LOADED},e.prototype.load_contacts=function(t,n){return s.get_viewer().is_signed_in&&(this.callback_manager.add_one_time_callback(n),this.loading_state!==e.LOADING_NONE_AVAILABLE)?(t&&(this.poll_counter=0),this.loading_state===e.HAVENT_LOADED&&(this.loading_state=e.LOADING_NONE_AVAILABLE),this._schedule_fetch(!0)):void 0},e.prototype._schedule_fetch=function(e){var t,n;return null==e&&(e=!1),window.clearTimeout(this.timer),t=function(e){return function(){return e._fetch_contacts()}}(this),e?t():(n=this._get_next_interval(),null!=n?this.timer=window.setTimeout(t,n):void 0)},e.prototype._fetch_contacts=function(){return i.BackgroundRequest({url:this._get_request_url(),data:this._get_request_params(),success:function(e){return function(t,n,i){var o;return o=JSON.parse(t),e._contacts_loaded_callback(o),e._schedule_fetch()}}(this)})},e.prototype._get_next_interval=function(){return this.poll_counter+=1,this.poll_counter<15?1e3*this.poll_counter:this.poll_counter>this.max_polls?null:this._is_page_hidden()?36e5:6e4},e.prototype._is_page_hidden=function(){return null!=window.document.visibilityState&&window.document.hidden},e.prototype._contacts_loaded_callback=function(t){return t.up_to_date?void(null!=this.cached_contacts&&this.callback_manager.invoke_one_time_callbacks(this.cached_contacts)):(f(null!=t.contacts,"Contacts result should always have either contacts or up_to_date"),t.contacts.length?(this.digest=t.digest,this.cached_contacts=o.create_contacts_list(t.contacts),this.loading_state=e.LOADED,this.callback_manager.invoke_all_callbacks(this.cached_contacts)):void 0)},e.prototype._get_request_params=function(){var e;return e={version:0},this.limit&&(e.limit=this.limit),this.digest&&(e.digest=this.digest),e},e.prototype._get_request_url=function(){return null!=this.digest?"/contacts/check":"/contacts/get"},e}(),c=new m,p=500,h=new m(p),"OFF"===a.LEGACY_CACHE_LIMIT?_=c:(d=+a.LEGACY_CACHE_LIMIT,_=new m(d)),{DefaultContactsCache:c,LegacyContactsCache:_,LimitedContactsCache:h,PollingContactsCache:m}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/contacts/data",["external/underscore","modules/core/exception","modules/clean/contacts/bloodhound_contacts","modules/clean/contacts/cache","modules/clean/contacts/list","modules/clean/contacts/types","modules/clean/fuzzy","modules/clean/viewer"],function(n,i,o,r,s,a,l,u){var c,d,p,_;return _=i.assert,p=r.DefaultContactsCache,c=function(){function e(e){this.dbx_account_id=e.dbx_account_id,this.type=e.type,this.name=e.name,this.email=e.email,this.fb_id=e.fb_id,this.group_id=e.group_id,this.photo_url=e.photo_url,this.members=e.members,this.avatar_url=e.avatar_url,this.invalid=e.invalid,this.on_team=e.on_team,this.dbx_team_id=e.dbx_team_id,this.nameMatch=e.nameMatch,this.emailMatch=e.emailMatch,this.pending=e.pending,this.unique_key=e.unique_key,null!=this.unique_key&&""!==this.unique_key||(this.unique_key=this.getContactID())}return e.prototype.getKey=function(){return"contact-"+this.type+"-"+this.unique_key},e.prototype.getContactID=function(){switch(this.type){case a.FB:return this.fb_id;case a.NEW_STYLE_GROUP:return this.group_id;default:return this.email}},e}(),d=function(){function i(t){var n;this.user=t.user,this.filterFunc=t.filterFunc,this._set_contacts=e(this._set_contacts,this),_(this.user,"must include user"),null==this.filterFunc&&(this.filterFunc=function(){return!0}),this.instance=i.INSTANCE++,n="contacts-data-source:"+this.instance,p.register_for_updates(n,this._set_contacts),this._team_members=[],this.bloodhound_contacts=new o(this.filterFunc,this.user,1e5)}return i.INSTANCE=0,i.prototype._set_contacts=function(e){var t;return this.user.is_team?(t=e.excludeNonTeam().contacts,this._team_members=n.map(t,function(e){return e.email})):void 0},i.prototype.registerForUpdates=function(e){return this.bloodhound_contacts.registerForUpdates(e)},i.prototype._isTeamContact=function(e){return this.user.is_team&&null!=e.team&&e.team},i.prototype.isTeamEmail=function(e){return this.user.is_team&&t.call(this._team_members,e)>=0},i.prototype._process_matches=function(e,t,n){var i,o,r,u,d,p;for(null==n&&(n=null),o=[],p=s.create_contacts_list(e).includeForUser(this.user.id).contacts,r=0,u=p.length;u>r;r++)d=p[r],n&&(d.nameMatch=l.match(n,d.name||""),d.emailMatch=l.match(n,d.email||"")),d.on_team=d.type!==a.FB&&this._isTeamContact(d),i=new c(d),i.pending=!1,o.push(i);return t(o)},i.prototype.query=function(e,t){return""===e.trim()?t([]):this.bloodhound_contacts.get(e,function(n){return function(i){return n._process_matches(i,t,e)}}(this))},i.prototype.query_batch=function(e,t){var i,o,r,s,a,l;for(r={},s=0,a=e.length;a>s;s++)i=e[s],i.pending=!1,r[i.getContactID()]=i;return o=function(e){var n,i,o;for(i=0,o=e.length;o>i;i++)n=e[i],r[n.getContactID()]=n;return t(r)},l=function(e){return function(t){return e._process_matches(t,o)}}(this),this.bloodhound_contacts.get(n.keys(r),l)},i}(),{Contact:c,ContactTypes:a,ContactsDataSource:d}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function i(){this.constructor=e}for(var o in t)n.call(t,o)&&(e[o]=t[o]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},n={}.hasOwnProperty;define("modules/clean/contacts/facebook_modal",["modules/clean/dbmodal"],function(n){var i,o;return i=n.DBUserModal,o=function(n){function i(t,n,o){this.show_hidden_modal=n,this.link_with_facebook=o,this.on_confirm_button_click=e(this.on_confirm_button_click,this),this.on_hide=e(this.on_hide,this),i.__super__.constructor.call(this,t,{element_id:"facebook-confirm-modal-user-"+t.id})}return t(i,n),i.prototype.on_hide=function(){return"function"==typeof this.show_hidden_modal?this.show_hidden_modal():void 0},i.prototype.on_confirm_button_click=function(e){return this.hide(),this.link_with_facebook()},i}(i)})}.call(this),function(){define("modules/clean/contacts/facebook_oauth",["jquery","modules/core/exception","modules/core/uri","modules/clean/ajax","modules/clean/viewer","modules/constants/viewer"],function(e,t,n,i,o,r){var s,a;return a=t.assert,s={do_auth:function(e,t){var i;return a(null!=t,"user_id must be specified"),i=window.open(n({path:"/fb/access_token"}).updateQuery(r.UID_PARAM_NAME,t).toString(),"fb_auth","width=600,height=450"),e?s.onLoginSuccessCallback=e:void 0},post:function(e,t,r,l,u,c,d){return a(null!=d,"user_id must be specified!"),o.get_viewer().is_signed_in?("function"==typeof s.custom_show_posting&&s.custom_show_posting(),new i.WebRequest({url:"/fb/post",data:{message:e,link:t,link_name:r,description:l,from_referrals:s.from_referrals,from_getspace:s.from_getspace,picture:u?u:""},success:function(n,i,o){var a;return a=o.responseText,0===a.indexOf("ok")?"function"==typeof s.custom_show_complete?s.custom_show_complete():void 0:0===a.indexOf("auth")?s.do_auth(function(){return s.post(e,t,r,l,u,c,d)},d):void 0},error:function(){return"function"==typeof c?c():void 0},subject_user:d})):void window.open(n.parse("http://www.facebook.com/sharer.php").setQuery({u:t,t:r}).toString())}}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/contacts/list",["jquery","modules/clean/em_string","modules/clean/contacts/types"],function(n,i,o){var r;return r=function(){function n(t){var n;this.contacts=t,this._lowercaseContact=e(this._lowercaseContact,this),this._excludeType=e(this._excludeType,this),this.sortByTeamFirst=e(this.sortByTeamFirst,this),this.excludeSuspended=e(this.excludeSuspended,this),this.excludeNonTeamActive=e(this.excludeNonTeamActive,this),this.excludeNonTeam=e(this.excludeNonTeam,this),this.excludePairedUserDuplicates=e(this.excludePairedUserDuplicates,this),this.excludeTeamMembers=e(this.excludeTeamMembers,this),this.excludeFacebook=e(this.excludeFacebook,this),this.excludeNewStyleGroups=e(this.excludeNewStyleGroups,this),this.excludeMe=e(this.excludeMe,this),this.excludeByEmail=e(this.excludeByEmail,this),this.includeForViewer=e(this.includeForViewer,this),this.includeForUser=e(this.includeForUser,this),this.slice=e(this.slice,this),this.length=e(this.length,this),this.filterContacts=e(this.filterContacts,this),this.lcontacts=function(){var e,t,i,o;for(i=this.contacts,o=[],e=0,t=i.length;t>e;e++)n=i[e],o.push(this._lowercaseContact(n));return o}.call(this)}return n._format_contact_array=function(e){var t,n,o,r;for(t=22,o=0,r=e.length;r>o;o++)n=e[o],null!=n.email&&(n.email_snippet=i.em_snippet(n.email,t)),null!=n.name&&(n.name=i.em_snippet(n.name,t));return e},n.create_contacts_list=function(e){return e=n._format_contact_array(e),new n(e)},n.prototype.filterContacts=function(e){var t;return t=this.contacts.filter(e),new n(t)},n.prototype.length=function(){return this.contacts.length},n.prototype.slice=function(e,t){return new n(this.contacts.slice(e,t))},n.prototype.includeForUser=function(e){return this.filterContacts(function(t){return t.owning_user_id===e})},n.prototype.includeForViewer=function(e){var n;return n=e.get_user_ids(),this.filterContacts(function(e){var i;return i=e.owning_user_id,t.call(n,i)>=0})},n.prototype.excludeByEmail=function(e){return e=e?e.toLowerCase():"",this.filterContacts(function(t){return!(e===t.email.toLowerCase())})},n.prototype.excludeMe=function(){return this.filterContacts(function(e){return!e.is_owner})},n.prototype.excludeNewStyleGroups=function(){return this._excludeType(o.NEW_STYLE_GROUP)},n.prototype.excludeFacebook=function(){return this._excludeType(o.FB)},n.prototype.excludeTeamMembers=function(){return this.filterContacts(function(e){return!e.team})},n.prototype.excludePairedUserDuplicates=function(){return this.filterContacts(function(e){return!e.paired_user_duplicate})},n.prototype.excludeNonTeam=function(){return this.filterContacts(function(e){return e.team})},n.prototype.excludeNonTeamActive=function(){return this.filterContacts(function(e){return e.team&&"active"===e.join_state})},n.prototype.excludeSuspended=function(){return this.filterContacts(function(e){return"suspended"!==e.join_state})},n.prototype.sortByTeamFirst=function(){return new n(n.sortContactsByTeamFirst(this.contacts))},n.sortContactsByTeamFirst=function(e){var t,n,i,o,r;for(r=[],o=[],n=0,i=e.length;i>n;n++)t=e[n],t.team?r.push(t):o.push(t);return r.concat(o)},n.prototype._excludeType=function(e){return this.filterContacts(function(t){return t.type!==e})},n.prototype._lowercaseContact=function(e){var t,n,i;n={};for(t in e)i=e[t],("string"==typeof i||i instanceof String)&&(i=i.toLowerCase()),n[t]=i;return n},n}()})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/contacts/tokenizer",["external/react","external/underscore","modules/core/i18n","modules/clean/analytics","modules/clean/avatar/contact_avatar","modules/clean/contacts/data","modules/clean/contacts/typeahead","modules/clean/contacts/types","modules/clean/em_string","modules/clean/react/sprite","modules/clean/tokenizer","modules/clean/validators/validators","jquery"],function(t,n,i,o,r,s,a,l,u,c,d,p,_){var h,m,f,v,g,y,b,w,E,T,C,S,k,I,A,P;return C=i._,m=o.ContactSearchLogger,h=s.Contact,g=s.ContactsDataSource,w=a.ContactsTypeaheadSelector,T=d.Tokenizer,S=t.createElement,k=t.DOM,E=16,P=p.check(p.create(["EmailValidator"])),f={invalid:"invalid",warn:"warn",pending:"pending",ok:"ok"},y=t.createClass({displayName:"ContactsToken",propTypes:{customClass:t.PropTypes.string,className:t.PropTypes.string,contact:t.PropTypes.object.isRequired,onRemove:t.PropTypes.func,tabIndex:t.PropTypes.number,tokenState:t.PropTypes.oneOf(function(){var e;e=[];for(I in f)A=f[I],e.push(A);return e}()).isRequired},render:function(){var e,n;return n={"tokenizer-token":!0,"contact-token":!0,invalid:this.props.tokenState===f.invalid,warned:this.props.tokenState===f.warn,pending:this.props.tokenState===f.pending},n[this.props.customClass]=null!=this.props.customClass,n[this.props.className]=null!=this.props.className,e=t.addons.classSet(n),k.a(_.extend({tabIndex:-1},this.props,{className:e}),this._renderInput(),this._renderIcon(),this._renderText(),this._makeCloseButton())},_getTokenName:function(){switch(this.props.contact.type){case l.FB:return"fb_ids";case l.EMAIL:return"emails";case l.NEW_STYLE_GROUP:return"new_style_group_ids";default:return"invalids"}},_getTokenValue:function(){switch(this.props.contact.type){case l.FB:return this.props.contact.fb_id;case l.NEW_STYLE_GROUP:return this.props.contact.group_id;default:return this.props.contact.email}},_renderIcon:function(){return this.props.contact.type===l.FB?k.img({className:"token-icon",src:"/static/images/icons/fb_16-vflbiYTkC.png"}):this.props.contact.type===l.NEW_STYLE_GROUP||this.props.contact.dbx_account_id?new r({dimension:E,contact:this.props.contact,optionalClass:"token-icon"}):""},_renderInput:function(){return k.input({type:"hidden",name:this._getTokenName(),value:this._getTokenValue()})},_renderText:function(){var e,t;return e=22,t=this.props.contact.name||this.props.contact.email,u.em_snippet(t,e)},_makeCloseButton:function(){return this.props.onRemove?k.span({className:"tokenizer-token-close",onClick:function(e){return function(){return e.props.onRemove(e.props.contact),!1}}(this),dangerouslySetInnerHTML:{__html:"&nbsp;"}}):""}}),v={basic:function(e){var t;return t=e.name&&!e.invalid&&e.email!==e.name,{state:e.invalid?f.invalid:f.ok,msg:t?e.email:null}},warn:function(e){return{state:e.pending?f.pending:e.on_team?f.ok:e.invalid?f.invalid:f.warn,msg:null}},forbid:function(e){return{state:e.pending?f.pending:e.on_team?f.ok:f.invalid,msg:null}}},b=t.createClass({displayName:"ContactsTokenizer",propTypes:{user:t.PropTypes.object.isRequired,context:t.PropTypes.string,customClass:t.PropTypes.string,customContactFilter:t.PropTypes.func,customContactValidator:t.PropTypes.func,id:t.PropTypes.string,onContentsChange:t.PropTypes.func,placeholder:t.PropTypes.string,populatedInputData:t.PropTypes.shape({tokens:t.PropTypes.array,value:t.PropTypes.string}),tabIndex:t.PropTypes.number,showContactImport:t.PropTypes.bool,shouldLogContactSearch:t.PropTypes.bool,tokenSpacing:t.PropTypes.number,focusOnMount:t.PropTypes.bool},getDefaultProps:function(){return{customContactFilter:function(e){return!0},customContactValidator:v.basic,id:null,placeholder:C("Invite more people"),populatedInputData:{tokens:[],value:""},tokenSpacing:4,showContactImport:!1,shouldLogContactSearch:!1,focusOnMount:!1}},componentWillReceiveProps:function(e){var t;e.user===this.props.user&&e.customContactFilter.toString()===this.props.customContactFilter.toString()||(this.contactsDataSource=new g({user:e.user,filterFunc:e.customContactFilter})),this._validateTokens(null!=(t=e.populatedInputData)?t.tokens:void 0)},componentWillMount:function(){var e;this.contactsDataSource=new g({user:this.props.user,filterFunc:this.props.customContactFilter}),this._validateTokens(null!=(e=this.props.populatedInputData)?e.tokens:void 0,!0)},componentDidMount:function(){var e,t,n,i,o;return this.props.shouldLogContactSearch&&(this.contact_search_logger=new m),this.props.populatedInputData.tokens.length>0||(null!=(t=this.props.populatedInputData.value)?t.length:void 0)>0?(n=this.serializeInputData(),i=n.tokens,o=n.value,"function"==typeof(e=this.props).onContentsChange?e.onContentsChange(i,o):void 0):void 0},_validateTokens:function(e,t){var n,i,o,r;if(null==t&&(t=!1),(null!=e?e.length:void 0)>0){for(o=[],n=0,i=e.length;i>n;n++)r=e[n],r.invalid=!P(r.email),t?o.push(r.pending=!0):o.push(void 0);return o}},finishLogging:function(e){return this.props.shouldLogContactSearch?this.contact_search_logger.log_records(this.props.user.id,e):void 0},_logTokenChangeEvent:function(e,t,n){var i,o;if(null==t&&(t=!1),null==n&&(n={}),this.props.shouldLogContactSearch){if(t)return this.contact_search_logger.flag_record_as_removed(e.getContactID());i="react_tokenizer",null!=this.props.context&&(i+="_"+this.props.context),o={context:i,contact_type:e.type,contact_id:e.getContactID(),contact_name:e.name,sort_variant:null};for(I in n)A=n[I],o[I]=A;return this.contact_search_logger.add_record(o)}},addExternalContacts:function(e){return this.refs.tokenizer.addExternalTokens(e)},render:function(){return S(T,{ref:"tokenizer",dataSource:this.contactsDataSource,customClass:this.props.customClass,initialInputText:this.props.populatedInputData.value,placeholderText:this.props.placeholder,renderSelector:function(e){
return function(){return S(w,{showContactImport:e.props.showContactImport,user:e.props.user})}}(this),renderInput:function(e){return function(){return k.textarea({className:"contacts-tokenizer-input",id:e.props.id,rows:1})}}(this),renderToken:this._renderToken,renderTokenHover:this._renderTokenHover,onContentsChange:this.props.onContentsChange,onTokensAdd:this._lookupTokens,stringTokenizer:this.tokenizeEmails,populatedTokenData:this.props.populatedInputData.tokens,tabIndex:this.props.tabIndex,tokenSpacing:this.props.tokenSpacing,focusOnMount:this.props.focusOnMount,logTokenChangeEvent:this._logTokenChangeEvent},this.props.children)},_renderToken:function(e){return S(y,{contact:e,tokenState:this.props.customContactValidator(e).state})},_renderTokenHover:function(e){return this.props.customContactValidator(e).msg},_lookupTokens:function(t){var n;return n=t.filter(function(e){return e.pending}),this.contactsDataSource.query_batch(n,function(t){return function(n){var i,o,r,s,a,l,u;for(l=[],i=t.serializeInputData().tokens,o=[],r=0,s=i.length;s>r;r++)u=i[r],a=n[u.getContactID()]||u,I=a.getKey(),e.call(o,I)>=0||(o.push(I),l.push(a));return t.refs.tokenizer.replaceTokens(l)}}(this))},tokenizeEmails:function(e,t){var n,i,o,r,s,a,u,c,d,p;for(null==t&&(t=!1),n=/[,|;\n]+/,i=/[,|;\n ]+/,a=e.split(i),c=2===a.length&&P(a[0])&&""===a[1]?a:e.split(n),p="",t||(p=c.pop()),d=[],r=0,s=c.length;s>r;r++)u=c[r],o=u.trim(),""!==o&&d.push(new h({name:o,email:o,type:l.EMAIL,invalid:!P(o),on_team:this.refs.tokenizer.props.dataSource.isTeamEmail(o),pending:!0}));return{tokens:d,value:p}},serializeInputData:function(){return this.refs.tokenizer.serializeInputData()},getContacts:function(){var e,t,n,i;return e=this.serializeInputData(),n=e.tokens,i=e.value,t=this.tokenizeEmails(i,!0),n.concat(t.tokens)},tokenizeAll:function(){return this.refs.tokenizer.tokenizeAll()}}),{ContactsTokenizer:b,ContactTokenValidator:v,ContactTokenState:f}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/contacts/typeahead",["jquery","external/react","external/underscore","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/avatar/contact_avatar","modules/clean/css","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/clean/contacts/types","modules/clean/react/flag","modules/clean/react/image","modules/clean/react/paging_list","modules/clean/react/sprite","modules/clean/static_urls","modules/clean/typeahead"],function(t,n,i,o,r,s,a,l,u,c,d,p,_,h,m,f,v){var g,y,b,w,E,T,C,S,k,I,A,P,N,R,O,D,x,L;return N=o.assert,P=r._,T=c.LinkedProfileServices,C=c.ProfileServicesLinkingHandler,L=f.static_url,A=v.TypeaheadSelectorMixin,D=n.DOM,R=n.createElement,O=n.addons.classSet,x=function(e,t){return i.extend({},e,t)},S=32,y=x(A,{getOptions:function(){var e,t,n;return null==this.props.queryOptions?[]:this.state.importsExpanded?function(){var e,n,i,o;for(i=u.contact_services(),o=[],e=0,n=i.length;n>e;e++)t=i[e],o.push(new k({provider:t,connected:this.profile_services.service_is_connected(t)}));return o}.call(this):(e=this.props.queryOptions.slice(0),(null!=(n=this.profile_services)?n.has_unconnected_services(!0):void 0)&&e.push(new w),e)},renderOption:function(e){return e instanceof w?R(E):e instanceof k?R(I,{import:e}):this.props.renderQueryOption(e)},onSelect:function(t){var n,i;return t instanceof w?(this._changeSelectionIndex(0),this.setState({importsExpanded:!0})):t instanceof k?(N((i=t.provider,e.call(u.contact_services(),i)>=0),"invalid party contact provider "+t.provider),this.profile_services.service_is_connected(t.provider)?(n=P("You're already connected to %(service_name)s").format({service_name:u.to_name(t.provider)}),void s.success(n)):this.link_handler.auth_service_with_user(t.provider,this.props.user.id,function(e){return function(e){return C.show_import_notifications(e)}}(this))):this.props.onSelect(t)},reset:function(){return this._changeSelectionIndex(0),this.setState({importsExpanded:!1})}}),g=n.createClass({displayName:"ContactsTypeaheadSelector",mixins:[y],propTypes:{customClass:n.PropTypes.string,onClose:n.PropTypes.func.isRequired,onSelect:n.PropTypes.func.isRequired,queryOptions:n.PropTypes.array,renderQueryOption:n.PropTypes.func.isRequired,showContactImport:n.PropTypes.bool,user:n.PropTypes.object.isRequired},componentWillMount:function(){return this.link_handler=new C,this.profile_services=null,this.props.showContactImport&&null!=this.props.user?this.profile_services=T.get_linked_profile_services_for_user(this.props.user.id):void 0},componentWillReceiveProps:function(e){var t;return 0===(null!=(t=e.queryOptions)?t.length:void 0)?this._changeSelectionIndex(-1):void 0},shouldComponentUpdate:function(e,t){return!i.isEqual(e,this.props)||!i.isEqual(t,this.state)},getDefaultProps:function(){return{showContactImport:!1,onSelect:function(e){},renderQueryOption:function(e){return R(b,{contact:e})}}},onSelectionIndexChange:function(e){var t;return null!=(t=this.refs.pagingList)?t.scrollAround(e):void 0},render:function(){var e;return l.require_css("/static/css/react/contacts_typeahead-vflRzfV9H.css"),this.getOptions().length?(e={"typeahead-selector":!0,"contacts-selector":!0},e[this.props.customClass]=null!=this.props.customClass,n.createElement(h,{customClass:n.addons.classSet(e),pageSize:4,itemSize:54,ref:"pagingList"},this.renderOptions())):D.div({})}}),b=n.createClass({displayName:"ContactsTypeaheadSelectorOption",propTypes:{contact:n.PropTypes.object.isRequired,customClass:n.PropTypes.string},render:function(){var e,t,o,r,s;return e={"contacts-typeahead-option":!0},e[this.props.customClass]=null!=this.props.customClass,null!=this.props.className&&(e[this.props.className]=!0),o={primary:this._renderPrimary(),secondary:this._renderSecondary()},o=i.pick(o,function(e){return""!==e}),D.li(x(this.props,{className:n.addons.classSet(e)}),R(p,{leftAttachment:this._renderIcon()},function(){var n;n=[];for(r in o)s=o[r],e={"option-only":1===i.size(o)},e["option-"+r]=!0,n.push(t=D.div({className:O(e),key:"option-"+r},s));return n}()))},_renderPrimary:function(){return this._renderMatch(this.props.contact.name,this.props.contact.nameMatch)},_renderSecondary:function(){switch(this.props.contact.type){case d.EMAIL:return this.props.contact.email===this.props.contact.name?"":this._renderMatch(this.props.contact.email,this.props.contact.emailMatch);case d.FB:return P("Facebook message");case d.NEW_STYLE_GROUP:return this.props.contact.members;default:return""}},_renderMatch:function(e,t){var n,i,o,r,s,a,l,u,c;if(!t)return e;for(r=0,l=[],u=t.highlighted,i=0,s=u.length;s>i;i++)c=u[i],o=c[0],a=c[1],o>r&&l.push(e.slice(r,o)),n=e.slice(o,o+a),l.push(D.strong({key:"highlight-"+n+"-"+o},n)),r=o+a;return r<e.length&&l.push(e.slice(r)),l},_renderIcon:function(){return D.div({className:"u-pad-right-xs"},R(a,{dimension:S,contact:this.props.contact,optionalClass:"contact-icon"}))}}),w=function(){function e(){}return e.prototype.getKey=function(){return"expand-importer"},e}(),E=n.createClass({displayName:"ExpandImportOption",render:function(){var e;return e={"expand-imports-option":!0,"contacts-typeahead-option":!0},null!=this.props.className&&(e[this.props.className]=!0),D.li(x(this.props,{className:n.addons.classSet(e)}),R(p,{leftAttachment:R(_,{className:"u-pad-right-xs",src:L("/static/images/icons/icon-import-vflOL9sCs.png"),srcHiRes:L("/static/images/icons/icon-import@2x-vfluE8TBO.png")})},D.div({className:"option-primary option-only"},P("Import contacts"))))}}),k=function(){function e(e){this.provider=e.provider,this.connected=e.connected}return e.prototype.getKey=function(){return"third-party-import"+this.provider},e}(),I=n.createClass({displayName:"ThirdPartyImportOption",getInitialState:function(){return{showSpinner:!1}},propTypes:{import:n.PropTypes.object.isRequired},componentWillMount:function(){return t(document).on("db:profile_service:auth_complete",function(e){return function(t){return e.show_contact_import_spinner(t)}}(this))},show_contact_import_spinner:function(e){return this.props.import.provider===e.provider?this.setState({showSpinner:!0}):void 0},render:function(){var e,t,i,o,r,s;return s=this.props.import,o=s.provider,t=s.connected,r=u.to_name(o),!t&&this.state.showSpinner&&(r=P("Importing %(service_name)s Contacts").format({service_name:r})),i=t?P("Connected"):"",e={"third-party-option":!0,"contacts-typeahead-option":!0},null!=this.props.className&&(e[this.props.className]=!0),D.li(x(this.props,{className:n.addons.classSet(e)}),!t&&this.state.showSpinner?D.div({className:"option-spinner"},D.img({src:"/static/images/icons/ajax-loading-small-blue-vflm7vRcz.gif"})):void 0,R(p,{spacing:"xs",leftAttachment:R(_,{alt:"",src:L(u.to_img(o)[0]),srcHiRes:L(u.to_img(o)[1])})},D.div({className:O({"option-primary":!0,"option-only":!t})},r,t?D.div({className:"option-secondary u-font-meta"},i):void 0)))}}),{ContactsTypeaheadSelector:g,ContactsTypeaheadSelectorOption:b,ExpandImportOption:E,ThirdPartyImportOption:I}})}.call(this),function(){define("modules/clean/contacts/types",[],function(){var e;return e={EMAIL:0,FB:1,INVALID:2,NEW_STYLE_GROUP:4,DBX_ID:6}})}.call(this),function(){define("modules/clean/crypto",["external/sjcl"],function(e){var t;return t={},t.getRandomValues=function(t){var n,i,o,r;for(r=e.random.randomWords(t.length),n=i=0,o=t.length;o>=0?o>i:i>o;n=o>=0?++i:--i)t[n]=r[n];return t},t})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/dbmodal_loading",["modules/clean/dbmodal","modules/clean/uirequest"],function(t,n){var i;return i=function(t){function i(e){i.__super__.constructor.call(this,e)}return e(i,t),i.prototype.on_show=function(){return this.fetch()},i.prototype.fetch=function(){return new n(this.$modal_window,this.options.endpoint_url,{data:this.options.parameters||{},subject_user:this.options.subject_user,html_in_error_msg:this.options.html_in_error_msg,error:function(e){return function(t,n,i){return e.hide()}}(this)})},i.prototype.on_confirm_button_click=null,i.prototype.on_cancel_button_click=null,i}(t.DBModal)})}.call(this),function(){define("modules/clean/display_format",["modules/core/i18n"],function(e){var t,n,i;return t=e._,i=function(n,i){var o,r,s;return null==i&&(i=2),n=parseFloat(n),o=Math.abs(n),1024>o?(i=0,r=n,s=e.ungettext("byte","bytes",n)):921600>o?(r=n/1024,s=t("KB")):943718400>o?(r=n/1048576,s=t("MB")):966367641600>o||0===i&&1099511627776>n?(r=n/1073741824,s=t("GB")):(r=n/1099511627776,s=t("TB")),r=Math.round(r*Math.pow(10,i))/parseFloat(Math.pow(10,i)),r=r.toFixed(i),r+" "+s},n={format_bytes:i}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/downloads",["jquery","modules/constants/env","modules/constants/python","modules/constants/viewer","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri"],function(t,n,i,o,r,s,a,l,u){var c,d,p,_,h;return h=s.assert,_=a._,p=[n.BLOCK_CLUSTER,n.PUBSERVER],c=_("There was an error downloading your file."),d=function(){function s(){}return s.get=function(n){var o,a,d,_,m,f,v,g,y;return y=n.url,_=n.error,m=n.expected_domain,d=u.parse(y),o=m||d.authority,h(e.call(p,o)>=0),r.iOS?(h((g=d.authority,e.call(["",window.location.host].concat(p),g)>=0)),void r.unsafeRedirect(y)):(s.initialized||s.init(),a=s._create_download_id(),v={},v[i.DOWNLOAD_ID_PARAM_NAME]=a,v[i.DOWNLOADS_NOTIFY_DOMAIN_PARAM_NAME]=window.location.host,d.updateQuery(v),f=t("<iframe />",{src:String(d)}).css("display","none"),f.on("load",function(){var e;return e=function(){var e;return e=s.current_watches[a],null!=e?(r.chrome&&(l.error(c),"function"==typeof e.error&&e.error()),s._cleanup(a)):void 0},setTimeout(e,100)}),s.current_watches[a]={origin:o,error:_,iframe:f},t("body").append(f),window.setTimeout(function(){return s._cleanup(a)},9e4),!1)},s.get_blockserver_link=function(e){var t,i,o;return o=e.url,t=e.error,i=u.parse(o),i.setScheme("https"),i.updateQuery({dl:1}),h(i.authority===n.BLOCK_CLUSTER,"download_blockserver_url expects a blockserver resource, got: "+o),this.get({url:i.toString(),error:t})},s.get_zip=function(e){var i,r,s,a,l,c,d,p,_,h;for(s=e.fq_paths,h=e.subject_uid,i=e.block_hash,p=e.parent_path,a=u({scheme:"https",authority:n.BLOCK_CLUSTER,path:"/zip_batch"}).updateQuery(o.UID_PARAM_NAME,h).toString(),_=t("<form>",{action:a,method:"post"}),c=0,d=s.length;d>c;c++)r=s[c],l=t("<input>",{name:"files",value:r}),l.appendTo(_);return l=t("<input>",{name:"parent_path",value:p||"/"}),l.appendTo(_),l=t("<input>",{name:"w",value:i}),l.appendTo(_),t(document.body).append(_),_.submit(),_.remove()},s.init=function(){return s.initialized=!0,s.current_watches={},t(window).on("message",s._post_handler)},s._post_handler=function(t){var n,i,o,r;if(n=u.parse(t.originalEvent.origin),"https"===n.scheme&&(o=n.authority,!(e.call(p,o)<0))){try{i=JSON.parse(t.originalEvent.data)}catch(e){return}if(null!=(null!=i?i.download_id:void 0)&&(r=s.current_watches[i.download_id],null!=r&&n.authority===r.origin&&t.originalEvent.source===r.iframe[0].contentWindow))return"failed"===i.status&&(l.error(i.message||c),"function"==typeof r.error&&r.error()),s._cleanup(i.download_id)}},s._cleanup=function(e){var t;return t=this.current_watches[e],null!=t?(t.iframe.remove(),delete this.current_watches[e]):void 0},s._create_download_id=function(){var e,t,n;for(n="",e=t=1;4>=t;e=++t)n+=String(Math.random()).split(".")[1];return n},s}()})}.call(this),function(){define("modules/clean/dropbox_nav",["jquery","modules/clean/analytics","modules/clean/photos/photos_engagement_logger"],function(e,t,n){var i;return i=function(){function i(){e(".carousel-nav-item").click(function(e){return function(){return e.log_click("carousel_nav_link_click")}}(this)),e(".composer-nav-item").click(function(e){return function(){return e.log_click("composer_nav_link_click")}}(this)),e(".mailbox-nav-item").click(function(e){return function(){return e.log_click("mailbox_nav_link_click")}}(this)),e(".carousel-nav-item").click(function(){return n.log_and_send(n.CAROUSEL_NAV_LINK_CLICK)}),e(".photos-nav-item").click(function(){return n.log_and_send(n.PHOTOS_NAV_LINK_CLICK)})}return i.prototype.log_click=function(e){return t.WebMiscActivityLogger.log(e)},i}()})}.call(this),function(){define("modules/clean/event_emitter",["external/reflux"],function(e){return e.utils.EventEmitter})}.call(this),function(){define("modules/clean/events/rollback",["jquery","modules/core/browser","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/analytics","modules/clean/react/modal","modules/clean/ajax"],function(e,t,n,i,o,r,s,a,l){var u,c,d;return d=i._,c=s.SupportExperimentsWebLogger,u={configureAllLinks:function(t,n,i,o){return null==i&&(i=null),null==o&&(o=void 0),e(t).on("click",n,function(t){var n,r,s,l,p;return null!=i&&c.log_file_restore(i),n=e(t.target),p=n.data("user-id"),s=n.data("ns-id"),r=n.data("cs-id"),l=n.data("redirect"),null==l&&(l=!0),a.SimpleModal.show({title_text:d("Undo this deletion"),body_html:d("Are you sure you want to undo this deletion?"),confirm_text:d("Undo deletion"),confirm_callback:function(){return u.rollback(p,s,r,l,o)},cancel_text:d("Cancel")}),!1})},configureLink:function(t,i,o,r,s,l){return e(t).on("click",function(e){return e.stopPropagation(),a.SimpleModal.show({title_text:i,body_html:n.escape(o).toHTML(),confirm_text:d("Restore"),confirm_callback:function(){return u.rollback(r,s,l)},cancel_text:d("Cancel")}),!1})},rollback:function(e,n,i,s,a){var u;return null==a&&(a=void 0),u={},u[n]=i,l.WebProgressRequest({url:"/cmd/restore_changesets",data:{ns_to_cs:JSON.stringify(u)},subject_user:e,html_in_error_msg:!0,progress_text:d("Restoring files..."),success:function(){return o.success(d("Finished restoring files.")),"function"==typeof a&&a(),s?t.redirect(r({path:"/browse_cs/"+e+"/"+n+"/"+i})):void 0}})}}})}.call(this),function(){define("modules/clean/file_activity/api",["external/underscore","modules/core/types","modules/constants/viewer","modules/clean/ajax","modules/clean/activity/activity","modules/clean/comments/models/immutable_comment_activity","modules/clean/comments/models/immutable_file_activity","external/rsvp"],function(e,t,n,i,o,r,s,a){var l,u,c,d,p,_,h,m,f,v,g,y,b,w,E,T,C,S,k,I,A,P,N,R,O,D,x,L,M,F,U,B,q,W,V,H,j;return q=t.takes,M=t.returns,m=t.Maybe,c=t.Either,f=a.Promise,E={actorId:m(Number),oref:m(String),isBackgroundRequest:m(Boolean)},I=function(t){var n,o,r,s,a,l,u,c;return c=t.url,u=t.type,o=t.data,n=t.actorId,s=t.oref,r=t.isBackgroundRequest,l=r?i.SilentBackgroundRequestOref:i.WebRequestOref,a=new f(function(t,i){return l({url:c,type:u,data:e.extend({oref:s},o),subject_user:n,success:t,error:function(e,t,n){return i(t)}})}),a.then(JSON.parse)},C=function(e){var t,n,i;if("error"===e.status)throw n=null!=(i=e.payload)?i.error_text:void 0,t=Error(n),t.payload=e.payload,t.error_text=n,t;return e.payload},S=function(e){var t,n;return n=C(e),t=e.bolt_data,[n,t]},T=function(e){var t;return t=new o.FileActivity(e),s.fromMutable(t)},l=e.extend({commentActivityKey:m(String),context:Number,contextData:String,text:m(String),metadata:m(Object)},E),A=q(l,M(f,function(e){var t,n,i,s,a,l,u,c;return t=e.actorId,n=e.commentActivityKey,i=e.context,s=e.contextData,c=e.text,l=e.metadata,u=e.oref,a=e.isBackgroundRequest,I({actorId:t,url:"/file_activity/comment",type:"POST",data:{activity_context:i,activity_context_data:s,comment_text:c,comment_metadata_json:JSON.stringify(l),target_comment_activity_key:n},oref:u,isBackgroundRequest:a}).then(C).then(function(e){var t;return t=new o.CommentActivity(e),r.fromMutable(t)})})),u=e.extend({commentActivityKey:String,context:Number,contextData:String},E),P=q(u,M(f,function(e){var t,n,i,o,r,s;return t=e.actorId,n=e.commentActivityKey,i=e.context,o=e.contextData,s=e.oref,r=e.isBackgroundRequest,I({actorId:t,url:"/file_activity/comment/delete",type:"POST",data:{comment_key:n,activity_context:i,activity_context_data:o},oref:s,isBackgroundRequest:r}).then(C)})),y=e.extend({liked:Boolean,commentActivityKey:String,context:Number,contextData:String},E),H=q(y,M(f,function(e){var t,n,i,o,r,s,a;return t=e.actorId,s=e.liked,n=e.commentActivityKey,i=e.context,o=e.contextData,a=e.oref,r=e.isBackgroundRequest,I({actorId:t,url:"/file_activity/comment/like",type:"POST",data:{activity_key:n,activity_context:i,activity_context_data:o,liked:s},oref:a,isBackgroundRequest:r}).then(C)})),g=e.extend({enableComment:Boolean,context:Number,contextData:String},E),W=q(g,M(f,function(e){var t,n,i,o,r,s;return t=e.actorId,o=e.enableComment,n=e.context,i=e.contextData,s=e.oref,r=e.isBackgroundRequest,I({actorId:t,url:"/file_activity/feedback_setting",type:"POST",data:{activity_context:n,activity_context_data:i,feedback_off:!o},oref:s,isBackgroundRequest:r}).then(C)})),b=e.extend({resolved:Boolean,commentActivityKey:String,context:Number,contextData:String},E),j=q(b,M(f,function(e){var t,n,i,o,r,s,a;return t=e.actorId,a=e.resolved,n=e.commentActivityKey,i=e.context,o=e.contextData,s=e.oref,r=e.isBackgroundRequest,I({actorId:t,url:"/file_activity/comment/resolve",type:"POST",data:{activity_key:n,activity_context:i,activity_context_data:o,resolved:a},oref:s,isBackgroundRequest:r}).then(C)})),h=e.extend({commentActivityKeys:Array,context:Number,contextData:String},E),x=q(h,M(f,function(e){var t,n,i,o,r,s;return t=e.actorId,n=e.commentActivityKeys,i=e.context,o=e.contextData,s=e.oref,r=e.isBackgroundRequest,I({actorId:t,url:"/file_activity/mark_comment_seen_batch",type:"POST",data:{comment_activity_keys:JSON.stringify(n),activity_context:i,activity_context_data:o},oref:s,isBackgroundRequest:r}).then(C)})),_=e.extend({context:Number,contextData:String},E),k=function(e){var t,n,i,r,s;return t=e.actorId,n=e.context,i=e.contextData,s=e.oref,r=e.isBackgroundRequest,I({actorId:t,url:"/file_activity/file_activity",type:"GET",data:{activity_context:n,activity_context_data:i,activity_type:o.ActivityType.FILE},oref:s,isBackgroundRequest:r})},O=q(_,M(f,function(e){return k(e).then(C).then(T)})),D=q(_,M(f,function(e){return k(e).then(S).then(function(e){var t,n;return t=e[0],n=e[1],[T(t),n]})})),p=e.extend({context:Number,contextDataList:Array},E),R=q(p,M(f,function(t){var n,i,r,s,a;return n=t.actorId,i=t.context,r=t.contextDataList,a=t.oref,s=t.isBackgroundRequest,I({actorId:n,url:"/file_activity/file_activity_batch",type:"GET",data:{activity_context:i,activity_context_data_batch:JSON.stringify(r),activity_type:o.ActivityType.FILE},oref:a,isBackgroundRequest:s}).then(function(t){return e.mapObject(t,T)})})),w=e.extend({targetUserEmail:m(String),subscribed:Boolean,context:Number,contextData:String},E),V=q(w,M(f,function(e){var t,n,i,o,r,s,a;return t=e.actorId,a=e.targetUserEmail,s=e.subscribed,n=e.context,i=e.contextData,r=e.oref,o=e.isBackgroundRequest,I({actorId:t,url:"/file_activity/subscribe",type:"POST",data:{activity_context:n,activity_context_data:i,subscribed:s,target_user_identifier:a},oref:r,isBackgroundRequest:o}).then(C)})),d=e.extend({context:Number,contextDataList:Array},E),N=q(d,M(f,function(t){var n,i,o,r,s;return n=t.actorId,i=t.context,o=t.contextDataList,s=t.oref,r=t.isBackgroundRequest,I({actorId:n,url:"/file_activity/comment_status_batch",type:"POST",data:{activity_context:i,activity_context_data_batch:JSON.stringify(o)},oref:s,isBackgroundRequest:r}).then(C).then(function(t){return e.mapObject(t,function(e){var t,n,i;return n=e.feedback_off,t=e.comment_count,i=e.unresolved_comment_count,{feedback_off:n,comment_count:t,unresolved_comment_count:i}})})})),v=e.extend({feedbackText:String,context:Number,contextData:String},E),B=q(v,M(f,function(e){var t,n,i,o,r,s;return t=e.actorId,o=e.feedbackText,n=e.context,i=e.contextData,s=e.oref,r=e.isBackgroundRequest,I({actorId:t,url:"/file_activity/product_feedback",type:"POST",data:{activity_context:n,activity_context_data:i,feedback_text:o},oref:s,isBackgroundRequest:r}).then(C)})),L=q({actorId:Number},M(f,function(e){var t,n;return t=e.actorId,n=new f(function(e,n){return i.SilentBackgroundRequestOref({url:"/file_activity/mark_commenting_onboarding_seen",type:"POST",success:e,error:n,subject_user:t})}),n.then(JSON.parse).then(C)})),U=q({actorId:Number},M(f,function(e){var t,n;return t=e.actorId,n=new f(function(e,n){return i.SilentBackgroundRequestOref({url:"/file_activity/should_show_commenting_onboarding",type:"POST",success:e,error:n,subject_user:t})}),n.then(JSON.parse).then(C)})),F=q({actorId:Number,shouldShow:Boolean},M(f,function(e){var t,i;return t=e.actorId,i=e.shouldShow,n.SHOW_COMMENTS_PANEL=i,I({actorId:t,url:"/file_activity/set_commenting_pane_visibility",type:"POST",data:{show_pane:i}}).then(C)})),{markCommentingOnboardingSeen:L,shouldShowCommentingOnboarding:U,setCommentingPaneVisibility:F,addComment:A,deleteComment:P,updateLikeComment:H,updateResolveComment:j,updateCommentSetting:W,markCommentSeenBatch:x,fetchCommentStatusBatch:N,fetchFileActivity:O,fetchFileActivityWithBoltData:D,fetchFileActivities:R,updateFileActivitySubscription:V,submitProductFeedback:B}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function i(){this.constructor=e}for(var o in t)n.call(t,o)&&(e[o]=t[o]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},n={}.hasOwnProperty;define("modules/clean/file_activity/clients/file_activity_bolt_client",["external/underscore","modules/core/exception","modules/core/types","modules/clean/bolt","modules/clean/event_emitter","modules/clean/file_activity/api","external/rsvp","modules/clean/storage"],function(n,i,o,r,s,a,l,u){var c,d,p,_,h,m,f;return f=o.takes,d=o.Maybe,p=l.Promise,_=u.SessionStorage,h=function(e,t){return new r.SignedChannelState("file_activity",e.activity_key,t.revision,t.token)},m=function(e){var t,n;return t=e.revision,n=e.token,{revision:t,token:n}},c=function(n){function o(){return this._onBoltRefresh=e(this._onBoltRefresh,this),this._onBoltUpdate=e(this._onBoltUpdate,this),s.apply(this,arguments)}var s;return t(o,n),s=f({actorId:d(Number),context:Number,contextData:String,oref:d(String)},function(e){var t,n,i,o;return t=e.actorId,n=e.context,i=e.contextData,o=e.oref,this.__requestOptions={actorId:t,context:n,contextData:i,oref:o,isBackgroundRequest:!0},this.__isLive=!1,this.__isReady=!1,this.__canInit=!0}),o.prototype.getFileActivity=function(){return this.__fileActivity},o.prototype.isReady=function(){return this.__isReady},o.prototype.isLive=function(){return this.__isLive},o.prototype.init=function(){i.assert(this.__canInit,"Cannot initialize an already initialized or initialization in-progress client"),this.__canInit=!1,this._pullFromServer().then(function(e){return function(){return e.__isLive?e._doStartLiveUpdate():void 0}}(this)).catch(function(e){return function(){return e.__canInit=!0}}(this))},o.prototype.startLiveUpdate=function(){return i.assert(!this.__isLive,"Client is already live updating"),this.__isReady&&this._doStartLiveUpdate(),this.__isLive=!0},o.prototype.stopLiveUpdate=function(){var e;return this.__isLive=!1,null!=(e=this.__boltClient)?e.unsubscribe():void 0},o.prototype.update=function(e){var t,n;return i.assert(this.__isReady,"Cannot open transaction when server data is not ready"),n=this.__fileActivity,t=e(this.__fileActivity),this.__fileActivity=t,this.emit("updated",t,n),t},o.prototype._doStartLiveUpdate=function(){var e;return e=h(this.__fileActivity,this.__boltData),this.__boltClient=new r.BoltClient([e],this._onBoltUpdate,this._onBoltRefresh),this.__boltClient.start()},o.prototype._pullFromServer=function(){var e;return _.set("reload-timestamp",(new Date).getTime()),e=a.fetchFileActivityWithBoltData(this.__requestOptions),e.then(function(e){return function(t){var n,i,o;return i=t[0],n=t[1],o=e.__fileActivity,e.__fileActivity=(null!=o?o.union(i):void 0)||i,e.__boltData=n,e.__isReady?e.emit("updated",e.__fileActivity,o):(e.__isReady=!0,e.emit("ready",e.__fileActivity))}}(this)),e.catch(function(e){return function(t){return e.emit("error",t)}}(this)),e},o.prototype._onBoltUpdate=function(e){var t;if(1===(null!=e?e.length:void 0)&&e[0].unique_id===this.__fileActivity.activity_key)return t=e[0],this.__boltData=m(t),this._pullFromServer().then(function(e){return function(){return e.__isLive?(t=h(e.__fileActivity,e.__boltData),e.__boltClient.update_states([t])):void 0}}(this))},o.prototype._onBoltRefresh=function(e){return this._pullFromServer().then(function(e){return function(){return e.__isLive?(e.stopLiveUpdate(),e.startLiveUpdate()):void 0}}(this))},o}(s)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/file_activity/clients/file_activity_data_source",["external/underscore","external/lru","modules/clean/comments/events","modules/clean/comments/store","modules/clean/file_activity/clients/file_activity_bolt_client","external/rsvp"],function(t,n,i,o,r,s){var a,l,u;return l=s.Promise,u=function(e,t,n,i){return null==i&&(i=""),e=null!=e?e:"",e+":"+t+":"+n+":"+i},a=function(){function s(t){this._cache=t._cache,this._unsubscribeStore=t._unsubscribeStore,this._sendFileActivity=t._sendFileActivity,this._state=t._state,this.onClientUpdated=e(this.onClientUpdated,this),this.onStoreUpdate=e(this.onStoreUpdate,this)}return s.getInstance=function(){var e;return e=s,null==e.__instance&&(e.__instance=e.create(o,function(e){return i.emit("file-activity-updated",e)})),e.__instance},s.create=function(e,t,i){var o,r;return null==i&&(i=10),o=new n(i),o.shift=function(){var e,t;return t=n.prototype.shift.call(this),e=t.value,null!=e&&e.removeAllListeners(),null!=e&&e.stopLiveUpdate(),t},r=new s({_cache:o,_state:{},_sendFileActivity:t}),r._unsubscribeStore=e.listen(r.onStoreUpdate),r.onStoreUpdate(e.state),r},s.prototype.dispose=function(){return this._unsubscribeStore()},s.prototype.replaceState=function(e){var t;return this.shouldUpdate(e)?(this.willUpdate(e),t=this._state,this._state=e,this.didUpdate(t)):void 0},s.prototype.getState=function(){return this._state},s.prototype.onStoreUpdate=function(e){var t,n,i,o,r,s;return t=e.actorId,r=e.oref,s=e.viewing,n=s.context,i=s.contextData,o={oref:r,actorId:t,context:n,contextData:i},this.replaceState(o)},s.prototype.shouldUpdate=function(e){return!t.isEqual(this._state,e)},s.prototype.willUpdate=function(e){var t;return t=this.getCurrentClient(),null!=t?this.deactivateClient(t):void 0},s.prototype.didUpdate=function(e){var t;return t=this.getCurrentFetchKey(),this.isFetching(t)||(this.sendActivity(null),this.isNullState(this._state))?void 0:this.fetchAndSend(this._state)},s.prototype.getFetchKey=function(e){var t,n,i,o;return t=e.actorId,n=e.context,i=e.contextData,o=e.oref,u(t,n,i,o)},s.prototype.getCurrentFetchKey=function(){return this.getFetchKey(this._state)},s.prototype.getCurrentClient=function(){var e;return e=this.getCurrentFetchKey(),this._cache.get(e)},s.prototype.isFetching=function(e){var t;return t=this._cache.find(this.getFetchKey(e)),null!=t&&!t.isReady()},s.prototype.isNullState=function(e){return!(null!=e.context&&null!=e.contextData)},s.prototype.activateClient=function(e){return e.on("ready",this.onClientUpdated),e.on("updated",this.onClientUpdated),e.on("error",this.onClientError),e.startLiveUpdate(),e.isReady()?this.onClientUpdated(e.getFileActivity()):void 0},s.prototype.deactivateClient=function(e){return e.off("ready",this.onClientUpdated),e.off("updated",this.onClientUpdated),e.off("error",this.onClientError),e.stopLiveUpdate()},s.prototype.deactivateCurrentClient=function(){var e;return e=this.getCurrentClient(),null!=e?this.deactivateClient(e):void 0},s.prototype.fetchAndSend=function(e){var t,n,i,o,r,s,a;return t=e.actorId,o=e.context,r=e.contextData,a=e.oref,s=u(t,o,r,a),n=this._cache.get(s),null!=n?this.activateClient(n):(i=this.createFileActivityBoltClient({actorId:t,context:o,contextData:r,oref:a}),i.init(),this._cache.set(s,i),this.activateClient(i))},s.prototype.onClientUpdated=function(e){return this.sendActivity(e)},s.prototype.onClientError=function(e){throw e},s.prototype.sendActivity=function(e){return this._sendFileActivity(e)},s.prototype.createFileActivityBoltClient=function(e){return new r(e)},s.prototype.modify=function(e){var t;return t=this.getCurrentClient(),null!=t?(t.update(e),!0):!1},s}()})}.call(this),function(){define("modules/clean/file_events",[],function(){var e;return e={DELETE:"db:bulk_delete",COPY:"db:bulk_copy",MOVE:"db:bulk_move",RENAME:"db:bulk_rename",PURGE:"db:bulk_purge",RESTORE:"db:bulk_restore",UPLOAD:"db:upload",COMPRESS:"db:compress",SF_NEW:"db:sf_new",SF_LEAVE:"db:sf_leave",SF_UNSHARE:"db:sf_unshare",SF_ADD_TO_DROPBOX:"db:sf_add_to_dropbox",SF_INVITE:"db:sf_invite",SF_IGNORE:"db:sf_ignore",LINKS_REMOVE:"db:link_remove",LINKS_ADD:"db:link_add",FILE_ACTIVITY_UPDATE:"db:file_activity_update"}})}.call(this),function(){var e={}.hasOwnProperty;define("modules/clean/flux/action_type",[],function(){var t;return t=function(t,n){var i,o,r,s;r={},s={};for(i in n)if(e.call(n,i)){if(o=n[i],r[i]=t+"__"+o,null!=s[o])throw new Error("Duplicate action value '"+o+"'!");s[o]=!0}return r},{withActionNamespace:t}})}.call(this),function(){"use strict";var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/flux/base_store",["modules/core/exception","modules/clean/flux/dispatcher"],function(t,n){var i,o,r;return o=t.assert,r=function(){var t,i;return i=!1,t=[],n.dispatch_begin=function(){return i=!0},n.dispatch_end=function(){var e,n,o,r;i=!1;try{for(r=[],n=0,o=t.length;o>n;n++)e=t[n],r.push(e());return r}finally{t.length=0}},function(n){return i?e.call(t,n)<0?t.push(n):void 0:n()}}(),i=function(){
function t(e){null==e&&(e=null),"function"==typeof this._init&&this._init(),this._change_listeners=[],this._dispatcher=e||n,this.dispatchToken=this._dispatcher.register(this._new_payload_wrapper.bind(this))}return t.WIPE_TYPE="WIPE_ALL",t.prototype.destructor=function(){return this._dispatcher.unregister(this.dispatchToken),this.remove_all_change_listeners()},t.prototype.emit_change=function(){var e,t,n,i,o;for(i=this._change_listeners,o=[],t=0,n=i.length;n>t;t++)e=i[t],o.push(r(e));return o},t.prototype.add_change_listener=function(t){return o(!(e.call(this._change_listeners,t)>=0)),this._change_listeners.push(t)},t.prototype.remove_change_listener=function(e){var t;return this._change_listeners=function(){var n,i,o,r;for(o=this._change_listeners,r=[],n=0,i=o.length;i>n;n++)t=o[n],t!==e&&r.push(t);return r}.call(this)},t.prototype.remove_all_change_listeners=function(){return this._change_listeners.length=0},t.prototype._new_payload_wrapper=function(e){var t;return(null!=e&&null!=(t=e.action)?t.type:void 0)===this.constructor.WIPE_TYPE&&"function"==typeof this._init&&this._init(),this._new_payload(e)},t.prototype._new_payload=function(e){throw new Error("Abstract method - must be implemented")},t}()})}.call(this),function(){define("modules/clean/flux/flux_store",function(){var e;return e=function(){function e(e){this._listeners=[],this._dispatcher=e,this._dispatchToken=this._dispatcher.register(this.__invokeOnDispatch.bind(this)),this.__hasChanged=!1}return e.prototype.teardown=function(){return this._dispatcher.unregister(this._dispatchToken)},e.prototype.getDispatcher=function(){return this._dispatcher},e.prototype.getDispatchToken=function(){return this._dispatchToken},e.prototype.addListener=function(e){return this._listeners.push(e),function(t){return function(){var n;return t._listeners=function(){var t,i,o,r;for(o=this._listeners,r=[],t=0,i=o.length;i>t;t++)n=o[t],n!==e&&r.push(n);return r}.call(t)}}(this)},e.prototype.hasChanged=function(){return this.__hasChanged},e.prototype.__emitChange=function(){return this.__hasChanged=!0},e.prototype.__onDispatch=function(){throw new Error("__onDispatch should be overridden by subclass")},e.prototype.__invokeOnDispatch=function(e){var t,n,i,o,r;if(this.__hasChanged=!1,this.__onDispatch(e),this.__hasChanged){for(o=this._listeners,r=[],n=0,i=o.length;i>n;n++)t=o[n],r.push(t());return r}},e}()})}.call(this),function(){var e={}.hasOwnProperty;define("modules/clean/flux/store_listener",["external/react"],function(t){var n;return n=function(n,i,o){var r;return t.createClass({displayName:"StoreListener("+(null!=(r=n.displayName)?r:"Unknown")+")",getInitialState:function(){return{childProps:o(this.props,i)}},componentDidMount:function(){var t,n;for(n in i)e.call(i,n)&&(t=i[n],t.add_change_listener(this._handleStoreChanged));return this.setState({childProps:o(this.props,i)})},componentWillUnmount:function(){var t,n,o;t=[];for(o in i)e.call(i,o)&&(n=i[o],t.push(n.remove_change_listener(this._handleStoreChanged)));return t},render:function(){var i,o,r,s;i={ref:"wrapped"},r=this.state.childProps;for(o in r)e.call(r,o)&&(s=r[o],i[o]=s);return t.createElement(n,i,this.props.children)},getWrappedComponent:function(){return this.refs.wrapped},getStores:function(){return i},_handleStoreChanged:function(){var e;return this.isMounted()&&(e=o(this.props,i),null!=e)?this.setState({childProps:e}):void 0}})},{listenToStores:n}})}.call(this),function(){var e={}.hasOwnProperty;define("modules/clean/form",["jquery","external/purify","modules/core/exception","modules/core/notify","modules/clean/ajax","modules/core/cookies","modules/constants/request"],function(t,n,i,o,r,s,a){var l,u;return u=i.assert,l={submit:function(e,t,n,i){return r.FormWebRequest({url:e.attr("action"),data:this.collect_data(e),skipErrorHandling:!0,success:function(e,i,o){var r,s,a;return s=l.parse_response(o.responseText),a=s[0],r=s[1],a?t(r):n(r)},error:function(e,t,i){return n(o.DEFAULT_ERROR)},complete:i})},collect_data:function(e){var n,i,o,r,s,a,l;for(n={},a=e.find("input, select, textarea"),i=0,r=a.length;r>i;i++)if(o=a[i],s=t(o).attr("name")){if("checkbox"===t(o).attr("type"))l=t(o).prop("checked")?"True":"";else if("radio"===t(o).attr("type")){if(!t(o).prop("checked"))continue;l=t(o).val()}else l=t(o).val();s in n?("string"==typeof n[s]&&(n[s]=[n[s]]),n[s].push(l)):n[s]=l}return n},parse_response:function(e){var t,n,i,r;if(0!==e.indexOf("err:"))return[!0,e];n=e.substr(4);try{return r=JSON.parse(n),[!1,r]}catch(e){return t=e,[!1,n||o.DEFAULT_ERROR]}},parse_error:function(e){var t,n;if("string"==typeof e)return[!0,e];if("object"==typeof e)for(n in e)if(t=e[n],"message_text"in t)return[!0,t.message_text];return[!1,o.DEFAULT_ERROR]},add_vars:function(i,o){var r,s,a,l;a=[];for(s in o)e.call(o,s)&&(r=t("<input>",{type:"hidden",name:s}),r.val(o[s]),l=n.sanitize(r.prop("outerHTML")),a.push(i.append(l)));return a},post_request:function(e,i,o){var r,l;return null==i&&(i={}),null==o&&(o={}),u(null!=e,"post_request missing action"),r=t("<form>",{action:e,method:"POST",target:o.target?o.target:void 0}),i.t=s.read(a.JS_CSRF_COOKIE),this.add_vars(r,i),l=t(n.sanitize(r.prop("outerHTML"))),t("body").append(l),l.submit()}}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/frame_messenger",["jquery"],function(n){var i;return i=function(){function i(){this.handleUntrustedMessage=e(this.handleUntrustedMessage,this),Object.defineProperty(this,"trustedParentOriginForPosting",{get:function(){return this._trustedParentOriginForPosting}}),Object.defineProperty(this,"trustedChildOriginForPosting",{get:function(){var e,t,i,o;if(null!=this._trustedChildOriginForPosting)return this._trustedChildOriginForPosting;for(e=n(this._childIframeQuery),t=0,o=e.length;o>t&&(i=e[t],!this._validateChildOriginForPosting(i.src));t++);return this._trustedChildOriginForPosting}})}return i._ALLOWED_CHILD_ORIGINS=["https://www.dropboxstatic.com","https://www.dropboxstatic.com:443","https://cf.dropboxstatic.com","https://cf.dropboxstatic.com:443","https://www.dropbox.com","https://www.dropbox.com:443","https://dl-doc.dropbox.com","https://dl-doc.dropbox.com:443","https://dl-web.dropbox.com","https://dl-web.dropbox.com:443","https://dl.dropboxusercontent.com","https://dl.dropboxusercontent.com:443","null"],i._ALLOWED_PARENT_ORIGINS=["https://www.dropbox.com","https://www.dropbox.com:443"],i._REQUEST_PARENT_ORIGIN_POLL_DELAY=100,i.prototype._childIframeQuery=null,i.prototype._trustedChildOriginForPosting=null,i.prototype._trustedParentOriginForPosting=null,i.prototype._validActionsFromChild=[],i.prototype._validActionsFromParent=[],i.prototype._trustedMessageFromChildHandler=null,i.prototype._trustedMessageFromParentHandler=null,i.prototype._parentMessageQueue=[],i.prototype._requestParentOriginPollRetry=null,i.prototype._onParentReady=null,i.prototype.resetOriginsForPosting=function(){return this._trustedChildOriginForPosting=null,this._trustedParentOriginForPosting=null},i.prototype.configureChildMessaging=function(e,t,n){return this._childIframeQuery=e,this._trustedChildOriginForPosting=null,this._validActionsFromChild=n,this._trustedMessageFromChildHandler=t},i.prototype.configureParentMessaging=function(e,t,n){return null==n&&(n=null),this._trustedParentOriginForPosting=null,this._validActionsFromParent=t,this._trustedMessageFromParentHandler=e,this._onParentReady=n},i.prototype.startListening=function(){return window.addEventListener("message",this.handleUntrustedMessage),null!=this._validActionsFromParent&&this._validActionsFromParent.length>0&&null!=this._trustedMessageFromParentHandler&&this._requestParentOrigin(),null!=this._validActionsFromChild&&this._validActionsFromChild.length>0&&null!=this._trustedMessageFromChildHandler?this.postMessageToChildren("parent-ready"):void 0},i.prototype.stopListening=function(){return window.removeEventListener("message",this.handleUntrustedMessage)},i.prototype._isNumber=function(e){return!isNaN(parseInt(e))},i.prototype._getOriginFromUrl=function(e){var t,n,i;return i=document.createElement("a"),i.href=e,t=this._isNumber(i.port)?":"+i.port:"",n="https://"+i.hostname+t},i.prototype._isChildOriginAllowed=function(e){return t.call(this.constructor._ALLOWED_CHILD_ORIGINS,e)>=0||this._isDevVmOrigin(e)},i.prototype._isParentOriginAllowed=function(e){return t.call(this.constructor._ALLOWED_PARENT_ORIGINS,e)>=0||this._isDevVmOrigin(e)},i.prototype._isDevVmOrigin=function(e){var t;return t=e.match(/\.dev\.corp\.dropbox(static|usercontent)?\.com($|:)/),(null!=t?t.length:void 0)>=1},i.prototype._validateChildOriginForPosting=function(e){var t;return t="null"===e?"*":this._getOriginFromUrl(e),"null"===e||this._isChildOriginAllowed(t)?(this._trustedChildOriginForPosting=t,!0):(console.warn("Untrusted message from child blocked: "+e),!1)},i.prototype.childIsValidated=function(){return null!=this._trustedChildOriginForPosting},i.prototype._validateParentOriginForPosting=function(e){var t,n,i,o,r,s,a;if(s=this._trustedParentOriginForPosting,r=this._getOriginFromUrl(e),!this._isParentOriginAllowed(r))return console.warn("Untrusted message from parent blocked: "+e),!1;if(this._trustedParentOriginForPosting=r,this._parentMessageQueue.length>0){for(a=this._parentMessageQueue,t=0,n=a.length;n>t;t++)i=a[t],o=JSON.parse(i),this.postMessageToParent(o.action,o.parameters);this._parentMessageQueue=[]}return null!=this._trustedParentOriginForPosting&&null==s&&null!=this._onParentReady&&this._onParentReady(),!0},i.prototype.handleUntrustedMessage=function(e){var n,i,o,r,s;if(!this._isChildOriginAllowed(e.origin)&&!this._isParentOriginAllowed(e.origin))return void console.warn("Message received not in parent or child origin whitelist: "+e.origin);try{o=JSON.parse(e.data)}catch(e){return void(n=e)}if(null!=o.action)return"child-requesting-parent-origin"===o.action?void(this._validateChildOriginForPosting(e.origin)&&this.postMessageToChildren("parent-ready")):"parent-ready"===o.action?void this._validateParentOriginForPosting(e.origin):(r=o.action,t.call(this._validActionsFromChild,r)>=0&&this._validateChildOriginForPosting(e.origin)&&null!=this._trustedMessageFromChildHandler?void this._trustedMessageFromChildHandler(o):(s=o.action,void(t.call(this._validActionsFromParent,s)>=0&&this._validateParentOriginForPosting(e.origin)&&null!=this._trustedMessageFromParentHandler&&this._trustedMessageFromParentHandler(o))))},i.prototype._packagePostMessage=function(e,t){var n,i;return i=this.trustedChildOriginForPosting,n={action:e,parameters:t},JSON.stringify(n)},i.prototype.postMessageToChildElements=function(e,t,n){var i,o,r,s,a;if(null==n&&(n={}),null!=this.trustedChildOriginForPosting){for(s=this._packagePostMessage(t,n),a=[],i=0,r=e.length;r>i;i++)o=e[i],a.push(o.contentWindow.postMessage(s,this.trustedChildOriginForPosting));return a}},i.prototype.postMessageToChildren=function(e,t,i){var o;return null==t&&(t={}),null==i&&(i=null),null==i&&(i=this._childIframeQuery),o=n(i),this.postMessageToChildElements(o,e,t)},i.prototype.postMessageToParent=function(e,t){var n;return null==t&&(t={}),n=this._packagePostMessage(e,t),null==this.trustedParentOriginForPosting?void this._parentMessageQueue.push(n):window.parent.postMessage(n,this.trustedParentOriginForPosting)},i.prototype._requestParentOrigin=function(){var e;return window.parent.postMessage('{"action": "child-requesting-parent-origin"}',"*"),e=function(){return this._requestParentOriginPollRetry=null,null==this._trustedParentOriginForPosting?this._requestParentOrigin():void 0},setTimeout(n.proxy(e,this),this._REQUEST_PARENT_ORIGIN_POLL_DELAY)},i}()})}.call(this),function(){define("modules/clean/fuzzy",[],function(){var e;return e={simpleFilter:function(t,n){return n.filter(function(n){return e.test(t,n)})},test:function(t,n){return null!==e.match(t,n)},match:function(e,t,n){var i,o,r,s,a,l,u,c,d,p,_,h,m,f;for(n=n||{},d=0,m=[],c=t.length,f=0,l=0,_=n.pre||"",p=n.post||"",r=n.caseSensitive&&t||t.toLowerCase(),i=void 0,o=void 0,e=n.caseSensitive&&e||e.toLowerCase(),u=0,h=[],s=0,a=0;c>u;)i=t[u],r[u]===e[d]?(i=_+i+p,a?a+=1:(s=u,a=1),d+=1,l+=1+l):(l=0,a&&(h.push([s,a]),a=0)),f+=l,m[m.length]=i,u++;return a&&h.push([s,a]),d===e.length?{highlighted:h,rendered:m.join(""),score:f}:null},filter:function(e,t,n){var i,o;return null==n&&(n={}),o=[],i=this._reduce.bind(this,e,n),t.reduce(i,o).sort(this._sort)},_reduce:function(t,n,i,o,r){var s,a;return a=o,n.extract&&(a=n.extract(o)),s=e.match(t,a,n),null!=s&&i.push({string:s.rendered,score:s.score,index:r,original:o}),i},_sort:function(e,t){var n;return n=t.score-e.score,n?n:e.index-t.index}}})}.call(this),function(){define("modules/clean/groups/api",["jquery","modules/clean/ajax","modules/clean/contacts/cache","modules/clean/viewer"],function(e,t,n,i){var o,r,s;return o=n.DefaultContactsCache,s={},r="/groups_ajax",s.ready=function(){},s.get_groups_for_user=function(e,t){return null==e&&(e={}),null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"get_groups_for_user",data:e,success:t})},s.get_group_info=function(e,t){return null==e&&(e={}),null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"get_group_info",data:e,success:t})},s.get_groups_for_team=function(e,t){return null==e&&(e={}),null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"get_groups_for_team",data:{},success:t})},s.get_users_for_group=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"get_users_in_group",data:e,success:t})},s.create_group=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"make_new_group",data:e,success:t,reload_contacts:!0})},s.create_group_with_users=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"make_new_group_with_users",data:e,success:t,reload_contacts:!0})},s.remove_group=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"remove_group",data:e,success:t,reload_contacts:!0})},s.rename_group=function(e,t,n){return null==n&&(n=function(){return{}}),s.metaserver_ajax({method:"rename_group",data:e,success:t,error:n,reload_contacts:!0})},s.add_users_to_group=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"add_users_to_group",data:e,success:t,reload_contacts:!0})},s.remove_user_from_group=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"remove_user_from_group",data:e,success:t,reload_contacts:!0})},s.change_group_member_type=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"change_group_member_type",data:e,success:t})},s.remove_namespace_from_group=function(e,t){return s.metaserver_ajax({method:"remove_namespace_from_group",data:e,success:t})},s.change_group_access_type=function(e,n){var o;return o=function(e,t,i){return n(i)},t.WebRequest({url:r+"/change_group_access_type",type:"post",data:e,subject_user:i.get_viewer().work_user,success:o})},s.make_group_join_request=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"make_group_join_request",data:e,success:t})},s.metaserver_ajax=function(n){var s,a,l,u;return u=r+"/"+n.method,a=n.reload_contacts||!1,l=function(t){var i,r;i=JSON.parse(t),i.ok&&(n.success(i.data),e(".error_msg").hide()),a&&o.load_contacts(r=!0)},s=function(t){var i;i=t.responseText,n.error&&(n.error(i.slice(4)),e(".error_msg").hide())},t.WebRequest({url:u,type:"post",data:n.data,subject_user:i.get_viewer().work_user,success:l,error:s})},s})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/growth/admin_console_ad",["jquery","modules/clean/analytics","modules/clean/dbmodal","modules/core/browser"],function(t,n,i,o){var r;return r=function(){function r(n,o,r){this.cta_selector=r,this._handleLinkClick=e(this._handleLinkClick,this),this.modal=new i.DBModal({element_id:o}),t(n).click(this._handleLinkClick)}return r.prototype._handleLinkClick=function(e){return e.preventDefault(),n.TeamsWebActionsLogger.log("click_admin_console_ad"),this.modal.show(),t(this.cta_selector).off(),t(this.cta_selector).click(this._handleCTAClick)},r.prototype._handleCTAClick=function(e){var i;return e.preventDefault(),i=t(e.target).attr("href"),n.TeamsWebActionsLogger.log("click_admin_console_ad_cta",{},function(){return o.redirect(i)})},r}()})}.call(this),function(){define("modules/clean/history",["external/modernizr","external/underscore","modules/core/browser","modules/core/exception","modules/core/uri"],function(e,t,n,i,o){var r,s;return s=i.assert,r=function(){var i,r,a,l,u,c,d,p,_,h,m,f,v,g,y;return i=new RegExp("#|;|\\?|:|@|&|=|\\+|\\$"),f=function(){var t,r,s;return s=void 0,e.history||-1===n.get_href().indexOf("#!")?(t=window.location.pathname,r=window.location.search,-1!==t.search(i)&&(t=String(o({path:t}))),s=t+r):s=n.get_href().split("#!").pop(),s},c=function(e,t){return String(o.parse(e).setQuery(t))},d=function(e){var t;return null==e&&(e=f()),t=e.split("?"),{url:e,path:t[0],qargs:o.parse(e).getQuery()}},a={},p={},v=f(),y=null,r="",m=function(e){var t;return t=r+"/"+e.substring(r.length).split("/")[1]},g=function(e){return r=e},_=function(){var e,t,n;return n=v,t=d(n),e=m(t.path),e in a?(a[e](t.path.substr(e.length+1),t.qargs),!0):!1},h=function(){var e,t,n;return n=v,t=d(n),e=m(t.path),e in p?p[e](t.path.substr(e.length+1),t.qargs):void 0},l=function(e,t){var n,i;return i=m(e),n=m(t),i!==n?h():void 0},u=function(){var e;return e=f(),e!==v?(l(v,e),v=e,_()):void 0},{init:function(){return y?void 0:(v=f(),y=setInterval(u,50))},add_callback:function(e,t,n){return this.init(),s("string"==typeof e,"DBHistory prefix is not a string"),s(0===e.indexOf("/"),"DBHistory prefix must be absolute"),s(-1===e.substring(r.length).indexOf("/",1),"multi-component prefixes arent supported"),a[e]=t,n?void 0:_()},add_exit_callback:function(e,t){return this.init(),s("string"==typeof e,"DBHistory prefix is not a string"),s(0===e.indexOf("/"),"DBHistory prefix must be absolute"),s(-1===e.substring(r.length).indexOf("/",1),"multi-component prefixes arent supported"),p[e]=t},fire_callbacks:function(){return _()},_build_url_for_state_change:function(e,t){var n;return s("string"==typeof e,"DBHistory path is not a string"),s(0===e.indexOf("/"),"DBHistory path must be absolute"),s(-1===e.indexOf("//"),"DBHistory path contains //"),n=c(e,t)},_pre_state_change:function(e){return e===v?!1:(l(v,e),!0)},_post_state_change:function(e){return null==e&&(e=!0),v=f(),e?_():void 0},replace_state:function(e,t){var n;return n=this._build_url_for_state_change(e,t),this._pre_state_change(n)&&window.history.replaceState?(window.history.replaceState(null,null,n),this._post_state_change()):void 0},push_state:function(n,i,o){var r;return null==o&&(o={}),o=t.defaults(o,{immediatelyRestoreState:!0}),s(-1===n.indexOf("?"),"DBHistory path contains ?"),s(-1===n.indexOf("#"),"DBHistory path contains #"),r=this._build_url_for_state_change(n,i),this._pre_state_change(r)?(e.history?window.history.pushState(null,null,r):window.location.href="#!"+r,this._post_state_change(o.immediatelyRestoreState)):void 0},update_query_param:function(t,n){var i;if(e.history)return i=this.deconstruct_url(),i.qargs[t]=n,this.replace_state(i.path,i.qargs)},remove_query_param:function(t){var n;if(e.history)return n=this.deconstruct_url(),delete n.qargs[t],this.replace_state(n.path,n.qargs)},get_url:f,construct_url:c,deconstruct_url:d,set_base_prefix:g,URL_ESCAPE_REGEX:i}}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/image_annotations",["jquery","modules/clean/image_viewer_annotation_interface","modules/clean/image_viewer_annotation_renderer","modules/clean/image_preview_util","modules/constants/comments_panel"],function(t,n,i,o,r){var s;return s=function(){function s(){this.onResize=e(this.onResize,this),this._onScroll=e(this._onScroll,this),this._handleMessage=e(this._handleMessage,this),this.isImagePreviewAnnotationCreationEnabled=r.ALLOW_ANNOTATION_IMAGE_PREVIEWS}return s.prototype.onImageLoad=function(e,t){return null==e&&(e=null),null==t&&(t=null),this.reset(),this.switchPreviewCallback=e,this.resizeImageCallback=t,this.$imageContainer=o.getPreviewImageContainer(),this.$image=o.getPreviewImage(),this._prepareAnnotations()},s.prototype._prepareAnnotations=function(){return this.isImagePreviewAnnotationCreationEnabled&&this._prepareAnnotationInterface(),this.annotationRenderer=new i,window.addEventListener("resize",this.onResize),o.getPreviewImageWrapper().on("scroll",this._onScroll),window.addEventListener("message",this._handleMessage),this._postPageRendered()},s.prototype._prepareAnnotationInterface=function(){var e,i;return 0===o.getAnnotationCreationContainer().length&&(e=o.getPreviewImageWrapper(),i=t("<div class='"+o.ANNOTATION_CREATION_CONTAINER+"' />"),this.$annotationCreationContainer=i.appendTo(e)),this._resizeAnnotationCreationContainer(),this.annotationInterface=new n,t(window).on("mouseup.image",this.annotationInterface.onMouseUpCallback).on("mousedown.image",this.annotationInterface.onMouseDownCallback).on("mousemove.image",this.annotationInterface.onMouseMoveCallback).on("keydown.image",this.annotationInterface.onKeyDownCallback),setTimeout(function(e){return function(){var t;return e._resizeAnnotationCreationContainer(),null!=(t=e.annotationInterface)?t.onScaleChangeCallback():void 0}}(this),0)},s.prototype._handleMessage=function(e){var t,n,i,o,r,s,a,l,u,c,d,p,_;try{r=JSON.parse(e.data)}catch(e){return void(i=e)}switch(r.action){case"update-annotations":return null!=(s=this.annotationRenderer)?s.updateAnnotations(r.parameters):void 0;case"remove-annotation":return n=r.parameters.commentActivity,null!=(a=this.annotationRenderer)?a.removeAnnotation(n):void 0;case"remove-all-annotations":return null!=(l=this.annotationRenderer)?l.removeAllAnnotations():void 0;case"enable-annotation-creation":return null!=(u=this.annotationInterface)?u.enableAnnotations():void 0;case"disable-annotation-creation":return null!=(c=this.annotationInterface)?c.disableAnnotations():void 0;case"hide-annotation":return null!=(d=this.annotationInterface)?d.onHideAnnotation():void 0;case"scroll-to-annotation":return n=r.parameters.commentActivity,null!=(p=this.annotationRenderer)?p.highlightAnnotation(n):void 0;case"file-feedback-ui-ready":return this._postPageRendered();case"switch-preview":return _=r.parameters.thumbnailUrl,n=r.parameters.commentActivity,t=function(e){return function(){return n?setTimeout(function(){var t;return null!=(t=e.annotationRenderer)?t.highlightAnnotation(n):void 0},300):void 0}}(this),"function"==typeof this.switchPreviewCallback?this.switchPreviewCallback(_,t):void 0}},s.prototype._postPageRendered=function(){return this._postMessage("page-rendered")},s.prototype._postMessage=function(e,t){return null==t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},s.prototype._onScroll=function(){var e;return null!=(e=this.annotationInterface)?e.onScrollCallback():void 0},s.prototype.onResize=function(e){var t,n;return null==e&&(e=!0),null!=(t=this.annotationRenderer)&&t.removeAllAnnotations(),this._postMessage("scale-change"),n=function(e){return function(){var t;return e._resizeAnnotationCreationContainer(),e._postPageRendered(),null!=(t=e.annotationInterface)&&t.onScaleChangeCallback(),"function"==typeof e.resizeImageCallback?e.resizeImageCallback():void 0}}(this),clearTimeout(this.scaleChangeTimer),e?this.scaleChangeTimer=setTimeout(n,100):n()},s.prototype._resizeAnnotationCreationContainer=function(){var e,t,n;return null!=(e=this.$annotationCreationContainer)&&e.height(this.$image.height()),null!=(t=this.$annotationCreationContainer)&&t.width(this.$image.width()),null!=(n=this.$annotationCreationContainer)?n.css("margin",this.$image.css("margin")):void 0},s.prototype.removeAnnotations=function(){var e;return null!=(e=this.annotationRenderer)?e.removeAllAnnotations():void 0},s.prototype.reset=function(){var e,n;return null!=(e=this.annotationRenderer)&&e.reset(),this.isImagePreviewAnnotationCreationEnabled&&(t(window).off("mouseup.image").off("mousedown.image").off("mousemove.image").off("keydown.image"),o.getPreviewImageWrapper().off("scroll",this.onResize),null!=(n=this.annotationInterface)&&n.reset()),window.removeEventListener("resize",this.onResize),window.removeEventListener("message",this._handleMessage),this._postMessage("reset-file-feedback-ui")},s}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/image_cache",[],function(){var t;return t=function(){function t(n){this._evict_lru=e(this._evict_lru,this),this._add_newest_node=e(this._add_newest_node,this),this._remove_node=e(this._remove_node,this),this._insert=e(this._insert,this),this.get_image=e(this.get_image,this),this.preload_image=e(this.preload_image,this),n&&(t.MAX_SIZE=n)}return t.MAX_SIZE=100,t.image_nodes_by_url={},t.oldest=null,t.newest=null,t.size=0,t.prototype.preload_image=function(e){return this._insert(e)},t.prototype.get_image=function(e){var t;return t=this._insert(e),this._remove_node(t),this._add_newest_node(t),t.image},t.prototype._insert=function(e){var n,i;return t.image_nodes_by_url[e]?t.image_nodes_by_url[e]:(i=new Image,i.src=e,n={url:e,image:i},t.image_nodes_by_url[e]=n,this._add_newest_node(n),n)},t.prototype._remove_node=function(e){var n,i;return t.oldest===e&&(t.oldest=e.newer),t.newest===e&&(t.newest=e.older),n=e.newer,i=e.older,null!=n&&(n.older=i),null!=i&&(i.newer=n),e.newer=null,e.older=null,t.size--},t.prototype._add_newest_node=function(e){return 0===t.size?(t.oldest=e,t.newest=e):(e.older=t.newest,t.newest.newer=e,t.newest=e),t.size++,this._evict_lru()},t.prototype._evict_lru=function(){var e;return t.size>t.MAX_SIZE?(e=t.oldest,this._remove_node(e),delete t.image_nodes_by_url[e.url]):void 0},t}()})}.call(this),function(){define("modules/clean/image_preview_util",["jquery","modules/clean/annotations/annotation"],function(e,t){var n,i,o,r;return n=t.Annotation,o=t.AnnotationTypes,i=t.AnnotationSubtypes,r={PREVIEW_IMAGE_CONTAINER:"preview-image-container",PREVIEW_IMAGE_WRAPPER:"preview-image-wrapper",PREVIEW_IMAGE:"preview-image",ANNOTATION_CREATION_CONTAINER:"db-annotation-creation-container",ANNOTATION_LAYER_CSS:"db-annotation-layer",ANNOTATION_CANVAS_LAYER_CSS:"db-annotation-canvas-layer",getPreviewImageContainer:function(){return e("."+this.PREVIEW_IMAGE_CONTAINER)},getPreviewImageWrapper:function(){return e("."+this.PREVIEW_IMAGE_WRAPPER)},getPreviewImage:function(){return this.getPreviewImageContainer().find("."+this.PREVIEW_IMAGE)},getPreviewImageElement:function(){return this.getPreviewImage()[0]},getAnnotationCreationContainer:function(){return e("."+this.ANNOTATION_CREATION_CONTAINER)},getAnnotationLayers:function(){return e("."+this.ANNOTATION_LAYER_CSS)},getAnnotationLCanvasLayer:function(){return e("."+this.ANNOTATION_CANVAS_LAYER_CSS)},convertAnnotationImagePointsToViewportCoordinates:function(e){var t,n,i,o,r,s,a,l,u,c,d,p,_,h,m,f,v;for(c=[],t=this.getPreviewImageElement(),_=t.offsetLeft,h=t.offsetTop,s=t.clientWidth,r=t.clientHeight,f=e.image_coordinates,o=0,l=f.length;l>o;o++){for(n=f[o],i=[],v=n.coordinates,a=0,u=v.length;u>a;a++)m=v[a],d=m.x*s+_,p=m.y*r+h,i.push({x:d,y:p});c.push(i)}return c},convertAnnotationViewportCoordinatesToImagePoints:function(e){var t,n,i,o,r,s,a,l,u,c,d,p,_,h,m,f,v;for(d=[],t=this.getPreviewImageElement(),r=t.getBoundingClientRect(),h=r.left,m=r.top,a=t.clientWidth,s=t.clientHeight,v=e.viewportCoordinates,o=0,u=v.length;u>o;o++){for(n=v[o],i=[],l=0,c=n.length;c>l;l++)f=n[l],p=(f.x-h)/a,_=(f.y-m)/s,i.push({x:p,y:_});d.push({coordinates:i})}return d}}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/image_viewer_annotation_interface",["jquery","external/react","modules/clean/annotations/annotation_controller","modules/clean/image_preview_util","modules/constants/comments_panel"],function(t,n,i,o,r){var s;return s=function(){function s(){this.onAnnotationLeaveCallback=e(this.onAnnotationLeaveCallback,this),this.onAnnotationEnterCallback=e(this.onAnnotationEnterCallback,this),this.onAnnotationScaleChangeCallback=e(this.onAnnotationScaleChangeCallback,this),this.onAnnotationScrollCallback=e(this.onAnnotationScrollCallback,this),this.onAnnotationEndDragCallback=e(this.onAnnotationEndDragCallback,this),this.onAnnotationStartDragCallback=e(this.onAnnotationStartDragCallback,this),this.onAnnotationPlacedCallback=e(this.onAnnotationPlacedCallback,this),this.onAnnotationHiddenCallback=e(this.onAnnotationHiddenCallback,this),this.onScaleChangeCallback=e(this.onScaleChangeCallback,this),this.onScrollCallback=e(this.onScrollCallback,this),this.onKeyDownCallback=e(this.onKeyDownCallback,this),this.onMouseUpCallback=e(this.onMouseUpCallback,this),this.onMouseMoveCallback=e(this.onMouseMoveCallback,this),this.onMouseDownCallback=e(this.onMouseDownCallback,this),this.onHideAnnotation=e(this.onHideAnnotation,this),this._prepareAnnotationCoords=e(this._prepareAnnotationCoords,this),this._prepareAnnotationController=e(this._prepareAnnotationController,this),this.controllerEventHandlers={onMouseMoveCallback:t.noop,onMouseDownCallback:t.noop,onMouseUpCallback:t.noop,onHideAnnotation:t.noop,onScrollCallback:t.noop,onScaleChangeCallback:t.noop,onKeyDownCallback:t.noop},this.isAnnotationMarkerEnabled=r.ALLOW_ANNOTATION_MARKER,this.isAnnotationRegionEnabled=r.ALLOW_ANNOTATION_REGION,this.isAnnotationCreationEnabled=!1,this._prepareAnnotationController()}return s.prototype._sendToParent=function(e,t){return null==t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},s.prototype._isOnAnnotationCreationContainer=function(e){return t(e.target).closest(".db-annotation-creation-container").length>0},s.prototype._isOnAnnotationUI=function(e){return t(e.target).parents(".db-annotation-layer").length>0},s.prototype._destroyAnnotationController=function(){var e;return e=o.getAnnotationLCanvasLayer(),n.unmountComponentAtNode(null!=e?e[0]:void 0),e.remove()},s.prototype._prepareAnnotationController=function(){var e,r,s;return r=o.getAnnotationCreationContainer(),0===r.find("."+o.ANNOTATION_CANVAS_LAYER_CSS).length?(s=t("<div class='"+o.ANNOTATION_CANVAS_LAYER_CSS+"' />"),this.$parentContainerEl=s.appendTo(r),e=this.$parentContainerEl.offset(),this.annotationController=n.render(n.createElement(i,{parentContainerOffset:e,controllerEventHandlers:this.controllerEventHandlers,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback,isAnnotationMarkerEnabled:this.isAnnotationMarkerEnabled,isAnnotationHighlightEnabled:!1,isAnnotationRegionEnabled:this.isAnnotationRegionEnabled,isAnnotationCreationEnabled:this.isAnnotationCreationEnabled}),this.$parentContainerEl.get(0))):void 0},s.prototype._prepareAnnotationCoords=function(e){return null!=e&&(e=this._addTranslatedImagePoints(e)),e},s.prototype._addTranslatedImagePoints=function(e){return e.image_coordinates=o.convertAnnotationViewportCoordinatesToImagePoints(e),e},s.prototype._updateOffset=function(e){var t;return null!=(t=this.annotationController)?t.setProps({parentContainerOffset:this.$parentContainerEl.offset()},function(){return"function"==typeof e?e():void 0}):void 0},s.prototype.enableAnnotations=function(){var e;return t("html").addClass("annotation"),this.isAnnotationCreationEnabled=!0,null!=(e=this.annotationController)?e.setProps({
isAnnotationCreationEnabled:this.isAnnotationCreationEnabled}):void 0},s.prototype.disableAnnotations=function(){var e;return t("html").removeClass("annotation"),this.isAnnotationCreationEnabled=!1,(null!=(e=this.annotationController)?e.isMounted():void 0)?this.annotationController.setProps({isAnnotationCreationEnabled:this.isAnnotationCreationEnabled}):void 0},s.prototype.reset=function(){return this.disableAnnotations(),this._destroyAnnotationController(),o.getAnnotationCreationContainer().remove()},s.prototype.onHideAnnotation=function(){var e;return null!=(e=this.controllerEventHandlers)?e.onHideAnnotation():void 0},s.prototype.onMouseDownCallback=function(e){var t;return!this._isOnAnnotationUI(e)&&this._isOnAnnotationCreationContainer(e)&&null!=(t=this.controllerEventHandlers)?t.onMouseDownCallback(e):void 0},s.prototype.onMouseMoveCallback=function(e){var t;return(this._isOnAnnotationCreationContainer(e)||this._isOnAnnotationUI(e))&&null!=(t=this.controllerEventHandlers)?t.onMouseMoveCallback(e):void 0},s.prototype.onMouseUpCallback=function(e){var t;return(this._isOnAnnotationCreationContainer(e)||this._isOnAnnotationUI(e))&&null!=(t=this.controllerEventHandlers)?t.onMouseUpCallback(e):void 0},s.prototype.onKeyDownCallback=function(e){var t;return t=e.keyCode||e.which||e.charCode,this._sendToParent("on-keydown",{keyCode:t})},s.prototype.onScrollCallback=function(e){var t;return this._updateOffset(null!=(t=this.controllerEventHandlers)?t.onScrollCallback:void 0)},s.prototype.onScaleChangeCallback=function(e){var t;return this._updateOffset(null!=(t=this.controllerEventHandlers)?t.onHideAnnotation:void 0),this._sendToParent("scale-change",e)},s.prototype.onAnnotationHiddenCallback=function(){return this._sendToParent("annotation-hidden")},s.prototype.onAnnotationPlacedCallback=function(e){return this._sendToParent("annotation-placed",{annotation:this._prepareAnnotationCoords(e)})},s.prototype.onAnnotationStartDragCallback=function(e){return this._sendToParent("annotation-start-drag")},s.prototype.onAnnotationEndDragCallback=function(e){return this._sendToParent("annotation-end-drag",{annotation:this._prepareAnnotationCoords(e)})},s.prototype.onAnnotationScrollCallback=function(e){return this._sendToParent("scroll",{annotation:this._prepareAnnotationCoords(e)})},s.prototype.onAnnotationScaleChangeCallback=function(e){return this._sendToParent("scale-change",{annotation:this._prepareAnnotationCoords(e)})},s.prototype.onAnnotationEnterCallback=function(){return this._sendToParent("annotation-enter",{annotation:this._prepareAnnotationCoords()})},s.prototype.onAnnotationLeaveCallback=function(){return this._sendToParent("annotation-leave",{annotation:this._prepareAnnotationCoords()})},s}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/image_viewer_annotation_renderer",["jquery","external/react","modules/clean/annotations/annotation_highlight_ui","modules/clean/annotations/annotation_marker_ui","modules/clean/annotations/annotation_region_ui","modules/clean/annotations/annotation_renderer_utils","modules/clean/image_preview_util"],function(t,n,i,o,r,s,a){var l,u;return u=new s,l=function(){function i(){this.onAnnotationLeaveCallback=e(this.onAnnotationLeaveCallback,this),this.onAnnotationEnterCallback=e(this.onAnnotationEnterCallback,this),this.onAnnotationClickCallback=e(this.onAnnotationClickCallback,this),this._renderAnnotation=e(this._renderAnnotation,this),this.updateAnnotations=e(this.updateAnnotations,this),this.removeAnnotation=e(this.removeAnnotation,this),this._annotationsByActivityKey={}}return i.prototype._isAnnotationAlreadyRendered=function(e){return t("."+a.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e+"']").length>0},i.prototype.removeAnnotation=function(e){var i;return this._isAnnotationAlreadyRendered(e.activity_key)?(i=t("."+a.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e.activity_key+"']").get(0),n.unmountComponentAtNode(i),i.remove()):void 0},i.prototype.removeAllAnnotations=function(){return this.reset()},i.prototype.reset=function(){var e,t,i,o;for(t=a.getAnnotationLayers(),i=0,o=t.length;o>i;i++)e=t[i],n.unmountComponentAtNode(e);return t.remove(),this._annotationsByActivityKey={}},i.prototype.highlightAnnotation=function(e){var n;return this._isAnnotationAlreadyRendered(e.activity_key)?(n=t("."+a.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e.activity_key+"']"),n.removeClass("start-highlight-animation"),n.width(n.width()),n.addClass("start-highlight-animation")):void 0},i.prototype.updateAnnotations=function(e){var t,n,i,o,r,s;if(u.shouldUpdateAnnotations(e,this._annotationsByActivityKey)){for(this.removeAllAnnotations(),r=e.annotations,s=[],i=0,o=r.length;o>i;i++)n=r[i],u.renderAnnotation(n,this._isAnnotationAlreadyRendered,this._renderAnnotation),t=n.commentActivity.activity_key,s.push(this._annotationsByActivityKey[t]=n);return s}},i.prototype._renderAnnotation=function(e,i,o,r){var s,l,u;return l=a.getPreviewImageWrapper(),(null!=l?l.length:void 0)>0?(i.viewportCoordinates=a.convertAnnotationImagePointsToViewportCoordinates(i),u=t("<div class='"+a.ANNOTATION_LAYER_CSS+"' />"),u.attr({"data-comment-activity-key":o.activity_key}),s=u.appendTo(l).get(0),n.render(n.createElement(e,{annotation:i,commentActivity:o,options:r,onAnnotationClickCallback:this.onAnnotationClickCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationOverCallback:this.onAnnotationOverCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback}),s)):void 0},i.prototype._sendToParent=function(e,t){return null==t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},i.prototype.onAnnotationClickCallback=function(e){return this._sendToParent("annotation-ui-click",e)},i.prototype.onAnnotationEnterCallback=function(e){return this._sendToParent("annotation-ui-enter",e)},i.prototype.onAnnotationOverCallback=function(e){return{}},i.prototype.onAnnotationLeaveCallback=function(e){return this._sendToParent("annotation-ui-leave",e)},i}()})}.call(this),function(){define("modules/clean/immutability_helper",["external/underscore","external/react","modules/core/types"],function(e,t,n){var i,o,r,s,a,l,u,c,d,p;return u=n.takes,i=n.Either,d=t.addons.update,p=u(i(Object,Array),Array,Function,function(e,t,n){var i,o;return o=function(e,t){var n;return n={},n[""+t]=e,n},i=t.reduceRight(o,{$apply:n}),d(e,i)}),a=function(e,t,n){return p(e,t,function(){return n})},o=u(i(Object,Array),Array,function(e,t){var n;return n=function(e,t){return null!=e?e[t]:void 0},t.reduce(n,e)}),r=function(e,t){return d(e,{$merge:t})},s=function(e,t){return d(e,{$push:t})},c=function(e,t){return d(e,{$unshift:t})},l=function(e,t){return d(e,{$splice:t})},{updateIn:p,setIn:a,getIn:o,splice:l,unshift:c,push:s,merge:r}})}.call(this),function(){define("modules/clean/index_2015",["jquery","external/underscore","modules/clean/dbmodal","modules/clean/analytics","modules/clean/register_form"],function(e,t,n,i,o){var r,s;return s=i.UserActivityLogger,r=function(){function i(){var i,r,a;this._onScrollHandler(),e(window).scroll(t.throttle(this._onScrollHandler,33,{leading:!0,trailing:!0})),a=new n.DBModal({element_id:"sign-up-modal"}),e("#sign-up, .sign-up").on("click",function(e){return e.preventDefault(),s.log("","web_register"),a.show()}),r=new n.DBModal({element_id:"index-sign-in-modal"}),e("#sign-in").on("click",function(e){return e.preventDefault(),r.show(),s.log("","web_login")}),e(document).on(o.USER_EXISTS,function(e){return r.show(e.focus,e.prefill)}),e(".get-dropbox-cta-v2__show-modal").length>0&&(i=new n.DBModal({element_id:"pro-plan-modal"}),e(".get-dropbox-cta-v2__show-modal").on("click",function(e){return i.show()}))}return i.prototype._onScrollHandler=function(){return e(window).scrollTop()>350?(e("#dropbox-logo").addClass("fade-out"),e(".button-toggler").addClass("show-sign-up")):(e("#dropbox-logo").removeClass("fade-out"),e(".button-toggler").removeClass("show-sign-up"))},i}()})}.call(this),function(){define("modules/clean/js_environment",[],function(){return{isBrowser:function(){return"undefined"!=typeof window&&null!==window},isTest:function(){return"undefined"!=typeof jasmine&&null!==jasmine}}})}.call(this),function(){define("modules/clean/legacy_ui_button",["jquery"],function(e){var t;return t=function(){var t;return t=e(document),e(document).on("mouseover.ui-button",".ui-button",function(){return e(this).addClass("over")}).on("mouseout.ui-button",".ui-button",function(){return e(this).removeClass("over")}).on("mousedown.ui-button",".ui-button",function(){return e(this).addClass("down")}).on("click.ui-button",".ui-button",function(){var n;return n=e(this),n.hasClass("ui-button-dropdown")&&(n.hasClass("active")?t.trigger("dropdownClosed",[1]):t.trigger("dropdownOpened",[1])),n.toggleClass("active")}),t.on("click.ui-button",function(n){var i,o,r;return i=e(n.target),o=i.closest(".ui-button.active"),r=0,e(".ui-button.active").not(o).each(function(){var t;return t=e(this),t.hasClass("active")&&t.hasClass("ui-button-dropdown")&&(r+=1),t.removeClass("active")}),t.trigger("dropdownClosed",[r])}).on("mouseup.ui-button",function(){return e(".ui-button.down").removeClass("down")})}})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/loggers/file_preview_logger",["modules/clean/ajax","modules/clean/react/file_viewer/constants","modules/clean/uuid"],function(t,n,i){var o,r,s,a,l;return r=n.EventTypes,o={},o[r.FILE_VIEWER_CLOSED]="viewer_closed",o[r.FILE_PREVIEW_ATTEMPT_STARTED]="preview_attempted",o[r.FILE_PREVIEW_SUPPORT_CONFIRMED]="support_confirmed",o[r.FILE_PREVIEW_SUPPORT_DENIED]="support_denied",o[r.FILE_PREVIEW_DOWNLOAD_SUCCEEDED]="download_succeeded",o[r.FILE_PREVIEW_DOWNLOAD_FAILED]="download_failed",o[r.FILE_PREVIEW_RENDER_SUCCEEDED]="render_succeeded",o[r.FILE_PREVIEW_RENDER_FAILED]="render_failed",o[r.FILE_PREVIEW_SEEN_STATE_SHOWN]="seen_state_shown",o[r.FILE_PREVIEW_PASS_SHOWN]="pass_shown",o[r.FILE_PREVIEW_PASS_HOVER]="pass_hover",o[r.FILE_PREVIEW_PASS_CLICK]="pass_click",s=function(){function e(){}return e.prototype._getSerializedTimeline=function(){return null},e.prototype._log=function(e,n,i){var r,s;return null==i&&(i={}),s=this._getSerializedTimeline(),r={event_name:o[e],file_viewer_session_id:n.fileViewerSession.id,file_preview_session_id:n.id,file_ns_id:n.file.ns_id,file_sjid:n.file.sjid,file_preview_timeline:null!=s?JSON.stringify(s):null,extra:JSON.stringify(i)},t.AuthenticatedRequest({url:"/log/file_preview",data:r})},e}(),a=function(t){function n(){this._passEventsToHandler={},this._passEventsToHandler[r.FILE_PREVIEW_SEEN_STATE_SHOWN]=this._handleFilePreviewSeenStateShown.bind(this),this._passEventsToHandler[r.FILE_PREVIEW_PASS_SHOWN]=this._handleFilePreviewPassShown.bind(this),this._passEventsToHandler[r.FILE_PREVIEW_PASS_HOVER]=this._handleFilePreviewPassHover.bind(this),this._passEventsToHandler[r.FILE_PREVIEW_PASS_CLICK]=this._handleFilePreviewPassClick.bind(this)}return e(n,t),n.prototype.listenTo=function(e){var t,n,i,o;i=this._passEventsToHandler,o=[];for(t in i)n=i[t],o.push(e.addListener(t,n));return o},n.prototype.unlistenTo=function(e){var t,n,i,o;i=this._passEventsToHandler,o=[];for(t in i)n=i[t],o.push(e.removeListener(t,n));return o},n.prototype._convertEventDataToExtra=function(e){return{num_current_viewers:e.numCurrentViewers,num_viewers:e.numViewers}},n.prototype._handleFilePreviewSeenStateShown=function(e,t){return this._log(r.FILE_PREVIEW_SEEN_STATE_SHOWN,e,this._convertEventDataToExtra(t))},n.prototype._handleFilePreviewPassShown=function(e,t){return this._log(r.FILE_PREVIEW_PASS_SHOWN,e,this._convertEventDataToExtra(t))},n.prototype._handleFilePreviewPassHover=function(e,t){return this._log(r.FILE_PREVIEW_PASS_HOVER,e,this._convertEventDataToExtra(t))},n.prototype._handleFilePreviewPassClick=function(e,t){return this._log(r.FILE_PREVIEW_PASS_CLICK,e,this._convertEventDataToExtra(t))},n}(s),l=function(t){function n(e){this._currentFileViewerSession=e,this._lastEvent=null,this._expectedPreviousEvent={},this._expectedPreviousEvent[r.FILE_PREVIEW_ATTEMPT_STARTED]=null,this._expectedPreviousEvent[r.FILE_PREVIEW_SUPPORT_CONFIRMED]=r.FILE_PREVIEW_ATTEMPT_STARTED,this._expectedPreviousEvent[r.FILE_PREVIEW_SUPPORT_DENIED]=r.FILE_PREVIEW_ATTEMPT_STARTED,this._expectedPreviousEvent[r.FILE_PREVIEW_DOWNLOAD_SUCCEEDED]=r.FILE_PREVIEW_SUPPORT_CONFIRMED,this._expectedPreviousEvent[r.FILE_PREVIEW_DOWNLOAD_FAILED]=r.FILE_PREVIEW_SUPPORT_CONFIRMED,this._expectedPreviousEvent[r.FILE_PREVIEW_RENDER_SUCCEEDED]=r.FILE_PREVIEW_DOWNLOAD_SUCCEEDED,this._expectedPreviousEvent[r.FILE_PREVIEW_RENDER_FAILED]=r.FILE_PREVIEW_DOWNLOAD_SUCCEEDED,this._timelineEventsToHandler={},this._timelineEventsToHandler[r.FILE_PREVIEW_ATTEMPT_STARTED]=this._handleFilePreviewAttemptStarted.bind(this),this._timelineEventsToHandler[r.FILE_PREVIEW_SUPPORT_CONFIRMED]=this._handleFilePreviewSupportConfirmed.bind(this),this._timelineEventsToHandler[r.FILE_PREVIEW_SUPPORT_DENIED]=this._handleFilePreviewSupportDenied.bind(this),this._timelineEventsToHandler[r.FILE_PREVIEW_DOWNLOAD_SUCCEEDED]=this._handleFilePreviewDownloadSucceeded.bind(this),this._timelineEventsToHandler[r.FILE_PREVIEW_DOWNLOAD_FAILED]=this._handleFilePreviewDownloadFailed.bind(this),this._timelineEventsToHandler[r.FILE_PREVIEW_RENDER_SUCCEEDED]=this._handleFilePreviewRenderSucceeded.bind(this),this._timelineEventsToHandler[r.FILE_PREVIEW_RENDER_FAILED]=this._handleFilePreviewRenderFailed.bind(this),this._timelineEventsToHandler[r.FILE_VIEWER_CLOSED]=this._handleFileViewerClosed.bind(this),this.filePreviewTimeline={}}return e(n,t),n.prototype.listenTo=function(e){var t,n,i,o;i=this._timelineEventsToHandler,o=[];for(t in i)n=i[t],o.push(e.addListener(t,n));return o},n.prototype.unlistenTo=function(e){var t,n,i,o;i=this._timelineEventsToHandler,o=[];for(t in i)n=i[t],o.push(e.removeListener(t,n));return o},n.prototype._handleFilePreviewAttemptStarted=function(e){return this._handleEvent(r.FILE_PREVIEW_ATTEMPT_STARTED,e)},n.prototype._handleFilePreviewSupportConfirmed=function(e){return this._handleEvent(r.FILE_PREVIEW_SUPPORT_CONFIRMED,e)},n.prototype._handleFilePreviewSupportDenied=function(e){return this._handleEvent(r.FILE_PREVIEW_SUPPORT_DENIED,e)},n.prototype._handleFilePreviewDownloadSucceeded=function(e){return this._handleEvent(r.FILE_PREVIEW_DOWNLOAD_SUCCEEDED,e)},n.prototype._handleFilePreviewDownloadFailed=function(e){return this._handleEvent(r.FILE_PREVIEW_DOWNLOAD_FAILED,e)},n.prototype._handleFilePreviewRenderSucceeded=function(e){return this._handleEvent(r.FILE_PREVIEW_RENDER_SUCCEEDED,e)},n.prototype._handleFilePreviewRenderFailed=function(e){return this._handleEvent(r.FILE_PREVIEW_RENDER_FAILED,e)},n.prototype._handleFileViewerClosed=function(e){return this._handleEvent(r.FILE_VIEWER_CLOSED,e)},n.prototype._handleEvent=function(e,t){if(this._currentFileViewerSession===t.fileViewerSession&&null!=t.file){if(e===r.FILE_PREVIEW_ATTEMPT_STARTED)this._currentFilePreviewSession=t,this._lastEvent=null,this.clearState();else if(this._currentFilePreviewSession!==t)return;if(!(e in this._expectedPreviousEvent&&this._lastEvent!==this._expectedPreviousEvent[e]||this._isEventInTimeline(e)))return this._addToTimeline(e),this._lastEvent=e,this._log(e,this._currentFilePreviewSession,{file_preview_timeline:JSON.stringify(this._getSerializedTimeline())})}},n.prototype._isEventInTimeline=function(e){return e in this.filePreviewTimeline},n.prototype._addToTimeline=function(e){return this.filePreviewTimeline[e]={timestamp:Date.now()}},n.prototype._getSerializedTimeline=function(){var e,t,n,i,o;n={},t=this.filePreviewTimeline;for(e in t)i=t[e],o=this._timelineKey(e),n[o]=i.timestamp;return n},n.prototype._timelineKey=function(e){var t;return t=o[e],t+"_ts"},n.prototype.clearState=function(){return this.filePreviewTimeline={}},n}(s),{FilePreviewPassLogger:a,FilePreviewTimelineLogger:l}})}.call(this),function(){define("modules/clean/loggers/file_viewer_logger",["jquery","modules/constants/python","modules/clean/analytics","modules/clean/previews/util"],function(e,t,n,i){var o,r,s,a,l;return o=t.FileViewModeType,r=t.FileViewPlatformType,s=t.FileViewTargetType,l=i.PreviewHelper,a=function(){function t(){}return t.start=function(){return n.UserActivityLogger.start("web","file_view_first_page_rendered"),n.PreviewActivityLogger.start("file_view_first_page_rendered"),n.FileViewLogger.start()},t.logPageRendered=function(t,i){var o,r,s,a,u,c,d;for(t=t,o=l.get_extension(t),a=e.extend(i.attributes,{total_time:-1,file_ext:o,source:"file-viewer",originalSize:null!=t.bytes?t.bytes:0,docPreviewStatus:t.doc_preview_status}),c=i.stats,r=0,s=c.length;s>r;r++)d=c[r],u=function(){switch(d.name){case"Page Request":return"viewer_page_request_time";case"Rendering":return"viewer_rendering_time";case"Overall":return"viewer_overall_time"}}(),a[u]=d.end-d.start;return n.UserActivityLogger.stop("web","file_view_first_page_rendered",a),n.PreviewActivityLogger.stop("file_view_first_page_rendered",{file_ext:o,extra:JSON.stringify(a)})},t.logView=function(e,t,i,o,s,a,u,c){var d;return null==u&&(u=1),null==c&&(c=!1),d={user_id:null!=t?t.id:void 0,target:i,platform:r.WEB,ns_id:e.ns_id,sjid:e.sjid,ns_path:e.ns_path,origin:o,action:s,shared_link_url:a,extra:{file_ext:l.get_extension(e),file_bytes:e.bytes,file_mtime:e.ts,preview_type:e.preview_type,preview_status:e.doc_preview_status,time_taken:-1,in_progress:c,is_team:1===(null!=t?t.is_team:void 0),paid:1===(null!=t?t.paid:void 0),file_view_attempts:u}},n.FileViewLogger.stop(d)},t}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/loggers/folder_invite_impression_logger",["modules/clean/analytics","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/models"],function(t,n,i){var o,r,s,a,l,u,c,d;return l=t.ProEventsLogger,o=n.EventTypes,c=i.SharedFolderInviteData,d=i.UserNotification,a=c.OVER_QUOTA_STATUSES,s=3,u={},u[a.ALREADY_OVER]="view_shared_folder_notification_already_oq",u[a.WILL_BE_OVER]="view_shared_folder_notification_near_oq",r=function(){function t(){this._handleRenderedNotifications=e(this._handleRenderedNotifications,this)}return t.prototype.listenTo=function(e){return e.addListener(o.RENDERED_NOTIFICATIONS,this._handleRenderedNotifications)},t.prototype.unlistenTo=function(e){return e.removeListener(o.RENDERED_NOTIFICATIONS,this._handleRenderedNotifications)},t.prototype._handleRenderedNotifications=function(e){var t;return t=e.notifications,this._hasLoggedOverQuotaImpressions?void 0:(this._hasLoggedOverQuotaImpressions=!0,this._logOverQuotaImpressions(t))},t.prototype._logOverQuotaImpressions=function(e){var t,n,i,o,r,a,c;for(a=e.slice(0,s),c=[],n=0,i=a.length;i>n;n++)if(o=a[n],o.type===d.TYPES.SHARED_FOLDER_INVITE){if(r=o.typeData.overQuotaStatus,t=u[r]){l.log(t);break}c.push(void 0)}else c.push(void 0);return c},t}()})}.call(this),function(){define("modules/clean/loggers/notification_logger",["modules/clean/ajax","modules/clean/react/user_notifications/models"],function(e,t){var n,i;return i=t.UserNotification,n={logReceive:function(e){return n._log("receive",e,!1,0,n._eventData)},logRender:function(e,t){return n._log("render",e,!0,t,n._eventData)},logReceiveLegacy:function(e){return n._log("receive",e,!1,0,n._eventDataLegacy)},logRenderLegacy:function(e,t){return n._log("render",e,!0,t,n._eventDataLegacy)},_log:function(t,n,i,o,r){var s,a,l;if(0!==n.length)return s=function(){var e,s,u;for(u=[],a=e=0,s=n.length;s>e;a=++e)l=n[a],u.push(r(t,l,o+a,i));return u}(),e.AuthenticatedRequest({url:"/log/notif_events",data:{event_list:JSON.stringify(s)}})},_eventData:function(e,t,n,o){var r;return r={event_name:e,type_id:t.typeId,campaign_id:t.campaignId,campaign_version:t.campaignVersion,instance_id:t.id,status:i.STATUS_STRINGS[t.status],target_object_key:t.targetObjectKey,location:o?"home":void 0,location_index:o?n:void 0,is_prominent:o?t.isSticky:void 0}},_eventDataLegacy:function(e,t,n,o){var r;return r={event_name:e,type_id:t.type_id,campaign_id:t.campaign_id,campaign_version:t.campaign_version,instance_id:t.nid,status:i.STATUS_STRINGS[t.status],target_object_key:t.target_object_key,location:o?"home":void 0,location_index:o?n:void 0,is_prominent:o?t.sticky:void 0}}},{NotificationLogger:n}})}.call(this),function(){define("modules/clean/multiaccount_login",["jquery","modules/core/browser","modules/core/controller_helpers","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/viewer","modules/clean/dbmodal","modules/clean/teams/team_assume_user_personal_locked_modal"],function(e,t,n,i,o,r,s,a,l){var u,c,d,p;return p=i.assert,d=o._,u=a.DBModal,c=function(){function i(){}return i.$element=function(){return e("#db-modal-multiaccount-login-modal")},i.set_during_login_callback=function(e){return p(!this._during_login_callback,"already have a during_login_callback"),this._during_login_callback=e},i.show_modal=function(i){var o,a,l,c,_;return null==i&&(i={}),s.get_viewer().is_team_assume_user_session?this.show_personal_account_disabled_modal():(this.$element=e.isFunction(this.$element)?this.$element():this.$element,p(null!=(a=this.$element)?a.length:void 0,"MultiaccountLogin needs its @$element to be set"),p(!(null!=i.on_success&&null!=i.success_href),"on_success and success_href are mutually exclusive"),null!=i.user?_=i.user:null!=i.user_id?_=s.get_viewer().get_user_by_id(i.user_id,!0):null!=i.role&&(_=s.get_viewer().get_user_by_role(i.role,!0)),p(null!=_,"invalid user"),l=_.role,p(!s.get_viewer().is_user_signed_in(_),"called MultiaccountLogin for a user that's already signed in"),c="personal"===l?d("Sign in to your personal Dropbox"):d("Sign in to your %(team_name)s Dropbox").format({team_name:s.get_viewer().team_name}),o=this.$element.find("form"),n.get_controller(o).reset(),n.get_controller(o).set_input_value("login_email",_.email),this.auth_success_callback=function(e){return function(){var n;return s.get_viewer()._sign_in_all_users(),n=function(n){return null!=n?(r.error(n),s.get_viewer()._sign_out_user_by_id(_.id),void e.modal.hide()):null!=i.success_href?t.get_uri().toString()!==i.success_href?t.redirect(i.success_href):t.reload():(e.modal.hide(),"function"==typeof i.on_success?i.on_success():void 0)},null!=e._during_login_callback&&null==i.success_href?e._during_login_callback(_,n):n(),!1}}(this),e(document).off("db:multilogin:success"),e(document).on("db:multilogin:success",this.auth_success_callback),this.modal=new u({element_id:"multiaccount-login-modal"}),this.modal.show(),this.modal.set_title(c),this.$element.find('input[name="login_password"]').focus())},i.show_page_login_modal=function(e){var t,n,i,o,r,a,l;for(l=s.get_viewer(),i=null,r=l.get_users(!0),t=0,n=r.length;n>t;t++)if(a=r[t],!l.is_user_signed_in(a)){i=a;break}return i?(o={user:i},"string"==typeof e?o.success_href=e:"function"==typeof e&&(o.on_success=e),this.show_modal(o),!1):void 0},i.show_personal_account_disabled_modal=function(){var e;return e=s.get_viewer(),l.AssumePersonalLockedModal.show({displayName:e.display_name,teamName:e.team_name}),!1},i}(),INLINE_JS.MultiaccountLogin=c,c})}.call(this),function(){define("modules/clean/notification_feed",["jquery","modules/clean/ajax","modules/clean/loggers/notification_logger","modules/clean/notserver","modules/constants/legacy","modules/core/i18n","modules/clean/analytics"],function(e,t,n,i,o,r,s){var a,l,u,c,d,p;return l=n.NotificationLogger,a=i.NotClients,p=r.ungettext,u=s.ProEventsLogger,c={USER_NOTIFICATION_STATUS_UNREAD:0,USER_NOTIFICATION_STATUS_READ:1,USER_NOTIFICATION_STATUS_INVISIBLE:2,MAX_ROWS_TO_RETRIEVE:100,MAX_INITIAL_ROWS:10,NUM_ROWS_TO_APPEND:10,SCROLLING_OFFSET:10,_is_retrieving_feed:!1,_unread_count:0,_notifications:[],LAST_ACKED_META_ID_KEY:"last_acked_meta_id_key",_current_meta_not_id:null,_num_event_rows:0,_acked_ids:{},_shown:{},_has_more:!1,_has_acked:!1,_feed_load_callbacks:[],THUMBS_BATCH_SIZE:16,_thumb_cache:{},init:function(){var t,n,i;this.refresh_feed(),e("#event-feed-container").scroll(function(){var e;return c._has_more&&c._scroller_within_offset_to_bottom(c.SCROLLING_OFFSET)?(e=c._append_event_rows(!1),c.log_rendered_notifications(e)):void 0}),e("#event-feed-container").on("mousewheel",this.scrolling.bind(this)),e("#event-feed-container").on("DOMMouseScroll",this.scrolling.bind(this)),e("#event-feed").on("click",this._mouseclick.bind(this)),n=[];for(i in a)t=a[i],n.push(this._subscribe_user(t));return n},refresh_feed:function(e,n){var i,o,r;return r=function(t){return function(i){var o,r,s,a;return t._unread_count=i.unread_count,t._notifications=i.notifications,i.meta_notification&&(r=i.meta_notification,s=t._identifier(r),s!==t._get_last_acked_meta_not_id()&&t._unread_count++,t._current_meta_not_id=s,t._notifications.push(r)),l.logReceiveLegacy(t._notifications),t._has_acked=!1,t._notifications.sort(t._sort_key),t._append_event_rows(!0),t.update_jewel_ui(t._unread_count),null!=e&&null!=n?(a=e.get_user_id(),o=i.latest_nid[a],e.handler_success(n,{nid:i.latest_nid[a]})):void 0}}(this),o=function(e){return function(){var t,n,i,o;for(e._is_retrieving_feed=!1,o=e._feed_load_callbacks,n=0,i=o.length;i>n;n++)(t=o[n])();return e._feed_load_callbacks=[]}}(this),(i=function(i){return function(){var s;return i._is_retrieving_feed=!0,s={count:i.MAX_ROWS_TO_RETRIEVE},t.WebRequest({url:"/web/notifications/retrieve",data:s,dataType:"json",success:r,complete:o,error:function(){return null!=e&&null!=n?e.handler_failure(n):void 0}})}}(this))()},ack_unread_notifications:function(){return!this._has_acked&&this._unread_count>0?(this.update_jewel_ui(0),this._get_last_acked_meta_not_id()!==this._current_meta_not_id&&(this._set_last_acked_meta_not_id(this._current_meta_not_id),this._acked_ids[this._current_meta_not_id]=!0),t.WebRequest({url:"/web/notifications/ack_all",dataType:"json",success:function(e){return function(t){var n,i,o,r,s;for(s=[],n=0,o=t.length;o>n;n++)r=t[n],i=e._identifier(r),e._acked_ids[i]=!0,s.push(e._append_event_rows());return s}}(this)}),this._has_acked=!0):void 0},update_jewel_ui:function(t){var n;return n="",t>0&&(n=p("%(count)s new","%(count)s new",t,{comment:"new notification count"}).format({count:t})),e("#new-notification-count--descriptive").text(n),e("#new-notification-count").text(t).toggleClass("show",t>0),t>0&&e(".notifications-bell").addClass("shake"),setTimeout(function(){return e(".notifications-bell").removeClass("shake")},500)},scrolling:function(t){var n;return t.originalEvent&&(t=t.originalEvent),n=t.detail?-40*t.detail:t.wheelDelta,!this._has_more&&0>=n&&this._scroller_within_offset_to_bottom(0)?t.preventDefault():n>=0&&0===e("#event-feed-container")[0].scrollTop?t.preventDefault():void 0},clear_cached_client_states:function(){return this._is_retrieving_feed?void 0:(this._acked_ids={},this._append_event_rows(!0))},_subscribe_user:function(e){var t;return t=e.subscribe_user({name:"NotificationFeedUpdater",handler:function(n){return function(){return n.refresh_feed(e,t)}}(this)})},_append_event_rows:function(t){var n,i,r,s,a,l,u,c,d,p,_,h,m,f,v,g,y,b;for(null==t&&(t=!1),t?(e("#event-feed").empty(),this._shown={},this._num_event_rows=Math.min(this._notifications.length,this.MAX_INITIAL_ROWS)):(this._num_event_rows+=this.NUM_ROWS_TO_APPEND,this._num_event_rows=Math.min(this._num_event_rows,this._notifications.length)),h=e(".feed-row").size(),i=[],g=h,f=this._notifications,c=a=0,d=f.length;d>a&&(_=f[c],!(h>=this._num_event_rows));c=++a)l=this._identifier(_),l in this._shown||(this._shown[l]=!0,y=_.status,s=e(_.notification_div),v=s,e("#event-feed").append(v),h++,u=s.find("img").get(0),u&&(n=e(u),n.attr("alt",""),r=n.attr("data-src"),r&&(this._thumb_cache[r]?(p=this._thumb_cache[r],n.attr("src",p),this._add_thumbnail_frame(n)):r in this._thumb_cache||(this._thumb_cache[r]=!1,b=_.user_id,n.data("uid",b),n.data("not-identifier",l),i.push(u)))),s.hasClass("feed-row")||(s=s.find(".feed-row")),_.type_id===o.NOTIFICATION_TYPE_META&&(s.addClass("meta-feed"),l in this._acked_ids||l!==this._get_last_acked_meta_not_id()||s.addClass("read")),y===this.USER_NOTIFICATION_STATUS_INVISIBLE&&(s.addClass("invisible"),l in this._acked_ids&&delete this._acked_ids[l]),y===this.USER_NOTIFICATION_STATUS_READ&&(l in this._acked_ids||s.addClass("read")));return m=function(t){return function(n){var i,o,r;return i=e(n),t._add_thumbnail_frame(i),l=i.data("not-identifier"),r=i.attr("data-src"),o=i.attr("src"),t._thumb_cache[r]=o}}(this),i.length&&require(["modules/clean/photos/legacy_thumb_loader"],function(e){return function(t){var n;return(n=t.batch_load_thumbs)(i,e.THUMBS_BATCH_SIZE,m)}}(this)),this._has_more=this._num_event_rows<this._notifications.length,0===e(".feed-row").length?e("#event-feed-container").addClass("empty"):e("#event-feed-container").removeClass("empty"),g},_identifier:function(e){return e.user_id+" "+e.type_id+" "+e.target_object_key},_sort_key:function(e,t){return e.sticky&&!t.sticky?-1:t.sticky&&!e.sticky?1:e.status===c.USER_NOTIFICATION_STATUS_UNREAD&&t.status!==c.USER_NOTIFICATION_STATUS_UNREAD?-1:t.status===c.USER_NOTIFICATION_STATUS_UNREAD&&e.status!==c.USER_NOTIFICATION_STATUS_UNREAD?1:t.feed_time-e.feed_time},_get_last_acked_meta_not_id:function(){return window.localStorage?localStorage.getItem(this.LAST_ACKED_META_ID_KEY):void 0},_set_last_acked_meta_not_id:function(e){return window.localStorage?localStorage.setItem(this.LAST_ACKED_META_ID_KEY,e):void 0},_add_thumbnail_frame:function(t){return e(t).addClass("thumbnail"),e(t).parent(".feed-thumbnail").addClass("has-frame")},_mouseclick:function(t){var n,i;return n=e(t.target),n.is("a")&&n.hasClass("view")&&(t.preventDefault(),i=n.attr("data-mount"),window.open(i)),n.closest("a").hasClass("meta-notification-sign-in-needed")?(t.preventDefault(),require(["modules/clean/multiaccount_login"],function(e){return function(t){return t.show_page_login_modal(function(){return e.refresh_feed()})}}(this))):void 0},_scroller_within_offset_to_bottom:function(t){var n;return n=e("#event-feed-container")[0],n.scrollTop+n.offsetHeight+t>=n.scrollHeight},log_if_sf_invite_overquota_view:function(){var e,t,n,i,o,r,s;if(e=function(e){return function(){return e.log_if_sf_invite_overquota_view()}}(this),this._is_retrieving_feed)return void this._feed_load_callbacks.push(e);for(s=this._notifications.slice(0,3),n=0,i=s.length;i>n;n++)if(o=s[n],r=o.sf_invite_overquota,t="overquota"===r?"view_shared_folder_notification_already_oq":"will_be_overquota"===r?"view_shared_folder_notification_near_oq":void 0)return void u.log(t)},log_rendered_notifications:function(e){var t,n;return this._notifications.length>0&&(n=function(){var e,n,i,o;for(i=this._notifications,o=[],e=0,n=i.length;n>e;e++)t=i[e],this._shown[this._identifier(t)]&&o.push(t);return o}.call(this),e>0&&(n=n.slice(e)),n)?l.logRenderLegacy(n,e):void 0}},d=function(){var t,n;return t=e(document),n=function(){return e(".notification-button").hasClass("bubble-dropdown-target--active")},e(".notification-button").click(function(e){return require(["dropbox"]),c.ack_unread_notifications(),n()?c.clear_cached_client_states():(c.log_if_sf_invite_overquota_view(),c.log_rendered_notifications(0))})},{UserNotifier:c,initNotificationButton:d}})}.call(this),function(){define("modules/clean/notifications/file_watcher",["jquery","external/underscore","modules/clean/notserver","modules/clean/revisions/file_revisions_iterator"],function(e,t,n,i){var o,r,s,a,l,u,c;return s=n.NotClients,c={},l=function(e){return s[e.id]},u=function(e,t){var n,i;return n=e.fq_path,i=t.id,n in c||(c[n]={}),i in c[n]||(c[n][i]=new o(e,t)),c[n][i]},o=function(){function n(t,n){var i,o;this.file=t,this.user=n,this.subscriptions=[],i=l(this.user),o=i.subscribe_sfj({name:"FileWatcher",handler:function(t){return function(){
var n;return n=new e.Deferred,n.done(function(){return i.handler_success(o,{ns_map:{}})}),n.fail(function(){return i.handler_failure(o)}),t.checkForUpdates(n)}}(this)})}return n.prototype.subscribe=function(e){return this.subscriptions.push(e)},n.prototype.unsubscribe=function(e){return this.subscriptions=t.reject(this.subscriptions,e)},n.prototype.checkForUpdates=function(e){var t,n,o;return 0===this.subscriptions.length?void e.resolve():(n=new i(this.file.fq_path,this.user.id),o=n.next(1),o.done(function(e){var n,i;return i=e.revisions[0],n=i.file,t(n)}),o.then(e.resolve,e.reject),t=function(e){return function(t){var n,i,o,r,s;for(o=e.subscriptions,r=[],n=0,i=o.length;i>n;n++)s=o[n],r.push(function(e){return setTimeout(function(){return t.sjid>e.latestSjid?e.fulfill(t):void 0},0)}(s));return r}}(this))},n}(),r=function(){function e(e,t,n){this.file=e,this.user=t,this.onFulfill=n,this.latestSjid=this.file.sjid}return e.prototype.fulfill=function(e){return this.file=e,this.latestSjid=e.sjid,this.onFulfill(e)},e.prototype.cancel=function(){var e;return e=u(this.file,this.user),e.unsubscribe(this)},e}(),a={},a.subscribe=function(e,t,n){var i,o;if(l(t))return i=new r(e,t,n),o=u(e,t),o.subscribe(i),i},a._reset=function(){return c={}},a})}.call(this),function(){define("modules/clean/notifications/updated_file_notification",["jquery","modules/core/i18n","modules/core/notify"],function(e,t,n){var i,o,r;return r=t._,i=10,o=function(){function t(e){this.refresh=e,this._render()}return t.prototype.hide=function(){return this._isShowing()&&n.clear(),delete this._notification},t.prototype._render=function(){var t,o,s,a;return t=e("<span></span>").text(r("Someone edited this file.")),a=e("<span></span>").html("&nbsp;"),s=e("<a/>").text(r("Refresh")),s.on("click",this._hideAndRefresh.bind(this)),o=e("<span></span>").append(t).append(a).append(s),this._notification=n.success(o,i)},t.prototype._isShowing=function(){return null!=this._notification&&n.isShown()&&n.current()===this._notification},t.prototype._hideAndRefresh=function(){return this.hide(),this.refresh()},t}()})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/open_with",["external/underscore","modules/clean/browse_interface","modules/clean/filepath","modules/clean/gandalf_util","modules/core/uri"],function(t,n,i,o,r){var s;return s=function(){function s(){}var a,l,u;return s.PRELOAD_URLS={},s.MAX_SUPPORTED_FILE_SIZE_B=157286400,a=["com.adobe.Reader","Acrord32.exe","com.adobe.Acrobat","Acrobat.exe"],l=[{id:"excel",ext:["ods","xlsb","xlsm","xlsx"],icon:"excel",name:"Microsoft Excel Online"},{id:"powerpoint",ext:["odp","ppsx","pptx"],icon:"powerpoint",name:"Microsoft PowerPoint Online"},{id:"word",ext:["odt","docm","docx"],icon:"word",name:"Microsoft Word Online"},{id:"wopitest",ext:["wopitest"],icon:"word",name:"WopiTest"}],u=function(n){var o,r;return r=i.filename(n),o=i.file_extension(r).toLowerCase(),t.find(l,function(t){return e.call(t.ext,o)>=0})},s.get_open_handler_for=function(e,t){var i,o;return o=u(e.fq_path),o&&s.is_app_supported(o.id)?(i=r.encode_parts(e.fq_path),{icon:o.icon,name:o.name,uri:"/ow/msft/edit"+n.get_browse_root(t)+i}):null},s.file_supported=function(e){return!!u(e.fq_path)},s.is_adobe_app=function(t){return e.call(a,t)>=0},s.is_app_supported=function(e){switch(e){case"word":return!0;case"excel":return!0;case"powerpoint":return!0;case"wopitest":return o.getGandalfRule("wopi_view_wopitest");default:return!1}},s}(),__CONDITIONAL_JS__.OpenWith=s,s})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/openwith/logger",["jquery","modules/clean/ajax"],function(t,n){var i,o;return i=function(){function e(){}return e.log=function(e,t,i){return i=i||{},i.vendor=e,n.AuthenticatedRequest({url:"/ow/js_log",data:{evt:t,extra:JSON.stringify(i)}})},e}(),o=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.log=function(e,t){return i.__super__.constructor.log.call(this,"msft",e,t)},i.log_postmessage_sent=function(e,t,n,o){var r,s,a,l,u;for(r={user_id:e,wopi_id:t,postmsg_url:n},u=["MessageId","SendTime","Values"],s=0,l=u.length;l>s;s++)a=u[s],a in o&&(r[a]=o[a]);return i.log("postmessage_sent",r)},i.log_conflict_modal_shown=function(e,t,n){var o;return o={user_id:e,wopi_id:t},i.log(n,o)},i.log_open_button_pressed=function(e,t,i,o){return n.AuthenticatedRequest({url:"/ow/log_open_button_pressed",data:{user_id:e,server_path:i+":"+o,file_extension:t}})},i}(i),__CONDITIONAL_JS__.OpenWithMicrosoftLogger=o,{OpenWithLogger:i,OpenWithMicrosoftLogger:o}})}.call(this),function(){define("modules/clean/page_role_observer",["modules/core/exception"],function(e){var t,n;return n=e.assert,new(t=function(){function e(){this._listeners=[]}return e.prototype.addListener=function(e){return n("function"==typeof e,"PageRoleState.addListener expects a function, got: "+typeof e),this._listeners.push(e)},e.prototype.removeListener=function(e){var t;return n("function"==typeof e,"PageRoleState.removeListener expects a function, got: "+typeof e),this._listeners=function(){var n,i,o,r;for(o=this._listeners,r=[],n=0,i=o.length;i>n;n++)t=o[n],t!==e&&r.push(t);return r}.call(this)},e.prototype.removeAllListeners=function(){return this._listeners=[]},e.prototype.emit=function(e){var t,n,i,o,r;for(o=this._listeners.slice(),r=[],n=0,i=o.length;i>n;n++)t=o[n],r.push(t(e));return r},e}())})}.call(this),function(){define("modules/clean/pagination_manager",["modules/clean/ajax","modules/constants/viewer","modules/core/notify","modules/core/i18n"],function(e,t,n,i){var o,r;return r=i._,o=function(){function i(){}var o,s;return o=function(){function e(e,t){this.userRole=e,this.hasMoreItems=t}return e.prototype.areAllItemsReady=function(e){return null==e&&(e=this.userRole),e===t.ROLE_BOTH?!(this.hasMoreItems[t.ROLE_PERSONAL]||this.hasMoreItems[t.ROLE_WORK]):!this.hasMoreItems[e]},e.prototype.invalidateHasMore=function(){var e,t;e=[];for(t in this.hasMoreItems)e.push(this.hasMoreItems[t]=!0);return e},e.prototype.addDataToAjax=function(e){return e.role=this.areAllItemsReady()?t.ROLE_BOTH:this.userRole},e}(),s=function(){function e(e){this.hasMoreItems=e}return e.prototype.areAllItemsReady=function(){return!this.hasMoreItems},e.prototype.invalidateHasMore=function(){return this.hasMoreItems=!0},e.prototype.addDataToAjax=function(){},e}(),i.prototype.initialize=function(e,t,n,i,o){return this.ajaxURL=n,this.newDataCallback=o,this.autoFetching=!1,this.mode=new s(e.has_more_items),this.keyName=t,this.items={},this.pages=[],this.nextRequestVoucher=e.next_request_voucher,this.userID=i,this._addPage(e.items)},i.prototype.areAllItemsReady=function(e){return this.mode.areAllItemsReady(e)},i.prototype._addPage=function(e){var t,i,o,s,a,l;for(l=[],a=[],t=0,s=e.length;s>t;t++){if(i=e[t],o=i[this.keyName],null==o)return void n.warning(r("Invalid server response"));null==this.items[o]&&(this.items[o]=i,a.push(i),l.push(o))}return this.pages.push(l),this.newDataCallback(this,a)},i.prototype.startAutoFetching=function(){return this.autoFetching=!0,this.fetchNext()},i.prototype.stopAutoFetching=function(){return this.autoFetching=!1},i.prototype.setUserRole=function(e){return this.mode=new o(e,this.mode.hasMoreItems)},i.prototype.reSync=function(e){var n;return null==e&&(e=!1),e&&(this.nextRequestVoucher=null,this.items={},this.pages=[]),n=this.autoFetching&&this.mode.areAllItemsReady(t.ROLE_BOTH),this.mode.invalidateHasMore(),n?this.startAutoFetching():void 0},i.prototype.fetchNext=function(){var i;if(!this.mode.areAllItemsReady(t.ROLE_BOTH))return i={},this.nextRequestVoucher&&(i.voucher=this.nextRequestVoucher),this.mode.addDataToAjax(i),e.WebRequest({url:this.ajaxURL,data:i,subject_user:this.userID,success:function(e){return function(t){return t=JSON.parse(t),e.nextRequestVoucher=t.next_request_voucher,e.mode.hasMoreItems=t.has_more_items,e.autoFetching&&e.fetchNext(),e._addPage(t.items)}}(this),error:function(e){return function(){return n.error()}}(this)})},i.prototype.loadedPageCount=function(){return this.pages.length},i.prototype.getLoadedPage=function(e){var t,n,i,o,r;if(o=[],r=this.pages[e],null==r)return null;for(t=0,i=r.length;i>t;t++)n=r[t],o.push(this.items[n]);return o},i.prototype.getLastLoadedPage=function(){return this.getLoadedPage(this.loadedPageCount()-1)},i}()})}.call(this),function(){define("modules/clean/payments/cash",[],function(){var e,t,n,i;return i=function(){function e(){}return e._groupSymbol=",",e._decimalSymbol=".",e._minusSignSymbol="-",e._currencyFormatMap={USD:"$%v"},e.set_locale_number_format=function(t,n,i){e._groupSymbol=null!=t?t:",",e._decimalSymbol=null!=n?n:".",e._minusSignSymbol=null!=i?i:"-"},e.set_currency_format_map=function(t){e._currencyFormatMap=t},e._formatAmountThousandsHelper=function(t){var n;return n=Math.abs(parseInt(t)).toFixed(0)+"",n.length<=3?n:e._formatAmountThousandsHelper(n.substr(0,n.length-3))+e._groupSymbol+n.substr(n.length-3)},e.roundCurrency=function(e,t,n){return null==t&&(t="USD"),null==n&&(n=2),e%1===0&&(n=0),this.formatCurrency(e,t,n)},e.formatCurrency=function(t,n,i,o){var r,s,a,l;return null==n&&(n="USD"),null==i&&(i=2),null==o&&(o=!1),"JPY"===n&&(i=0),s=e.formatNumber(t,i),a=(null!=(l=e._currencyFormatMap[n])?l.replace("%v",s):void 0)||s+" "+n,o?(r=a.indexOf(e._decimalSymbol),-1===r?[a,""]:[a.slice(0,r+1),a.slice(r+1)]):a},e.formatNumber=function(t,n){return null==n&&(n=2),(0>t?e._minusSignSymbol:"")+e._formatAmountThousandsHelper(t)+(n>0?e._decimalSymbol+t.toFixed(n).split(".")[1]:"")},e}(),t=function(){function e(e,t){this.cash1=e,this.cash2=t}return e}(),n=function(){function e(){}return e}(),e=function(){function e(e,t){if(this.currency=t,!e&&0!==e||!this.currency)throw new n;this.amount=parseFloat(e)}return e.prototype.add=function(n){if(this.currency!==n.currency)throw new t(self,n);return new e(this.amount+n.amount,this.currency)},e.prototype.subtract=function(t){return this.add(new e(-t.amount,t.currency))},e.prototype.multiply=function(t){return new e(this.amount*t,this.currency)},e.prototype.divide=function(t){return new e(this.amount/t,this.currency)},e.prototype.round=function(t){var n;return null==t&&(t=2),n=Math.pow(10,t),new e(Math.round(this.amount*n)/n,this.currency)},e.prototype.toString=function(e){return null==e&&(e=2),"JPY"===this.currency&&(e=0),i.roundCurrency(this.amount,this.currency,e)},e.prototype.formatCurrency=function(e){return null==e&&(e=2),i.formatCurrency(this.amount,this.currency,e)},e.fromObject=function(t){return new e(t.amount,t.currency)},e}(),{CashUtil:i,CashCurrenciesDoNotMatch:t,CashNeedsAmountAndCurrency:n,Cash:e}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/payments/dfb_util",["external/underscore","modules/clean/ajax","modules/clean/payments/cash","modules/clean/payments/validation","modules/core/exception"],function(t,n,i,o,r){var s,a,l,u,c;return s=i.Cash,c=r.assert,u=function(){function e(e,t,n,i,o,r,s){this.plan_ids=e,this.schedule_ids=t,this.license_ids_and_counts=n,this.currencies=i,this.country_code=o,this.zip_code=r,this.vat_id=s,this.renew=!1,this.discount_ratio=0}return e.prototype.set_only_license_count=function(e){var t;return t=Object.keys(this.license_ids_and_counts)[0],this.license_ids_and_counts[t]=e},e.prototype.get_only_license_count=function(){var e;return e=Object.keys(this.license_ids_and_counts)[0],this.license_ids_and_counts[e]},e.prototype.set_country_code=function(e){this.country_code=e},e.prototype.set_zip_code=function(e){this.zip_code=e},e.prototype.set_currencies=function(e){this.currencies=e},e.prototype.set_renew=function(e){this.renew=e},e.prototype.set_discount_ratio=function(e){this.discount_ratio=e},e.prototype.set_vat_id=function(e){return""!==e&&o.validate_vat(this.country_code,e)?this.vat_id=e:this.vat_id=""},e.prototype.cache_key=function(){var e;return this.currencies&&(e=this.currencies.join(",")),[this.plan_ids.join(","),this.schedule_ids.join(","),this.get_only_license_count(),e,this.country_code,this.zip_code,this.vat_id,this.renew,this.discount_ratio].join(":")},e.prototype.to_json=function(){var e;return e=this.renew?{renew:1}:{},e=t.extend(e,{plan_ids:JSON.stringify(this.plan_ids),schedule_ids:JSON.stringify(this.schedule_ids),license_ids_and_counts:JSON.stringify(this.license_ids_and_counts),currencies:this.currencies?JSON.stringify(this.currencies):"",country_code:this.country_code,zip_code:this.zip_code,vat_id:this.vat_id,discount_percentage:JSON.stringify(100*this.discount_ratio)})},e.from_transition_view_models=function(n){var i,o,r,s,a,l,u,d,p,_,h,m,f,v,g,y,b,w,E,T,C,S,k,I;for(h=[],C=[],r=[],_=!1,o=!1,k=!1,I=!1,s=0,u=n.length;u>s;s++)if(S=n[s],h.push(S.state.plan.id),C.push(S.state.schedule.id),r.push(S.state.currency),_===!1){for(_={},m=S.state.allocated_licenses,a=0,d=m.length;d>a;a++)i=m[a],_[i.license_id]=i.license_count;o=null!=(f=S.read_only_invoice)?f.tax_country_code:void 0,k=null!=(v=null!=(g=S.read_only_invoice)?g.tax_exclusion_id:void 0)?v:null,I=null!=(y=S.read_only_invoice)?y.tax_zip_code:void 0}else{for(c(S.state.allocated_licenses.length===Object.keys(_).length,"License sets differ"),b=S.state.allocated_licenses,l=0,p=b.length;p>l;l++)i=b[l],c(i.license_id in _,"License sets differ"),c(_[i.license_id]===i.license_count,"License count must match");c(o===(null!=(w=S.read_only_invoice)?w.tax_country_code:void 0),"country codes must match"),c(I===(null!=(E=S.read_only_invoice)?E.tax_zip_code:void 0),"zip codes must match"),c(k===(null!=(T=S.read_only_invoice)?T.tax_exclusion_id:void 0),"VAT IDs must match")}return new e(t.uniq(h),t.uniq(C),_,t.uniq(r),o,I,k)},e}(),a=function(){function e(e){var t,n;this.transition_view_model=e,this.transition_view_model.read_only_invoice?this.current_total=s.fromObject(this.transition_view_model.read_only_invoice.total):this.current_total=new s(0,this.transition_view_model.state.currency),this.transition_view_model.state.per_license_prices.length?this.per_license_price=s.fromObject(this.transition_view_model.state.per_license_prices[0].price):this.per_license_price=new s(0,this.transition_view_model.state.currency),this.recurring_total=s.fromObject(this.transition_view_model.state.total_recurring_price),this.transition_view_model.prices?this.tax=s.fromObject(this.transition_view_model.prices.tax):this.tax=new s(0,this.recurring_total.currency),this.recurring_total_tax=this.recurring_total.add(this.tax),this.tax_percentage=0,this.transition_view_model.read_only_invoice&&(n=this.transition_view_model.read_only_invoice.line_items,t=n.length>0?n[0]:void 0,(null!=t?t.country_tax_percentage:void 0)?this.tax_percentage=t.country_tax_percentage:(null!=t?t.state_tax_percentage:void 0)&&(this.tax_percentage=t.state_tax_percentage))}return e}(),l=function(){function t(t){this.default_transition_view_models=t,this._get_transition_info_for=e(this._get_transition_info_for,this),this._add_to_cache=e(this._add_to_cache,this),this.has_inflight_request=e(this.has_inflight_request,this),this.transition_view_model_requests={},this.transition_info_cache={},this._add_to_cache(this.default_transition_view_models)}return t.prototype.get=function(e,t){var i,o,r;return r=u.from_transition_view_models(this.default_transition_view_models),t.total_users&&r.set_only_license_count(t.total_users),t.country_code&&r.set_country_code(t.country_code),t.currency&&r.set_currencies([t.currency]),t.remove_currency&&r.set_currencies(),t.zip_code&&r.set_zip_code(t.zip_code),t.renew&&r.set_renew(t.renew),(t.vat_id||""===t.vat_id)&&r.set_vat_id(t.vat_id),t.discount_ratio&&r.set_discount_ratio(t.discount_ratio),i=r.cache_key(),(o=this._get_transition_info_for(i))?void e(o):this.transition_view_model_requests[i]?void 0:(this.transition_view_model_requests[i]=!0,n.AuthenticatedRequest({url:"/business/transition-model",type:"GET",dataType:"json",data:r.to_json(),success:function(t){return function(n){var o;return delete t.transition_view_model_requests[i],o=t._add_to_cache(n),e(o)}}(this),error:function(e){return function(t){return delete e.transition_view_model_requests[i]}}(this)}))},t.prototype.has_inflight_request=function(){return Object.keys(this.transition_view_model_requests).length},t.prototype._add_to_cache=function(e){var t,n,i;return t=u.from_transition_view_models(e).cache_key(),n=function(){var t,n,o;for(o=[],t=0,n=e.length;n>t;t++)i=e[t],o.push(new a(i));return o}(),this.transition_info_cache[t]=n,n},t.prototype._get_transition_info_for=function(e){return e in this.transition_info_cache?this.transition_info_cache[e]:null},t}(),{DfBTransitionInfo:a,DfBTransitionInfoFetcher:l}})}.call(this),function(){define("modules/clean/payments/validation",[],function(){var e,t,n,i;return e={AT:{prefix:"AT",regex:/^ATU[0-9]{8}$/,examples:["ATU12345678"]},BE:{prefix:"BE",regex:/^BE(0?|1)[0-9]{9}$/,examples:["BE0123456789","BE1123456789","BE1234567890"]},BG:{prefix:"BG",regex:/^BG[0-9]{9,10}$/,examples:["BG123456789","BG1234567890"]},CH:{prefix:"CH",regex:/^CHE[0-9]{9}(TVA|MWST|IVA)$/,examples:["CHE123456789TVA","CHE123456789MWST","CHE123456789IVA"]},CY:{prefix:"CY",regex:/^CY[0-9]{8}[A-Z]$/,examples:["CY12345678X"]},CZ:{prefix:"CZ",regex:/^CZ[0-9]{8,10}$/,examples:["CZ12345678","CZ123456789","CZ1234567890"]},DE:{prefix:"DE",regex:/^DE[0-9]{9}$/,examples:["DE123456789"]},DK:{prefix:"DK",regex:/^DK[0-9]{8}$/,examples:["DK12345678"]},EE:{prefix:"EE",regex:/^EE[0-9]{9}$/,examples:["EE123456789"]},GR:{prefix:"EL",regex:/^EL[0-9]{9}$/,examples:["EL123456789"]},ES:{prefix:"ES",regex:/^ES([A-Z][0-9]{7}[0-9A-Z]|[0-9A-Z][0-9]{7}[A-Z])$/,examples:["ESX12345678","ES12345678X","ESX1234567X"]},FI:{prefix:"FI",regex:/^FI[0-9]{8}$/,examples:["FI12345678"]},FR:{prefix:"FR",regex:/^FR[0-9A-Z]{2}[0-9]{9}$/,examples:["FR12345678901","FRX1234567890","FR1X123456789","FRXX123456789"]},GB:{prefix:"GB",regex:/^GB([0-9]{9}|[0-9]{12}|GD[0-9]{3}|HA[0-9]{3})$/,examples:["GB123456789","GB123456789012","GBGD123","GBHA123"]},HR:{prefix:"HR",regex:/^HR[0-9]{11}$/,examples:["HR12345678901"]},HU:{prefix:"HU",regex:/^HU[0-9]{8}$/,examples:["HU12345678"]},IE:{prefix:"IE",regex:/^IE([0-9][0-9A-Z+*][0-9]{5}[A-Z]{1,2}|[0-9]{7}WI)$/,examples:["IE1X23456X","IE1X23456X","IE1234567XX"]},IT:{prefix:"IT",regex:/^IT[0-9]{11}$/,examples:["IT12345678901"]},LT:{prefix:"LT",regex:/^LT([0-9]{9}|[0-9]{12})$/,examples:["LT123456789","LT123456789012"]},LU:{prefix:"LU",regex:/^LU[0-9]{8}$/,examples:["LU12345678"]},LV:{prefix:"LV",regex:/^LV[0-9]{11}$/,examples:["LV12345678901"]},MT:{prefix:"MT",regex:/^MT[0-9]{8}$/,examples:["MT12345678"]},NL:{prefix:"NL",regex:/^NL[0-9]{9}B[0-9]{2}$/,examples:["NL123456789B01"]},NO:{prefix:"NO",regex:/^NO[0-9]{9}(MVA)?$/,examples:["NO123456789","NO123456789MVA"]},PL:{prefix:"PL",regex:/^PL[0-9]{10}$/,examples:["PL1234567890"]},PT:{prefix:"PT",regex:/^PT[0-9]{9}$/,examples:["PT123456789"]},RO:{prefix:"RO",regex:/^RO[0-9]{2,10}$/,examples:["RO12","RO1234567890"]},SE:{prefix:"SE",regex:/^SE[0-9]{12}$/,examples:["SE123456789012"]},SI:{prefix:"SI",regex:/^SI[0-9]{8}$/,examples:["SI12345678"]},SK:{prefix:"SK",regex:/^SK[0-9]{10}$/,examples:["SK1234567890"]}},i=function(t,n){var i,o;return i=null!=(o=e[t])?o.regex:void 0,i&&i.test(n)},n=function(t){var n;return null!=(n=e[t])?n.prefix:void 0},t=function(t){var n;return null!=(n=e[t])?n.examples:void 0},{validate_vat:i,get_vat_prefix:n,get_vat_examples:t}})}.call(this),function(){define("modules/clean/photos/photos_engagement_logger",["jquery","modules/clean/ajax"],function(e,t){var n;return n=function(){function n(){}return n.Platform={WEB:"web",WEB_CAROUSEL:"web_carousel"},n.CAROUSEL_NAV_LINK_CLICK="carousel_nav_link_click",n.PHOTOS_NAV_LINK_CLICK="photos_nav_link_click",n.WEBAPP_VIEW_TIMELINE="webapp_view_gallery",n.WEBAPP_VIEW_SHARED_ALBUM="webapp_view_conversations",n.WEBAPP_VIEW_SHARED_ALBUMS_GRID="webapp_view_shared_albums_grid",n.WEBAPP_VIEW_ALBUMS_GRID="webapp_view_albums_grid",n.WEBAPP_VIEW_ALBUM="webapp_view_albums",n.WEBAPP_VIEW_FLASHBACK="webapp_view_flashback",n.WEBAPP_ACTION_ADD_TO_ALBUM="webapp_action_add_to_album",n.WEBAPP_ACTION_REMOVE_FROM_ALBUM="webapp_action_remove_from_album",n.WEBAPP_ACTION_DOWNLOAD="webapp_action_download",n.WEBAPP_ACTION_SHOW_IN_FOLDER="webapp_action_show_in_folder",n.WEBAPP_ACTION_DELETE="webapp_action_delete",n.WEBAPP_SHOW_EXCLUDE_MODAL="webapp_show_exclude_modal",n.ATTEMPT_EXCLUDE_CAROUSEL_SUBFOLDER="attempt_exclude_carousel_subfolder",n.ATTEMPT_EXCLUDE_CU_FOLDER="attempt_exclude_cu_folder",n.ATTEMPT_EXCLUDE_CAROUSEL_FOLDER="attempt_exclude_carousel_folder",n.ATTEMPT_EXCLUDE_DROPBOX_ROOT="attempt_exclude_dropbox_root",n.WEBAPP_GALLERY_SELECT_EVENT="webapp_gallery_select_event",n.WEBAPP_GALLERY_DESELECT_EVENT="webapp_gallery_deselect_event",n.WEBAPP_GALLERY_SELECT_ITEM="webapp_gallery_select_item",n.WEBAPP_GALLERY_DESELECT_ITEM="webapp_gallery_deselect_item",n.WEBAPP_GALLERY_TIME_FIRST_ITEM="webapp_gallery_time_first_item",n.WEBAPP_GALLERY_TIME_EVENTS_OUTLINE="webapp_gallery_time_events_outline",n.WEBAPP_GALLERY_TIME_FIRST_VISIBLE_EVENTS="webapp_gallery_time_first_visible_events",n.WEBAPP_GALLERY_TIME_FIRST_VISIBLE_THUMBS_BATCH="webapp_gallery_time_first_visible_thumbs_batch",n.WEBAPP_GALLERY_EMPTY="webapp_gallery_empty",n.WEBAPP_GALLERY_CONTEXT_MENU_SHOWN="webapp_gallery_context_menu_shown",n.WEBAPP_LIGHTBOX_OPEN="webapp_lightbox_open",n.WEBAPP_LIGHTBOX_DOWNLOAD="webapp_lightbox_download",n.WEBAPP_LIGHTBOX_SELECT_ITEM="webapp_lightbox_select_item",n.WEBAPP_LIGHTBOX_DESELECT_ITEM="webapp_lightbox_deselect_item",n.WEBAPP_LIGHTBOX_FORWARD="webapp_lightbox_forward",n.WEBAPP_LIGHTBOX_BACK="webapp_lightbox_back",n.WEBAPP_LIGHTBOX_SHARE="webapp_lightbox_share",n.WEBAPP_LIGHTBOX_CLOSE_ICON="webapp_lightbox_close_icon",n.WEBAPP_LIGHTBOX_CLOSE_KEY="webapp_lightbox_close_key",n.WEBAPP_TIMELINE_NAVIGATION_SHOWN="webapp_timeline_navigation_shown",n.WEBAPP_TIMELINE_NAVIGATION_TRACK_CLICKED="webapp_timeline_navigation_track_clicked",n.WEBAPP_TIMELINE_NAVIGATION_SCRUBBER_DRAGGED="webapp_timeline_navigation_scrubber_dragged",n.WEBAPP_SHARE_CART_CANCEL="webapp_share_cart_cancel",n.WEBAPP_SHARE_CART_SHARE="webapp_share_cart_share",n.WEBAPP_SHARE_CART_SHARE_FACEBOOK="webapp_share_cart_share_facebook",n.WEBAPP_SHARE_CART_SHARE_TWITTER="webapp_share_cart_share_twitter",n.WEBAPP_SHARE_CART_ITEM_CLICKED="webapp_share_cart_item_clicked",n.WEBAPP_SHARE_DROPDOWN_SEND_LINK="webapp_share_dropdown_send_link",n.WEBAPP_SHARE_DROPDOWN_SHARED_ALBUM="webapp_share_dropdown_shared_album",n.WEBAPP_OPEN_SHARE_MODAL="webapp_open_share_modal",n.WEBAPP_GALLERY_DELETE_MODAL_CONFIRMED="webapp_gallery_delete_modal_confirmed",n.WEBAPP_GALLERY_DELETE_MODAL_CANCELED="webapp_gallery_delete_modal_canceled",n.WEBAPP_GALLERY_REMOVE_FROM_ALBUM_MODAL_CONFIRMED="webapp_gallery_remove_from_album_modal_confirmed",n.WEBAPP_GALLERY_REMOVE_FROM_ALBUM_MODAL_CANCELED="webapp_gallery_remove_from_album_modal_canceled",n.WEBAPP_SHARE_COMPOSER_RECIPIENT="webapp_share_composer_recipient",n.WEBAPP_SHARE_COMPOSER_MESSAGE="webapp_share_composer_message",n.WEBAPP_SHARE_COMPOSER_SHARE="webapp_share_composer_share",n.WEBAPP_SHARE_COMPOSER_TWITTER="webapp_share_composer_twitter",n.WEBAPP_SHARE_COMPOSER_FACEBOOK="webapp_share_composer_facebook",n.WEBAPP_SHARE_COMPOSER_LINK="webapp_share_composer_link",n.WEBAPP_SHARE_WITH_SELF_ATTEMPT="webapp_share_with_self_attempt",n.WEBAPP_CONVERSATIONS_ROOM_CLICKED="webapp_conversations_room_clicked",n.WEBAPP_CONVERSATIONS_VIEW_SETTINGS="webapp_conversations_view_settings",n.WEBAPP_CONVERSATIONS_CLOSE_SETTINGS="webapp_conversations_close_settings",n.WEBAPP_CONVERSATIONS_TIME_FIRST_POST="webapp_conversations_time_first_post",n.WEBAPP_CONVERSATIONS_EMPTY="webapp_conversations_empty",n.WEBAPP_CONVERSATIONS_CHAT_VIEW_CLICKED="webapp_conversations_chat_view_clicked",n.WEBAPP_CONVERSATIONS_GALLERY_VIEW_CLICKED="webapp_conversations_gallery_view_clicked",n.WEBAPP_CONVERSATIONS_CHAT_VIEW_LOAD_MORE="webapp_conversations_chat_view_load_more",n.WEBAPP_CONVERSATIONS_GALLERY_VIEW_LOAD_MORE="webapp_conversations_gallery_view_load_more",n.WEBAPP_SHARING_COMMENT_SUBMIT="webapp_sharing_comment_submit",n.WEBAPP_SHARING_GALLERY_ADD_PHOTOS="webapp_sharing_gallery_add_photos",n.WEBAPP_SHARING_COPY_LINK="webapp_sharing_copy_link",n.WEBAPP_SHARING_LIKE_ITEM="webapp_sharing_like_item",n.WEBAPP_SHARING_UNLIKE_ITEM="webapp_sharing_unlike_item",n.WEBAPP_FLASHBACK_SELECT_EVENT="webapp_flashback_select_event",n.WEBAPP_FLASHBACK_SELECT_ITEM="webapp_flashback_select_item",n.WEBAPP_FLASHBACK_CLICK_ITEM="webapp_flashback_click_item",n.WEBAPP_FLASHBACK_CLICK_SHARE="webapp_flashback_click_share",n.WEBAPP_FLASHBACK_SURVEY_RESPONSE="webapp_flashback_survey_response",n.WEBAPP_FLASHBACK_SURVEY_FREE_RESPONSE="webapp_flashback_survey_free_response",n.WEBAPP_FLASHBACK_SHARE_ALL="webapp_flashback_share_all",n.WEBAPP_FLASHBACK_SHARE_SINGLE_ITEM_FACEBOOK="webapp_flashback_share_single_item_facebook",n.WEBAPP_FLASHBACK_SHARE_SINGLE_ITEM_TWITTER="webapp_flashback_share_single_item_twitter",n.WEBAPP_FLASHBACK_SHARE_SINGLE_ITEM_LINK="webapp_flashback_share_single_item_link",n.PUBLIC_LASS_INPUT_CLICK="public_lass_input_click",n.PUBLIC_LASS_INPUT_MESSAGE="public_lass_input_message",n.PUBLIC_LASS_INPUT_SUBMIT="public_lass_input_submit",n.PUBLIC_LASS_ADD_PHOTOS="public_lass_add_photos",n.PUBLIC_LASS_LIKE_CLICK="public_lass_like_click",n.PUBLIC_LASS_START_LOGIN="public_lass_start_login",n.PUBLIC_LASS_FINISH_LOGIN="public_lass_finish_login",n.PHOTO_SPACE_START_LOGIN="photo_space_start_login",n.PHOTO_SPACE_FINISH_LOGIN="photo_space_finish_login",n.PHOTO_SPACE_SUBSCRIBE="photo_space_subscribe",n.MOBILE_DROPBOX_FLASHBACK_SHARE_CART_SHARE="share_cart_share",n.MOBILE_DROPBOX_FLASHBACK_SHARE_CART_CANCEL="share_cart_cancel",n.MOBILE_DROPBOX_FLASHBACK_LINK_GENERATED="link_generated",n.MOBILE_DROPBOX_FLASHBACK_SHARE_DONE="share_done",n.first_log_sent=!1,n.logs_queued=[],n.HACK_prefix_to_replace=null,n.HACK_prefix_replace_with=null,n.HACK_new_platform=null,n.HACK_extra={},n.hack_all_log_prefixes_and_platform=function(e){var t,i,o,r;return r=e.prefix_to_replace,o=e.prefix_replace_with,i=e.new_platform,t=e.extra,n.HACK_prefix_to_replace=r,n.HACK_prefix_replace_with=o,n.HACK_new_platform=i,n.HACK_extra=t},n.apply_hacky_log_overrides=function(t,i,o){var r,s;return n.HACK_prefix_to_replace?(s=0===t.indexOf(n.HACK_prefix_to_replace)?t.replace(n.HACK_prefix_to_replace,n.HACK_prefix_replace_with):0!==t.indexOf(n.HACK_prefix_replace_with)?n.HACK_prefix_replace_with+t:t,r=e.extend({},o,this.HACK_extra),[s,n.HACK_new_platform,r]):[t,i,o]},n.log_and_send=function(e,i,o){var r;return null==i&&(i={}),null==o&&(o=n.Platform.WEB),r=n.apply_hacky_log_overrides(e,o,i),e=r[0],o=r[1],i=r[2],t.AuthenticatedRequest({url:"/photos/photos_engagement_log",data:{event:e,extra:JSON.stringify(i),platform:o}})},n.log=function(e,t,i){var o,r;return this._init(),n.first_log_sent?(null==t&&(t={}),null==i&&(i=n.Platform.WEB),r=n.apply_hacky_log_overrides(e,i,t),e=r[0],i=r[1],t=r[2],o={event:e,extra:t,platform:i},n.logs_queued.push(o)):(n.log_and_send(e,t,i),void(n.first_log_sent=!0))},n.log_carousel=function(e,t){return n.log(e,t,n.Platform.WEB_CAROUSEL)},n._send_log_batch=function(){return n.logs_queued.length?(t.AuthenticatedRequest({url:"/photos/photos_engagement_batch_log",data:{events:JSON.stringify(n.logs_queued)}}),n.logs_queued=[]):void 0},n._init=function(){return this._initialized?void 0:(this._initialized=!0,setInterval(n._send_log_batch,1e4),e(window).unload(n._send_log_batch))},n}()})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/photos/thumbnail_url_util",["external/underscore","modules/constants/python","modules/core/exception","modules/core/uri"],function(t,n,i,o){var r,s,a,l;return r=n.THUMBNAIL_SIZE_MODE,s=n.THUMBNAIL_SIZES,l=function(n,a,l,u){var c,d;return i.assert(null!=a&&null!=l,"Width and height must both be specified or neither"),d=a+"x"+l,i.assert(e.call(s,d)>=0,"Invalid thumbnail size ("+d+")"),c={size:d},null!=u&&(i.assert(e.call(t.values(r),u)>=0,"Invalid thumbnail size mode ("+u+")"),c.size_mode=u),o.parse(n).updateQuery(c).toString()},a=function(e){return o.parse(e).updateQuery({size_mode:5}).toString()},{ThumbnailSizeMode:r,thumbnailUrlForSize:l,fullSizeUrl:a}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/previews/file_view_rams_common",["jquery","modules/clean/gandalf_util","modules/constants/env","modules/core/browser","modules/core/uri"],function(t,n,i,o,r){var s;return s={RAMS_FULLSCREEN_TRANSITION_TIME_MSEC:1e3,_PDF_PREVIEW_DOMAINS:[i.DL_DOC_DOMAIN,i.BLOCK_CLUSTER,i.PUBSERVER,i.DL_DOC_USER_CONTENT_DOMAIN],enterRamsFullscreen:function(e){return e.addClass("rams-fullscreen").data("rams-fullscreen",!0),t(window).resize()},exitRamsFullscreen:function(e){return e.removeClass("rams-fullscreen").removeData("rams-fullscreen"),t(window).resize()},isRamsFullscreenActive:function(e){var t;return t=e.data("rams-fullscreen"),null!=t&&t},_isPdfPreviewDomain:function(t){return t=t.toLowerCase(),e.call(this._PDF_PREVIEW_DOMAINS,t)>=0},_supportsNativePrinting:function(){return o.chrome||o.safari},getNativePrintUrl:function(e,t){var n,i;return this._supportsNativePrinting()?this._isPdfPreviewDomain(t)?(i=e.clone(),i.updateQuery({from_native_print:1}),n=r.parse("https://"+t+"/nativeprint"),n.updateQuery({file:i}),n.toString()):(console.warn("Blocked attempt to load pdf native print for unexpected domain"),null):null}}})}.call(this),function(){define("modules/clean/previews/file_viewer_utils",["jquery"],function(e){var t;return t=function(){return e("#file-viewer")},{getFileViewerElement:t}})}.call(this),function(){define("modules/clean/previews/pdf_loader",["external/underscore","modules/clean/ajax","modules/clean/frame_messenger","modules/clean/gandalf_util","modules/core/browser","modules/core/uri"],function(e,t,n,i,o,r){var s,a,l,u;return l=["exit-parent-fullscreen","failed","pagerendered","viewer-initialized","loaded","viewer-ready"],s="iframe.pdfjs",u=function(e){var t,n,i,o,r,s,a,l,u;t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";try{l=crypto.getRandomValues(new Uint8Array(e))}catch(e){i=e,l=[]}for(null==l&&(l=[]),s="",r=a=0,u=e;u>=0?u>a:a>u;r=u>=0?++a:--a)n=e===l.length?l[r]%t.length:Math.floor(Math.random()*t.length),s+=t[n];return s},a=function(){function a(){}return a.prototype._exitFullscreenCallback=null,a.prototype._frameMessenger=new n,a.prototype._fileUrl=null,a.prototype._isFullscreen=!1,a.prototype._options={},a.prototype._ducId=u(64),a.prototype.startListening=function(){return this._frameMessenger.configureChildMessaging(s,this.handleTrustedMesssageFromChild.bind(this),l),this._frameMessenger.startListening()},a.prototype.stopListening=function(){return this._frameMessenger.stopListening()},a.prototype.handleTrustedMesssageFromChild=function(e){switch(e.action){case"viewer-initialized":return this._sendOpenFileAction();case"viewer-ready":if(this._isFullscreen)return this._sendEnterFullscreenAction();break;case"exit-parent-fullscreen":return this._isFullscreen=!1,"function"==typeof this._exitFullscreenCallback?this._exitFullscreenCallback():void 0;case"failed":return this._onFailed();case"pagerendered":return this._onPageRendered();case"loaded":return this._onLoaded()}},a.prototype.setExitFullscreenCallback=function(e){return this._exitFullscreenCallback=e},a.prototype.setIsFullscreen=function(e){return this._isFullscreen=e},a.prototype.setOnDownloadSucceeded=function(e){return this._onDownloadSucceeded=e},a.prototype.setOnDownloadFailed=function(e){return this._onDownloadFailed=e},a.prototype.setOnRenderSucceeded=function(e){return this._onRenderSucceeded=e;
},a.prototype.setOnRenderFailed=function(e){return this._onRenderFailed=e},a.prototype.openFile=function(n,s){var a,l,u,c;return null==s&&(s={}),this._hasDocumentDownloaded=!1,null!=n?(e.defaults(s,{disableRange:!!o.safari_version_at_most(8),chunkSizeGandalf:"64000",minRangeSizeGandalf:"10000000",presentationMode:!1,dropboxDucId:this._ducId}),a=null,i.getGandalfRule("docpreview_debug_force_test_pdf")?a="test.pdf":i.getGandalfRule("docpreview_debug_force_test_deck_pdf")?a="test-deck.pdf":i.getGandalfRule("docpreview_debug_force_test_excel2_pdf")&&(a="test-excel2.pdf"),null!=a&&(u=r.parse(n),c=u.getQuery(),c.canned_file_name=a,u.setQuery(c),n=u.toString()),u=r.parse(n.toString()),0===u.getPath().toString().indexOf("/pri")?(l=u.getPath().toString().slice(8),u.setPath("/pri/get_content_url"),t.WebRequest({url:u.toString(),data:{path:l},success:function(e){return function(t){var n;return n=JSON.parse(t),e._finishOpenFile(n.url,s)}}(this)})):this._finishOpenFile(n,s)):void 0},a.prototype._finishOpenFile=function(e,t){return null==t&&(t={}),this._fileUrl=e.toString(),this._options=t,this._sendOpenFileAction()},a.prototype._sendOpenFileAction=function(){return this._frameMessenger.postMessageToChildren("open-file",{fileUrl:this._fileUrl,options:this._options})},a.prototype._sendEnterFullscreenAction=function(){return this._frameMessenger.postMessageToChildren("enter-fullscreen")},a.prototype._onLoaded=function(){return"function"==typeof this._onDownloadSucceeded&&this._onDownloadSucceeded(),this._hasDocumentDownloaded=!0},a.prototype._onPageRendered=function(){return"function"==typeof this._onRenderSucceeded?this._onRenderSucceeded():void 0},a.prototype._onFailed=function(e){return this._hasDocumentDownloaded?"function"==typeof this._onRenderFailed?this._onRenderFailed():void 0:"function"==typeof this._onDownloadFailed?this._onDownloadFailed():void 0},a}()})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/previews/preview_actions_helper",["jquery","modules/clean/previews/file_view_rams_common","modules/clean/previews/util","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/store","modules/constants/legacy","modules/core/browser","modules/core/uri"],function(t,n,i,o,r,s,a,l){var u,c,d,p;return p=i.PreviewHelper,d=function(){function e(){}return e.getIframeQuery=function(){return".react-file-viewer__preview iframe"},e.nativePdfPrint=function(e){var t,i,o,r,u,c,d,_;if(null!=e.preview_type){if(i=e,r=i.doc_preview_status!==s.DOC_PREVIEW_AVAILABLE,u="doc"!==(_=i.preview_type)&&"adobecs"!==_,r||u)return!1;d=p.get_progressive_url("doc",i.href),t=l.parse(d).getAuthority()}else{if(0!==("function"==typeof e.indexOf?e.indexOf("https://"):void 0))return!1;c=e,d=l.parse(a.get_href()),d.setQuery({preview:1}),t=l.parse(c).getAuthority()}return o=n.getNativePrintUrl(d,t),null==o?!1:(window.open(o,"_blank"),!0)},e.enterFullscreen=function(){return o.openFullscreen(),!1},e.exitFullscreen=function(){return o.closeFullscreen(),!1},e.isFullscreen=function(){return r.isFullscreen()},e}(),u=function(i){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,i),o.getEmbedContainer=function(){var e;return e=t("#pdf-embed-container, #html-container, #htmlified-wrapper, #code-wrapper"),1!==e.length&&(e=[]),e},o._getPdfEmbedIframe=function(){return t("#pdf-embed-iframe")},o.getIframeQuery=function(){return".preview-box iframe"},o.nativePdfPrint=function(e){var i,o,r,s;return i=this._getPdfEmbedIframe(),t("body").hasClass("file-preview-body")&&1===i.length&&null!=e?(s=l.parse(a.get_href()),s.setQuery({preview:1}),o=l.parse(e).getAuthority(),r=n.getNativePrintUrl(s,o),null==r?!1:(window.open(r,"_blank"),!0)):!1},o.enterFullscreen=function(){return n.enterRamsFullscreen(t(this.getEmbedContainer())),!0},o.exitFullscreen=function(){return n.exitRamsFullscreen(t(this.getEmbedContainer())),!0},o.isFullscreen=function(){return n.isRamsFullscreenActive(t(this.getEmbedContainer()))},o}(d),c=function(i){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,i),o.prototype._non_fullscreen_vert_overflow=null,o.getIframeQuery=function(){return".preview-content-container > iframe"},o.enterFullscreen=function(){var e;return n.enterRamsFullscreen(t(".preview")),e=t("html"),this._non_fullscreen_vert_overflow=e.css("overflow-y"),e.css("overflow-y","hidden"),!0},o.exitFullscreen=function(){return n.exitRamsFullscreen(t(".preview")),t("html").css("overflow-y",this._non_fullscreen_vert_overflow),this._non_fullscreen_vert_overflow=null,!0},o.isFullscreen=function(){return n.isRamsFullscreenActive(t(".preview"))},o.nativePdfPrint=function(e){var i,o,r,a;return e.doc_preview_status!==s.DOC_PREVIEW_AVAILABLE||"doc"!==(a=e.preview_type)&&"adobecs"!==a?!1:(r=p.get_progressive_url("doc",e.href),i=l.parse(r).getAuthority(),o=n.getNativePrintUrl(r,i,t("#file-viewer")),null==o?!1:(window.open(o,"_blank"),!0))},o}(d),{PreviewActions:d,LegacyFileViewerActions:c,LegacyFilePreviewActions:u}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/previews/preview_status_watcher",["modules/constants/legacy","modules/core/uri","modules/clean/ajax"],function(t,n,i){var o;return o=function(){function o(){this._onCheckError=e(this._onCheckError,this),this._onCheckSuccess=e(this._onCheckSuccess,this),this._check=e(this._check,this)}return o.TIMEOUT=1e3,o.MAX_TRIES=5,o.prototype._statusRequest=null,o.prototype._statusTimeout=null,o.prototype._statusTries=0,o.prototype.onSuccess=null,o.prototype.onError=null,o.prototype.userId=0,o.prototype.start=function(e,t,i,o){return this.userId=e,this.onSuccess=i,this.onError=o,this.url=n({path:"/doc_preview_status"+t}).toString(),this._check()},o.prototype.stop=function(){return this.reset()},o.prototype.reset=function(){var e;return null!=(e=this._statusRequest)&&e.abort(),this._statusRequest=null,clearTimeout(this._statusTimeout),this._statusTimeout=null,this._statusTries=0},o.prototype._check=function(){return this._statusTries>=o.MAX_TRIES?void("function"==typeof this.onError&&this.onError()):(this._statusTries++,this._statusRequest=i.WebRequest({url:this.url,subject_user:this.userId,success:this._onCheckSuccess,error:this._onCheckError}))},o.prototype._onCheckSuccess=function(e,n,i){switch(parseInt(e,10)){case t.DOC_PREVIEW_AVAILABLE:return"function"==typeof this.onSuccess?this.onSuccess():void 0;case t.DOC_PREVIEW_IN_PROGRESS:return this._statusTimeout=setTimeout(this._check,o.TIMEOUT);default:return"function"==typeof this.onError?this.onError():void 0}},o.prototype._onCheckError=function(e,t,n){return"function"==typeof this.onError?this.onError():void 0},o}()})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/previews/util",["modules/core/browser","modules/clean/analytics","modules/clean/datetime","modules/clean/filepath","modules/clean/gandalf_util","modules/constants/comments_panel","modules/constants/env","modules/constants/legacy","modules/constants/static","modules/constants/viewer","modules/core/uri"],function(t,n,i,o,r,s,a,l,u,c,d){var p,_,h,m;return h=n.UserActivityLogger,m=i.getActingTime,p={is_annotation_marker_enabled:function(){return s.ALLOW_ANNOTATION_MARKER},is_annotation_highlight_enabled:function(){return s.ALLOW_ANNOTATION_HIGHLIGHT},is_annotation_region_enabled:function(){return s.ALLOW_ANNOTATION_REGION},is_indesign_preview_enabled:function(){return c.docpreview_indesign_preview},is_saveas_experiment_enabled:function(){return r.getGandalfRule("saveas_experiment")},is_password_protected_preview_enabled:function(){return c.docpreview_password_protected_preview},use_excel2_for_extension:function(e){return null==e&&(e=""),_.is_excel_file(e)&&r.getGandalfRule("docpreview_excel2")},is_commenting_integrated:function(){return r.getGandalfRule("file_viewer_hide_comments")},force_serve_from_dldoc:function(){return c.docpreview_serve_from_dldoc},use_riviera_to_generate_preview:function(){return c.docpreview_riviera_on_the_fly},validate_riviera:function(){return c.docpreview_validate_riviera}},_={get_extension:function(e){return o.file_extension(e.fq_path||e.filename).toLowerCase()},get_filename:function(e){return o.filename(e.fq_path||e.filename)},normalize_extension:function(e){var t;if("indd"===e)return e;switch(t=e.substring(0,3)){case"rtf":case"odt":return"doc";case"pps":case"odp":return"ppt";case"csv":case"ods":return"xls";default:return t}},is_excel_file:function(e){return"xls"===e.substring(0,3)},get_progressive_url:function(e,t){var n,i,o;return n=_.normalize_extension(e),o=d.parse(t),("doc"===n||"key"===n||"keynote"===n||"adobecs"===n||p.use_excel2_for_extension(n))&&"pdf-js"!==l.PDF_PREVIEW_MODE&&(o=o.updateQuery({post_message_on_failure:1})),"xls"!==n||p.use_excel2_for_extension(n)||(i="xls/preview"),(null!=i||p.use_excel2_for_extension(n))&&o.setAuthority(o.getAuthority().replace("dl-web","dl-doc")),null!=i&&(o.setPath(o.getPath().replace("/pri/get/","/get/")),o.setPath(o.getPath().replace("/get/","/"+i+"/"))),o=o.updateQuery({get_preview:1,saveas:p.is_saveas_experiment_enabled()?1:0,use_riviera:p.use_riviera_to_generate_preview()?1:0,validate_riviera:p.validate_riviera()?1:0})},get_pdf_js_url:function(e,t){return"pdf-js"===l.PDF_PREVIEW_MODE&&(e=p.use_excel2_for_extension(t)?d.parse(u.static_url_pdfjs_excel):d.parse(u.static_url_pdfjs_viewer)),e},getModifierString:function(e){return m(1e3*e.ts)},_getVersionHistoryUrl:function(e,t){var n;return n=d(r.getGandalfRule("revision_history_web")?{path:"/history"+e.fq_path}:{path:"/revisions"+e.fq_path}),this.update_url_with_user_id(n,t.id)},redirectToVersionHistory:function(e,n){var i;return h.log("web","view_version_history"),i=_._getVersionHistoryUrl(e,n),t.redirect(i)},update_url_for_annotation:function(e){return p.is_annotation_marker_enabled()&&(e=e.updateQuery("annotation_marker","1")),p.is_annotation_highlight_enabled()&&(e=e.updateQuery("annotation_highlight","1")),p.is_annotation_region_enabled()&&(e=e.updateQuery("annotation_region","1")),e},update_url_with_user_id:function(e,t){return e.updateQuery(c.UID_PARAM_NAME,t)},VALID_PREVIEW_TYPES:["photo","video","linkfile","adobecs","doc","excel","html","keynote","text","audio"],isPreviewable:function(n){var i,o,r,s,a,u;return o=_.get_extension(n),u=n.preview_type,a=e.call(this.VALID_PREVIEW_TYPES,u)>=0,s=Number.MAX_VALUE,"pdf"===o?s=l.MAX_PDF_FILE_SIZE_B:"text"===n.preview_type?s=l.MAX_TEXT_FILE_SIZE_B:"linkfile"===n.preview_type&&(s=l.MAX_LINKFILE_SIZE_B),r=n.bytes<s,i=!t.msie_version_at_most(9),a&&r&&i},canGeneratePreview:function(e){var t;return t=_.get_extension(e),_.isPreviewable(e)&&e.doc_preview_status!==l.DOC_PREVIEW_UNAVAILABLE_BAD_FILE&&_.extCanGeneratePreview(t)},extCanGeneratePreview:function(e){var t;return t=_.normalize_extension(e),"doc"===t||"ppt"===t||"xls"===t||"key"===t||"eps"===t||"ai"===t||"indd"===t},usesFrameMessenger:function(e){return"excel"===e||"text"===e||"doc"===e}},{PermissionHelper:p,PreviewHelper:_}})}.call(this),function(){define("modules/clean/react/browse/constants",["modules/core/i18n"],function(e){var t,n,i,o,r,s,a,l;t=e._,o={},o.BrowseActionTypes={INITIALIZE_EVERYTHING:"INITIALIZE_EVERYTHING",LOAD_PATH:"LOAD_PATH",ADD_FILES:"ADD_FILES",SET_PATH:"SET_PATH",SET_USER:"SET_USER",SET_URL_PREFIX:"SET_URL_PREFIX",SET_LOADING_STATE:"SET_LOADING_STATE",SET_MOUNT_POINTS:"SET_MOUNT_POINTS",CHANGE_FILES:"CHANGE_FILES",SET_SELECTION:"SET_SELECTION",SELECT_FILES_BY_FQ_PATH:"SELECT_FILES_BY_FQ_PATH",TOGGLE_FQ_PATH_SELECTED:"TOGGLE_FQ_PATH_SELECTED",SET_SHOULD_SHOW_DELETED_FILES:"SET_SHOULD_SHOW_DELETED_FILES",START_INTERNAL_DRAG:"START_INTERNAL_DRAG",STOP_INTERNAL_DRAG:"STOP_INTERNAL_DRAG",SET_DROP_TARGET:"SET_DROP_TARGET",SORT_FILES:"SORT_FILES",SET_COPY_MODE:"SET_COPY_MODE",COPY_SELECTED_FILES_TO_CLIPBOARD:"COPY_SELECTED_FILES_TO_CLIPBOARD",REQUEST_NEW_FILE_NAME:"REQUEST_NEW_FILE_NAME",CANCEL_FILE_RENAME:"CANCEL_FILE_RENAME",SET_FILE_RENAME_PENDING:"SET_FILE_RENAME_PENDING",SET_FILE_RENAME_COMPLETE:"SET_FILE_RENAME_COMPLETE",REQUEST_FOLDER_NAME:"REQUEST_FOLDER_NAME",CREATE_FOLDER_PENDING:"CREATE_FOLDER_PENDING",CREATE_FOLDER_COMPLETE:"CREATE_FOLDER_COMPLETE",CANCEL_CREATE_FOLDER:"CANCEL_CREATE_FOLDER",SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE:"SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE",TEAM_FOLDER_DOWNGRADE:"TEAM_FOLDER_DOWNGRADE",ADD_COMMENT_STATUS_BATCH:"ADD_COMMENT_STATUS_BATCH",ADD_FILE_JUMP_KEY_CODE:"ADD_FILE_JUMP_KEY_CODE",RESET_FILE_JUMP:"RESET_FILE_JUMP"},o.NewFolderCreationState={CREATE_FOLDER_INACTIVE:"CREATE_FOLDER_INACTIVE",PENDING_INPUT:"PENDING_INPUT",SAVING_INPUT:"SAVING_INPUT"},o.LoadingStates={LOADED:"LOADED",LOADING_FIRST_PAGE:"LOADING_FIRST_PAGE",LOADING_REMAINING_PAGES:"LOADING_REMAINING_PAGES"},o.Direction={UP:"UP",DOWN:"DOWN"},o.FileTypes={FILE:1,FOLDER:2,PACKAGE:3,SHARED_FOLDER:4,SANDBOX:5,TEAM_SHARED_FOLDER:6},o.NameSpaceAccess={ACCESS_NO_ACCESS:0,ACCESS_READER:1,ACCESS_WRITER:2,ACCESS_OWNER:3},o.REACT_FILE_VIEWER_ELEMENT_ID="browse-react-file-viewer-container",o.BrowseSortField={FILENAME:"FILENAME",MODIFIED:"MODIFIED",CATEGORY:"CATEGORY",EXTENSION:"EXTENSION",SIZE:"SIZE"},o.DropTargetHighlightMode={NONE:"NONE",ALL_FOLDERS:"ALL_FOLDERS",NONSELECTED_FOLDERS:"NONSELECTED_FOLDERS",NONSELECTED_NONSHARED_FOLDERS:"NONSELECTED_NONSHARED_FOLDERS",NONSELECTED_NONSHARED_NONTEAM_FOLDERS:"NONSELECTED_NONSHARED_NONTEAM_FOLDERS"},n={IMAGE:["bmp","cr2","gif","ico","jpeg","jpg","nef","png","psd","tif","tiff","svg","svgz"],VIDEO:["3gp","3gpp","3gpp2","avi","dv","flv","m2t","m4v","mkv","mov","mp4","mpeg","mpg","mts","ts","vob","wmv"],AUDIO:["aif","flac","m4a","m4p","mp3","ogg","wav","wma"],DOCUMENT:["ai","cdr","csv","doc","docx","docm","eps","fla","indd","keynote","numbers","otf","pages","pdf","ppt","pptx","pptm","pps","ppsx","ppsm","ps","rtf","swf","txt","wpd","xls","xlsx","xlsm"],COMPRESSED_FILE:["7z","bz2","gz","gzip","rar","tar","zip"],CODE:["as","as3","c","coffee","cpp","cs","css","cxx","h","html","java","js","less","php","py","rb","sass","scss","sh","sql","vb","xhtml","xml"],DISK_IMAGE:["dmg","iso"],EXECUTABLE:["exe"],SHORTCUT:["lnk"],LINK:["url","webloc"],FONT:["ttf"]},o.FileTypeCategoryTranslations={FILE:t("file"),FOLDER:t("folder"),SHARED_FOLDER:t("shared folder"),TEAM_SHARED_FOLDER:t("team folder"),PUBLIC_FOLDER:t("folder"),IMAGE:t("image"),VIDEO:t("video"),AUDIO:t("audio"),DOCUMENT:t("document"),COMPRESSED_FILE:t("archive"),CODE:t("code"),DISK_IMAGE:t("disk image"),EXECUTABLE:t("executable"),SHORTCUT:t("shortcut"),LINK:t("link"),FONT:t("font"),SANDBOX:t("app folder")},o.DeletedFileTypeCategoryTranslations={FILE:t("deleted file"),FOLDER:t("deleted folder"),SHARED_FOLDER:t("deleted shared folder"),TEAM_SHARED_FOLDER:t("deleted team folder"),PUBLIC_FOLDER:t("deleted folder"),IMAGE:t("deleted image"),VIDEO:t("deleted video"),AUDIO:t("deleted audio"),DOCUMENT:t("deleted document"),COMPRESSED_FILE:t("deleted archive"),CODE:t("deleted code"),DISK_IMAGE:t("deleted disk image"),EXECUTABLE:t("deleted executable"),SHORTCUT:t("deleted shortcut"),LINK:t("deleted link"),FONT:t("deleted font"),SANDBOX:t("deleted app folder")},o.ExtensionCategories={};for(i in n)for(s=n[i],a=0,l=s.length;l>a;a++)r=s[a],o.ExtensionCategories[r]=i;return o.RenameStates={PENDING_INPUT:"pending-input",SAVING_INPUT:"saving-input"},o.MouseEventButton={NONE:-1,LEFT:0,MIDDLE:1,RIGHT:2},o.ShareFolderModalTypes={ShareExisting:1,EditShared:2,EditSharedSubFolder:3},o.SharedWithActionTypes={SET_SHARED_FOLDER_DATA:"SET_SHARED_FOLDER_DATA",SET_MEMBER_COUNTS_FOR_NS:"SET_MEMBER_COUNTS_FOR_NS",SET_SHARED_LINK_DATA:"SET_SHARED_LINK_DATA",SET_SHARED_FILE_DATA:"SET_SHARED_FILE_DATA",SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE:"SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE",SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE:"SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE",SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE:"SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE",CLEAR_SHARED_FOLDER_DATA_FOR_NS:"CLEAR_SHARED_FOLDER_DATA_FOR_NS",REMOVE_SHARED_LINK_DATA:"REMOVE_SHARED_LINK_DATA"},o.SEARCH_PREFIX="/search",o})}.call(this),function(){define("modules/clean/react/browse/models",["external/underscore","external/react","external/immutable","modules/core/exception","modules/clean/filepath","modules/clean/react/browse/constants","modules/constants/legacy"],function(e,t,n,i,o,r,s){var a,l,u,c,d,p,_,h,m,f,v,g;return f=t.PropTypes,m=r.NameSpaceAccess,_=r.FileTypeCategoryTranslations,u=r.DeletedFileTypeCategoryTranslations,c=r.ExtensionCategories,h=r.FileTypes,v=r.RenameStates,d=n.Record({ago:void 0,bytes:void 0,direct_blockserver_link:void 0,doc_preview_status:void 0,file_id:void 0,filename_highlights:void 0,fq_path:void 0,href:void 0,htmlified_link:void 0,icon:void 0,in_root_coll:void 0,is_dir:!1,is_read_only_mount:!1,linkfile_link:void 0,ns_id:0,is_in_team_folder_tree:!1,ns_path:void 0,preview_type:void 0,size:-1,sjid:0,sort_key:[""],target_ns:0,thumbnail_url_tmpl:void 0,preview_url:void 0,ts:0,type:null,video_transcode_url:void 0,last_modified_fname:null,feedback_off:null,comment_count:null,unresolved_comment_count:null,isDeleted:!1}),g={ago:"ago",bytes:"bytes",direct_blockserver_link:"direct_blockserver_link",doc_preview_status:"doc_preview_status",file_id:"file_id",filename_highlights:"filename_highlights",fq_path:"fq_path",href:"href",htmlified_link:"htmlified_link",icon:"icon",in_root_coll:"in_root_coll",is_dir:"is_dir",is_read_only_mount:"is_read_only_mount",linkfile_link:"linkfile_link",ns_id:"ns_id",is_in_team_folder_tree:"is_in_team_folder_tree",ns_path:"ns_path",preview_type:"preview_type",size:"size",sjid:"sjid",sort_key:"sort_key",target_ns:"target_ns",thumbnail_url_tmpl:"thumbnail_url_tmpl",preview_url:"preview_url",ts:"ts",type:"type",video_transcode_url:"video_transcode_url",last_modified_fname:"last_modified_fname",feedback_off:"feedback_off",comment_count:"comment_count",unresolved_comment_count:"unresolved_comment_count"},d.fromServerObject=function(e){var t,n,o;if("object"!=typeof e)return i.raiseAndReport({msg:"File.fromServerObject called with an unexpected argument: "+e}),new d;n={};for(o in e)g.hasOwnProperty(o)&&(t=g[o],n[t]=e[o]);return e.hasOwnProperty("bytes")&&(n.isDeleted=-1===e.bytes),new d(n)},d.getExtension=function(e){return o.file_extension(e.fq_path,!0).toLowerCase()},d.getCategoryDescription=function(e){var t;if(e.is_dir){switch(t="FOLDER",e.type){case h.TEAM_SHARED_FOLDER:t="TEAM_SHARED_FOLDER";break;case h.SHARED_FOLDER:t="SHARED_FOLDER";break;case h.SANDBOX:t="SANDBOX";break;default:e.target_ns&&(t="SHARED_FOLDER")}return e.isDeleted?u[t]:_[t]}return t=c[d.getExtension(e)]||"FILE",e.isDeleted?u[t]:_[t]},l=n.Record({isSimpleSharingEnabled:!1,isPublicFolderEnabled:!1,publicAppToken:null}),a=n.Record({currentNSID:s.root_ns,currentFQPath:null,currentMountPoint:null,currentNSPath:null,currentSharedFolderPermissionRole:m.ACCESS_NO_ACCESS,currentNSAllowsNesting:!1,inactiveNSIDByFQPath:n.Map(),permanentDeletionDisabledStateByNSID:n.Map(),isInFolderMode:!0,isInsideSharedFolder:!1,isInsideAutoTeamFolder:!1,isInsideTeamFolderTree:!1,isInsideDeletedFolder:!1,isInsideDeletedSharedFolder:!1,showSharedFolderCreateTeamPromo:!1,blockHash:null,config:new l}),a.prototype.isCurrentPathWriteable=function(){var e;return!this.isInsideSharedFolder||(e=this.currentSharedFolderPermissionRole)===m.ACCESS_WRITER||e===m.ACCESS_OWNER},p=n.Record({file:null,state:null}),p.propTypes=f.shape({file:f.instanceOf(d),state:f.oneOf(e.values(v))}),{File:d,Config:l,BrowseContext:a,FileRename:p}})}.call(this),function(){define("modules/clean/react/bubble_menu",["jquery","external/react","external/underscore","modules/clean/keycode","modules/clean/react/bubble_dropdown"],function(e,t,n,i,o){var r,s,a,l,u,c,d;return d=t.DOM,u=t.createElement,c=t.addons.classSet,l=t.PropTypes,s=t.createClass({displayName:"BubbleMenuItem",propTypes:{onClick:t.PropTypes.func,href:t.PropTypes.string,target:t.PropTypes.string,disabled:t.PropTypes.bool,closeOnClick:t.PropTypes.bool,closeFunc:t.PropTypes.func.isRequired,className:t.PropTypes.string,onMouseEnter:t.PropTypes.func,onMouseLeave:t.PropTypes.func},getDefaultProps:function(){return{onClick:function(){},href:"#",closeOnClick:!0}},_handleMouseEnter:function(t){var n;if(null!=this.refs.item)return e(this.refs.item.getDOMNode()).closest(".bubble-menu").removeClass("bubble-menu--keyboard"),"function"==typeof(n=this.props).onMouseEnter?n.onMouseEnter(t):void 0},_handleClick:function(e){return this.props.disabled?(e.preventDefault(),e.stopPropagation()):"#"===this.props.href&&(e.preventDefault(),this.props.onClick(e),this.props.closeOnClick)?this.props.closeFunc():void 0},renderContents:function(){var e;return e={"bubble-menu-item":!0,"bubble-menu-item--disabled":this.props.disabled},d.a({ref:"item",role:"menuitem",className:c(e),href:this.props.href,target:this.props.target,onClick:this._handleClick,onMouseEnter:this._handleMouseEnter,onMouseLeave:this.props.onMouseLeave,"aria-disabled":this.props.disabled},this.props.children)},render:function(){return d.li({role:"presentation",className:this.props.className?"bubble-menu-item-wrapper "+this.props.className:"bubble-menu-item-wrapper"},this.renderContents())}}),a=t.createClass({displayName:"BubbleMenuItemGroup",props:{items:t.PropTypes.arrayOf(s).isRequired,closeFunc:t.PropTypes.func},render:function(){var e,n;return 0===this.props.items.length?null:d.li({className:"bubble-menu-item-group",role:"presentation"},d.ul({className:"bubble-menu-item-group u-unlist u-trim-padding",role:"group"},function(){var i,o,r,s,a;for(r=this.props.items,a=[],e=i=0,o=r.length;o>i;e=++i)n=r[e],a.push(t.addons.cloneWithProps(n,{closeFunc:this.props.closeFunc,key:null!=(s=n.key)?s:e}));return a}.call(this)))}}),r=t.createClass({displayName:"BubbleMenu",propTypes:n.extend(o.propTypes,{items:l.array}),render:function(){var e,i;return u(o,n.extend({},this.props,{ref:"bubble",autofocus:!1,bubbleDropdownShown:this.bubbleDropdownShown}),d.ul({role:"menu",ref:"menu",className:"bubble-menu",tabIndex:"-1"},function(){var n,o,r,s,a;for(r=this.props.items,a=[],e=n=0,o=r.length;o>n;e=++n)i=r[e],a.push(t.addons.cloneWithProps(i,{closeFunc:this.hide,key:null!=(s=i.key)?s:e}));return a}.call(this)))},componentDidMount:function(){return null!=this.refs.bubble?this.refs.bubble.getTargetButton().setAttribute("aria-haspopup",!0):void 0},bubbleDropdownShown:function(){var t;if(null!=this.refs.menu&&null!=this.refs.bubble)return this.$menu=e(this.refs.menu.getDOMNode()),this.$menu.attr("aria-labelledby",this.refs.bubble.containerId),this.$menu.focus(),this.$menuitems=this.$menu.find('*[role="menuitem"]'),this.$menu.on("keydown",this.onKeyDown),"function"==typeof(t=this.props).bubbleDropdownShown?t.bubbleDropdownShown():void 0},onKeyDown:function(t){return e(this.$menu).addClass("bubble-menu--keyboard"),t.keyCode===i.DOWN?(this.focusNext(t.target),t.preventDefault(),t.stopPropagation()):t.keyCode===i.UP?(this.focusPrevious(t.target),t.preventDefault(),t.stopPropagation()):void 0},focusPrevious:function(e){var t;return t=this.$menuitems.index(e),t=-1===t||0===t?this.$menuitems.length-1:t-1,this.$menuitems.get(t).focus()},focusNext:function(e){var t;return t=this.$menuitems.index(e),t=-1===t||t===this.$menuitems.length-1?0:t+1,this.$menuitems.get(t).focus()},hideIfShown:function(){var e;return null!=(e=this.refs.bubble)?e.hideIfShown():void 0},toggle:function(){var e;return null!=(e=this.refs.bubble)?e.toggle():void 0},show:function(){var e;return null!=(e=this.refs.bubble)?e.show():void 0},hide:function(){var e;return null!=(e=this.refs.bubble)?e.hide():void 0}}),{BubbleMenuItem:s,BubbleMenuItemGroup:a,BubbleMenu:r}})}.call(this),function(){define("modules/clean/react/button",["external/react","external/underscore"],function(e,t){var n,i;return i=e.DOM,n=e.addons.classSet,{button:e.createClass({displayName:"button",propTypes:{importance:e.PropTypes.string,variant:e.PropTypes.string,disabled:e.PropTypes.bool,className:e.PropTypes.string},render:function(){var e,o,r,s;return s=this.props.importance||"primary",r={},r["button-"+s]=!0,r["button-"+this.props.variant]=null!=this.props.variant&&"standard"!==this.props.variant,null!=this.props.className&&(r[this.props.className]=!0),o=t.clone(this.props),o.className=n(r),e=i.button(o,this.props.children)}}),link_button:e.createClass({displayName:"link_button",propTypes:{importance:e.PropTypes.string,variant:e.PropTypes.string,disabled:e.PropTypes.bool,className:e.PropTypes.string},render:function(){var e,o,r,s;return s=this.props.importance||"primary",r={},r["button-"+s]=!0,r["button-"+this.props.variant]=null!=this.props.variant&&"standard"!==this.props.variant,null!=this.props.className&&(r[this.props.className]=!0),o=t.clone(this.props),o.className=n(r),e=i.a(o,this.props.children)}})}})}.call(this),function(){define("modules/clean/react/copy_to_dropbox/actions",["modules/clean/react/copy_to_dropbox/api","modules/core/browser"],function(e,t){var n;return new(n=function(){function n(){}return n.prototype.copySharedFile=function(n,i,o){return e.copySharedFile(n,i,o).then(function(e){return t.redirect(e)})},n}())})}.call(this),function(){define("modules/clean/react/copy_to_dropbox/api",["modules/clean/ajax"],function(e){var t;return t={},t.copySharedFile=function(t,n,i){var o,r;return o={link_type:t.linkType,link_key:t.linkKey,subpath:t.subPath,secure_hash:t.secureHash,is_package:t.isPackage},t.itemId&&(o.item_id=t.itemId),r=e.WebProgressRequest({url:"/sm/c2d",data:o,progress_text:i,subject_user:n.id})},t})}.call(this),function(){define("modules/clean/react/copy_to_dropbox/modal",["external/react","modules/clean/analytics","modules/clean/em_string","modules/clean/react/copy_to_dropbox/actions","modules/clean/react/modal","modules/clean/viewer","modules/constants/viewer","modules/core/i18n","modules/core/notify"],function(e,t,n,i,o,r,s,a,l){var u,c,d,p,_,h,m;return _=t.WebMiscActivityLogger,c=o.Modal,d=s.ROLE_PERSONAL,p=s.ROLE_WORK,h=a._,m=e.DOM.p,c=e.createFactory(c),u=e.createClass({displayName:"CopyToDropboxModal",propTypes:{shareToken:e.PropTypes.object.isRequired,file:e.PropTypes.object.isRequired,user:e.PropTypes.object.isRequired},componentDidMount:function(){return _.log("show-c2d-modal",{filename:this.props.file.filename})},_getTitle:function(){var e,t,i,o,s;if(s=r.get_viewer(),e=this.props.file.filename,!s.is_paired)return t=15,e=n.em_snippet(e,t),h("Save ‘%(filename)s’ to my Dropbox").format({filename:e});switch(this.props.user.role){case d:return t=10,e=n.em_snippet(e,t),h("Save ‘%(filename)s’ to my personal Dropbox").format({filename:e});case p:return i=s.team_name,o=new n(i).length,t=Math.max(10,15-o),e=n.em_snippet(e,t),h("Save ‘%(filename)s’ to my %(team_name)s Dropbox").format({filename:e,team_name:i})}},_getBodyText:function(){var e;if(e=r.get_viewer(),!e.is_paired)return h("This file will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.");switch(this.props.user.role){case d:return h("This file will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account.");case p:return h("This file will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.").format({team_name:e.team_name})}},_getAcceptButtonText:function(){var e;if(e=r.get_viewer(),!e.is_paired)return h("Save to my Dropbox");switch(this.props.user.role){case d:return h("Save to my personal Dropbox");case p:return h("Save to my %(team_name)s Dropbox").format({team_name:e.team_name})}},_getProgressMessage:function(){var e;if(e=r.get_viewer(),!e.is_paired)return h("Saving to your Dropbox...");switch(this.props.user.role){case d:return h("Saving to your personal Dropbox...");case p:return h("Saving to your %(team_name)s Dropbox...").format({team_name:e.team_name})}},_handleAccept:function(){var e;return e=this._getProgressMessage(),l.success(e),i.copySharedFile(this.props.shareToken,this.props.user,e)},render:function(){return c({title:this._getTitle(),acceptButtonText:this._getAcceptButtonText(),dismissButtonText:h("Cancel"),onAccept:this._handleAccept},m({},this._getBodyText()))}})})}.call(this),function(){define("modules/clean/react/css",["external/react","external/underscore","modules/clean/css","modules/clean/js_environment"],function(e,t,n,i){var o,r,s,a;return s=e.DOM,r=e.createElement,o={LOADING:"loading",SUCCESS:"success",FAILED:"failed",FORCE_RENDERED:"force-rendered"},a=function(s,a,l){var u,c,d,p,_,h,m,f,v,g,y,b,w,E,T;for(null==l&&(l=[]),f=null!=(E=s.displayName)?E:"UnnamedComponent",T="Css("+f+")",_={},m=0,y=a.length;y>m;m++)h=a[m],_[h]=!0;for(v=0,b=l.length;b>v;v++)if(u=l[v],d="function"==typeof u.getCombinedCssPaths?u.getCombinedCssPaths():void 0,(null!=d?d.length:void 0)>0)for(g=0,w=d.length;w>g;g++)c=d[g],_[c]=!0;return p=Object.keys(_),e.createClass({displayName:T,statics:{getCombinedCssPaths:function(){return p},wrappedClass:s},propTypes:{cssPlaceholder:e.PropTypes.node,onCssFail:e.PropTypes.func,onCssLoad:e.PropTypes.func,skipCssInTest:e.PropTypes.bool},getDefaultProps:function(){return{cssPlaceholder:null,onCssFail:function(e){return e()},onCssLoad:null,skipCssInTest:!0}},getInitialState:function(){var e;return e=i.isTest()&&this.props.skipCssInTest||n.is_loaded(p)?o.FORCE_RENDERED:o.LOADING,{cssMode:e}},componentWillMount:function(){return this.state.cssMode===o.LOADING?n.require_css_multi(p,this._handleCssLoaded,this._handleCssFailed):void 0},render:function(){var e;return(e=this.state.cssMode)===o.FORCE_RENDERED||e===o.SUCCESS?r(s,t.extend({ref:"wrapped"},this.props),this.props.children):this.props.cssPlaceholder},getWrappedComponent:function(){return this.refs.wrapped},_handleCssLoaded:function(){return this.setState({cssMode:o.SUCCESS},function(e){return function(){var t;return"function"==typeof(t=e.props).onCssLoad?t.onCssLoad():void 0}}(this))},_handleCssFailed:function(){return this.setState({cssMode:o.FAILED},function(e){return function(){var t;return"function"==typeof(t=e.props).onCssFail?t.onCssFail(e._forceRender):void 0}}(this))},_forceRender:function(){return this.setState({cssMode:o.FORCE_RENDERED})}})}})}.call(this),function(){define("modules/clean/react/file_action_button",["external/react","modules/clean/react/bubble_menu","modules/clean/react/sprite_div","modules/core/i18n"],function(e,t,n,i){var o,r,s,a,l,u;return o=t.BubbleMenuItem,a=i._,l=e.createElement,u=e.DOM,s={COMMENT:"COMMENT",COPY:"COPY",DELETE:"DELETE",DOWNLOAD:"DOWNLOAD",MOVE:"MOVE",OPEN:"OPEN",PREVIOUS_VERSIONS:"PREVIOUS_VERSIONS",REMOVE_LINK:"REMOVE_LINK",RENAME:"RENAME",SHARE:"SHARE",ENABLE_COMMENTS:"ENABLE_COMMENTS",DISABLE_COMMENTS:"DISABLE_COMMENTS",SHOW_RESOLVED_COMMENTS:"SHOW_RESOLVED_COMMENTS",HIDE_RESOLVED_COMMENTS:"HIDE_RESOLVED_COMMENTS",SUBSCRIBE:"SUBSCRIBE",UNSUBSCRIBE:"UNSUBSCRIBE"},r=e.createClass({displayName:"FileActionButton",propTypes:{type:e.PropTypes.string.isRequired,callback:e.PropTypes.func.isRequired,closeFunc:e.PropTypes.func,className:e.PropTypes.string},getDefaultProps:function(){return{closeFunc:null}},_getIconAndText:function(){switch(this.props.type){case s.COMMENT:return{icon:"s_file_comment",text:a("Comment",{comment:"BUTTON"})};case s.COPY:return{icon:"copy",text:a("Copy…",{comment:"BUTTON"})};case s.DELETE:return{icon:"delete_16",text:a("Delete…",{comment:"BUTTON"})};case s.DOWNLOAD:return{icon:"download_arrow",text:a("Download",{comment:"BUTTON"})};case s.MOVE:return{icon:"move_16",text:a("Move…",{comment:"BUTTON"})};case s.OPEN:return{icon:"open",text:a("Open",{comment:"BUTTON"})};case s.PREVIOUS_VERSIONS:return{icon:"previous_versions",text:a("Previous versions",{comment:"BUTTON"})};case s.REMOVE_LINK:return{icon:"lock",text:a("Remove link",{comment:"BUTTON"})};case s.RENAME:return{icon:"rename",text:a("Rename",{comment:"BUTTON"
})};case s.SHARE:return{icon:"s_rainbow",text:a("Share",{comment:"BUTTON"})};case s.ENABLE_COMMENTS:return{icon:"s_file_comment",text:a("Enable comments",{comment:"BUTTON"})};case s.DISABLE_COMMENTS:return{icon:"s_disable",text:a("Disable comments",{comment:"BUTTON"})};case s.SHOW_RESOLVED_COMMENTS:return{icon:"s_resolve",text:a("Show resolved comments",{comment:"BUTTON"})};case s.HIDE_RESOLVED_COMMENTS:return{icon:"s_resolve",text:a("Hide resolved comments",{comment:"BUTTON"})};case s.SUBSCRIBE:return{icon:"s_notifications_on",text:a("Subscribe to notifications",{comment:"BUTTON"})};case s.UNSUBSCRIBE:return{icon:"s_notifications_off",text:a("Unsubscribe from notifications",{comment:"BUTTON"})};default:return null}},render:function(){var e,t,i;return t=this._getIconAndText(),e=t.icon,i=t.text,l(o,{onClick:this.props.callback,closeFunc:this.props.closeFunc,className:this.props.className},l(n,{group:"web",name:e,text:i}))}}),{FileActionButtonType:s,FileActionButton:r}})}.call(this),function(){define("modules/clean/react/file_comments/comment_tab_nav",["jquery","external/react","external/classnames","modules/core/i18n","modules/clean/react/tabs/tab_nav","modules/clean/react/tabs/tab_util","modules/clean/comments/actions"],function(e,t,n,i,o,r,s){var a,l,u,c,d,p,_;return d=i._,_=i.ungettext,p=t.DOM,c=t.createFactory(o),u="tab_nav_comments",l="tab_nav_annotations",a=t.createClass({displayName:"CommentTabNav",propTypes:{commentListOptions:t.PropTypes.node,commentField:t.PropTypes.node,commentList:t.PropTypes.arrayOf(t.PropTypes.node),annotationList:t.PropTypes.arrayOf(t.PropTypes.node),selectedTab:t.PropTypes.oneOf([u,l]),numComments:t.PropTypes.number.isRequired,numAnnotations:t.PropTypes.number.isRequired},getDefaultProps:function(){return{selectedTab:u}},onTabNavChange:function(e){return s.switchTabs({selectedTab:e})},_getCommentsTabLabel:function(){return _("Comment (%(num)s)","Comments (%(num)s)",this.props.numComments).format({num:this.props.numComments})},_getAnnotationsTabLabel:function(){return _("Annotation (%(num)s)","Annotations (%(num)s)",this.props.numAnnotations).format({num:this.props.numAnnotations})},render:function(){var e,t;return t=n({"comments-tab-content":!0,hidden:this.props.selectedTab===l}),e=n({"annotations-tab-content":!0,hidden:this.props.selectedTab===u}),p.div({className:"comments-tab-nav__container"},p.div({className:"comments-tab-nav__options"},this.props.commentListOptions),c({tabs:[{value:u,label:this._getCommentsTabLabel()},{value:l,label:this._getAnnotationsTabLabel()}],defaultSelectedIndex:[u,l].indexOf(this.props.selectedTab),onChange:this.onTabNavChange,variant:r.variants.UNDERLINE+" comments-tab-nav__variant"},p.div({className:t},p.div({className:"comment-list"},null!=this.props.commentField?p.div({className:"comment-field-wrapper threaded-comment-list"},this.props.commentField):void 0,this.props.commentList)),p.div({className:e},p.div({ref:"annotationList",className:"comment-list"},this.props.annotationList))))}}),{CommentTabNavClass:a,TAB_NAV_COMMENTS:u,TAB_NAV_ANNOTATIONS:l}})}.call(this),function(){define("modules/clean/react/file_comments/logger",["modules/clean/ajax","modules/clean/activity/activity","modules/clean/activity/like","modules/clean/annotations/annotation","modules/clean/viewer","modules/core/exception"],function(e,t,n,i,o,r){var s,a,l;return s=i.Annotation,a=function(){function t(){}return t.prototype.log_event=function(t,n,i,o,s,a,l,u,c){return null==l&&(l=null),null==u&&(u=null),null==c&&(c=null),r.assert(t,"event_type not provided"),r.assert(n,"file_activity_key not provided"),e.SilentBackgroundRequest({url:"/file_activity/client_log",type:"POST",data:{event_type:t,file_activity_key:n,comment_activity_key:i,client_origin_type:o,activity_context:a,annotation_type:l,annotation_subtype:u,annotation_page:c},subject_user:s})},t.prototype.log_annotation_event=function(e,t,n,i,o,r){var a,l,u,c;return null==r&&(r=null),null!=r&&(a=s.createAnnotationFromDict(r),c=a.type,u=a.subtype,l=a.getFirstPdfPage()),this.log_event(e,t,n,null,i,o,c,u,l)},t}(),l=new a})}.call(this),function(){var e=[].slice;define("modules/clean/react/file_comments/onboarding",["external/react","modules/core/i18n","modules/clean/react/image","modules/clean/react/onboarding_modal","modules/clean/static_urls","modules/constants/comments_panel"],function(t,n,i,o,r,s){var a,l,u,c,d,p,_,h,m,f;return _=n._,f=r.static_url,m=t.DOM,h=t.addons.classSet,c=[{src:f("/static/images/commenting/onboarding_step1-vflB01-Fx.png"),srcHiRes:f("/static/images/commenting/onboarding_step1@2x-vflyooTgN.png")},{src:f("/static/images/commenting/onboarding_step2-vflQHsmaO.png"),srcHiRes:f("/static/images/commenting/onboarding_step2@2x-vflEm4vmD.png")},{src:f("/static/images/commenting/onboarding_step3-vflvKl_oO.png"),srcHiRes:f("/static/images/commenting/onboarding_step3@2x-vfljsqrRb.png")}],u=t.createFactory(o),l=t.createFactory(i),p=t.createClass({displayName:"Slide",mixins:[t.addons.PureRenderMixin],statics:{slideImages:c},propTypes:{heading:t.PropTypes.string.isRequired,subheading:t.PropTypes.string.isRequired,image:t.PropTypes.shape({src:t.PropTypes.string.isRequired,srcHiRes:t.PropTypes.string.isRequired}).isRequired,className:t.PropTypes.string},render:function(){return m.div({className:h("comment-onboarding-slide",this.props.className)},l({src:this.props.image.src,srcHiRes:this.props.image.srcHiRes,className:"comment-onboarding-illustration"}),m.h1({className:"comment-onboarding-heading"},this.props.heading),m.h2({className:"comment-onboarding-subheading"},this.props.subheading))}}),d=t.createFactory(p),a=t.createClass({displayName:"CommentingOnboardingModal",mixins:[t.addons.PureRenderMixin],PropTypes:{onOpen:t.PropTypes.func,onClose:t.PropTypes.func},componentDidMount:function(){var e;return"function"==typeof(e=this.props).onOpen?e.onOpen():void 0},getSlides:function(){return s.ALLOW_INLINE_EA?[d({className:"comment-slide-1",heading:_("Annotate your files"),subheading:_("Give clear, focused feedback that’s faster than email."),image:c[0]}),d({className:"comment-slide-2",heading:_("Point to what you’re talking about"),subheading:_("Just click anywhere inside the doc, or drag around a specific area."),image:c[1]}),d({className:"comment-slide-3",heading:_("Never lose track of feedback"),subheading:_("Conversations stay with the file, and you can view on any device."),image:c[2]})]:[d({className:"comment-slide-1",heading:_("Comment on your files"),subheading:_("Give clear, focused feedback that’s faster than email."),image:c[0]}),d({className:"comment-slide-2",heading:_("Never lose track of feedback"),subheading:_("Conversations stay with the file, and you can view on any device."),image:c[2]})]},render:function(){return u.apply(null,[{className:"comment-onboarding-modal",slideWidth:600,onClose:this.props.onClose}].concat(e.call(this.getSlides())))}})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/react/file_comments/shared_link_signup_modals",["jquery","modules/clean/ajax","modules/clean/dbmodal","modules/clean/react/file_comments/logger","modules/constants/legacy","modules/core/browser","modules/core/i18n","modules/core/notify"],function(t,n,i,o,r,s,a,l){var u,c,d;return c=i.DBModal,d=a._,u=function(){function t(){this._toggle_form=e(this._toggle_form,this),this._prepare_form=e(this._prepare_form,this),this._reload=e(this._reload,this),this.before_modal=e(this.before_modal,this),this.show_sign_in_modal=e(this.show_sign_in_modal,this),this.show_sign_up_modal=e(this.show_sign_up_modal,this),this.hide_modal=e(this.hide_modal,this),this.init_modals=e(this.init_modals,this),this.show_register=!1,this.init_modals()}return t.POST_COMMENT_VARIANT="post_comment_variant",t.LIKE_COMMENT_VARIANT="like_comment_variant",t.SUBSCRIBE_VARIANT="subscribe_variant",t.prototype.init_modals=function(){return this.default_signup_modal=new c({element_id:"shared-link-default-comments-signup-modal"}),this.default_signup_modal.before_show=this.before_modal},t.prototype.hide_modal=function(){return this.default_signup_modal.hide()},t.prototype.show_sign_up_modal=function(e){return this.show_register=!0,this.variant=e,this.default_signup_modal.show()},t.prototype.show_sign_in_modal=function(e){return this.show_register=!1,this.variant=e,this.default_signup_modal.show()},t.prototype.set_activity_key=function(e){return this.activity_key=e},t.prototype.before_modal=function(e){var t,n;return this._prepare_form(e),e.find(".toggle-form-link").click(function(t){return function(){return t._toggle_form(e)}}(this)),n=e.find(".register-form"),n.length&&n.on("db:register:success",function(e){return function(t,n){return e.user=n,l.success(d("Successfully signed up for Dropbox")),o.log_event(r.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_UP_SUCCESS,e.activity_key,null,null,e.user.id),e._reload()}}(this)),t=e.find(".login-form"),t.length?(n.length&&n.on("db:register:user_exists",function(n){return function(i){var o,r,s,a,l;for(n._toggle_form(e),a=i.prefill,l=o=0,s=a.length;s>o;l=++o)r=a[l],t.find(r).val(l);return t.find(i.focus).focus()}}(this)),t.on("db:login:success",function(e){return function(t,n){return e.user=n,l.success(d("Successfully signed in to Dropbox")),o.log_event(r.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_IN_SUCCESS,e.activity_key,null,null,e.user.id),e._reload()}}(this))):void 0},t.prototype._reload=function(){return s.reload()},t.prototype._prepare_form=function(e){switch(e.find(".form-component").hide(),e.find(".text-variant").hide(),this.show_register?e.find(".register-form-component").show():e.find(".login-form-component").show(),this.variant){case t.POST_COMMENT_VARIANT:return e.find(".text-variant.post-comment-variant").show();case t.LIKE_COMMENT_VARIANT:return e.find(".text-variant.like-comment-variant").show();case t.SUBSCRIBE_VARIANT:return e.find(".text-variant.subscribe-variant").show();default:return e.find(".text-variant.default-variant").show()}},t.prototype._toggle_form=function(e){var t,n,i;return i=e.find(".register-form-component"),n=e.find(".login-form-component"),i.is(":visible")?(t=r.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_IN_MODAL,i.fadeOut({complete:function(){return n.show()}})):(t=r.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_UP_MODAL,n.fadeOut({complete:function(){return i.show()}})),o.log_event(t,this.activity_key,null,r.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.MODAL_TOGGLE_BUTTON)},t}()})}.call(this),function(){define("modules/clean/react/file_viewer/account_menu/account_info",["external/react","modules/clean/react/file_viewer/account_menu/avatar"],function(e,t){var n,i,o;return i=e.createFactory(t),o=e.DOM.div,n=e.createClass({displayName:"AccountInfo",propTypes:{accountPhotoUrl:e.PropTypes.string,userDisplayName:e.PropTypes.string.isRequired,isAccountPhotoEnabled:e.PropTypes.bool.isRequired},render:function(){return o({className:"account-info"},o({className:"o-flag"},o({className:"o-flag__fix"},i({isEnabled:this.props.isAccountPhotoEnabled,photoUrl:this.props.accountPhotoUrl})),o({className:"o-flag__flex"},o({className:"account-info-name"},this.props.userDisplayName))))}})})}.call(this),function(){define("modules/clean/react/file_viewer/account_menu/account_menu",["external/react","external/underscore","modules/clean/em_string","modules/clean/react/bubble_dropdown","modules/clean/react/file_viewer/account_menu/avatar","modules/clean/react/file_viewer/account_menu/account_menu_contents","modules/clean/react/sprite"],function(e,t,n,i,o,r,s){var a,l,u,c,d,p,_,h;return u=e.createFactory(o),l=e.createFactory(r),c=e.createFactory(i),_=e.DOM,p=_.button,h=_.span,d=18,a=e.createClass({displayName:"AccountMenu",propTypes:{accountPhotoUrl:e.PropTypes.string,isAccountPhotoEnabled:e.PropTypes.bool,logoutContinuationPath:e.PropTypes.string,openLinksInNewTab:e.PropTypes.bool,showBusinessUpgradeLink:e.PropTypes.bool,showInstallLink:e.PropTypes.bool,showProGiftingLink:e.PropTypes.bool,showProUpgradeLink:e.PropTypes.bool,showSettingsLink:e.PropTypes.bool,user:e.PropTypes.object.isRequired},getDefaultProps:function(){return{accountPhotoUrl:null,isAccountPhotoEnabled:!0}},_getTargetButtonText:function(){var e,t;return t=this.props.user,e=t.display_name.length<=d?t.display_name:t.familiar_name,n.em_snippet(e,d)},render:function(){var e;return e=p({className:"button-as-link account-menu-target"},u({isEnabled:this.props.isAccountPhotoEnabled,photoUrl:this.props.accountPhotoUrl}),h({className:"account-menu__name u-mar-left-xs"},this._getTargetButtonText()),s({group:"web",name:"control_menu",className:"u-mar-left-xxs"})),c({targetButton:e,arrow_position:"top",extra_css_class:"account-menu"},l(t.extend({},this.props)))}})})}.call(this),function(){define("modules/clean/react/file_viewer/account_menu/account_menu_contents",["external/react","modules/clean/react/file_viewer/account_menu/business_upgrade_link","modules/clean/react/file_viewer/account_menu/avatar","modules/clean/react/file_viewer/account_menu/account_info","modules/clean/react/file_viewer/account_menu/install_link","modules/clean/react/file_viewer/account_menu/logout_link","modules/clean/react/file_viewer/account_menu/pro_gifting_link","modules/clean/react/file_viewer/account_menu/pro_upgrade_link","modules/clean/react/file_viewer/account_menu/settings_link","modules/clean/react/sprite"],function(e,t,n,i,o,r,s,a,l,u){var c,d,p,_,h,m,f,v,g,y,b,w,E;return p=e.createFactory(n),c=e.createFactory(i),_=e.createFactory(t),h=e.createFactory(o),m=e.createFactory(r),f=e.createFactory(s),v=e.createFactory(a),g=e.createFactory(l),w=e.DOM,y=w.div,b=w.li,E=w.ul,d=e.createClass({displayName:"AccountMenuContents",propTypes:{accountPhotoUrl:e.PropTypes.string,isAccountPhotoEnabled:e.PropTypes.bool,logoutContinuationPath:e.PropTypes.string,openLinksInNewTab:e.PropTypes.bool,showBusinessUpgradeLink:e.PropTypes.bool,showInstallLink:e.PropTypes.bool,showProGiftingLink:e.PropTypes.bool,showProUpgradeLink:e.PropTypes.bool,showSettingsLink:e.PropTypes.bool,user:e.PropTypes.object.isRequired},getDefaultProps:function(){return{accountPhotoUrl:null,isAccountPhotoEnabled:!0,logoutContinuationPath:null,openLinksInNewTab:!1,showBusinessUpgradeLink:!1,showInstallLink:!0,showProGiftingLink:!1,showProUpgradeLink:!1,showSettingsLink:!0}},_renderInstallLink:function(){return b({className:"link-item"},h({openLinksInNewTab:this.props.openLinksInNewTab}))},_renderLogoutLink:function(){return b({className:"link-item"},m({continuationPath:this.props.logoutContinuationPath}))},_renderBusinessUpgradeLink:function(){return b({className:"link-item"},_({openLinksInNewTab:this.props.openLinksInNewTab}))},_renderProUpgradeLink:function(){return b({className:"link-item"},v({openLinksInNewTab:this.props.openLinksInNewTab}))},_renderProGiftingLink:function(){return b({className:"link-item"},s())},_renderSettingsLink:function(){return b({className:"link-item"},g({openLinksInNewTab:this.props.openLinksInNewTab}))},render:function(){return y({className:"dropdown-content-wrapper"},c({userDisplayName:this.props.user.display_name,isAccountPhotoEnabled:this.props.isAccountPhotoEnabled,accountPhotoUrl:this.props.accountPhotoUrl}),E({className:"links"},this.props.showSettingsLink?this._renderSettingsLink():void 0,this.props.showInstallLink?this._renderInstallLink():void 0,this.props.showBusinessUpgradeLink?this._renderBusinessUpgradeLink():void 0,this.props.showProUpgradeLink?this._renderProUpgradeLink():void 0,this.props.showProGiftingLink?this._renderProGiftingLink():void 0,this._renderLogoutLink()))}})})}.call(this),function(){define("modules/clean/react/file_viewer/account_menu/avatar",["external/react","modules/clean/avatar/faceholder","modules/clean/avatar/viewer_avatar"],function(e,t,n){var i,o,r;return o=e.createFactory(t),r=e.createFactory(n),i=e.createClass({displayName:"Avatar",propTypes:{isEnabled:e.PropTypes.bool,photoUrl:e.PropTypes.string},getDefaultProps:function(){return{isEnabled:!0}},render:function(){return this.props.isEnabled?r({defaultAvatar:o({dimension:24}),dimension:24,photoUrl:this.props.photoUrl}):null}})})}.call(this),function(){define("modules/clean/react/file_viewer/account_menu/business_upgrade_link",["external/react","modules/constants/env","modules/core/i18n","modules/core/uri"],function(e,t,n,i){var o,r,s;return r=n._,s=e.DOM.a,o=e.createClass({displayName:"BusinessUpgradeLink",propTypes:{openLinksInNewTab:e.PropTypes.bool},getDefaultProps:function(){return{openLinksInNewTab:!1}},_getUpgradeUrl:function(){return new i({scheme:"https",authority:t.WEBSERVER,path:"/business"})},render:function(){return s({href:this._getUpgradeUrl(),className:"link",target:this.props.openLinksInNewTab?"_blank":""},r("Try Dropbox for business"))}})})}.call(this),function(){define("modules/clean/react/file_viewer/account_menu/install_link",["external/react","modules/constants/env","modules/core/i18n","modules/core/uri"],function(e,t,n,i){var o,r,s;return r=n._,s=e.DOM.a,o=e.createClass({displayName:"InstallLink",propTypes:{openLinksInNewTab:e.PropTypes.bool},getDefaultProps:function(){return{openLinksInNewTab:!1}},_getInstallUrl:function(){return new i({scheme:"https",authority:t.WEBSERVER,path:"/install"})},render:function(){return s({href:this._getInstallUrl(),className:"link",target:this.props.openLinksInNewTab?"_blank":""},r("Install"))}})})}.call(this),function(){define("modules/clean/react/file_viewer/account_menu/logout_link",["external/react","modules/constants/env","modules/core/i18n","modules/core/uri"],function(e,t,n,i){var o,r,s;return r=n._,s=e.DOM.a,o=e.createClass({displayName:"LogoutLink",propTypes:{continuationPath:e.PropTypes.string},_getLogoutUrl:function(){var e;return e=new i({scheme:"https",authority:t.WEBSERVER,path:"/logout",query:{cont:this.props.continuationPath}})},render:function(){return s({href:this._getLogoutUrl(),className:"link"},r("Sign out"))}})})}.call(this),function(){define("modules/clean/react/file_viewer/account_menu/pro_gifting_link",["external/react","modules/constants/env","modules/core/i18n","modules/core/uri"],function(e,t,n,i){var o,r,s;return r=n._,s=e.DOM.a,o=e.createClass({displayName:"ProGiftingLink",_getGiftingUrl:function(){return new i({scheme:"https",authority:t.WEBSERVER,path:"/gift",query:{trigger:"dropdown"}})},render:function(){return s({href:this._getGiftingUrl(),className:"link"},r("Gift Dropbox Pro"))}})})}.call(this),function(){define("modules/clean/react/file_viewer/account_menu/pro_upgrade_link",["external/react","modules/constants/env","modules/core/i18n","modules/core/uri"],function(e,t,n,i){var o,r,s;return r=n._,s=e.DOM.a,o=e.createClass({displayName:"ProUpgradeLink",propTypes:{openLinksInNewTab:e.PropTypes.bool},getDefaultProps:function(){return{openLinksInNewTab:!1}},_getUpgradeUrl:function(){return new i({scheme:"https",authority:t.WEBSERVER,path:"/pro/buy",query:{trigger:"direct"}})},render:function(){return s({href:this._getUpgradeUrl(),className:"link",target:this.props.openLinksInNewTab?"_blank":""},r("Upgrade your Dropbox"))}})})}.call(this),function(){define("modules/clean/react/file_viewer/account_menu/settings_link",["external/react","modules/constants/env","modules/core/i18n","modules/core/uri"],function(e,t,n,i){var o,r,s;return r=n._,s=e.DOM.a,o=e.createClass({displayName:"SettingsLink",propTypes:{openLinksInNewTab:e.PropTypes.bool},getDefaultProps:function(){return{openLinksInNewTab:!1}},_getSettingsUrl:function(){return new i({scheme:"https",authority:t.WEBSERVER,path:"/account"})},render:function(){return s({href:this._getSettingsUrl(),className:"link",target:this.props.openLinksInNewTab?"_blank":""},r("Settings"))}})})}.call(this),function(){define("modules/clean/react/file_viewer/actions",["modules/clean/previews/util","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/dispatcher","modules/clean/react/file_viewer/store","modules/clean/analytics"],function(e,t,n,i,o){var r,s,a,l;return l=e.PreviewHelper,r=t.ActionTypes,a=o.PreviewActivityLogger,new(s=function(){function e(){}return e.prototype.setup=function(e,t,i,o){var s,a,l,u,c;return l=null!=o?o:{},c=l.shareToken,u=l.sharePermissions,a=l.disableFlipping,s=l.areCommentsOpen,n.dispatch({type:r.SETUP,data:{files:e,currentIndex:t,user:i,shareToken:c,sharePermissions:u,disableFlipping:a,areCommentsOpen:s}})},e.prototype.cleanup=function(){return n.dispatch({type:r.CLEANUP})},e.prototype.updateFiles=function(e){return n.dispatch({type:r.UPDATE_FILES,data:{files:e}})},e.prototype.replaceFile=function(e){return n.dispatch({type:r.REPLACE_FILE,data:{file:e}})},e.prototype.flipNext=function(){return n.dispatch({type:r.FLIP_NEXT})},e.prototype.flipPrevious=function(){return n.dispatch({type:r.FLIP_PREVIOUS})},e.prototype.openFullscreen=function(){var e;return e={file_ext:l.get_extension(i.currentFile())},this.openFullscreenLogging(e),n.dispatch({type:r.OPEN_FULLSCREEN})},e.prototype.openFullscreenLogging=function(e){return a.log("enter-fullscreen",e)},e.prototype.closeFullscreen=function(){var e;return e={file_ext:l.get_extension(i.currentFile())},this.closeFullscreenLogging(e),n.dispatch({type:r.CLOSE_FULLSCREEN})},e.prototype.closeFullscreenLogging=function(e){return a.log("exit-fullscreen",e)},e.prototype.openComments=function(){return n.dispatch({type:r.OPEN_COMMENTS})},e.prototype.closeComments=function(){return n.dispatch({type:r.CLOSE_COMMENTS})},e.prototype.switchRevision=function(e){return n.dispatch({type:r.SWITCH_REVISION,data:{file:e}})},e.prototype.restoreRevision=function(){return n.dispatch({type:r.RESTORE_REVISION})},e}())})}.call(this),function(){define("modules/clean/react/file_viewer/coach_mark",["external/react","modules/clean/css","modules/clean/react/flag","modules/clean/react/image"],function(e,t,n,i){var o,r,s,a,l,u,c;return c=e.DOM,s=c.button,a=c.div,l=c.h4,u=c.p,r=e.createFactory(n),o=e.createClass({displayName:"CoachMark",propTypes:{title:e.PropTypes.string.isRequired,imageUrl:e.PropTypes.string.isRequired,imageUrl2x:e.PropTypes.string.isRequired,imageAlt:e.PropTypes.string.isRequired,buttonText:e.PropTypes.string.isRequired,onButtonClick:e.PropTypes.func.isRequired,onShown:e.PropTypes.func},componentWillMount:function(){return t.require_css("/static/css/components/bubble_dropdown-vflBim83A.css"),t.require_css("/static/css/components/coach_mark-vfl5FeU94.css")},componentDidMount:function(){var e;return"function"==typeof(e=this.props).onShown?e.onShown():void 0},_renderCoachMarkImage:function(){return i({className:"c-coach-mark__img u-pad-right-xs",src:this.props.imageUrl,srcHiRes:this.props.imageUrl2x,alt:this.props.imageAlt})},_renderCoachMarkMessage:function(){return a({className:"coach-mark_message"},l({},this.props.title),u({refs:"coachmarkBody"},this.props.children),s({className:"button-primary button-small",onMouseUp:this.props.onButtonClick,ref:"coachmarkButton"},this.props.buttonText))},render:function(){return a({className:"c-coach-mark bubble-dropdown top-right",ref:"coachmark"},r({leftAttachment:this._renderCoachMarkImage()},this._renderCoachMarkMessage()),a({className:"bubble-arrow-border"}),a({className:"bubble-arrow"}))}})})}.call(this),function(){define("modules/clean/react/file_viewer/comment_menu_item_group",["external/react","external/reflux","modules/clean/comments/store","modules/clean/react/bubble_menu","modules/clean/react/file_action_button","modules/clean/comments/action_creators"],function(e,t,n,i,o,r){var s,a,l,u,c,d,p,_,h;return a=i.BubbleMenuItemGroup,s=i.BubbleMenuItem,c=o.FileActionButtonType,u=o.FileActionButton,d=e.createElement,h=e.DOM,_=h.li,p=h.hr,a=e.createFactory(a),l=e.createClass({displayName:"CommentsMenuItemGroup",props:{closeFunc:e.PropTypes.func,file:e.PropTypes.object,user:e.PropTypes.object,areCommentsOpen:e.PropTypes.bool},mixins:[t.listenTo(n,"_onStoreChange")],getInitialState:function(){return this._getStoreState()},_onStoreChange:function(){return this.setState(this._getStoreState())},_getStoreState:function(){return{isFileActivityReady:n.isFileActivityReady(),isCommentingEnabled:n.isCommentingEnabled(),isUserSubscribed:n.isUserSubscribed(this.props.user.id),showResolvedComments:n.state.showResolvedComments}},componentDidMount:function(){return this._unsubscribe=n.listen(this._onStoreChange)},componentWillUnmount:function(){return this._unsubscribe()},_handleEnableCommentsToggleClick:function(){return r.setCommentsEnabled({enabled:!this.state.isCommentingEnabled})},_handleShowResolvedCommentsToggleClick:function(){return this.state.showResolvedComments?r.hideResolvedComments():r.showResolvedComments()},_handleSubscribeToggleClick:function(){return r.setCommentSubscribed({subscribed:!this.state.isUserSubscribed})},_getMenuItems:function(){var e,t;return e=[],this.state.isFileActivityReady?(e.push(d(p,{role:"separator",className:"c-rule u-mar-bottom-xs"})),t=this.state.isCommentingEnabled?c.DISABLE_COMMENTS:c.ENABLE_COMMENTS,e.push(d(u,{type:t,callback:this._handleEnableCommentsToggleClick})),this.props.areCommentsOpen&&this.state.isCommentingEnabled&&(t=this.state.showResolvedComments?c.HIDE_RESOLVED_COMMENTS:c.SHOW_RESOLVED_COMMENTS,e.push(d(u,{type:t,callback:this._handleShowResolvedCommentsToggleClick}))),this.state.isCommentingEnabled&&(t=this.state.isUserSubscribed?c.UNSUBSCRIBE:c.SUBSCRIBE,e.push(d(u,{type:t,callback:this._handleSubscribeToggleClick}))),e):e},render:function(){var e;return e=this._getMenuItems(),a({items:e,closeFunc:this.props.closeFunc})}})})}.call(this),function(){define("modules/clean/react/file_viewer/constants",[],function(){var e;return e={},e.ActionTypes={SETUP:"SETUP",CLEANUP:"CLEANUP",UPDATE_FILES:"UPDATE_FILES",REPLACE_FILE:"REPLACE_FILE",FLIP_NEXT:"FLIP_NEXT",FLIP_PREVIOUS:"FLIP_PREVIOUS",OPEN_FULLSCREEN:"OPEN_FULLSCREEN",CLOSE_FULLSCREEN:"CLOSE_FULLSCREEN",OPEN_COMMENTS:"OPEN_COMMENTS",CLOSE_COMMENTS:"CLOSE_COMMENTS",SWITCH_REVISION:"SWITCH_REVISION",RESTORE_REVISION:"RESTORE_REVISION"},e.EventTypes={FILE_VIEWER_OPENED:"FILE_VIEWER_OPENED",FILE_VIEWER_CLOSED:"FILE_VIEWER_CLOSED",FILE_PREVIEW_ATTEMPT_STARTED:"FILE_PREVIEW_ATTEMPT_STARTED",FILE_PREVIEW_SUPPORT_CONFIRMED:"FILE_PREVIEW_SUPPORT_CONFIRMED",FILE_PREVIEW_SUPPORT_DENIED:"FILE_PREVIEW_SUPPORT_DENIED",FILE_PREVIEW_DOWNLOAD_SUCCEEDED:"FILE_PREVIEW_DOWNLOAD_SUCCEEDED",FILE_PREVIEW_DOWNLOAD_FAILED:"FILE_PREVIEW_DOWNLOAD_FAILED",FILE_PREVIEW_RENDER_SUCCEEDED:"FILE_PREVIEW_RENDER_SUCCEEDED",FILE_PREVIEW_RENDER_FAILED:"FILE_PREVIEW_RENDER_FAILED",FILE_PREVIEW_SEEN_STATE_SHOWN:"FILE_PREVIEW_SEEN_STATE_SHOWN",FILE_PREVIEW_PASS_SHOWN:"FILE_PREVIEW_PASS_SHOWN",FILE_PREVIEW_PASS_HOVER:"FILE_PREVIEW_PASS_HOVER",FILE_PREVIEW_PASS_CLICK:"FILE_PREVIEW_PASS_CLICK"},e})}.call(this),function(){define("modules/clean/react/file_viewer/copyright_flag",["external/react","modules/clean/components/title_bubble","modules/constants/env","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,n,i,o,r){var s,a,l,u,c,d;return l=o._,a=e.createFactory(t),d=e.DOM,u=d.a,c=d.div,s=e.createClass({displayName:"CopyrightFlag",getCopyrightHref:function(){return new r({scheme:"https",authority:n.WEBSERVER,path:"/copyright_complaint",query:{ssu:i.get_href()}})},render:function(){return c({className:"react-copyright-complaint-flag"},a({text:l("Flag for copyright"),direction:"east"},u({href:this.getCopyrightHref(),className:"flag-link",title:l("Flag for copyright"),rel:"nofollow"})))}})})}.call(this),function(){define("modules/clean/react/file_viewer/dispatcher",["modules/clean/flux/dispatcher"],function(e){return e})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_viewer/file_preview",["external/react","modules/constants/legacy","modules/clean/frame_messenger","modules/clean/loggers/file_viewer_logger","modules/clean/previews/util","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/previews/audio/preview_audio","modules/clean/react/previews/preview_blank","modules/clean/react/previews/preview_html","modules/clean/react/previews/preview_image","modules/clean/react/previews/preview_image_with_annotations","modules/clean/react/previews/preview_image_zoom","modules/clean/react/previews/preview_linkfile","modules/clean/react/previews/preview_pdf","modules/clean/react/previews/preview_password_protected","modules/clean/react/previews/preview_video","modules/core/exception","modules/core/uri"],function(t,n,i,o,r,s,a,l,u,c,d,p,_,h,m,f,v,g,y,b){var w,E,T,C,S,k,I,A,P,N,R,O,D,x,L,M,F;return S=r.PermissionHelper,P=r.PreviewHelper,w=s.EventTypes,E=l.FilePreviewSession,T=l.FileViewerSession,C=".react-file-viewer__preview iframe",k=t.createFactory(u),I=t.createFactory(c),A=t.createFactory(d),N=t.createFactory(p.PreviewImage),R=t.createFactory(_.PreviewImageWithAnnotations),O=t.createFactory(h.PreviewImageZoom),D=t.createFactory(m.PreviewLinkfile),x=t.createFactory(f),L=t.createFactory(v),M=t.createFactory(g.PreviewVideo),F=t.createClass({displayName:"FilePreview",propTypes:{file:t.PropTypes.shape({preview_type:t.PropTypes.string.isRequired}).isRequired,user:t.PropTypes.object,isFullscreen:t.PropTypes.bool,onCloseViewer:t.PropTypes.func,fileViewTarget:t.PropTypes.number.isRequired,fileViewOrigin:t.PropTypes.number.isRequired,fileViewAction:t.PropTypes.number.isRequired,sharedLinkUrl:t.PropTypes.string,maxFilenameEmLength:t.PropTypes.number.isRequired,areImagePreviewAnnotationsVisible:t.PropTypes.bool,shouldDisplayAnnotationsToolbar:t.PropTypes.bool,index:t.PropTypes.number,count:t.PropTypes.number,onPrevious:t.PropTypes.func,onNext:t.PropTypes.func},getDefaultProps:function(){return{user:null,isFullscreen:!1}},getInitialState:function(){return{hasLoadError:!1}},componentWillReceiveProps:function(e){return e.file.fq_path!==this.props.file.fq_path?(this.setState({hasLoadError:!1}),this._viewAttempts=0,this._logPreviewAttempted(e.file)):void 0},componentWillMount:function(){return this._logPreviewAttempted(this.props.file)},componentDidMount:function(){return this._startLogger(),this._viewAttempts=0,this._logView(this.state.hasLoadError)},componentDidUpdate:function(e,t){return e.file!==this.props.file||t.hasLoadError!==this.state.hasLoadError?this._logView(this.state.hasLoadError):void 0},componentWillUnmount:function(){return this._stopLogger()},_startLogger:function(){return this._frameMessenger=new i,this._frameMessenger.configureChildMessaging(C,this._onFrameMessage,["pagerendered"]),this._frameMessenger.startListening()},_stopLogger:function(){return this._frameMessenger.stopListening()},_onFrameMessage:function(e){switch(e.action){case"pagerendered":return o.logPageRendered(this.props.file,e.parameters)}},_logView:function(e){return null==e&&(e=!1),this._viewAttempts++,o.logView(this.props.file,this.props.user,this.props.fileViewTarget,this.props.fileViewOrigin,this.props.fileViewAction,this.props.sharedLinkUrl,this._viewAttempts,e)},_logPreviewAttempted:function(e){return E.currentSession=new E({fileViewerSession:T.currentSession,file:e}),a.emit(w.FILE_PREVIEW_ATTEMPT_STARTED,E.currentSession)},_renderImagePreview:function(){var e,t,n,i;return e=this.props.file,t=P.get_extension(e),i=e.preview_url||e.thumbnail_url_tmpl,this.props.isFullscreen?O({thumbnailUrlTmpl:i,fileExtension:t,isFlippable:!0}):(n={"thumbnail-url-tmpl":e.thumbnail_url_tmpl,"file-extension":P.get_extension(e),"file-meta":{filename:P.get_filename(e),mtime:e.ts,formattedSize:e.size},"preview-url":i,isFullscreen:this.props.isFullscreen,"should-display-annotations-toolbar":this.props.shouldDisplayAnnotationsToolbar,index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onNext:this.props.onNext,"log-time-to-interactive":!0},this.props.areImagePreviewAnnotationsVisible?R(n):N(n))},_renderVideoPreview:function(){var e;return e=this.props.file,M({"preview-url":e.video_transcode_url,"thumbnail-url-tmpl":e.thumbnail_url_tmpl,isFullscreen:this.props.isFullscreen,shouldDisplayAnnotationsToolbar:this.props.shouldDisplayAnnotationsToolbar,
index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onNext:this.props.onNext,"log-time-to-interactive":!0})},_renderLinkfilePreview:function(){var e;return e=this.props.file,P.isPreviewable(e)?D({filename:P.get_filename(e),"linkfile-data-link":e.linkfile_link,"authenticated-data-link":!0,source:"browse","log-time-to-interactive":!0}):this._renderBlankPreview()},_renderPDFPreview:function(){var e,t,n,i;return e=this.props.file,t=P.get_extension(e),n=null!=e.direct_blockserver_link?e.direct_blockserver_link:e.href,P.isPreviewable(e)?x({fileExtension:t,fqPath:e.fq_path,isFullscreen:this.props.isFullscreen,onCloseViewer:this.props.onCloseViewer,onError:this._onLoadError,previewStatus:e.doc_preview_status,previewType:e.preview_type,src:n,userId:null!=(i=this.props.user)?i.id:void 0,forceServeFromDLDoc:S.force_serve_from_dldoc(),isSharedLink:null!=this.props.sharedLinkUrl}):this._renderBlankPreview()},_renderHTMLPreview:function(){var e,t,i,o,r,s;if(e=this.props.file,t=P.get_extension(e),"excel"===e.preview_type){if(i=null!=e.direct_blockserver_link?e.direct_blockserver_link:e.href,o=P.normalize_extension(t),r=P.get_progressive_url(o,i),S.is_password_protected_preview_enabled()&&e.doc_preview_status===n.DOC_PREVIEW_UNAVAILABLE_PROTECTED_DOC)return this._renderPasswordProtectedPreview(r,t)}else{if("keynote"===e.preview_type)return this._renderBlankPreview();r=null!=e.htmlified_link?e.htmlified_link:e.href}return s=P.usesFrameMessenger(e.preview_type),P.isPreviewable(e)?A({src:r,previewType:e.preview_type,isFullscreen:this.props.isFullscreen,onError:this._onLoadError,fileExtension:t,fileDocPreviewStatus:e.doc_preview_status,filePreviewType:e.preview_type,usesFrameMessenger:s}):this._renderBlankPreview()},_renderAudioPreview:function(){var e;return e=this.props.file,k({src:e.direct_blockserver_link,onError:this._onLoadError,"log-time-to-interactive":!0})},_renderBlankPreview:function(){var e;return e=this.props.file,I({filename:P.get_filename(e),maxFilenameEmLength:this.props.maxFilenameEmLength,icon:e.icon,size:e.size,created:new Date(1e3*e.ts),isFallbackForLoadError:this.state.hasLoadError})},_renderPasswordProtectedPreview:function(e,t){var n;return n=this.props.file,L({filename:P.get_filename(n),fileExtension:t,icon:n.icon,size:n.size,created:new Date(1e3*n.ts),fileUrl:e,previewType:n.preview_type})},_onLoadError:function(){return this.setState({hasLoadError:!0})},_choosePreview:function(){var t,n;if(n=this.props.file.preview_type,e.call(P.VALID_PREVIEW_TYPES,n)<0)return this._renderBlankPreview();switch(t=P.get_extension(this.props.file),this.props.file.preview_type){case"photo":return this._renderImagePreview();case"video":return this._renderVideoPreview();case"linkfile":return this._renderLinkfilePreview();case"adobecs":case"doc":return"indd"!==t||S.is_indesign_preview_enabled()?this._renderPDFPreview():this._renderBlankPreview();case"excel":return S.use_excel2_for_extension(t)?this._renderPDFPreview():this._renderHTMLPreview();case"html":case"keynote":case"text":return this._renderHTMLPreview();case"audio":return this._renderAudioPreview();default:return y.assert(!1,"Preview type "+this.props.file.preview_type+" in VALID_PREVIEW_TYPES but not implemented")}},render:function(){return this.state.hasLoadError?this._renderBlankPreview():this._choosePreview()}})})}.call(this),function(){define("modules/clean/react/file_viewer/file_preview_event_emitter",["modules/clean/event_emitter"],function(e){return new e})}.call(this),function(){define("modules/clean/react/file_viewer/file_preview_update_watcher",["modules/clean/notifications/file_watcher","modules/clean/notifications/updated_file_notification","modules/core/visibility"],function(e,t,n){var i;return i=function(){function i(e,t,n){this.file=e,this.user=t,this.refresh=n,this._watchFile()}return i.prototype.stop=function(){return this._hideUpdatedFileNotification(),this._unwatchFile()},i.prototype._watchFile=function(){return this._subscription=e.subscribe(this.file,this.user,this._onFileUpdate.bind(this))},i.prototype._unwatchFile=function(){var e;return null!=(e=this._subscription)&&e.cancel(),delete this._subscription},i.prototype._showUpdatedFileNotification=function(){return this._subscription?(this._hideUpdatedFileNotification(),this._notification=new t(this._onRefresh.bind(this))):void 0},i.prototype._hideUpdatedFileNotification=function(){var e;return null!=(e=this._notification)&&e.hide(),delete this._notification},i.prototype._onFileUpdate=function(){return n.when().then(this._showUpdatedFileNotification.bind(this))},i.prototype._onRefresh=function(){return this._subscription?(this._hideUpdatedFileNotification(),this.refresh(this._subscription.file)):void 0},i}()})}.call(this),function(){define("modules/clean/react/file_viewer/file_viewer",["external/keymaster","external/react","external/underscore","modules/clean/activity/activity","modules/clean/css","modules/clean/file_events","modules/clean/gandalf_util","modules/clean/history","modules/clean/image_preview_util","modules/clean/loggers/file_preview_logger","modules/clean/loggers/file_viewer_logger","modules/clean/previews/util","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/file_preview_update_watcher","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/store","modules/clean/react/file_viewer/title_bar","modules/clean/react/file_viewer/utils","modules/clean/react/pass/actions","modules/clean/react/pass/utils","modules/clean/react/previews/image_helpers","modules/clean/react/previews/preview_quality_popup","modules/constants/comments_panel","modules/constants/file_viewer","modules/constants/python","modules/core/dom","modules/core/notify","modules/core/uri","modules/core/visibility"],function(e,t,n,i,o,r,s,a,l,u,c,d,p,_,h,m,f,v,g,y,b,w,E,T,C,S,k,I,A,P,N,R,O){var D,x,L,M,F,U,B,q,W,V,H,j,G,z,K,$,Y,Z,Q;return D=i.ActivityContext,M=u.FilePreviewTimelineLogger,j=d.PreviewHelper,x=_.EventTypes,L=g.FilePreviewSession,F=g.FileViewerSession,B=w.FlippableHelpers,H=T.PresenceHelpers,$=T.SeenStateHelpers,G=S.PreviewQualityPopup,Z=t.DOM.div,U=t.createFactory(v),z=t.createFactory(h),Y=t.createFactory(b),q="fileviewer",V="",W=35,Q="",K=t.createClass({displayName:"FileViewer",propTypes:{fileViewTarget:t.PropTypes.number.isRequired,fileViewOrigin:t.PropTypes.number.isRequired,fileViewAction:t.PropTypes.number.isRequired,disableRouting:t.PropTypes.bool,onCloseViewer:t.PropTypes.func,onComponentDidMount:t.PropTypes.func,onComponentWillUnmount:t.PropTypes.func,shareHelpers:t.PropTypes.object,activityContext:t.PropTypes.number.isRequired,hideComments:t.PropTypes.bool,oref:t.PropTypes.string,shouldFocusCommentInput:t.PropTypes.bool,hidePageChrome:t.PropTypes.bool,sharedLinkInfo:t.PropTypes.shape({url:t.PropTypes.string.isRequired,ownerName:t.PropTypes.string,ownerTeamName:t.PropTypes.string})},getDefaultProps:function(){return{onCloseViewer:null,onComponentDidMount:null,onComponentWillUnmount:null,forceFileUnlocked:!1,shouldFocusCommentInput:!1,hideComments:!1,disableRouting:!1,oref:A.OREF_CONSTANTS.BROWSE_UNKNOWN,hidePageChrome:!1}},getInitialState:function(){var e;return e=this._getStateFromStore(),e.commentsLoaded=!1,e},componentWillMount:function(){return this._setUpLogging()},componentDidMount:function(){var e,t;return"function"==typeof(e=this.props).onComponentDidMount&&e.onComponentDidMount(),this.props.hidePageChrome||require(["modules/clean/comments/components/file_comments_pane_container"],function(e){return function(){return e.isMounted()?e.setState({commentsLoaded:!0}):void 0}}(this)),this._flipNext=n.throttle(this._flipNext,100),this._flipPrevious=n.throttle(this._flipPrevious,100),this._removeStoreListener=y.addListener(this._onUpdateFromStore),this._watchFile(this.state.currentFile),this._setPreviewUrl(this.state.currentFile),this._setupKeymaster(),this._preloadImages(this.state.files,this.state.currentIndex),this._setDocumentTitle(j.get_filename(this.state.currentFile),!0),P.scroll_lock_document(),this._setupSeenState(this.state.currentFile,this.state.user,null!=(t=this.props.sharedLinkInfo)?t.url:void 0),this._setupPresence(this.state.currentFile,this.state.user),this._focusInViewer(),c.start()},componentWillUpdate:function(e,t){var n,i;return n=t.currentFile,this._watchFile(n),this._setPreviewUrl(n,!1),this._setDocumentTitle(j.get_filename(n)),this._preloadImages(t.files,t.currentIndex),key.setScope(q),n.ns_id!==this.state.currentFile.ns_id||n.sjid!==this.state.currentFile.sjid?(this._setupSeenState(n,t.user,null!=(i=e.sharedLinkInfo)?i.url:void 0),this._setupPresence(n,t.user)):void 0},componentWillUnmount:function(){var e;return this._removeStoreListener(),this._teardownLogging(),this._unwatchFile(),this._unsetPreviewUrl(),this._cleanupKeymaster(),this._unsetDocumentTitle(),P.scroll_unlock_document(),this._canShowPresence()&&this._shutdownPresence(),"function"==typeof(e=this.props).onComponentWillUnmount?e.onComponentWillUnmount():void 0},_getStateFromStore:function(){return{files:y.files(),currentIndex:y.currentIndex(),currentFile:y.currentFile(),user:y.user(),shareToken:y.shareToken(),sharePermissions:y.sharePermissions(),isFullscreen:y.isFullscreen(),areCommentsOpen:y.areCommentsOpen()}},_onUpdateFromStore:function(){return this.setState(this._getStateFromStore())},_canShowSeenState:function(){var e;return"LIBERAL"===I.FILE_VIEWER_SEEN_STATE&&(null!=(e=this.state.user)?e.is_team:void 0)},_canShowPresence:function(){var e;return I.FILE_VIEWER_PRESENCE_ENABLED&&(null!=(e=this.state.user)?e.is_team:void 0)&&!this.props.sharedLinkInfo},_setupSeenState:function(e,t,n){return this._canShowSeenState()?$.fetchSeenStateInfo(t.id,e.ns_id,e.sjid,n):void 0},_setupPresence:function(e,t){return this._canShowPresence()?H.updatePresence(e.ns_id,e.sjid,t.id,H.PRESENCE_STATES.VIEWER,this._updatePresenceCallback):void 0},_updatePresenceCallback:function(e,t,n,i){return null==this.props.sharedLinkInfo?E.receivePresenceData(e,t,n,i):void 0},_shutdownPresence:function(){return H.shutdownPresence(),H.updatePresence(this.state.currentFile.ns_id,this.state.currentFile.sjid,this.state.user.id,H.PRESENCE_STATES.OFFLINE,null)},_getActivityContextData:function(){var e;switch(e=this.state.currentFile,this.props.activityContext){case D.BROWSE_FILE_VIEWER:return e.fq_path;case D.SHARED_LINK_VIEW:return this.props.sharedLinkInfo.url;case D.SHARED_CONTENT_LINK_VIEW:return this.props.sharedLinkInfo.url;default:return null}},_setUpLogging:function(){return F.currentSession=new F,this._filePreviewTimelineLogger=new M(F.currentSession),this._filePreviewTimelineLogger.listenTo(m)},_teardownLogging:function(){return m.emit(x.FILE_VIEWER_CLOSED,L.currentSession),this._filePreviewTimelineLogger.unlistenTo(m),delete this._filePreviewTimelineLogger},_watchFile:function(e){return s.getGandalfRule("tap_to_refresh")&&null!=this.state.user?(this._unwatchFile(),this.watcher=new f(e,this.state.user,this._loadUpdatedFile)):void 0},_loadUpdatedFile:function(e){return this.watcher?p.replaceFile(e):void 0},_unwatchFile:function(){var e;return null!=(e=this.watcher)&&e.stop(),delete this.watcher},_setPreviewUrl:function(e,t){var n,i,o,r;return null==t&&(t=!0),this.props.disableRouting?void 0:(o=j.get_filename(e),n=R.parse(a.get_url()),i=R.encode_parts(n.getPath()),r=n.removeQuery("select").updateQuery({preview:o}).getQuery(),t?a.push_state(i,r,{immediatelyRestoreState:!1}):a.replace_state(i,r))},_unsetPreviewUrl:function(){var e,t,n;return this.props.disableRouting?void 0:(e=R.parse(a.get_url()),t=R.encode_parts(e.getPath()),n=e.removeQuery("select").removeQuery("preview").getQuery(),a.push_state(t,n,{immediatelyRestoreState:!1}))},_focusInViewer:function(){var e,t;if(!this.props.shouldFocusCommentInput){if(t=this.getDOMNode().querySelector(".button-primary"))return t.focus();if(e=P.getTabbableElementsIn(".react-file-viewer"),e.length)return e[0].focus()}},_flipNext:function(){return p.flipNext()},_flipPrevious:function(){return p.flipPrevious()},_setupKeymaster:function(){return B.isFlippableFile(this.state.currentFile)&&(key("left",q,function(e){return function(t){return e._flipPrevious()}}(this)),key("right",q,function(e){return function(t){return e._flipNext()}}(this))),key("esc",q,function(e){return function(t){var n;return P.focus_in_input()||P.is_input(t.target)||document.querySelector(".annotation-bubble")?void 0:"function"==typeof(n=e.props).onCloseViewer?n.onCloseViewer():void 0}}(this)),V=key.getScope(),key.setScope(q)},_cleanupKeymaster:function(){return key.clearScope(q),key.setScope(V)},_preloadImages:function(e,t){var n,i,o,r,s,a,l,u,c;if(0!==e.length){for(l=[0,1,2,3,4,5,6,-1,-2],c=[],r=0,s=l.length;s>r;r++)i=l[r],o=t+i,o>=0&&o<e.length&&"photo"===(null!=(u=e[t])?u.preview_type:void 0)?(n=e[t],a=n.preview_url||n.thumbnail_url_tmpl,c.push(C.preloadImage(a))):c.push(void 0);return c}},_setDocumentTitle:function(e,t){return null==t&&(t=!1),t&&(Q=document.title),document.title=e},_unsetDocumentTitle:function(){return""!==Q?document.title=Q:void 0},_renderFlippableControls:function(){return B.isFlippableFile(this.state.currentFile)&&!this.state.isFullscreen?U({index:""+(this.state.currentIndex+1),numFlippableFiles:this.state.files.length,onNext:this._flipNext,onPrevious:this._flipPrevious}):void 0},_renderFilePreview:function(){var e,t;return e=!this.props.hidePageChrome&&k.ALLOW_ANNOTATION_IMAGE_PREVIEWS,Z({className:"react-file-viewer__preview react-file-preview"},Z({className:"flex-preview-container"},s.getGandalfRule("docpreview-quality-popup-enabled")?this._renderPreviewQualityPopup():void 0,z({file:this.state.currentFile,fileViewTarget:this.props.fileViewTarget,fileViewOrigin:this.props.fileViewOrigin,fileViewAction:this.props.fileViewAction,sharedLinkUrl:null!=(t=this.props.sharedLinkInfo)?t.url:void 0,isFullscreen:this.state.isFullscreen,onCloseViewer:this.props.onCloseViewer,user:this.state.user,maxFilenameEmLength:W,areImagePreviewAnnotationsVisible:e,shouldDisplayAnnotationsToolbar:e,index:this.state.currentIndex,count:this.state.files.length,onPrevious:this._flipPrevious,onNext:this._flipNext})),e?void 0:this._renderFlippableControls())},_renderComments:function(){var e,n,i,o,r;return this.props.hidePageChrome||this.props.hideComments?null:this.state.commentsLoaded?(n=require("modules/clean/comments/components/file_comments_pane_container"),e=this._getActivityContextData(),i="photo"===this.state.currentFile.preview_type?".react-file-viewer__preview ."+l.PREVIEW_IMAGE_CONTAINER:".react-file-viewer__preview .flex-preview-container",r=!s.getGandalfRule("file_viewer_hide_comments"),Z({className:"react-file-viewer__activity"},t.createElement(n,{actorId:null!=(o=this.state.user)?o.id:void 0,context:this.props.activityContext,contextData:e,currentFile:this.state.currentFile,previewSelector:i,shouldInitiallyFocusInput:this.props.shouldFocusCommentInput,isCollapsed:!this.state.areCommentsOpen,shouldTrackCollapsedState:r}))):Z({id:"file-comments",className:"file-feedback"},Z({className:"comments-holder"}))},_renderTitleBar:function(){return this.props.hidePageChrome?null:Z({className:"react-file-viewer__title-bar"},Y({shareToken:this.state.shareToken,sharePermissions:this.state.sharePermissions,file:this.state.currentFile,user:this.state.user,maxFilenameEmLength:W,onCloseViewer:this.props.onCloseViewer,shareHelpers:this.props.shareHelpers,sharedLinkInfo:this.props.sharedLinkInfo,areCommentsOpen:this.state.areCommentsOpen}))},_renderPreviewQualityPopup:function(){return this.props.hidePageChrome?null:null!=this.props.sharedLinkInfo||this.state.user.root_ns!==this.state.currentFile.ns_id?null:t.createElement(G,{showalways:s.getGandalfRule("docpreview-quality-popup-always"),file:this.state.currentFile})},render:function(){var e;return e=j.get_filename(this.state.currentFile),this.state.isFullscreen?Z({className:"react-file-viewer",role:"dialog","aria-label":e},this._renderFilePreview()):Z({className:"react-file-viewer",role:"dialog","aria-label":e},this._renderTitleBar(),Z({className:"react-file-viewer__content"},this._renderFilePreview(),this._renderComments()))}})})}.call(this),function(){define("modules/clean/react/file_viewer/flippable_controls",["external/react","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n){var i,o,r,s,a;return a=e.DOM,r=a.button,s=a.div,o=n._,i=e.createClass({displayName:"FlippableControls",propTypes:{index:e.PropTypes.string.isRequired,numFlippableFiles:e.PropTypes.number.isRequired,onNext:e.PropTypes.func,onPrevious:e.PropTypes.func},_handlePreviousClick:function(){var e;return"function"==typeof(e=this.props).onPrevious?e.onPrevious():void 0},_handleNextClick:function(){var e;return"function"==typeof(e=this.props).onNext?e.onNext():void 0},render:function(){return this.props.numFlippableFiles>1?s({className:"react-file-viewer__controls"},r({onClick:this._handlePreviousClick,className:"nav-control"},t({group:"web",name:"s_flip_left",alt:o("Flip left",{comment:"Flip to the previous file in a series of files"})})),s({className:"nav-text"},o("%(cur_file_num)s of %(num_total_files)s").format({cur_file_num:this.props.index,num_total_files:this.props.numFlippableFiles})),r({onClick:this._handleNextClick,className:"nav-control"},t({group:"web",name:"s_flip_right",alt:o("Flip right",{comment:"Flip to the next file in a series of files"})}))):null}})})}.call(this),function(){define("modules/clean/react/file_viewer/full_screen_helpers",["jquery","modules/clean/react/file_viewer/actions"],function(e,t){var n;return n={setupFullscreen:function(t){return t&&(e(document).on("fullscreenchange.preview",this._setupExitFullscreenListeners),e(document).on("webkitfullscreenchange.preview",this._setupExitFullscreenListeners),e(document).on("msfullscreenchange.preview",this._setupExitFullscreenListeners),e(document).on("mozfullscreenchange.preview",this._setupExitFullscreenListeners)),this.setBrowserFullscreen(t)},_setupExitFullscreenListeners:function(){return e(document).off("fullscreenchange.preview"),e(document).off("webkitfullscreenchange.preview"),e(document).off("msfullscreenchange.preview"),e(document).off("mozfullscreenchange.preview"),e(document).on("fullscreenchange.preview",t.closeFullscreen.bind(t)),e(document).on("webkitfullscreenchange.preview",t.closeFullscreen.bind(t)),e(document).on("msfullscreenchange.preview",t.closeFullscreen.bind(t)),e(document).on("mozfullscreenchange.preview",t.closeFullscreen.bind(t))},teardownExitFullscreenListeners:function(){return e(document).off("fullscreenchange.preview"),e(document).off("webkitfullscreenchange.preview"),e(document).off("msfullscreenchange.preview"),e(document).off("mozfullscreenchange.preview")},setBrowserFullscreen:function(t){var n;if(n=e("body")[0],t){if(null!=n.requestFullscreen)return n.requestFullscreen();if(null!=n.msRequestFullscreen)return n.msRequestFullscreen();if(null!=n.mozRequestFullScreen)return n.mozRequestFullScreen();if(null!=n.webkitRequestFullscreen)return n.webkitRequestFullscreen()}else{if(document.exitFullscreen)return document.exitFullscreen();if(document.msExitFullscreen)return document.msExitFullscreen();if(document.mozCancelFullScreen)return document.mozCancelFullScreen();if(document.webkitExitFullscreen)return document.webkitExitFullscreen()}}},{FullscreenHelpers:n}})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/react/file_viewer/models",["external/immutable","modules/clean/uuid","modules/core/exception"],function(t,n,i){var o,r,s,a,l;return l={},a=t.Record({id:void 0}),s=function(t){function i(){i.__super__.constructor.call(this,{id:n.v4({allowInsecure:!0})})}return e(i,t),i.currentSession=null,i}(a),r=t.Record({id:void 0,fileViewerSession:void 0,file:void 0}),o=function(t){function o(e){var t,r;r=e.fileViewerSession,t=e.file,i.assert(r,"FileViewerSession required"),i.assert(t,"File required"),o.__super__.constructor.call(this,{id:n.v4({allowInsecure:!0}),fileViewerSession:r,file:t})}return e(o,t),o.currentSession=null,o}(r),l.FileViewerSession=s,l.FilePreviewSession=o,l})}.call(this),function(){define("modules/clean/react/file_viewer/more_dropdown",["external/react","modules/clean/components/title_bubble","modules/clean/previews/util","modules/clean/react/bubble_menu","modules/clean/react/file_action_button","modules/clean/react/file_viewer/comment_menu_item_group","modules/clean/react/sprite","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,n,i,o,r,s,a,l,u){var c,d,p,_,h,m,f,v,g,y,b,w;return h=n.PreviewHelper,c=i.BubbleMenu,p=o.FileActionButtonType,d=o.FileActionButton,v=l._,f=e.createFactory(t),m=e.createFactory(s),w=e.DOM,b=w.div,g=w.button,y=e.createElement,_=e.createClass({displayName:"MoreDropdown",propTypes:{file:e.PropTypes.object.isRequired,user:e.PropTypes.object.isRequired,isPrivate:e.PropTypes.bool.isRequired,onRemoveShareLink:e.PropTypes.func,areCommentsOpen:e.PropTypes.bool.isRequired,isCommentingIntegrated:e.PropTypes.bool.isRequired,tkey:e.PropTypes.string},_handleDownloadClick:function(e){var t;return e.preventDefault(),t=u.parse(this.props.file.href).updateQuery({dl:1}).toString(),a.redirect(t)},_handleRemoveLinkClick:function(e){return e.preventDefault(),this.props.onRemoveShareLink()},_handlePreviousVersionClick:function(e){return e.preventDefault(),h.redirectToVersionHistory(this.props.file,this.props.user)},_renderDropdownTarget:function(){return g({className:"more-button button-secondary control__button"},m({group:"web",name:"control_more",alt:v("More actions")}))},_renderRemoveShareLink:function(){return y(d,{className:"more-button__remove",type:p.REMOVE_LINK,callback:this._handleRemoveLinkClick})},_renderCommentsOptions:function(){return y(r,{areCommentsOpen:this.props.areCommentsOpen,user:this.props.user})},_getDropdownItems:function(){var e;return e=[],null!=this.props.onRemoveShareLink&&null!=this.props.tkey&&e.push(this._renderRemoveShareLink()),this.props.isPrivate&&(e.push(y(d,{className:"more-button__download",type:p.DOWNLOAD,callback:this._handleDownloadClick})),e.push(y(d,{className:"more-button__version-history",type:p.PREVIOUS_VERSIONS,callback:this._handlePreviousVersionClick}))),this.props.isCommentingIntegrated&&e.push(this._renderCommentsOptions()),e},render:function(){var e;return e=this._getDropdownItems(),e.length?b({className:"u-mar-left-xs"},new f({text:v("More"),direction:"south",className:"react-title-bar--title-bubble"},y(c,{targetButton:this._renderDropdownTarget(),arrow_position:"top-right",extra_css_class:"react-file-viewer-dropdown",justify:!0,vertical_displacement:4,items:e}))):b()}})})}.call(this),function(){define("modules/clean/react/file_viewer/mounted_file_actions",["external/react","modules/clean/react/file_viewer/more_dropdown","modules/clean/react/file_viewer/open_button","modules/clean/react/file_viewer/toggle_comments","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,i,o,r){var s,a,l,u,c,d,p,_,h,m;return d=r._,s=e.createFactory(t),l=e.createFactory(n),c=e.createFactory(i),u=e.createFactory(o),m=e.DOM,p=m.a,_=m.button,h=m.div,a=e.createClass({displayName:"MountedFileActions",propTypes:{file:e.PropTypes.object.isRequired,user:e.PropTypes.object.isRequired,shareHelpers:e.PropTypes.object,isCommentingIntegrated:e.PropTypes.bool,areCommentsOpen:e.PropTypes.bool},getDefaultProps:function(){return{shareHelpers:null}},getInitialState:function(){return{tkey:this.props.file.tkey||null}},componentDidMount:function(){return this._setupShare()},_setupShare:function(){var e;return null!=(e=this.props.shareHelpers)?e.fetchTkey(this.props.file.fq_path,this.props.user.id,function(e){return function(t){return e.isMounted()?e.setState({tkey:t}):void 0}}(this)):void 0},_handleShareClick:function(){return this.props.shareHelpers.share(this.props.file.fq_path,this.props.user)},_removeShareLink:function(){return this.props.shareHelpers.removeShareLink(this.props.file.fq_path,this.state.tkey,this.props.user.id,function(e){return function(){return e.setState({tkey:null})}}(this))},_renderToggleComments:function(){return this.props.isCommentingIntegrated?c({areCommentsOpen:this.props.areCommentsOpen}):void 0},render:function(){return h({className:"react-title-bar__controls u-mar-right-xs"},null!=this.props.shareHelpers?_({className:"share-button button-primary control__button",onClick:this._handleShareClick},d("Share")):void 0,l({file:this.props.file,user:this.props.user}),s({file:this.props.file,user:this.props.user,isPrivate:!0,tkey:this.state.tkey,onRemoveShareLink:this._removeShareLink,areCommentsOpen:this.props.areCommentsOpen,isCommentingIntegrated:this.props.isCommentingIntegrated}),this._renderToggleComments())}})})}.call(this),function(){define("modules/clean/react/file_viewer/open_button",["external/react","modules/clean/open_with","modules/clean/react/bubble_dropdown","modules/clean/react/file_viewer/open_button_coachmark","modules/clean/react/file_viewer/utils","modules/clean/react/sprite","modules/clean/react/sprite_div","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,n,i,o,r,s,a,l,u){var c,d,p,_,h,m,f,v,g,y,b,w,E,T,C,S,k,I;return f=o.OpenWithHelpers,y=o.UnityHelpers,b=l._,k=e.DOM,w=k.a,E=k.button,C=k.div,S=k.li,I=k.ul,c=e.createFactory(n),m=e.createFactory(i),T=e.addons.classSet,_="open-button",d=_+"__download",v=_+"__unity",p=_+"__open-with",g=_+"__unity-folder",h=e.createClass({displayName:"OpenButton",propTypes:{file:e.PropTypes.object.isRequired,user:e.PropTypes.object.isRequired},getInitialState:function(){return{coachmarkHidden:!1,unityInfo:null}},componentDidMount:function(){return y.isUnityEnabled()?this._setupUnity():void 0},componentDidUpdate:function(){var e;return null!=(e=this.refs.dropdown)?e.show():void 0},_hideCoachmark:function(){return this.setState({coachmarkHidden:!0})},_setupUnity:function(){return y.getUnityFileInfo(this.props.file.ns_id,this.props.file.ns_path,this.props.user.id,function(e){return function(t){return e.isMounted()?e.setState({unityInfo:t}):void 0}}(this),function(e){return function(){return e.isMounted()?e.setState({unityInfo:{can_open_directly:!1,is_locally_available:!1}}):void 0}}(this)),window.setTimeout(function(e){return function(){return null===e.state.unityInfo&&e.isMounted()?e.setState({unityInfo:{can_open_directly:!1,is_locally_available:!1}}):void 0}}(this),1e4)},_hasUnityFolderSupport:function(){return null!=this.state.unityInfo&&this.state.unityInfo.is_locally_available&&y.clientSupportsOpenInFileBrowser()},_hasUnityFileSupport:function(){return null!=this.state.unityInfo&&this.state.unityInfo.can_open_directly!==!1},_hasOpenWithSupport:function(){return f.canOpenWith(this.props.file,this.props.user)},_getNumEnabled:function(){return(this._hasOpenWithSupport()?1:0)+(this._hasUnityFileSupport()?1:0)+(this._hasUnityFolderSupport()?1:0)},_isDropdownDisabled:function(){return this._getNumEnabled()<2},_isButtonDisabled:function(){return null===this.state.unityInfo},_getFileBrowserLabel:function(){var e,t;return e=(null!=(t=this.state.unityInfo)?t.file_browser_display_name:void 0)||b("File Browser"),b("Show in %(file_browser)s").format({file_browser:e})},_getNativeAppLabel:function(){var e,t;return e=(null!=(t=this.state.unityInfo)?t.open_application_name:void 0)||b("Desktop"),b("Open in %(app_name)s").format({app_name:e})},_onClickAnyOpenButtonType:function(){return this._hideCoachmark()},_handleUnityFileClick:function(e){var t;return this._onClickAnyOpenButtonType(),t=this.props.file,y.openFile(t.ns_id,t.ns_path,this.props.user.id),null!=e?e.preventDefault():void 0},_handleUnityFolderClick:function(e){var t;return this._onClickAnyOpenButtonType(),t=this.props.file,y.openFile(t.ns_id,t.ns_path,this.props.user.id,!0),null!=e?e.preventDefault():void 0},_handleOpenWithClick:function(e){return this._onClickAnyOpenButtonType(),f.openWith(this.props.file,this.props.user),null!=e?e.preventDefault():void 0},_handleDownloadClick:function(e){var t;return this._onClickAnyOpenButtonType(),t=u.parse(this.props.file.href).updateQuery({dl:1}).toString(),a.redirect(t),null!=e?e.preventDefault():void 0},_renderCoachmark:function(e,t){return C({className:"c-coach-mark__container"},e,this.state.coachmarkHidden?void 0:m({file:this.props.file,user:this.props.user,inDropdown:t}))},_renderMainButton:function(){var e,n,i,o;return e={"button-secondary":!0,control__button:!0,"split-button":!this._isDropdownDisabled(),disabled:this._isButtonDisabled()},this._hasUnityFileSupport()?(e[v]=!0,i=E({ref:"openButton",className:T(e),onClick:this._handleUnityFileClick},b("Open")),t.is_adobe_app(null!=(o=this.state.unityInfo)?o.open_application_identifier:void 0)?this._renderCoachmark(i,!1):i):this._hasUnityFolderSupport()?(e[g]=!0,E({ref:"openButton",className:T(e),onClick:this._handleUnityFolderClick},b("Open"))):this._hasOpenWithSupport()&&!this._isButtonDisabled()?(e[p]=!0,n=E({ref:"openButton",className:T(e),onClick:this._handleOpenWithClick},b("Open")),this._renderCoachmark(n,!1)):this._isButtonDisabled()?E({ref:"openButton",className:T(e)},""):(e[d]=!0,E({ref:"openButton",className:T(e),onClick:this._handleDownloadClick},b("Download")))},_renderSplitButton:function(){var e,t,n;return t=f.getOpenWithHandlerData(this.props.file,this.props.user),n=E({className:"button-secondary split-dropdown control__button"},r({group:"web",name:"control_menu",alt:b("More options")})),e=c({targetButton:n,arrow_position:"top-right",extra_css_class:"react-file-viewer-dropdown",vertical_displacement:4,bubbleDropdownShown:this._hideCoachmark},I({className:"dropdown-contents"},this._hasUnityFileSupport()?S({},w({href:"#",className:v,onClick:this._handleUnityFileClick},s({group:"web",name:"ow_desktop",text:this._getNativeAppLabel()}))):void 0,this._hasOpenWithSupport()?S({},w({href:"#",className:p,onClick:this._handleOpenWithClick},s({group:"web",name:null!=t?t.icon:void 0,text:null!=t?t.name:void 0}))):void 0,this._hasUnityFolderSupport()?S({},w({href:"#",className:g,onClick:this._handleUnityFolderClick},s({group:"web",name:"ow_folder",text:this._getFileBrowserLabel()}))):void 0)),this._renderCoachmark(e,!0)},render:function(){return C({className:"split-button-wrap "+_},this._renderMainButton(),this._isDropdownDisabled()?void 0:this._renderSplitButton())}})})}.call(this),function(){define("modules/clean/react/file_viewer/open_button_coachmark",["external/modernizr","external/react","modules/clean/previews/util","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/coach_mark","modules/clean/react/file_viewer/utils","modules/clean/react/react_i18n","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,i,o,r,s,a,l){var u,c,d,p,_,h,m;return d=n.PreviewHelper,_=r.TooltipHelpers,m=a.static_url,h=l._,p=s.R_,u=t.createFactory(o),c=t.createClass({displayName:"OpenButtonCoachmark",propTypes:{file:t.PropTypes.object.isRequired,user:t.PropTypes.object.isRequired,inDropdown:t.PropTypes.string.isRequired},getInitialState:function(){return{vendor:null,application:null}},setCoachmarkConfig:function(e,t){return this.setState({vendor:e,application:t})},clearCoachmarkConfig:function(){return this.setCoachmarkConfig(null,null)},onReceiveTooltipInfo:function(e){var t,n,i,o;return n=d.get_extension(this.props.file),i=_.getVendorAndApplication(e,n),null!==i?(o=i.vendor,t=i.application,this.setCoachmarkConfig(o,t)):void 0},componentDidMount:function(){return _.fetchTooltipInfo(this.props.user.id,this.onReceiveTooltipInfo)},hasCoachmark:function(){return this.state.vendor&&this.state.application},dismissCoachmark:function(){return this.clearCoachmarkConfig()},onCoachmarkShown:function(){var e;return e=d.get_extension(this.props.file),
_.logImpression(e,this.props.user.id,this.state.application)},onCoachmarkButtonClick:function(){return this.dismissCoachmark()},_renderCoachmark:function(e){var t,n,i,o,r,s;return s=e.title,i=e.imageUrl,o=e.imageUrl2x,n=e.imageAlt,r=e.openButtonBody,t=e.dropdownBody,u({title:s,imageUrl:i,imageUrl2x:o,imageAlt:n,buttonText:h("Got it."),onButtonClick:this.onCoachmarkButtonClick,onShown:this.onCoachmarkShown},this.props.inDropdown?t:r)},_renderMsftWord:function(){return this._renderCoachmark({title:h("Edit shared docs together"),imageUrl:m("/static/images/file_viewer/coach_mark_docx-vflGsxySJ.png"),imageUrl2x:m("/static/images/file_viewer/coach_mark_docx@2x-vflJZIQKs.png"),imageAlt:h("An illustration of a Word file"),buttonText:h("Got it."),openButtonBody:p({},"Click <strong>open</strong> to edit together in Microsoft Word Online."),dropdownBody:p({},"Choose <strong>Microsoft Word Online</strong> to edit together.")})},_renderMsftExcel:function(){return this._renderCoachmark({title:h("Edit shared spreadsheets together"),imageUrl:m("/static/images/file_viewer/coach_mark_xlsx-vflaEwaN7.png"),imageUrl2x:m("/static/images/file_viewer/coach_mark_xlsx@2x-vflkU3Ma1.png"),imageAlt:h("An illustration of an Excel file"),openButtonBody:p({},"Click <strong>open</strong> to edit together in Microsoft Excel Online."),dropdownBody:p({},"Choose <strong>Microsoft Excel Online</strong> to edit together.")})},_renderMsftPowerpoint:function(){return this._renderCoachmark({title:h("Edit shared presentations together"),imageUrl:m("/static/images/file_viewer/coach_mark_pptx-vfltjppV8.png"),imageUrl2x:m("/static/images/file_viewer/coach_mark_pptx@2x-vflpvn3tE.png"),imageAlt:h("An illustration of a Powerpoint file"),openButtonBody:p({},"Click <strong>open</strong> to edit together in Microsoft PowerPoint Online."),dropdownBody:p({},"Choose <strong>Microsoft PowerPoint Online</strong> to edit together.")})},_renderAdobeAcrobatOrReader:function(){return this._renderCoachmark({title:h("Want to edit this PDF?"),imageUrl:m("/static/images/file_viewer/coach_mark_pdf-vflIMdX1a.png"),imageUrl2x:m("/static/images/file_viewer/coach_mark_pdf@2x-vflUkcAgn.png"),imageAlt:h("An illustration of a PDF file"),openButtonBody:p({},"You’re looking at a preview. To open this file for editing, click <strong>Open</strong>."),dropdownBody:h("You’re looking at a preview. To open this file for editing, click here.")})},render:function(){if(this.hasCoachmark&&e.flexbox)switch(this.state.vendor){case"msft":switch(this.state.application){case"word":return this._renderMsftWord();case"excel":return this._renderMsftExcel();case"powerpoint":return this._renderMsftPowerpoint()}break;case"adbe":switch(this.state.application){case"acrobat_or_reader":return this._renderAdobeAcrobatOrReader()}}return null}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_viewer/seen_state_facepile",["external/react","external/underscore","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/viewer_avatar","modules/clean/components/title_bubble","modules/clean/datetime","modules/clean/em_string","modules/clean/loggers/file_preview_logger","modules/clean/react/bubble_dropdown","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/pass/store","modules/clean/react/pass/utils","modules/clean/viewer","modules/core/i18n","modules/core/user_i18n"],function(t,n,i,o,r,s,a,l,u,c,d,p,_,h,m,f,v,g,y){var b,w,E,T,C,S,k,I,A,P,N,R,O,D,x,L,M,F,U,B;return x=l.ago,C=c.FilePreviewPassLogger,T=p.EventTypes,S=h.FilePreviewSession,R=f.SeenStateHelpers,D=g._,E=t.createFactory(d),U=t.DOM,L=U.button,M=U.div,F=U.li,B=U.ul,A=4,P=99,b=32,w="CIRCLE",I="c-avatar--inactive-photo",k="#7B8994",O=10,N=t.createClass({displayName:"SeenStateFacepile",propTypes:{nsId:t.PropTypes.number.isRequired,sjid:t.PropTypes.number.isRequired,userId:t.PropTypes.number.isRequired},componentWillMount:function(){return this._removeStoreListener=m.addListener(this._onUpdateFromStore),this._filePreviewPassLogger=new C,this._filePreviewPassLogger.listenTo(_)},componentDidMount:function(){return this._logFacepileShownEvents()},getInitialState:function(){return this._getStateFromStore(this.props.nsId,this.props.sjid)},componentWillReceiveProps:function(e){return this.props.nsId!==e.nsId||this.props.sjid!==e.sjid?this.setState(this._getStateFromStore(e.nsId,e.sjid)):void 0},componentDidUpdate:function(e,t){return n.isEqual(e,this.props)||(this._hasSeenStateBeenLogged=!1,this._hasPresenceBeenLogged=!1),this._logFacepileShownEvents()},componentWillUnmount:function(){return this._removeStoreListener(),this._filePreviewPassLogger.unlistenTo(_)},_getStateFromStore:function(e,t){return{presence:m.presence(e,t),seenStateInfo:m.seenStateInfo(e,t)}},_onUpdateFromStore:function(){return this.setState(this._getStateFromStore(this.props.nsId,this.props.sjid))},_logFacepileShownEvents:function(){return this.state.seenStateInfo?(this.state.presence?this._hasPresenceBeenLogged||(this._logPassEvent(T.FILE_PREVIEW_PASS_SHOWN),this._hasPresenceBeenLogged=!0):this._hasSeenStateBeenLogged||this._logPassEvent(T.FILE_PREVIEW_SEEN_STATE_SHOWN),this._hasSeenStateBeenLogged=!0):void 0},_logPassEvent:function(e){return _.emit(e,S.currentSession,{numViewers:this._getNumViewers(),numCurrentViewers:this._getNumCurrentViewers()})},_getNumViewers:function(){return this.state.seenStateInfo.seen_states.length+1},_getNumCurrentViewers:function(){return this.state.presence?1+this.state.presence.length:0},_getAvatarProps:function(e,t,n){return{dimension:b,photoUrl:t,defaultAvatar:new r({dimension:b,initials:y.getInitials(e),name:e,color:n?void 0:k,shape:w}),optionalClass:n?null:I}},_userIsOnline:function(t){var n;return null!=this.state.presence&&(n=t.user_id,e.call(this.state.presence,n)>=0)},_renderAvatar:function(e){return i(this._getAvatarProps(e.seen_state_user.display_name,e.seen_state_user.photo_circle_url,this._shouldShowColor(e)))},_shouldShowColor:function(e){return null==this.state.presence?!0:this._userIsOnline(e.seen_state_user)},_renderAvatarWithTooltip:function(e,t){return a({text:t,direction:"south",onMouseEnter:function(e){return function(){return e._logPassEvent(T.FILE_PREVIEW_PASS_HOVER)}}(this),respectLineBreaks:!0},e)},_renderDropdownButton:function(e){var t,n,i;return t=e.length-A,n=t>=P?P+"+":""+t,i=L({className:"overflow-button"},new o({dimension:b,initials:n,color:k,shape:w})),E({targetButton:i,arrow_position:"top-right",bubbleDropdownScrollable:!0,show_arrow:!1,vertical_displacement:-4,bubbleDropdownShown:function(e){return function(){return e._logPassEvent(T.FILE_PREVIEW_PASS_CLICK)}}(this)},this._renderDropdownContents(e))},_renderDropdownContents:function(e){var t,n,i,o;for(t=[],n=0,i=e.length;i>n;n++)o=e[n],t.push(this._renderDropdownRow(o.avatar,o.displayName,o.dropdownText));return M({className:"seen-state-dropdown"},B({className:"seen-state-dropdown__list"},t),M({className:"seen-state-dropdown__footer"},this._renderDropdownFooter()))},_renderDropdownRow:function(e,t,n){return F({className:"seen-state-row"},M({className:"seen-state-row__avatar"},e),M({className:"seen-state-row__info"},M({className:"seen-state-row__actor"},t),M({className:"seen-state-row__time"},n)))},_renderDropdownFooter:function(){return D("%(num_views)s total views").format({num_views:this.state.seenStateInfo.total_views})},_offlineDropdownText:function(e){return x(1e3*e.when_last_seen)},_offlineTooltipText:function(e){return D("%(user_name)s \n viewed %(ago)s",{comment:'Format like "userName <newline> viewed 5 days ago"'}).format({user_name:this._truncatedTooltipDisplayName(e.seen_state_user.display_name),ago:x(1e3*e.when_last_seen,!1)})},_onlineDropdownText:function(){return D("Currently viewing")},_onlineTooltipText:function(e){return D("%(user_name)s \n currently viewing",{comment:'Format like "user_name <newline> currently viewing"'}).format({user_name:this._truncatedTooltipDisplayName(e)})},_truncatedTooltipDisplayName:function(e){return u.em_snippet(e,O)},_buildUserInfo:function(e){var t,n;return t=this._renderAvatar(e),n=e.seen_state_user.display_name,this._userIsOnline(e)?{avatar:t,displayName:n,tooltipText:this._onlineTooltipText(n),dropdownText:this._onlineDropdownText(n)}:{avatar:t,displayName:n,tooltipText:this._offlineTooltipText(e),dropdownText:this._offlineDropdownText(e)}},_partitionUserInfoLists:function(){var e,t,n,i,o,r;for(i=[],n=[],o=this.state.seenStateInfo.seen_states,e=0,t=o.length;t>e;e++)r=o[e],this._userIsOnline(r)?i.push(this._buildUserInfo(r)):n.push(this._buildUserInfo(r));return{onlineUserInfoList:i,offlineUserInfoList:n}},_getUserInfoList:function(){var e,t,n,i,o,r,a;return i=[],a=v.get_viewer().get_user_by_id(this.props.userId),r=this._getAvatarProps(a.display_name,a.photo_url,!0),o=new s(r),i.push({avatar:o,displayName:a.display_name,tooltipText:this._onlineTooltipText(a.display_name),dropdownText:this._onlineDropdownText()}),n=this._partitionUserInfoLists(),t=n.onlineUserInfoList,e=n.offlineUserInfoList,i.concat(t).concat(e)},render:function(){var e,t,n,i,o;return this.state.seenStateInfo&&this.props.userId?(o=this._getUserInfoList(),i=o.length>A+1,e=i?A:o.length,t=o.slice(0,e),n=t.map(function(e){return function(t){return e._renderAvatarWithTooltip(t.avatar,t.tooltipText,o.length)}}(this)),i&&n.push(this._renderDropdownButton(o)),n.reverse(),M({className:"react-title-bar__facepile"},n)):M()}})})}.call(this),function(){define("modules/clean/react/file_viewer/shared_file_actions",["external/react","modules/clean/react/share_download/button","modules/clean/react/file_viewer/account_menu/account_menu","modules/clean/react/file_viewer/copyright_flag","modules/clean/react/file_viewer/more_dropdown","modules/clean/react/file_viewer/toggle_comments","modules/clean/react/user_notifications/dropdown","modules/clean/react/sprite","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,n,i,o,r,s,a,l,u,c){var d,p,_,h,m,f,v,g,y,b,w;return g=u._,d=e.createFactory(n),p=e.createFactory(i),_=e.createFactory(o),h=e.createFactory(t),f=e.createFactory(r),v=e.createFactory(s),w=e.DOM,y=w.a,b=w.div,m=e.createClass({displayName:"SharedFileActions",propTypes:{shareToken:e.PropTypes.object,sharePermissions:e.PropTypes.object,file:e.PropTypes.object.isRequired,user:e.PropTypes.object,isCommentingIntegrated:e.PropTypes.bool,areCommentsOpen:e.PropTypes.bool,sharedLinkInfo:e.PropTypes.object,shareHelpers:e.PropTypes.object},getDefaultProps:function(){return{user:null}},getInitialState:function(){return{tkey:this.props.file.tkey||null}},_handleAccountClick:function(){throw new Error("Not implemented")},_handleSignInClick:function(){throw new Error("Not implemented")},_removeShareLink:function(){return this.props.shareHelpers.removeShareLink(this.props.file.filename,this.props.shareToken.linkKey,this.props.sharePermissions.canRemoveLinkUids[0],function(){return l.redirect("/home")},!0,this.props.sharedLinkInfo.ownerName,this.props.sharedLinkInfo.ownerEmail)},_renderDownloadMenu:function(){return this.props.shareToken&&this.props.sharePermissions?h({shareToken:this.props.shareToken,sharePermissions:this.props.sharePermissions,file:this.props.file}):void 0},_renderAccountMenu:function(){return d({user:this.props.user,accountPhotoUrl:this.props.sharedLinkInfo.accountPhotoUrl,showProGiftingLink:this.props.sharedLinkInfo.showProGiftingLink,showBusinessUpgradeLink:this.props.sharedLinkInfo.showBusinessUpgradeLink,showProUpgradeLink:this.props.sharedLinkInfo.showProUpgradeLink})},_renderMoreDropdown:function(){var e,t;return t=(null!=(e=this.props.sharePermissions)?e.canRemoveLinkUids.length:void 0)>0?this.props.shareToken.linkKey:null,_({file:this.props.file,user:this.props.user,isPrivate:!1,tkey:t,onRemoveShareLink:this._removeShareLink,areCommentsOpen:this.props.areCommentsOpen,isCommentingIntegrated:this.props.isCommentingIntegrated})},_renderToggleComments:function(){return this.props.isCommentingIntegrated?f({areCommentsOpen:this.props.areCommentsOpen}):void 0},_renderSignIn:function(){return y({className:"button-primary sign-in-link control__button",href:c({path:"/login",query:{cont:l.get_href()}}).toString()},g("Sign in"))},render:function(){return b({className:"react-title-bar__controls shared-link u-mar-right-xs"},p(),null!=this.props.user?[v(),this._renderAccountMenu(),this._renderDownloadMenu(),this._renderMoreDropdown(),this._renderToggleComments()]:[this._renderSignIn(),this._renderDownloadMenu(),this._renderMoreDropdown(),this._renderToggleComments()])}})})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/react/file_viewer/store",["external/underscore","modules/clean/flux/flux_store","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/dispatcher","modules/clean/react/file_viewer/utils"],function(t,n,i,o,r){var s,a,l;return s=i.ActionTypes,l=r.FlippableHelpers,new(a=function(n){function i(e){i.__super__.constructor.call(this,e),this._files=[],this._currentIndex=0,this._user=null,this._shareToken=null,this._sharePermissions=null,this._isFullscreen=!1,this._areCommentsOpen=!0,this._cachedLatestRevision=null,this._disableFlipping=!1}return e(i,n),i.prototype.files=function(){return this._files},i.prototype.currentIndex=function(){return this._currentIndex},i.prototype.user=function(){return this._user},i.prototype.shareToken=function(){return this._shareToken},i.prototype.sharePermissions=function(){return this._sharePermissions},i.prototype.isFullscreen=function(){return this._isFullscreen},i.prototype.areCommentsOpen=function(){return this._areCommentsOpen},i.prototype.currentFile=function(){return this._files[this._currentIndex]},i.prototype.isViewingLatestRevision=function(){return!this._cachedLatestRevision},i.prototype._setup=function(e){var t,n,i,o,r,s,a;return o=e.files,n=e.currentIndex,a=e.user,s=e.shareToken,r=e.sharePermissions,i=e.disableFlipping,t=e.areCommentsOpen,this._user=a,this._shareToken=s,this._sharePermissions=r,this._disableFlipping=i,this._updateFiles(o,o[n]),null!=t?this._areCommentsOpen=t:void 0},i.prototype._updateFiles=function(e,t){return!l.isFlippableFile(t)||this._disableFlipping?(this._files=[t],this._currentIndex=0):(this._files=l.filterFlippableFiles(e),this._currentIndex=this._getFileIndex(this._files,t),-1===this._currentIndex&&(this._files=[t],this._currentIndex=0)),this.__emitChange()},i.prototype._replaceFile=function(e){var n;return n=t.findIndex(this._files,function(t){return t.fq_path===e.fq_path}),null!=n?n===this._currentIndex&&this._cachedLatestRevision?this._cachedLatestRevision=e:(this._files[n]=e,this.__emitChange()):void 0},i.prototype._cleanup=function(){return this._files=[],this._currentIndex=0,this._user=null,this._isFullscreen=!1,this._cachedLatestRevision=null},i.prototype._nextFile=function(){return this._restoreRevision(),this._currentIndex=this._currentIndex===this._files.length-1?0:this._currentIndex+1,this.__emitChange()},i.prototype._previousFile=function(){return this._restoreRevision(),this._currentIndex=0===this._currentIndex?this._files.length-1:this._currentIndex-1,this.__emitChange()},i.prototype._setIsFullscreen=function(e){return this._isFullscreen=e,this.__emitChange()},i.prototype._setCommentsOpen=function(e){return this._areCommentsOpen=e,this.__emitChange()},i.prototype._switchRevision=function(e){return this._cachedLatestRevision||(this._cachedLatestRevision=this._files[this._currentIndex]),e.fq_path===this._cachedLatestRevision.fq_path&&e.sjid===this._cachedLatestRevision.sjid?this._restoreRevision():(this._files[this._currentIndex]=e,this.__emitChange())},i.prototype._restoreRevision=function(){return this._cachedLatestRevision?(this._files[this._currentIndex]=this._cachedLatestRevision,this._cachedLatestRevision=null,this.__emitChange()):void 0},i.prototype._getFileIndex=function(e,t){var n,i,o,r;for(i=o=0,r=e.length;r>o;i=++o)if(n=e[i],t.sjid===n.sjid)return i;return-1},i.prototype.__onDispatch=function(e){switch(e.action.type){case s.SETUP:return this._setup(e.action.data);case s.CLEANUP:return this._cleanup();case s.UPDATE_FILES:return this._updateFiles(e.action.data.files,this.currentFile());case s.REPLACE_FILE:return this._replaceFile(e.action.data.file);case s.FLIP_NEXT:return this._nextFile();case s.FLIP_PREVIOUS:return this._previousFile();case s.OPEN_FULLSCREEN:return this._setIsFullscreen(!0);case s.CLOSE_FULLSCREEN:return this._setIsFullscreen(!1);case s.OPEN_COMMENTS:return this._setCommentsOpen(!0);case s.CLOSE_COMMENTS:return this._setCommentsOpen(!1);case s.SWITCH_REVISION:return this._switchRevision(e.action.data.file);case s.RESTORE_REVISION:return this._restoreRevision()}},i}(n))(o)})}.call(this),function(){define("modules/clean/react/file_viewer/title_bar",["external/classnames","external/react","modules/constants/env","modules/clean/em_string","modules/clean/filepath","modules/clean/previews/util","modules/clean/react/file_viewer/mounted_file_actions","modules/clean/react/file_viewer/seen_state_facepile","modules/clean/react/file_viewer/shared_file_actions","modules/clean/react/sprite","modules/clean/react/image","modules/clean/components/title_bubble","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,i,o,r,s,a,l,u,c,d,p,_){var h,m,f,v,g,y,b,w,E,T,C,S,k,I,A,P,N;return f=r.PreviewHelper,m=r.PermissionHelper,N=p.static_url,E=_._,A=t.DOM,T=A.a,C=A.button,S=A.div,k=A.h1,I=A.img,P=A.span,h=t.createFactory(s),v=t.createFactory(a),g=t.createFactory(l),y=t.createFactory(u),w=t.createFactory(d),b=t.createClass({displayName:"TitleBar",propTypes:{shareToken:t.PropTypes.object,sharePermissions:t.PropTypes.object,file:t.PropTypes.object.isRequired,maxFilenameEmLength:t.PropTypes.number.isRequired,user:t.PropTypes.object,onCloseViewer:t.PropTypes.func,shareHelpers:t.PropTypes.object,sharedLinkInfo:t.PropTypes.object,areCommentsOpen:t.PropTypes.bool.isRequired},getDefaultProps:function(){return{user:null,onCloseViewer:null,shareHelpers:null,sharedLinkInfo:null}},_isSharedFile:function(){return null!=this.props.sharedLinkInfo},_isMountedFile:function(){return!this._isSharedFile()},_redirectToVersionHistory:function(){return f.redirectToVersionHistory(this.props.file,this.props.user)},_renderCornerIcon:function(){return this._isMountedFile()?this._renderClose():this._renderLogo()},_renderClose:function(){return C({className:"react-title-bar__close u-mar-horizontal-xxs",title:E("Close"),onClick:this.props.onCloseViewer},y({group:"web",name:"control_close",alt:E("Close")}))},_renderFileIcon:function(){var e,t;return e=f.get_filename(this.props.file),t=o.file_icon(e)+"_32",y({group:"web",name:t,className:"file-icon u-mar-horizontal-xs",alt:""})},_renderLogo:function(){var e,t,i;return e=null!=(i=this.props.sharedLinkInfo)?i.ownerTeamLogo:void 0,t=e?I({alt:"Logo",src:e}):c({alt:"Dropbox",src:N("/static/images/header/header_logo_shmodel-vflsZ7QsE.png"),srcHiRes:N("/static/images/header/header_logo_shmodel@2x-vflvJX68X.png")}),T({href:"//"+n.WEBSERVER+"?src=shmodel",className:"title-bar-icon u-mar-horizontal-xxs"},t)},_renderFileInfo:function(){var t,n;return n=this.props.sharedLinkInfo,t=e({fileinfo:!0,"u-pad-top-xxs":null!=n&&null!=n.ownerName&&null!=n.ownerTeamName||null==n&&null!=this.props.file.ts}),S({className:t},this._renderFilename(),null!=this.props.sharedLinkInfo?this._renderSharedFileOwner():null!=this.props.file.ts?this._renderLastModifier():void 0)},_renderFilename:function(){return k({className:"filename"},i.em_snippet(f.get_filename(this.props.file),this.props.maxFilenameEmLength))},_renderSharedFileOwner:function(){var e,t,n;return n=this.props.sharedLinkInfo,e=n.ownerName,t=n.ownerTeamName,null!=e&&null!=t&&this._isSharedFile()?P({className:"file-modifier"},E(" from %(owner)s (%(team)s)").format({owner:e,team:t})):void 0},_renderLastModifier:function(){var e,t,n,i,o;return t=this.props.file,n=t.last_modified_name,e=2,i=t.event_type===e?n?E("%(modifier)s edited ",{comment:"Like 'John Smith edited just now'"}).format({modifier:n}):E("You edited ",{comment:"Like 'You edited just now'"}):E("Modified ",{comment:"Like 'Modified just now"}),o=f.getModifierString(t),P({className:"file-modifier"},i,new w({direction:"south",text:E("View file history")},T({className:"file-modifier",onClick:this._redirectToVersionHistory,href:"#"},o)))},_renderSeenStates:function(){var e;return v({nsId:this.props.file.ns_id,sjid:this.props.file.sjid,userId:null!=(e=this.props.user)?e.id:void 0})},_renderFileActions:function(){return this._isMountedFile()?h({file:this.props.file,user:this.props.user,shareHelpers:this.props.shareHelpers,isCommentingIntegrated:m.is_commenting_integrated(),areCommentsOpen:this.props.areCommentsOpen}):g({shareToken:this.props.shareToken,sharePermissions:this.props.sharePermissions,file:this.props.file,user:this.props.user,isCommentingIntegrated:m.is_commenting_integrated(),areCommentsOpen:this.props.areCommentsOpen,sharedLinkInfo:this.props.sharedLinkInfo,shareHelpers:this.props.shareHelpers})},render:function(){var t;return t=e({"react-title-bar__fileinfo-wrap":!0,"react-title-bar__fileinfo-wrap--shared-link":null!=this.props.sharedLinkInfo}),S({className:"react-title-bar"},S({className:t},this._renderCornerIcon(),S({className:"react-title-bar__divider u-mar-vertical-xs"}),this._renderFileIcon(),this._renderFileInfo()),S({className:"react-title-bar__fileaction-wrap"},this._renderSeenStates(),this._renderFileActions()))}})})}.call(this),function(){define("modules/clean/react/file_viewer/toggle_comments",["external/classnames","external/react","modules/clean/comments/store","modules/clean/components/title_bubble","modules/clean/react/file_viewer/actions","modules/clean/comments/action_creators","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,i,o,r,s,a){var l,u,c,d,p,_,h;return d=a._,l=t.createFactory(s),u=t.createFactory(i),h=t.DOM,_=h.div,p=h.button,c=t.createClass({displayName:"ToggleComments",propTypes:{areCommentsOpen:t.PropTypes.bool.isRequired},getInitialState:function(){return this._getStateFromStore()},componentDidMount:function(){return this._unsubscribe=n.listen(this._onStoreChange)},componentWillUnmount:function(){return"function"==typeof this._unsubscribe?this._unsubscribe():void 0},_getStateFromStore:function(){return{isStoreInitialized:n.isStoreInitialized(),isCommentingEnabled:n.isCommentingEnabled(),isCommentingReady:n.isFileActivityReady(),canEnableComments:n.canEnableComments()}},_onStoreChange:function(){return this.setState(this._getStateFromStore())},_onShowCommentsClick:function(){return o.openComments(),r.setShowCommentsPanePref(!0)},_onHideCommentsClick:function(){return o.closeComments(),r.setShowCommentsPanePref(!1)},render:function(){var t,n,i;if(!this.state.isStoreInitialized||this.state.isCommentingReady&&!this.state.isCommentingEnabled){if(!this.state.canEnableComments)return _();t=d("Comments are disabled"),i=l({group:"web",name:"control_comments_on",alt:t}),n=null}else this.props.areCommentsOpen?(t=d("Hide Comments"),i=l({group:"web",name:"control_comments_on",alt:t}),n=this._onHideCommentsClick):(t=d("Show Comments"),i=l({group:"web",name:"control_comments_off",alt:t}),n=this._onShowCommentsClick);return _({className:"toggle-comments u-mar-left-xs"},new u({text:t,direction:"south",className:"react-title-bar--title-bubble"},p({className:e({"button-secondary":!0,"toggle-comments__button":!0,control__button:!0,disabled:this.state.isCommentingReady&&!this.state.isCommentingEnabled}),onClick:n},i)))}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_viewer/utils",["modules/clean/ajax","modules/clean/gandalf_util","modules/clean/open_with","modules/clean/unity/check_file_cache","modules/clean/unity/features","modules/constants/legacy","modules/core/browser"],function(t,n,i,o,r,s,a){var l,u,c,d,p;return l=["photo","video"],u={isFlippableFile:function(t){var n;return n=t.preview_type,e.call(l,n)>=0},filterFlippableFiles:function(e){var t;return Array.isArray(e)?function(){var n,i,o;for(o=[],n=0,i=e.length;i>n;n++)t=e[n],this.isFlippableFile(t)&&o.push(t);return o}.call(this):[]}},c={canOpenWith:function(e,t){return n.getGandalfRule("wopi-button-visible")&&e.doc_preview_status!==s.DOC_PREVIEW_UNAVAILABLE_PROTECTED_DOC&&e.bytes<=i.MAX_SUPPORTED_FILE_SIZE_B&&null!==i.get_open_handler_for(e,t)},getOpenWithHandlerData:function(e,t){return i.get_open_handler_for(e,t)},openWith:function(e,t){var n,i;return n=this.getOpenWithHandlerData(e,t),i=n.uri+"?hpt_click_ts="+Date.now(),a.redirect(i)}},d={fetchTooltipInfo:function(e,n){var i;return i=t.AuthenticatedRequest({url:"/ow/get_available_tooltips",dataType:"json",success:function(e){return n(e)},subject_user:e})},getVendorAndApplication:function(t,n){var i,o,r,s,a;for(s in t){a=t[s];for(r in a)if(i=a[r],o=i.extensions,e.call(o,n)>=0)return{vendor:s,application:r}}return null},logImpression:function(e,n,i){return"acrobat_or_reader"===i?t.SilentBackgroundRequest({url:"/ow/log_adobe_tooltip_impression",data:{app_name:i,extension:e},subject_user:n}):t.SilentBackgroundRequest({url:"/ow/msft/log_tooltip_impression",data:{app_type:i,extension:e},subject_user:n})}},p={isUnityEnabled:function(){return null!=r},isFileInUnityCache:function(e,t){return!!o.is_cached_and_locally_available(e,t)},clientSupportsOpenInFileBrowser:function(){return r.client_supports_open_in_file_browser()},getFileInfoFromUnityCache:function(e,t){return o.get(e,t)},_fetchFileBrowserDisplayName:function(e,t){var n,i;return i=function(n){return e.file_browser_display_name=n,t(e)},n=function(){return t(e)},r.file_browser_display_name(i,n)},fetchUnityFileInfo:function(e,t,n,i,o){var s;return s=function(e){return function(t){return t.is_locally_available?e._fetchFileBrowserDisplayName(t,i):i(t)}}(this),r.check_file(e,t,n,s,o)},getUnityFileInfo:function(e,t,n,i,o){var r;return this.isFileInUnityCache(e,t)?(r=this.getFileInfoFromUnityCache(e,t),r.is_locally_available&&null==r.file_browser_display_name?this._fetchFileBrowserDisplayName(r,i):i(r)):this.fetchUnityFileInfo(e,t,n,i,o)},openFile:function(e,t,n,i){return r.open_file(e,t,n,r.standard_open_file_handler,function(e){return r.standard_open_file_handler(!1)},i)}},{FlippableHelpers:u,OpenWithHelpers:c,TooltipHelpers:d,UnityHelpers:p}})}.call(this),function(){define("modules/clean/react/flag",["external/classnames","external/underscore","external/react","modules/clean/react/css"],function(e,t,n,i){var o,r;return r=n.DOM,o=n.createClass({displayName:"Flag",propTypes:{alignment:n.PropTypes.oneOf(["top","middle","bottom"]),leftAttachment:n.PropTypes.oneOfType([n.PropTypes.element,n.PropTypes.node]),rightAttachment:n.PropTypes.oneOfType([n.PropTypes.element,n.PropTypes.node]),spacing:n.PropTypes.oneOf(["xs","s","m","l","xl"]),children:n.PropTypes.oneOfType([n.PropTypes.element,n.PropTypes.node])},getDefaultProps:function(){return{alignment:"middle"}},render:function(){var t,n,i,o,s,a;return o={"o-flag":!0},o["o-flag--"+this.props.alignment]=this.props.alignment,t=o,s={"o-flag__flex":!0},s["u-pad-left-"+this.props.spacing]=this.props.spacing&&this.props.leftAttachment,s["u-pad-right-"+this.props.spacing]=this.props.spacing&&this.props.rightAttachment,n=s,i=this.props.leftAttachment?r.div({className:"o-flag__fix"},this.props.leftAttachment):void 0,a=this.props.rightAttachment?r.div({className:"o-flag__fix"},this.props.rightAttachment):void 0,r.div({className:e(t)},i,r.div({className:e(n)},this.props.children),a)}}),o=i(o,["/static/css/scooter/scooter-scoped-vfljb_RbQ.css"])})}.call(this),function(){define("modules/clean/react/helpers",["external/immutable","external/underscore"],function(e,t){var n;return Object.is||(Object.is=function(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}),n=function(e,t){var n,i,o,r,s,a,l,u,c,d,p;if(e===t)return!0;if(s=Object.keys(e),a=Object.keys(t),s.length!==a.length)return!1;for(i=0,u=s.length;u>i;i++)if(l=s[i],d=e[l],p=t[l],Array.isArray(d)&&Array.isArray(p)){if(d.length!==p.length)return!1;for(o=r=0,c=d.length;c>r;o=++r)if(n=d[o],d[o]!==p[o])return!1}else if(!Object.is(d,p))return!1;return!0},{compareStateAndProps:function(e,n){return!t.isEqual(this.state,n)||!t.isEqual(this.props,e)},shallowCompareStateAndProps:function(e,t){return!n(this.state,t)||!n(this.props,e)}}})}.call(this),function(){define("modules/clean/react/hidden",["external/react","external/underscore"],function(e,t){var n,i,o,r;return r=e.DOM,o=e.createElement,n=e.createClass({displayName:"Hidden",render:function(){return r.div({hidden:!0,style:{display:"none"}},this.props.children)}}),i=e.createClass({displayName:"HiddenSelect",propTypes:{options:e.PropTypes.arrayOf(e.PropTypes.any).isRequired,value:e.PropTypes.any},render:function(){var e;return o(n,{},r.select(t.omit(this.props,"options"),function(){var t,n,i,o;for(i=this.props.options,o=[],t=0,n=i.length;n>t;t++)e=i[t],o.push(r.option({key:e,label:e,value:e}));return o}.call(this)))}}),{Hidden:n,HiddenSelect:i}})}.call(this),function(){define("modules/clean/react/image",["external/react","external/underscore","modules/core/exception"],function(e,t,n){var i,o,r,s;return o=n.assert,r=e.DOM,s=function(e){return-1!==e.indexOf("-vfl")},i=e.createClass({displayName:"Image",propTypes:{alt:e.PropTypes.string,src:e.PropTypes.string.isRequired,srcHiRes:e.PropTypes.string.isRequired,onLoad:e.PropTypes.func,className:e.PropTypes.string,id:e.PropTypes.string,width:e.PropTypes.number,height:e.PropTypes.number},getDefaultProps:function(){return{alt:""}},render:function(){var e;return o(s(this.props.src),"Non-VFL path: "+this.props.src),o(s(this.props.srcHiRes),"Non-VFL path: "+this.props.srcHiRes),e={src:this.props.src,srcSet:this.props.srcHiRes+" 2x",alt:this.props.alt,id:this.props.id,className:this.props.className,onLoad:this.props.onLoad,width:this.props.width,height:this.props.height},t.extend(e,t.pick(this.props,function(e,t){return t.match(/^(aria|data)-/)})),r.img(e)}})})}.call(this),function(){define("modules/clean/react/modal",["external/react","jquery","modules/core/i18n","modules/core/dom","modules/clean/react/button","modules/clean/keycode"],function(e,t,n,i,o,r){var s,a,l,u,c,d,p;return u=n._,p=e.DOM,d=e.addons.classSet,s="react-modal-root",c=function(e){var n,i;return null==e&&(e=!0),n=s,i=t("#"+n),!i.length&&e&&(i=t("<div />").attr({id:n}).prependTo("body")),i[0]},a=e.createClass({displayName:"Modal",statics:{showInstance:function(n,i){var o;return null==i&&(i=!0),o=c(),i&&(e.unmountComponentAtNode(o),t(o).siblings().attr("aria-hidden",!0)),e.render(n,o)},close:function(n){var i;return i=c(),i?(e.unmountComponentAtNode(i),t(i).siblings().attr("aria-hidden",!1),null!=n?n.focus():void 0):void 0},unhide:function(){var e;return e=c(),e?t(e).show():void 0},hide:function(){var e;return e=c(),e?t(e).hide():void 0}},propTypes:{width:e.PropTypes.number,submitting:e.PropTypes.bool,title:e.PropTypes.string,acceptButtonText:e.PropTypes.string,dismissButtonText:e.PropTypes.string,acceptButtonImportance:e.PropTypes.string,additionalButtonsText:e.PropTypes.array,additionalButtonsHandler:e.PropTypes.func,altAction:e.PropTypes.node,headerId:e.PropTypes.string,onAccept:e.PropTypes.func,onDismiss:e.PropTypes.func,onDismissCompleted:e.PropTypes.func,onShow:e.PropTypes.func,buttonComponent:e.PropTypes.element,autoClose:e.PropTypes.bool,clickOutToClose:e.PropTypes.bool,showX:e.PropTypes.bool,acceptButtonDisabled:e.PropTypes.bool,dismissButtonDisabled:e.PropTypes.bool,autoFocusPrimaryInput:e.PropTypes.bool,style:e.PropTypes.oneOf(["default","clean","simple","lightbox","bare"]),setMaxHeight:e.PropTypes.bool,className:e.PropTypes.string},close:function(){return a.close(this.elementToFocusOnClose);
},_invokeCallbackAndClose:function(e,t,n){return null!=e&&"function"==typeof e.call&&e.call(this,t),t.isDefaultPrevented()?void 0:this.props.autoClose||n?this.close():void 0},_dismiss:function(e){var t;return this._invokeCallbackAndClose(this.props.onDismiss,e,!0),null!=(t=this.props.onDismissCompleted)&&"function"==typeof t.call?t.call(this,e):void 0},_accept:function(e){return this._invokeCallbackAndClose(this.props.onAccept,e,!1)},_additionalButtonPressed:function(e,t){var n;return"function"==typeof(n=this.props).additionalButtonsHandler&&n.additionalButtonsHandler(t,e),this.close()},_onClickOnOverlay:function(e){return this.props.clickOutToClose?this._dismiss(e):void 0},getDefaultProps:function(){return{acceptButtonText:u("OK"),acceptButtonImportance:"primary",dismissButtonText:null,buttonComponent:null,headerId:"db-modal-title",onAccept:function(){},onDismiss:function(){},onShow:function(){},autoClose:!0,clickOutToClose:!0,style:"default",showX:!0,acceptButtonDisabled:!1,dismissButtonDisabled:!1,autoFocusPrimaryInput:!0}},_focus:function(){var e,n,i,o,r,s;return this.elementToFocusOnClose=document.activeElement,e=t(this.refs.modal.getDOMNode()),this.props.autoFocusPrimaryInput&&(n=e.find("input:not(:disabled)").first(),i=t(null!=(r=this.refs.primaryButton)?r.getDOMNode():void 0),o=t(null!=(s=this.refs.tertiaryButton)?s.getDOMNode():void 0),n.length?e=n:i.length&&!i.is(":disabled")?e=t(this.refs.primaryButton.getDOMNode()):o.length&&!o.is(":disabled")&&(e=t(this.refs.tertiaryButton.getDOMNode()))),e.focus()},_keyDown:function(e){return e.which===r.ESC&&this._dismiss(e),e.which!==r.BACKSPACE||i.focus_in_input()||(e.preventDefault(),this._dismiss(e)),null!=this.refs.modal?i.keepFocusIn(this.refs.modal.getDOMNode(),e):void 0},_renderButtons:function(){var e,t,n,i,r,s;if(this.props.buttonComponent)return this.props.buttonComponent;if(n=[],this.props.submitting&&n.push(p.span({className:"dbmodal-loading",key:"loading"},p.img({src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",alt:u("Loading")}))),this.props.acceptButtonText&&n.push(o.button({ref:"primaryButton",key:"primary",className:"dbmodal-button",importance:this.props.acceptButtonImportance,disabled:this.props.acceptButtonDisabled,onClick:this._accept},this.props.acceptButtonText)),this.props.dismissButtonText&&n.push(o.button({ref:"tertiaryButton",key:"tertiary-dismiss",className:"dbmodal-button",importance:"tertiary",disabled:this.props.dismissButtonDisabled,onClick:this._dismiss},this.props.dismissButtonText)),this.props.additionalButtonsText)for(s=this.props.additionalButtonsText,e=i=0,r=s.length;r>i;e=++i)t=s[e],n.push(o.button({ref:"tertiaryButton",key:"tertiary-"+e,className:"dbmodal-button",importance:"tertiary",onClick:this._additionalButtonPressed.bind(this,e)},t));return n.length?p.div({className:"db-modal-buttons"},n):void 0},_renderAltAction:function(){return this.props.altAction?p.div({className:"db-modal__alt-action"},this.props.altAction):void 0},componentDidMount:function(){var e;return t(document).trigger("modalOpened",this),i.scroll_lock_document(),t(this.refs.modal.getDOMNode()).on("keydown",this._keyDown),this._focus(),"function"==typeof(e=this.props).onShow?e.onShow():void 0},componentWillUnmount:function(){return t(document).trigger("modalClosed",this),i.scroll_unlock_document(),t(this.refs.modal.getDOMNode()).off("keydown",this._keyDown)},render:function(){var e,t,n,i;return t={"db-modal-wrapper":!0,"db-modal--clean-style":"clean"===this.props.style,"db-modal--simple-style":"simple"===this.props.style,"db-modal--lightbox-style":"lightbox"===this.props.style,"db-modal--bare-style":"bare"===this.props.style},null!=this.props.className&&(t[this.props.className]=!0),e=d(t),n=this.props.width?{width:this.props.width+"px"}:{},p.div({className:e},p.div({className:"db-modal-overlay",onClick:this._onClickOnOverlay}),p.div({ref:"modal",className:"db-modal",tabIndex:0,style:n,role:"dialog","aria-labelledby":"lightbox"===this.props.style?"":this.props.headerId},p.div({className:"db-modal-box",ref:"modalBox"},"lightbox"===(i=this.props.style)||"bare"===i?p.div({className:"db-modal-"+this.props.style},this.props.children):p.div({},this.props.showX?p.button({className:"db-modal-x",onClick:this._dismiss,"aria-label":u("Close")}):void 0,p.h2({id:"db-modal-title",className:"db-modal-title"},p.div({className:"db-modal-title-text",ref:"title"},this.props.title)),p.div({className:"db-modal-content clearfix",ref:"content"},this.props.children,this._renderButtons(),this._renderAltAction())))))}}),l={show:function(t){var n;return n={acceptButtonText:t.confirm_text,onAccept:t.confirm_callback,dismissButtonText:t.cancel_text,onDismiss:t.cancel_callback,onDismissCompleted:t.cancel_completed_callback,title:t.title_text,width:t.width,className:"simple-modal",autoClose:t.autoclose,style:t.style,onShow:t.on_show},a.showInstance(new a(n,e.DOM.div({className:"simple-modal-content",dangerouslySetInnerHTML:{__html:t.body_html}})))}},{Modal:a,SimpleModal:l,ReactModal:a}})}.call(this),function(){define("modules/clean/react/onboarding_modal",["external/react","modules/core/i18n","modules/core/exception","modules/clean/react/button","modules/clean/react/modal","modules/clean/react/slider"],function(e,t,n,i,o,r){var s,a,l,u,c,d,p,_,h,m,f,v,g,y,b,w,E,T,C,S;return E=t._,T=n.assert,a=i.button,p=o.Modal,c=r.IndicatorGroup,w=r.Slides,y=r.Slider,h=r.NavButtonGroup,S=e.DOM,C=e.addons.classSet,d=e.createFactory(p),s=e.createFactory(a),g=e.createFactory(y),b=e.createFactory(w),u=e.createFactory(c),_=e.createFactory(h),l=640,v=e.createClass({displayName:"OnboardingSlider",mixins:[e.addons.PureRenderMixin],propTypes:{width:e.PropTypes.number.isRequired,height:e.PropTypes.number,className:e.PropTypes.string,onSlideChange:e.PropTypes.func,onSlideEnd:e.PropTypes.func,initialSlideIndex:e.PropTypes.number,children:function(t,n,i){var o;return o=e.Children.count(t[n]),T(o>0,i+" has no slide to show")}},getDefaultProps:function(){return{initialSlideIndex:0}},getInitialState:function(){return{currentSlideIndex:this.props.initialSlideIndex}},isAtLastSlide:function(){return this.state.currentSlideIndex+1===this.getSlideCount()},getSlideCount:function(){return e.Children.count(this.props.children)},gotoSlide:function(e){return e!==this.state.currentSlideIndex?(T(e>=0&&e<this.getSlideCount(),"Invalid slide index: "+e),this.setState({currentSlideIndex:e},function(t){return function(){var n;return"function"==typeof(n=t.props).onSlideChange?n.onSlideChange(e):void 0}}(this))):void 0},prevSlide:function(){return this.gotoSlide(this.state.currentSlideIndex-1)},nextSlide:function(){return this.gotoSlide(this.state.currentSlideIndex+1)},render:function(){return g({className:this.props.className},b({width:this.props.width,height:this.props.height,currentSlideIndex:this.state.currentSlideIndex},this.props.children),u({slideCount:this.getSlideCount(),currentSlideIndex:this.state.currentSlideIndex,onIndicatorClick:this.gotoSlide}),_(null,this.isAtLastSlide()?s({className:"is-done",onClick:this.props.onSlideEnd},E("Got it")):s({className:"is-next",onClick:this.nextSlide},E("Next"))))}}),f=e.createFactory(v),m=e.createClass({displayName:"OnboardingModal",mixins:[e.addons.PureRenderMixin],propTypes:{className:e.PropTypes.string,onClose:e.PropTypes.func,slideWidth:e.PropTypes.number,slideHeight:e.PropTypes.number,initialSlideIndex:e.PropTypes.number},getDefaultProps:function(){return{slideWidth:l}},closeModal:function(){var e;return p.close(),"function"==typeof(e=this.props).onClose?e.onClose():void 0},render:function(){return d({acceptButtonText:null,onDismiss:this.props.onClose,style:"clean",className:this.props.className,clickOutToClose:!1},f({initialSlideIndex:this.props.initialSlideIndex,width:this.props.slideWidth,height:this.props.slideHeight,onSlideEnd:this.closeModal},this.props.children))}})})}.call(this),function(){define("modules/clean/react/paging_list",["external/react","jquery","external/underscore"],function(e,t,n){var i,o;return o=e.DOM,i=e.createClass({displayName:"PagingList",propTypes:{customClass:e.PropTypes.oneOfType([e.PropTypes.string,e.PropTypes.instanceOf(e.addons.classSet)]),itemSize:e.PropTypes.number.isRequired,pageSize:e.PropTypes.number.isRequired,threshold:e.PropTypes.number,useTranslate3d:e.PropTypes.bool},getDefaultProps:function(){return{threshold:100,useTranslate3d:!1}},getInitialState:function(){return{from:0,size:this._constrainSize(this.props.pageSize,this.props.children,0)}},componentWillReceiveProps:function(e){var t,n;return t=this._constrainFrom(this.state.from,e.children.length),n=this._constrainSize(this.state.size,e.children,t),this.setState({from:t,size:n})},componentDidMount:function(){return window.addEventListener("resize",this.updateFrame),this.getDOMNode().addEventListener("scroll",this.updateFrame),this.updateFrame()},shouldComponentUpdate:function(e,t){return!n.isEqual(e,this.props)||!n.isEqual(t,this.state)},componentDidUpdate:function(){return this.updateFrame()},componentWillUnmount:function(){return window.removeEventListener("resize",this.updateFrame),this.getDOMNode().removeEventListener("scroll",this.updateFrame)},_getScroll:function(){var e,t,n;return t=this.refs.scroller.getDOMNode().getBoundingClientRect().top,e=this.refs.container.getDOMNode().getBoundingClientRect().top,n=e-t},_setScroll:function(e){return this.refs.container.getDOMNode().scrollTop+=e-this._getScroll()},_getViewportSize:function(){return this.refs.container.getDOMNode().clientHeight},_getStartAndEnd:function(){var e,t;return t=Math.max(0,this._getScroll()-this.props.threshold),e=t+this._getViewportSize()+2*this.props.threshold,{start:t,end:e}},updateFrame:function(){var e,t,n,i,o,r;return i=this._getStartAndEnd(),r=i.start,e=i.end,n=this.props.itemSize,t=this._constrainFrom(Math.floor(r/n),this.props.children.length),o=this._constrainSize(Math.ceil((e-r)/n)+1,this.props.children,t),this.setState({from:t,size:o})},_getSpaceBefore:function(e){return e*this.props.itemSize},_constrainFrom:function(e,t){return e?Math.max(Math.min(e,t-1),0):0},_constrainSize:function(e,t,n){var i,o;return i=t.length,o=this.props.pageSize,Math.min(Math.max(e,o),i-n)},scrollTo:function(e){return this._setScroll(this._getSpaceBefore(e))},scrollAround:function(e){var t,n,i;return t=this._getScroll(),n=this._getSpaceBefore(e),t>n?this._setScroll(n):(i=n-this._getViewportSize()+this.props.itemSize,i>t?this._setScroll(i):void 0)},_renderItems:function(){var e;return e=this.state.from+this.state.size-1,this.props.children.slice(this.state.from,+e+1||9e9)},render:function(){var t,n,i,r;return n={position:"relative",height:this._getSpaceBefore(this.props.children.length)},r=this._getSpaceBefore(this.state.from),i=this.props.useTranslate3d?"translate3d(0px, "+r+"px, 0)":"translate(0px, "+r+"px)",t={MsTransform:i,WebkitTransform:i,transform:i},o.div({className:e.addons.classSet("paging-list",this.props.customClass),ref:"container"},o.div({style:n,ref:"scroller"},o.ul({style:t},this._renderItems())))}})})}.call(this),function(){define("modules/clean/react/pass/actions",["modules/clean/react/pass/constants","modules/clean/react/pass/dispatcher"],function(e,t){var n,i;return n=e.ActionTypes,new(i=function(){function e(){}return e.prototype.receivePresenceData=function(e,i,o,r){return t.dispatch({type:n.RECEIVE_PRESENCE_DATA,data:{nsId:e,sjid:i,onlineUsers:o,offlineUsers:r}})},e.prototype.updateSeenStateInfo=function(e,i,o){return t.dispatch({type:n.UPDATE_SEEN_STATE_INFO,data:{nsId:e,sjid:i,seenStateInfo:o}})},e}())})}.call(this),function(){define("modules/clean/react/pass/constants",[],function(){var e;return e={},e.ActionTypes={RECEIVE_PRESENCE_DATA:"RECEIVE_PRESENCE_DATA",UPDATE_SEEN_STATE_INFO:"UPDATE_SEEN_STATE_INFO"},e})}.call(this),function(){define("modules/clean/react/pass/dispatcher",["modules/clean/flux/dispatcher"],function(e){return e})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function i(){this.constructor=e}for(var o in t)n.call(t,o)&&(e[o]=t[o]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},n={}.hasOwnProperty;define("modules/clean/react/pass/event_bus_queue",["jquery","external/underscore","modules/clean/event_emitter","modules/constants/env","modules/core/uri"],function(n,i,o,r,s){var a,l;return a=function(){function t(t,n){this.getDelay=e(this.getDelay,this),this.fail=e(this.fail,this),this.reset=e(this.reset,this),this.numberOfRetries=0,this.slotTime=t,this.maxExponent=Math.floor(Math.log(n/this.slotTime)/Math.log(2))}return t.prototype.reset=function(){return this.numberOfRetries=0},t.prototype.fail=function(){return this.numberOfRetries+=1},t.prototype.getDelay=function(){var e,t;return t=Math.min(Math.floor(this.numberOfRetries*Math.sqrt(this.numberOfRetries)),this.maxExponent),e=Math.floor(Math.random()*Math.pow(2,t))*this.slotTime},t}(),l=function(o){function l(t){this._handlePollError=e(this._handlePollError,this),this._handlePollSuccess=e(this._handlePollSuccess,this),this._longPoll=e(this._longPoll,this),l.__super__.constructor.call(this),this.queueInfo=t,this.host=r.HARMONY_SERVER,this.backoff=new a(100,3e5),this.lastEventId="-1"}return t(l,o),l.prototype.start=function(){return this._started?void 0:(this._started=!0,this._longPoll())},l.prototype.end=function(){return this._started=!1,null!=this._longPollXhr?this._longPollXhr.abort():i.defer(function(e){return function(){return e.emit("close")}}(this))},l.prototype._longPoll=function(){var e,t,i,o;if(this._started)return i=this.queueInfo.queue_id,o=this.queueInfo.queue_token,t=window.btoa(i+":"+o),e=s({scheme:"https",authority:this.host,path:"/api/v1/events"}),this._longPollXhr=n.ajax({contentType:"application/json",url:e.toString(),type:"POST",processData:!1,data:JSON.stringify({last_event_id:this.lastEventId}),timeout:6e4,beforeSend:function(e){return e.setRequestHeader("HTTP-X-EVENTQUEUE-AUTHORIZATION","Basic "+t)},success:this._handlePollSuccess,error:this._handlePollError})},l.prototype._handlePollSuccess=function(e){return e=JSON.parse(e),this._longPollXhr=null,"success"===e.result&&null!=e.events&&e.events.length>0?(this.emit("poll"),this.backoff.reset(),i.defer(this._longPoll),this.lastEventId=e.events[e.events.length-1].id,"heartbeat"!==e.events[0].type?this.emit("events",e.events):void 0):(console.warn("EventBusQueue: longpoll error:",e),this.backoff.fail(),window.setTimeout(this._longPoll,this.backoff.getDelay()))},l.prototype._handlePollError=function(e,t){return this._longPollXhr=null,this._started?e.status>=400&&e.status<500?(this.emit("error",e.status),this.emit("close",!0)):(console.warn("EventBusQueue: longpoll error:",t,e.status),this.backoff.fail(),window.setTimeout(this._longPoll,this.backoff.getDelay())):this.emit("close",!1)},l}(o)})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/react/pass/store",["external/underscore","modules/clean/flux/flux_store","modules/clean/react/pass/constants","modules/clean/react/pass/dispatcher"],function(t,n,i,o){var r,s;return r=i.ActionTypes,new(s=function(n){function i(e){i.__super__.constructor.call(this,e),this._seenStateInfos={},this._presence={}}return e(i,n),i.prototype.presence=function(e,t){var n;return n=this._fileKey(e,t),n in this._presence?this._presence[n]:null},i.prototype.seenStateInfo=function(e,t){var n;return n=this._fileKey(e,t),this._seenStateInfos[n]||null},i.prototype._fileKey=function(e,t){return e+":"+t},i.prototype._receivePresenceData=function(e,n,i,o){var r,s,a;return r=this._fileKey(e,n),s=t.difference(this._presence[r],o),a=t.union(s,i),this._presence[r]=a,this.__emitChange()},i.prototype._updateSeenStateInfo=function(e,t,n){return this._seenStateInfos[this._fileKey(e,t)]=n,this.__emitChange()},i.prototype.__onDispatch=function(e){var t;switch(t=e.action.data,e.action.type){case r.RECEIVE_PRESENCE_DATA:return this._receivePresenceData(t.nsId,t.sjid,t.onlineUsers,t.offlineUsers);case r.UPDATE_SEEN_STATE_INFO:return this._updateSeenStateInfo(t.nsId,t.sjid,t.seenStateInfo)}},i}(n))(o)})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/pass/utils",["external/underscore","modules/clean/ajax","modules/clean/api_v2/client","modules/clean/react/pass/event_bus_queue","modules/core/exception","modules/clean/react/pass/actions","modules/clean/viewer"],function(t,n,i,o,r,s,a){var l,u,c;return l=i.ApiV2Client,u={PRESENCE_STATES:{OFFLINE:"offline",VIEWER:"viewer",MODIFIER:"modifier",IDLE:"idle"},_eventBusQueue:null,_queueInfo:null,_isOnline:function(n){return r.assert(e.call(t.values(this.PRESENCE_STATES),n)>=0,"Status "+n+" is invalid."),n===this.PRESENCE_STATES.VIEWER||n===this.PRESENCE_STATES.MODIFIER||n===this.PRESENCE_STATES.IDLE},_parsePresenceData:function(t){var n,i,o,r,s,l;for(r=[],o=[],n=0,i=t.length;i>n;n++)s=t[n],l=s.user_id,e.call(a.get_viewer().get_user_ids(),l)<0&&(this._isOnline(s.status)&&e.call(r,l)<0?r.push(l):!this._isOnline(s.status)&&e.call(o,l)<0&&o.push(l));return{onlineUsers:r,offlineUsers:o}},shutdownPresence:function(){return null!=this._eventBusQueue?(this._eventBusQueue.end(),delete this._eventBusQueue,delete this._queueInfo):void 0},updatePresence:function(e,t,i,r,s){return n.AuthenticatedRequest({url:"/update_presence/update_web_presence",dataType:"json",data:{ns_id:e,sjid:t,status:r,queue_id:null!=this._queueInfo?this._queueInfo.queue_id:null},success:function(n){return function(a){var l;return null!=n._queueInfo&&n._queueInfo.queue_id!==!a.bolt_data.queue_id||(n.shutdownPresence(),n._eventBusQueue=new o(a.bolt_data),n._eventBusQueue.start(),n._eventBusQueue.on("events",function(i){var o;return o=n._parsePresenceData(i),"function"==typeof s?s(e,t,o.onlineUsers,o.offlineUsers):void 0}),n._eventBusQueue.on("error",function(o){return 403===o?(n.shutdownPresence(),n.updatePresence(e,t,i,r,s)):void 0}),n._queueInfo=a.bolt_data),n._isOnline(r)?(l=n._parsePresenceData(a.presence_data),"function"==typeof s?s(e,t,l.onlineUsers,l.offlineUsers):void 0):void 0}}(this),subject_user:i})}},c={fetchSeenStateInfo:function(e,t,n,i){var o,r;return o="sjid:"+n,r=(new l).rpc(e,"seen_state/get_seen_state_info",{file_infos:[{ns_id:t,file_identifier:o,url:i}]}).then(function(e){var i;return i=e[0].seen_state_info,s.updateSeenStateInfo(t,n,i)})},filterSeenStates:function(t,n){var i,o,r,s,a,l,u;for(i=[],a={},o=0,r=t.length;r>o;o++)u=t[o],l=u.seen_activity_user,null==u.when_last_seen||(s=l.id,e.call(n.get_user_ids(),s)>=0)||l.paired_user_id in a||(i.push(u),a[l.id]=!0);return i},orderSeenStates:function(t,n){return t.sort(function(t,i){var o,r;if(null!=n){if(o=t.seen_activity_user.id,e.call(n,o)>=0)return-1;if(r=i.seen_activity_user.id,e.call(n,r)>=0)return 1}return t.when_last_seen>i.when_last_seen?-1:1}),t}},{PresenceHelpers:u,SeenStateHelpers:c}})}.call(this),function(){define("modules/clean/react/previews/audio/preview_audio",["external/classnames","external/react","external/underscore","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/average_counter","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/previews/audio/preview_audio_play_button","modules/clean/react/previews/audio/preview_audio_details","modules/clean/react/previews/audio/preview_audio_visuals","modules/clean/react/previews/audio/preview_audio_volume","modules/clean/react/previews/audio/utils","modules/clean/web_timing_logger"],function(e,t,n,i,o,r,s,a,l,u,c,d,p,_,h,m,f){var v,g,y,b,w,E,T,C,S,k,I,A,P,N,R,O,D,x,L;return D=o._,E=l.EventTypes,T=c.FilePreviewSession,A=m.PreviewAudioHelpers,O=m.PreviewAudioWaveformHelpers,x=t.DOM,L=t.PropTypes,N=t.createFactory(_),P=t.createFactory(d),I=t.createFactory(p),R=t.createFactory(h),g=2,v=1,S=1e3,y=100,C=.85,b=500,w="dropbox_duc_id",k=t.createClass({displayName:"PreviewAudio",propTypes:{src:L.string.isRequired,"log-time-to-interactive":L.bool,onError:L.func},getInitialState:function(){return{time:0,duration:0,bufferedLength:0,isPlaying:!1,isReady:!1,isMuted:!1,volumeLevel:1,rawWaveformHeights:[],waveformWidth:0,isContainerSet:!1}},componentDidMount:function(){var e;return this._logPreviewEvent(E.FILE_PREVIEW_SUPPORT_CONFIRMED),e=this._getAudioNode(),e.addEventListener("timeupdate",this._updateTime),e.addEventListener("durationchange",this._updateDuration),e.addEventListener("ended",this._pauseFile),e.addEventListener("canplay",this._setReady),e.addEventListener("progress",this._updateProgress),e.addEventListener("error",this._throwError),this._setWaveformWidth(),window.addEventListener("resize",this._getDebouncedWaveformWidthFunction()),this._sendWaveFormRequest()},componentWillUnmount:function(){var e,t;return e=this._getAudioNode(),e.removeEventListener("timeupdate",this._updateTime),e.removeEventListener("durationchange",this._updateDuration),e.removeEventListener("ended",this._pauseFile),e.removeEventListener("canplay",this._setReady),e.removeEventListener("progress",this._updateProgress),e.removeEventListener("error",this._throwError),window.removeEventListener("resize",this._getDebouncedWaveformWidthFunction()),null!=(null!=(t=this._audioContext)?t.close:void 0)?this._audioContext.close():void 0},_logPreviewEvent:function(e){return u.emit(e,T.currentSession)},_getAudioNode:function(){return this.refs.audio.getDOMNode()},_getDebouncedWaveformWidthFunction:function(){return this._debouncedWaveformWidthFunction||(this._debouncedWaveformWidthFunction=n.debounce(this._setWaveformWidth,100)),this._debouncedWaveformWidthFunction},_setWaveformWidth:function(){return this.isMounted()?this.setState({waveformWidth:this.refs.audioWrapper.getDOMNode().offsetWidth}):void 0},_getSrcUrl:function(){var e,t;return e=s.parse(this.props.src),e.updateQuery("duc_id",w),t=e.toString(),"//"===t.slice(0,2)&&(t="https:"+t),t},_setReady:function(){return this.props["log-time-to-interactive"]&&(f.mark_time_to_view(),f.mark_time_to_interactive()),this.setState({isReady:!0}),this._logPreviewEvent(E.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),this._logPreviewEvent(E.FILE_PREVIEW_RENDER_SUCCEEDED),setTimeout(this._setContainer.bind(this),b)},_setContainer:function(){return this.setState({isContainerSet:!0})},_getBufferProgress:function(){var e;return e=this._getAudioNode(),e.duration&&e.buffered.length?e.buffered.end(e.buffered.length-1):0},_updateProgress:function(){var e;return e=this._getBufferProgress(),this.setState({bufferedLength:e})},_updateTime:function(){return this.setState({time:this._getAudioNode().currentTime})},_updateTimeTo:function(e){return this._getAudioNode().currentTime=e,this.setState({time:e})},_updateDuration:function(){var e;return e=this._getBufferProgress(),this.setState({duration:this._getAudioNode().duration,bufferedLength:e})},_playOrPause:function(){return this.state.isPlaying?this._pauseFile():this._playFile()},_playFile:function(){return this._getAudioNode().play(),this.setState({isPlaying:!0})},_pauseFile:function(){return this._getAudioNode().pause(),this.setState({isPlaying:!1})},_toggleMute:function(){var e,t;return t=this.state.isMuted?this.state.volumeLevel||.1:0,this._getAudioNode().volume=t,e={isMuted:!this.state.isMuted},0===this.state.volumeLevel&&(e.volumeLevel=t),this.setState(e)},_changeVolumeTo:function(e){return this._getAudioNode().volume=e,this.setState({volumeLevel:e,isMuted:!e})},_sendWaveFormRequest:function(){var e;return this._setAudioContext(),null==this._audioContext?this._logFailedWaveformGeneration():(e=new XMLHttpRequest,e.open("GET",this._getSrcUrl()),e.responseType="arraybuffer",e.withCredentials=!0,e.onreadystatechange=function(t){return function(){return 4===e.readyState&&t.isMounted()?200===e.status?t._audioContext.decodeAudioData(e.response,t._parseWaveFormBuffer,t._logFailedWaveformGeneration):t._logFailedWaveformGeneration():void 0}}(this),e.send())},_throwError:function(){return r.error(D("An audio error occurred")),i.reportException({err:new Error("Audio file failed to play"),tags:["audioPreviews"],severity:i.SEVERITY.NONCRITICAL}),this._logPreviewEvent(E.FILE_PREVIEW_DOWNLOAD_FAILED),this.props.onError()},_updateWaveformState:function(e){return this.isMounted()?this.setState({rawWaveformHeights:e}):void 0},_logFailedWaveformGeneration:function(){return i.reportException({err:new Error("Audio could not be decoded"),tags:["audioPreviews"],severity:i.SEVERITY.NONCRITICAL})},_parseWaveFormBuffer:function(e){return this._setWaveformWidth(),O.buildFromBuffer(e,S,y,this.isMounted.bind(this),this._updateWaveformState)},_setAudioContext:function(){var e;return e=window.AudioContext||window.webkitAudioContext,e?this._audioContext=new e:void 0},_renderAudioTag:function(){return x.audio({src:this._getSrcUrl(),preload:"auto",ref:"audio"})},_generateWaveform:function(){var e;return e=Math.floor((this.state.waveformWidth-v)/(g+v)),O.returnWaveform(this.state.rawWaveformHeights,e,C)},_renderRadio:function(){var t,n;return n=0!==this.state.rawWaveformHeights.length,t=e({"preview-audio__radio":!0,"preview-audio__radio--hidden":!this.state.isReady||n}),x.div({className:t},A.getRadioImage())},_renderLoading:function(){return x.div({className:"preview-audio__load-wheel"},A.getLoaderWheel())},_renderWaveForm:function(){return N({generateWaveform:this._generateWaveform,time:this.state.time,duration:this.state.duration,bufferedLength:this.state.bufferedLength,updateTime:this._updateTimeTo,barWidth:g,barSpacing:v,waveformWidth:this.state.waveformWidth,isWaveformReady:0!==this.state.rawWaveformHeights.length,isPlayerReady:this.state.isReady,isContainerSet:this.state.isContainerSet})},_renderToolbar:function(){return x.div({className:"toolbar"},this._renderPlayButton(),this._renderDetails(),this._renderVolume())},_renderPlayButton:function(){return P({isPlaying:this.state.isPlaying,onChange:this._playOrPause})},_renderDetails:function(){return I({time:this.state.time,duration:this.state.duration})},_renderVolume:function(){return R({isMuted:this.state.isMuted,volumeLevel:this.state.volumeLevel,onVolumeChange:this._changeVolumeTo,onMuteToggle:this._toggleMute})},render:function(){var t;return t=e({"preview-audio__container":!0,"preview-audio__container--loading":!this.state.isReady}),x.div({className:"flex-preview-container"},x.div({className:"preview-audio preview-content preview-content--center"},x.div({className:"preview-audio__wrapper",ref:"audioWrapper"},x.div({className:"preview-audio__aspect-container"},x.div({className:t},this._renderAudioTag(),this._renderRadio(),this.state.isReady?[this._renderWaveForm(),this._renderToolbar()]:this._renderLoading())))))}})})}.call(this),function(){define("modules/clean/react/previews/audio/preview_audio_details",["external/react","modules/clean/datetime","modules/core/i18n"],function(e,t,n){var i,o,r,s,a;return s=t.formatAudioTime,o=n._,r=e.DOM,a=e.PropTypes,i=e.createClass({displayName:"PreviewAudioDetails",propTypes:{time:a.number.isRequired,duration:a.number.isRequired},_formatString:function(e){return o("%(time)s").format({time:s(e)})},_getDisplayString:function(){return r.span({className:"toolbar-details__time"},this._formatString(this.props.time)+" / "+this._formatString(this.props.duration))},render:function(){return r.div({className:"toolbar-details vertical-align"},r.div({className:"toolbar-details__string vertical-align__child"},this._getDisplayString()))}})})}.call(this),function(){define("modules/clean/react/previews/audio/preview_audio_play_button",["external/react","modules/clean/react/previews/audio/utils"],function(e,t){var n,i,o,r;return i=t.PreviewAudioHelpers,o=e.DOM,r=e.PropTypes,n=e.createClass({displayName:"PreviewAudioControls",propTypes:{isPlaying:r.bool.isRequired,onChange:r.func.isRequired},_getIconString:function(){return this.props.isPlaying?"pause":"play"},_renderButtonImage:function(){return i.getSprite(this._getIconString())},render:function(){return o.button({className:"toolbar-controller vertical-align",onClick:this.props.onChange},o.div({className:"toolbar-controller__button vertical-align__child"},this._renderButtonImage()))}})})}.call(this),function(){define("modules/clean/react/previews/audio/preview_audio_visuals",["external/classnames","external/react"],function(e,t){var n,i,o,r;return o=t.DOM,r=t.PropTypes,n=.4,i=t.createClass({displayName:"PreviewAudioVisuals",propTypes:{generateWaveform:r.func.isRequired,time:r.number.isRequired,duration:r.number.isRequired,bufferedLength:r.number.isRequired,updateTime:r.func.isRequired,barWidth:r.number.isRequired,barSpacing:r.number.isRequired,waveformWidth:r.number.isRequired,isWaveformReady:r.bool.isRequired,isPlayerReady:r.bool.isRequired,isContainerSet:r.bool.isRequired},getInitialState:function(){return{scrubPercentage:0,isMouseDown:!1}},_getSeekPercentageFromEvent:function(e){var t,n;return t=this.refs.waveform.getDOMNode().getBoundingClientRect(),n=e.pageX-t.left,n/t.width},_getProgress:function(){return this.props.time/(this.props.duration||1)},_getBuffered:function(){return this.state.scrubPercentage>0?this.state.scrubPercentage:this.props.isContainerSet?this.props.bufferedLength/(this.props.duration||1):0},_getWidthObject:function(e){return{width:e+"%"}},_scrubTime:function(e){var t;return t=this._getSeekPercentageFromEvent(e),this._updateWaveformScrubToPercentage(t),this.state.isMouseDown?this._updateTime(e):void 0},_resetScrub:function(){return this._updateWaveformScrubToPercentage(0),this._setMouseUp()},_updateWaveformScrubToPercentage:function(e){return this.setState({scrubPercentage:e})},_updateTime:function(e){var t,n;return n=this._getSeekPercentageFromEvent(e),t=n*this.props.duration,this.props.updateTime(t)},_setMouseDown:function(){return this.setState({isMouseDown:!0})},_setMouseUp:function(){return this.setState({isMouseDown:!1})},_getScrubObject:function(e){return{onClick:this._updateTime,onMouseMove:this._scrubTime,onMouseLeave:this._resetScrub,onMouseDown:this._setMouseDown,onMouseUp:this._setMouseUp,className:e}},_getWavebarClasses:function(t){return e({wavebar__single:!0,"wavebar__single--scrubbed":t})},_renderWaveBar:function(e,t){var n,i,r,s,a,l,u;return s=1-e,l={top:100*s+"%",height:100*e+"%"},u=this.props.waveformWidth,n=(t+1)*(this.props.barWidth+this.props.barSpacing)-this.props.barWidth,this.state.scrubPercentage>0?(a=this.state.scrubPercentage*u,i=this._getWavebarClasses(a>n)):(r=this._getProgress()*u,i=this._getWavebarClasses(r>n)),[o.div({className:"wavebar__single wavebar__space"}),o.div({className:i,style:l})]},_renderWaveBars:function(){var t,n,i,r;return n=e({wavebar__container:!0,"wavebar__container--ready":this.props.isWaveformReady}),i=this.props.isWaveformReady?this._getScrubObject(n):{className:n},o.div(i,function(){var e,n,i,o;for(i=this.props.generateWaveform(),o=[],r=e=0,n=i.length;n>e;r=++e)t=i[r],o.push(this._renderWaveBar(t,r));return o}.call(this))},_renderWaveForm:function(){var e;return e=this.props.isWaveformReady?this._getWidthObject(100*this.state.scrubPercentage):this._getWidthObject(0),o.div({className:"waveform"},o.div({className:"waveform__scrub",style:e,ref:"waveformScrub"}),this._renderWaveBars())},_renderProgressBar:function(){var t,n,i;return i=100*this._getProgress(),t=100*this._getBuffered(),n=e({"audio-progress-bar__done":!0,"audio-progress-bar__showing":i}),o.div(this._getScrubObject("audio-progress-bar"),o.div({className:"audio-progress-bar__buffered",style:this._getWidthObject(t)}),o.div({className:n,style:this._getWidthObject(i)}))},render:function(){return o.div({className:"visuals",ref:"waveform"},this._renderWaveForm(),this._renderProgressBar())}})})}.call(this),function(){define("modules/clean/react/previews/audio/preview_audio_volume",["external/react","modules/clean/react/previews/audio/utils"],function(e,t){
var n,i,o,r;return n=t.PreviewAudioHelpers,o=e.DOM,r=e.PropTypes,i=e.createClass({displayName:"PreviewAudioVolume",propTypes:{isMuted:r.bool.isRequired,volumeLevel:r.number.isRequired,onVolumeChange:r.func.isRequired,onMuteToggle:r.func.isRequired},getInitialState:function(){return{isMouseDown:!1}},_setMouseDown:function(){return this.setState({isMouseDown:!0})},_setMouseUp:function(){return this.setState({isMouseDown:!1})},_getVolumePercentageFromEvent:function(e){var t,n;return n=this.refs.volumebar.getDOMNode().getBoundingClientRect(),t=e.pageX-n.left,t/n.width},_safeChangeVolume:function(e){return this.state.isMouseDown?this._changeVolume(e):void 0},_changeVolume:function(e){var t;return t=this._getVolumePercentageFromEvent(e),this.props.onVolumeChange(t)},_getIconString:function(){return this.props.isMuted?"volumeMuted":"volume"},_renderVolumeImage:function(){var e;return e=n.getSprite(this._getIconString()),o.div({className:"toolbar-volume__button vertical-align__child"},o.button({onClick:this.props.onMuteToggle},e))},_renderVolumeBar:function(){var e,t;return t=this.props.isMuted?0:100*this.props.volumeLevel,e={width:t+"%"},o.div({className:"volume-bar vertical-align__child",onMouseUp:this._setMouseUp,onMouseDown:this._setMouseDown,onMouseLeave:this._setMouseUp,onMouseMove:this._safeChangeVolume,onClick:this._changeVolume},o.div({className:"volume-bar__container",ref:"volumebar"},o.div({className:"volume-bar__selected",style:e})))},render:function(){return o.div({className:"toolbar-volume vertical-align"},this._renderVolumeImage(),this._renderVolumeBar())}})})}.call(this),function(){define("modules/clean/react/previews/audio/utils",["external/react","external/underscore","modules/clean/average_counter","modules/clean/react/image","modules/clean/react/sprite","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,i,o,r,s){var a,l,u,c;return c=r.static_url,u=s._,a={getSprite:function(e){var t;return t=u("%(state)s").format({state:e}),o({group:"web",name:e,alt:t})},getLoaderWheel:function(){return i({src:c("/static/images/icons/spinner-blue-overlay-vflLgNAM7.gif"),srcHiRes:c("/static/images/icons/spinner-blue-overlay@2x-vflpi64gx.gif")})},getRadioImage:function(){return i({src:c("/static/images/icons/waveformEmpty-vflZHW9X-.png"),srcHiRes:c("/static/images/icons/waveformEmpty@2x-vflZvenXO.png")})}},l={buildFromBuffer:function(e,t,i,o,r){var s,a,l;return a=e.getChannelData(0),l=new Array(t),s=function(e){return function(){var u,c,d,p,_,h;return e>=t?void r(l):(d=Math.ceil(e*a.length/t),c=Math.ceil((e+1)*a.length/t),_=c-d,p=_>i?function(){var e,t,n;for(n=[],h=e=0,t=i;t>=0?t>e:e>t;h=t>=0?++e:--e)n.push(Math.abs(a[parseInt(Math.random()*_)+d]));return n}():a.slice(d,c),u=new n,u.addArray(p),l[e]=u.getAverage(),o()?setTimeout(s(e+1),0):void 0)}},setTimeout(s(0),0)},returnWaveform:function(e,i,o){var r,s,a,l,u,c,d,p,_,h,m;if(null==o&&(o=1),h=[],0===e.length||0>=i)return h;for(l=0,p=0,s=function(){var e,t,o;for(o=[],m=e=0,t=i;t>=0?t>e:e>t;m=t>=0?++e:--e)o.push(new n);return o}(),u=c=0,d=e.length;d>c;u=++c)_=e[u],a=Math.floor(u*i/e.length),r=s[a],r.add(_),h[a]=r.getAverage(),a!==p&&(l=Math.max(l,h[p]),p=a);return l=Math.max(l,h[i-1]),t.map(h,function(e){return e*o/l})},generateRandomWaveform:function(e){var t;return function(){var n,i,o;for(o=[],t=n=0,i=e;i>=0?i>n:n>i;t=i>=0?++n:--n)o.push(Math.random());return o}()}},{PreviewAudioHelpers:a,PreviewAudioWaveformHelpers:l}})}.call(this),function(){define("modules/clean/react/previews/image_helpers",["modules/clean/photos/thumbnail_url_util"],function(e){var t,n,i;return i=e.thumbnailUrlForSize,t=[[480,320],[640,480],[800,600],[1024,768],[1280,960],[1600,1200],[2048,1536]],n={IMG_SIZES_ATTR:"90vw",getSrcSet:function(e){return t.map(function(t){var n,o;return o=t[0],n=t[1],i(e,o,n,3)+(" "+o+"w")}).join(", ")},getFallbackSrc:function(e){return i(e,800,600,3)},preloadImage:function(e){var t;t=new Image,t.srcset=this.getSrcSet(e),t.sizes=this.IMG_SIZES_ATTR,t.src=this.getFallbackSrc(e)}}})}.call(this),function(){define("modules/clean/react/previews/password_component",["external/react"],function(e){var t,n,i,o;return o=e.DOM,i=o.input,n=o.form,t=e.createClass({displayName:"PasswordComponent",propTypes:{onPasswordSubmit:e.PropTypes.func.isRequired},_handleSubmit:function(e){var t,n;return e.preventDefault(),n=this.refs.password.getDOMNode().value,n&&"function"==typeof(t=this.props).onPasswordSubmit?t.onPasswordSubmit(n):void 0},render:function(){return n({className:"preview-blank-title",onSubmit:this._handleSubmit},[i({ref:"password",type:"password",defaultValue:"",autocomplete:"off"}),i({type:"submit",value:"Submit"})])}})})}.call(this),function(){define("modules/clean/react/previews/preview_blank",["external/react","jquery","modules/core/i18n","modules/core/uri","modules/clean/datetime","modules/clean/em_string","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/sprite"],function(e,t,n,i,o,r,s,a,l,u){var c,d,p,_,h;return c=s.EventTypes,d=l.FilePreviewSession,h=e.DOM,_=n._,p=e.createClass({displayName:"PreviewBlank",propTypes:{filename:e.PropTypes.string.isRequired,maxFilenameEmLength:e.PropTypes.number.isRequired,icon:e.PropTypes.string,created:e.PropTypes.object,size:e.PropTypes.string,isFallbackForLoadError:e.PropTypes.bool},getDefaultProps:function(){return{icon:"page_white_picture_32",isFallbackForLoadError:!1}},componentDidMount:function(){return this._logPreviewSupportDenied()},componentWillReceiveProps:function(){return this._logPreviewSupportDenied()},_logPreviewSupportDenied:function(){return this.props.isFallbackForLoadError?void 0:a.emit(c.FILE_PREVIEW_SUPPORT_DENIED,d.currentSession)},render:function(){var e;return h.div({className:"flex-preview-container"},h.div({className:"preview-content preview-content--center"},h.div({className:"preview-blank-wrapper"},h.div({className:"preview-blank-icon"},u({group:"web",name:""+this.props.icon,alt:""})),h.div({className:"preview-blank-title"},r.em_snippet(this.props.filename,this.props.maxFilenameEmLength)),h.div({className:"preview-blank-info"},null==this.props.created||isNaN(null!=(e=this.props.created)?e.getTime():void 0)?void 0:[h.span({},""+o.format_date(this.props.created,"MMMM dd, yyyy hh:mm a")),h.span({className:"bottom-dot"}," · ")],null!=this.props.size&&""!==this.props.size?h.span({},""+this.props.size):void 0))))}})})}.call(this),function(){define("modules/clean/react/previews/preview_flippable",["external/react","jquery","modules/clean/react/previews/preview_blank","modules/clean/react/previews/preview_image","modules/clean/react/previews/preview_image_with_annotations","modules/clean/react/previews/preview_video","modules/clean/react/sprite","modules/constants/comments_panel","modules/core/i18n","modules/core/uri"],function(e,t,n,i,o,r,s,a,l,u){var c,d,p,_,h,m,f;return p=i.PreviewImage,_=o.PreviewImageWithAnnotations,h=r.PreviewVideo,f=e.DOM,m=l._,c=100,d=e.createClass({statics:{isFlippable:function(e){return"photo"===e||"video"===e}},displayName:"PreviewFlippable",propTypes:{"preview-type":e.PropTypes.oneOf(["photo","video"]),"file-extension":e.PropTypes.string.isRequired,"thumbnail-url-tmpl":e.PropTypes.string.isRequired,"preview-url":e.PropTypes.string,gifUrl:e.PropTypes.string,onLoad:e.PropTypes.func,onError:e.PropTypes.func,index:e.PropTypes.number,count:e.PropTypes.number,totalFiles:e.PropTypes.number,onPrevious:e.PropTypes.func,onNext:e.PropTypes.func,"preview-url":e.PropTypes.string,"video-metadata-url":e.PropTypes.string,"file-meta":e.PropTypes.shape({filename:e.PropTypes.string,mtime:e.PropTypes.number,formattedSize:e.PropTypes.string}).isRequired},onImageLoad:function(){var e;return null!=(e=this.refs.previewImageWithAnnotations)?e._onImageLoad():void 0},componentWillMount:function(){return this.isImagePreviewAnnotationCreationEnabled=a.ALLOW_ANNOTATION_IMAGE_PREVIEWS},_onPrevious:function(){var e;return"function"==typeof(e=this.props).onPrevious?e.onPrevious():void 0},_onNext:function(){var e;return"function"==typeof(e=this.props).onNext?e.onNext():void 0},_flipLabelText:function(){var e;return e=this.props.totalFiles===c?"+":"",m("%(cur_file_num)s of %(num_total_files)s").format({cur_file_num:this.props.index+1,num_total_files:this.props.count})+e},_reactElementForPreviewType:function(i){var o,r;switch(i){case"photo":return r={"thumbnail-url-tmpl":this.props["thumbnail-url-tmpl"],"preview-url":this.props["preview-url"],"file-extension":this.props["file-extension"],"file-meta":this.props["file-meta"],gifUrl:this.props.gifUrl,onLoad:this.props.onLoad,onError:this.props.onError},this.isImagePreviewAnnotationCreationEnabled?(r=t.extend(r,{ref:"previewImageWithAnnotations",index:this.props.index,count:this.props.count,onPrevious:this._onPrevious,onNext:this._onNext,"should-display-annotations-toolbar":!0}),e.createElement(_,r)):e.createElement(p,r);case"video":return e.createElement(h,{"preview-url":this.props["preview-url"],"thumbnail-url-tmpl":this.props["thumbnail-url-tmpl"],onLoad:this.props.onLoad,index:this.props.index,count:this.props.count,onPrevious:this._onPrevious,onNext:this._onNext,shouldDisplayAnnotationsToolbar:this.isImagePreviewAnnotationCreationEnabled});default:return o=this.props["file-meta"],e.createElement(n,{filename:o.filename,created:new Date(1e3*o.mtime),size:o.formattedSize})}},render:function(){return f.div({className:"preview-flip-container"},[this._reactElementForPreviewType(this.props["preview-type"]),this.props.count>1&&!this.isImagePreviewAnnotationCreationEnabled?f.div({className:"flip-controls"},f.button({className:"flip-button-prev",onClick:this._onPrevious},s({group:"web",name:"s_flip_left",alt:m("Flip left",{comment:"Flip to the previous file in a series of files"})})),f.div({className:"flip-label"},this._flipLabelText()),f.button({className:"flip-button-next",onClick:this._onNext},s({group:"web",name:"s_flip_right",alt:m("Flip right",{comment:"Flip to the next file in a series of files"})}))):void 0])}}),{PreviewFlippable:d}})}.call(this),function(){define("modules/clean/react/previews/preview_html",["external/react","jquery","modules/clean/frame_messenger","modules/clean/previews/preview_actions_helper","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/previews/preview_toolbar","modules/clean/web_timing_logger"],function(e,t,n,i,o,r,s,a,l,u){var c,d,p,_,h,m,f,v,g,y,b,w;return m=i.PreviewActions,d=o.EventTypes,_=r.FullscreenHelpers,p=a.FilePreviewSession,g=l.ReactPreviewToolbarClass,w=e.DOM,y=w.div,b=w.iframe,h="previewhtml",c=["failed","viewer-ready"],v=e.createFactory(g),f=e.createClass({displayName:"PreviewHTML",propTypes:{src:e.PropTypes.string.isRequired,previewType:e.PropTypes.string.isRequired,isFullscreen:e.PropTypes.bool.isRequired,fileExtension:e.PropTypes.string.isRequired,onError:e.PropTypes.func,filePreviewType:e.PropTypes.number,usesFrameMessenger:e.PropTypes.bool},getDefaultProps:function(){return{onError:null,filePreviewType:"",usesFrameMessenger:!0}},_getIframeProps:function(){var e;return e={type:"text/html",src:this.props.src,sandbox:"",className:h,ref:"iframe"},this.props.usesFrameMessenger&&(e.sandbox="allow-modals allow-scripts allow-forms"),e},_handleTrustedMessageFromChild:function(e){var t;switch(e.action){case"failed":return this._logPreviewEvent(d.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),this._logPreviewEvent(d.FILE_PREVIEW_RENDER_FAILED),"function"==typeof(t=this.props).onError?t.onError():void 0;case"viewer-ready":return this._logPreviewEvent(d.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),this._logPreviewEvent(d.FILE_PREVIEW_RENDER_SUCCEEDED),this.props.isFullscreen?this._frameMessenger.postMessageToChildren("enter-fullscreen"):this._frameMessenger.postMessageToChildren("exit-viewer-fullscreen")}},componentDidMount:function(){var e,i;return this._logPreviewEvent(d.FILE_PREVIEW_SUPPORT_CONFIRMED),this.props.usesFrameMessenger&&(this._frameMessenger=new n,this._frameMessenger.configureChildMessaging("iframe."+h,this._handleTrustedMessageFromChild,c),this._frameMessenger.startListening(),_.setupFullscreen(this.props.isFullscreen),t(document).on("keydown",null!=(i=this.refs.previewToolbar)?i.onKeydown:void 0)),e=this.refs.iframe.getDOMNode(),e.onload=this._handleIframeLoad,e.onerror=this._handleIframeError},componentWillUnmount:function(){var e;return this.props.usesFrameMessenger&&(this._frameMessenger.stopListening(),t(document).off("keydown",null!=(e=this.refs.previewToolbar)?e.onKeydown:void 0),this.props.isFullscreen)?_.teardownExitFullscreenListeners():void 0},_handleIframeLoad:function(){return this._logPreviewEvent(d.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),this.props.usesFrameMessenger||this._logPreviewEvent(d.FILE_PREVIEW_RENDER_SUCCEEDED),u.mark_time_to_view(),u.mark_time_to_interactive()},_handleIframeError:function(){return this._logPreviewEvent(d.FILE_PREVIEW_DOWNLOAD_FAILED),u.mark_time_to_view(),u.mark_time_to_interactive()},_logPreviewEvent:function(e){return s.emit(e,p.currentSession)},_renderToolbar:function(){return v({actions:m,fileExtension:this.props.fileExtension,fileHref:this.props.src,filePreviewType:this.props.previewType,ref:"previewToolbar"})},render:function(){var e;return e=this._getIframeProps(),y({className:"preview-content"},b(e),this._renderToolbar())}})})}.call(this),function(){define("modules/clean/react/previews/preview_image",["external/react","external/underscore","jquery","modules/clean/analytics","modules/clean/image_cache","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/previews/preview_blank","modules/clean/react/previews/preview_image_zoom","modules/clean/react/previews/responsive_image","modules/clean/web_timing_logger","modules/core/browser","modules/core/i18n"],function(e,t,n,i,o,r,s,a,l,u,c,d,p,_,h){var m,f,v,g,y,b,w,E,T,C;return v=i.PreviewActivityLogger,m=s.EventTypes,f=l.FilePreviewSession,b=c.PreviewImageZoom,T=e.addons.classSet,C=e.DOM,E=h._,w=e.createFactory(d),g=e.createFactory(u),y=e.createClass({displayName:"PreviewImage",propTypes:{"thumbnail-url-tmpl":e.PropTypes.string.isRequired,"file-extension":e.PropTypes.string.isRequired,"file-meta":e.PropTypes.shape({filename:e.PropTypes.string,mtime:e.PropTypes.number,formattedSize:e.PropTypes.string}).isRequired,"preview-url":e.PropTypes.string,onLoad:e.PropTypes.func,onError:e.PropTypes.func,"log-time-to-interactive":e.PropTypes.bool,isFullscreen:e.PropTypes.bool},getInitialState:function(){return{imageVisible:!0,imageLoadError:!1}},_logPreviewEvent:function(e){return a.emit(e,f.currentSession)},_logOpen:function(){return v.log("open",{file_ext:this.props["file-extension"]})},_onImageLoad:function(){var e,t,i;return this._logPreviewEvent(m.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),this._logPreviewEvent(m.FILE_PREVIEW_RENDER_SUCCEEDED),t=n(".preview-image-container"),e=t.find(".preview-image"),this.props["log-time-to-interactive"]&&(p.mark_time_to_view(),p.mark_time_to_interactive()),this.setState({imageVisible:!0}),this._shouldDisableZoom()||e.off("click").on("click",this._onFullscreen),"function"==typeof(i=this.props).onLoad?i.onLoad():void 0},_onFullscreen:function(){return null!=this.props.isFullscreen?r.openFullscreen():b.open(this.props["preview-url"],this.props["file-extension"])},_onImageError:function(){var e;return this._logPreviewEvent(m.FILE_PREVIEW_DOWNLOAD_FAILED),"function"==typeof(e=this.props).onError&&e.onError(),this.setState({imageLoadError:!0})},_shouldDisableZoom:function(){return _.msie_version_at_most(9)},componentWillUnmount:function(){return null==this.props.isFullscreen?b.close():void 0},componentWillMount:function(){return this._logPreviewEvent(m.FILE_PREVIEW_SUPPORT_CONFIRMED)},componentDidMount:function(){var e;return this._logOpen(),(null!=(e=document.getElementsByClassName("preview-image")[0])?e.complete:void 0)?this._onImageLoad():void 0},componentWillReceiveProps:function(e){return this.props["thumbnail-url-tmpl"]!==e["thumbnail-url-tmpl"]?(this._logPreviewEvent(m.FILE_PREVIEW_SUPPORT_CONFIRMED),this._logOpen(),this.setState({imageVisible:!1,imageLoadError:!1})):void 0},_renderPreviewImage:function(){var e;return e={"preview-image-container":!0,"flex-preview-container":!0,"flex-preview-container--padded":!0,"image-visible":this.state.imageVisible,"zoom-disabled":this._shouldDisableZoom()},C.div({className:T(e)},C.div({className:"preview-image-wrapper preview-content"},w({thumbnailUrlTmpl:this.props["preview-url"],className:"preview-image absolute-center",onLoad:this._onImageLoad,onError:this._onImageError})))},_renderPreviewBlank:function(){var e;return e=this.props["file-meta"],g({filename:e.filename,created:new Date(1e3*e.mtime),size:e.formattedSize})},render:function(){return this.state.imageLoadError?this._renderPreviewBlank():this._renderPreviewImage()}}),{PreviewImage:y}})}.call(this),function(){define("modules/clean/react/previews/preview_image_with_annotations",["external/react","external/underscore","jquery","modules/clean/analytics","modules/clean/annotations/preview_image_annotations_toolbar","modules/clean/image_preview_util","modules/clean/image_annotations","modules/clean/photos/thumbnail_url_util","modules/clean/react/file_viewer/actions","modules/clean/react/previews/preview_blank","modules/clean/react/previews/preview_image_zoom","modules/clean/react/previews/responsive_image","modules/clean/web_timing_logger","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,n,i,o,r,s,a,l,u,c,d,p,_,h,m){var f,v,g,y,b,w,E,T,C,S,k;return v=i.PreviewActivityLogger,k=a.fullSizeUrl,b=c.PreviewImageZoom,C=e.addons.classSet,S=e.DOM,T=h._,E=1.25,f=16,w=e.createFactory(d),g=e.createFactory(u),y=e.createClass({displayName:"PreviewImageWithAnnotations",propTypes:{"thumbnail-url-tmpl":e.PropTypes.string.isRequired,"file-extension":e.PropTypes.string.isRequired,"file-meta":e.PropTypes.shape({filename:e.PropTypes.string,mtime:e.PropTypes.number,formattedSize:e.PropTypes.string}).isRequired,gifUrl:e.PropTypes.string,onLoad:e.PropTypes.func,onError:e.PropTypes.func,"log-time-to-interactive":e.PropTypes.bool,isFullscreen:e.PropTypes.bool,index:e.PropTypes.number,count:e.PropTypes.number,onPrevious:e.PropTypes.func,onNext:e.PropTypes.func,"should-display-annotations-toolbar":e.PropTypes.bool},getInitialState:function(){return this.props["should-display-annotations-toolbar"]?{imageVisible:!1,imageLoadError:!1,fullSizeImage:!1,width:"",height:"",zoomPercent:0,minimumZoomPercent:0,margin:"auto",zoomFit:!0}:{imageVisible:!1,imageLoadError:!1}},_logOpen:function(){return v.log("open",{file_ext:this.props["file-extension"]})},_onImageLoad:function(){var e;return this.fullsizeImage=null,this.$image=r.getPreviewImage(),this.props["log-time-to-interactive"]&&(p.mark_time_to_view(),p.mark_time_to_interactive()),this.setState({imageVisible:!0}),this.imageAnnotations.onImageLoad(this.switchImage,this.onResizeImage),this._shouldDisableZoom()||this.$image.off("click").on("click",this._onFullscreen),this.props["should-display-annotations-toolbar"]&&(this.fullsizeImage=new Image,this.fullsizeImage.src=k(this.props["thumbnail-url-tmpl"]),n(this.fullsizeImage).on("load",this._onFullsizeLoad)),"function"==typeof(e=this.props).onLoad?e.onLoad():void 0},_onFullscreen:function(){var e;return e={file_ext:this.props["file-extension"]},null!=this.props.isFullscreen?l.openFullscreen(e):b.open(this.props["thumbnail-url-tmpl"],this.props["file-extension"])},_onImageError:function(){var e;return"function"==typeof(e=this.props).onError&&e.onError(),this.setState({imageLoadError:!0})},_shouldDisableZoom:function(){var e;return _.msie_version_at_most(9)||(null!=(e=this.imageAnnotations)?e.isImagePreviewAnnotationCreationEnabled:void 0)},_onFullsizeLoad:function(){var e;return e=this._calculateZoomPercent(this.$image.height()),this.setState({zoomPercent:e,minimumZoomPercent:e,fullSizeImage:!0})},onResizeImage:function(){var e;return""===this.state.width&&""===this.state.height?(e=this._calculateZoomPercent(this.$image.height()),this.setState({zoomPercent:e,minimumZoomPercent:e})):void 0},_onZoom:function(e,t){var n,i,o,s,a,l,u,c,d,p,_,h,m,v,g;if(e+"px"!==this.state.width)return g=this._calculateZoomPercent(t),g<this.state.minimumZoomPercent?void this._onZoomFit():g>f?(o=f*this.fullsizeImage.naturalWidth,i=f*this.fullsizeImage.naturalHeight,void this._onZoom(o,i)):(d=this.$image.width(),p=e/d,n=r.getPreviewImageWrapper(),u=n.scrollLeft(),c=n.scrollTop(),h=n.width(),_=n.height(),a=h*(p-1)/2+u*p,l=_*(p-1)/2+c*p,v=t>=_?"0":"auto",m=e>=h?"0":"auto",s=v+" "+m,this.setState({fullSizeImage:null!=this.fullsizeImage,width:e+"px",height:t+"px",margin:s,zoomPercent:g,zoomFit:!1},function(){var e;return n.scrollLeft(a),n.scrollTop(l),this.imageAnnotations.onResize(e=!1)}))},_onZoomIn:function(){var e,t;return t=this.$image.width()*E,e=this.$image.height()*E,this._onZoom(t,e)},_onZoomOut:function(){var e,t;return t=this.$image.width()/E,e=this.$image.height()/E,this._onZoom(t,e)},_onZoomOriginalOrFit:function(){return 1===this.state.zoomPercent?this._onZoomFit():this._onZoomOriginal()},_onZoomOriginal:function(){var e,t;return t=this.$image.prop("naturalWidth"),e=this.$image.prop("naturalHeight"),this._onZoom(t,e)},_onZoomFit:function(){return""!==this.state.width?this.setState({width:"",height:"",margin:"auto",zoomFit:!0},function(){var e,t;return this.imageAnnotations.onResize(e=!1),t=this._calculateZoomPercent(this.$image.height()),this.setState({zoomPercent:t,minimumZoomPercent:t})}):void 0},_calculateZoomPercent:function(e){var t,n;if(this.fullsizeImage)return t=this.fullsizeImage.naturalHeight,e&&t?n=e/t:void 0},switchImage:function(e,t){var n;return e===this.props["thumbnail-url-tmpl"]&&(n=!0),this.setProps({"thumbnail-url-tmpl":e,onLoad:t},function(e){return function(){return n?e._onImageLoad():void 0}}(this))},componentWillUnmount:function(){var e;return null==this.props.isFullscreen&&b.close(),null!=(e=this.imageAnnotations)?e.reset():void 0},componentWillMount:function(){return this.imageAnnotations=new s},componentDidMount:function(){var e;return this._logOpen(),(null!=(e=r.getPreviewImageElement())?e.complete:void 0)?this._onImageLoad():void 0},componentWillReceiveProps:function(e){return e["thumbnail-url-tmpl"]!==this.props["thumbnail-url-tmpl"]&&(this.setState({imageVisible:!1,imageLoadError:!1}),this.props["should-display-annotations-toolbar"]&&(this.imageAnnotations.removeAnnotations(),this.setState({width:"",height:"",margin:"auto",zoomFit:!0,fullSizeImage:!1}))),this._logOpen()},_renderAnnotationsToolbar:function(){return e.createElement(o,{index:this.props.index,count:this.props.count,zoomPercent:this.state.zoomPercent,minimumZoomPercent:this.state.minimumZoomPercent,maximumZoomPercent:f,onPrevious:this.props.onPrevious,onNext:this.props.onNext,onFullscreen:this._onFullscreen,onZoomIn:this._onZoomIn,onZoomOut:this._onZoomOut,onZoomOriginalOrFit:this._onZoomOriginalOrFit})},_renderPreviewImage:function(){var e,t,n;return t={},t[""+r.PREVIEW_IMAGE_CONTAINER]=!0,t["flex-preview-container"]=!0,t["image-visible"]=this.state.imageVisible,t["annotations-visible"]=!0,t["zoom-disabled"]=this._shouldDisableZoom(),t["has-annotations-toolbar"]=this.props["should-display-annotations-toolbar"],t["zoom-fit"]=this.state.zoomFit,e=t,n=this.state.width&&this.state.height&&this.props["should-display-annotations-toolbar"]?{maxWidth:this.state.width,maxHeight:this.state.height,width:this.state.width,height:this.state.height,margin:this.state.margin}:{},S.div({className:C(e)},S.div({className:r.PREVIEW_IMAGE_WRAPPER+" preview-content"},this.state.fullSizeImage?S.img({src:k(this.props["thumbnail-url-tmpl"]),className:r.PREVIEW_IMAGE+" absolute-center",style:n,onLoad:this._onImageLoad}):w({thumbnailUrlTmpl:this.props["thumbnail-url-tmpl"],className:r.PREVIEW_IMAGE+" absolute-center",style:n,onLoad:this._onImageLoad,onError:this._onImageError})),this.props["should-display-annotations-toolbar"]?this._renderAnnotationsToolbar():void 0)},_renderPreviewBlank:function(){var e;return e=this.props["file-meta"],g({filename:e.filename,created:new Date(1e3*e.mtime),size:e.formattedSize})},render:function(){return this.state.imageLoadError?this._renderPreviewBlank():this._renderPreviewImage()}}),{PreviewImageWithAnnotations:y}})}.call(this),function(){define("modules/clean/react/previews/preview_image_zoom",["external/jquery.mousewheel","external/jquery.fs.zoomer","external/react","external/underscore","jquery","modules/clean/photos/thumbnail_url_util","modules/clean/react/image","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/helpers","modules/clean/react/previews/preview_zoom_container","modules/clean/react/previews/responsive_image","modules/clean/static_urls","modules/core/browser","modules/core/dom","modules/core/exception","modules/core/uri","modules/core/i18n"],function(e,t,n,i,o,r,s,a,l,u,c,d,p,_,h,m,f,v,g,y){var b,w,E,T,C,S,k,I,A,P,N,R;return N=r.fullSizeUrl,w=l.EventTypes,E=c.FilePreviewSession,I=d.compareStateAndProps,R=h.static_url,A=n.addons.classSet,P=n.DOM,k=y._,S=n.createFactory(_),C=n.createFactory(p),b="preview-image-zoomzoom-wrapper",T=n.createClass({statics:{open:function(e,t){var i,r,s;return s=o("<div />",{id:b}),o(document.body).append(s),r=T({thumbnailUrlTmpl:e,fileExtension:t,isFlippable:!1}),i={file_ext:t},a.openFullscreenLogging(i),n.render(r,s.get(0))},close:function(){var e;return e=document.getElementById(b),e?n.unmountComponentAtNode(e):void 0},SETUP_IMAGE_WAIT_TIME:100},displayName:"PreviewImageZoom",propTypes:{thumbnailUrlTmpl:n.PropTypes.string,fileExtension:n.PropTypes.string,isFlippable:n.PropTypes.bool},getInitialState:function(){return{loadedFullResolutionImageUrl:null,zoomOutDisabled:!0,zoomInDisabled:!1,dragDisabled:!0}},componentDidMount:function(){return this._logPreviewEvent(w.FILE_PREVIEW_SUPPORT_CONFIRMED),this._delayedSetupImage(this.props.thumbnailUrlTmpl)},componentWillReceiveProps:function(e){return e.thumbnailUrlTmpl!==this.props.thumbnailUrlTmpl?(this._logPreviewEvent(w.FILE_PREVIEW_SUPPORT_CONFIRMED),this.setState({loadedFullResolutionImageUrl:null}),this._destroyZoomer(),this._delayedSetupImage(e.thumbnailUrlTmpl)):void 0},componentWillUnmount:function(){return this._destroyZoomer(),o(window).off("resize.zommer")},shouldComponentUpdate:I,_delayedSetupImage:function(e){return setTimeout(function(t){return function(){return t.isMounted()&&t.props.thumbnailUrlTmpl===e?t._setupImage(e):void 0}}(this),T.SETUP_IMAGE_WAIT_TIME)},_logPreviewEvent:function(e){return u.emit(e,E.currentSession)},_setupImage:function(e){return this.fullResolutionImage=new window.Image,this.fullResolutionImage.onload=function(t){return function(){return t.props.thumbnailUrlTmpl===e?t._onFullResolutionImageLoaded():void 0}}(this),this.fullResolutionImage.onerror=this._onFullResolutionImageError,this.fullResolutionImage.src=N(e)},_onFullResolutionImageLoaded:function(){return this.isMounted()?(this._logPreviewEvent(w.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),this._logPreviewEvent(w.FILE_PREVIEW_RENDER_SUCCEEDED),this.setState({loadedFullResolutionImageUrl:this.fullResolutionImage.src},this._bindZoomer)):void 0},_onFullResolutionImageError:function(){return this._logPreviewEvent(w.FILE_PREVIEW_DOWNLOAD_FAILED),v.assert("Error loading full resoltuion image in zoom view")},_bindZoomer:function(){var e,t;if(null!=this.state.loadedFullResolutionImageUrl)return t=o(".preview-zoom").width(),e=this._getPreviewZoomerElement(),window.zoomer(e,{controls:{zoomIn:o(this.refs.previewZoomContainer.refs.zoomControlZoomIn.getDOMNode()),zoomOut:o(this.refs.previewZoomContainer.refs.zoomControlZoomOut.getDOMNode()),zoomLabel:o(this.refs.previewZoomContainer.refs.zoomLabel.getDOMNode()),zoomLabelContainer:o(this.refs.previewZoomContainer.refs.zoomLabelContainer.getDOMNode())},customClass:"preview-zoomer-style",retina:window.devicePixelRatio>1,onZoomCallback:this._onZoomCallback,startWidth:t}),null==this.fitToZoom&&(this.fitToZoom=this._getZoomPercent()),o(window).off("resize.zoomer").on("resize.zoomer",function(t){return function(){return zoomer(e,"resize"),t.fitToZoom=t._getZoomPercent()}}(this)),e.off("mousewheel.zoom").on("mousewheel.zoom",function(e){return function(t,n){return t.preventDefault(),e._zoomScroll(n*t.deltaFactor)}}(this))},_destroyZoomer:function(){return window.zoomer(this._getPreviewZoomerElement(),"destroy")},_onZoomCallback:function(e){return this.setState({zoomOutDisabled:e.atMinZoom,zoomInDisabled:e.atMaxZoom,dragDisabled:e.atMinZoom})},_getPreviewZoomerElement:function(){return o(".preview-zoomer")},_getZoomPercent:function(){return parseFloat(o(this.refs.previewZoomContainer.refs.zoomLabel.getDOMNode()).text())},_zoomToFit:function(){var e;return o(null!=(e=this.refs.previewZoomContainer.refs.zoomControlZoomOut)?e.getDOMNode():void 0).trigger("zoomout")},_zoom100:function(e,t){return zoomer(this._getPreviewZoomerElement(),"zoom100",e,t)},_zoomScroll:function(e){return zoomer(this._getPreviewZoomerElement(),"zoomScroll",e)},_unmount:function(){var e,t;return this.props.isFlippable?a.closeFullscreen():(t=this.getDOMNode().parentNode,n.unmountComponentAtNode(t),o(t).remove(),e={file_ext:this.props.fileExtension},a.closeFullscreenLogging(e))},_onImageDoubleClick:function(e){var t;return o(e.target).hasClass("zoomer")?void 0:this._getZoomPercent()<100?(t=e.target.getBoundingClientRect(),this._zoom100(e.pageX-t.left,e.pageY-t.top)):this._zoomToFit()},_renderImage:function(){return P.div({ref:"previewZoomer",className:"preview-zoomer",style:{textAlign:"center"},onDoubleClick:null!=this.state.loadedFullResolutionImageUrl?this._onImageDoubleClick:void 0},null!=this.state.loadedFullResolutionImageUrl?P.img({className:"preview-zoom",src:this.state.loadedFullResolutionImageUrl,style:{maxHeight:o(".preview-zoom").height(),maxWidth:o(".preview-zoom").width()}}):S({thumbnailUrlTmpl:this.props.thumbnailUrlTmpl,className:"preview-zoom"}))},_renderLoading:function(){return P.div({className:"preview-zoomer-loading"},s({alt:k("Loading..."),src:R("/static/images/icons/white-on-dark-spinner-vflInam4o.gif"),srcHiRes:R("/static/images/icons/white-on-dark-spinner@2x-vfltkzAUn.gif")}))},render:function(){var e;return e=null!=this.state.loadedFullResolutionImageUrl?"zoomer-image":null!=m.mozilla?"preview-zoomer-loading":"preview-zoom",C({isFlippable:this.props.isFlippable||!1,renderZoomControls:null!=this.state.loadedFullResolutionImageUrl,onClose:this._unmount,containerClass:e,zoomOutCallback:this._zoomToFit,zoomInDisabled:this.state.zoomInDisabled,zoomOutDisabled:this.state.zoomOutDisabled,dragDisabled:this.state.dragDisabled,ref:"previewZoomContainer"},null!=m.mozilla&&null==this.state.loadedFullResolutionImageUrl?this._renderLoading():this._renderImage())}}),{PreviewImageZoom:T}})}.call(this),function(){define("modules/clean/react/previews/preview_linkfile",["external/react","jquery","modules/clean/analytics","modules/clean/ajax","modules/clean/em_string","modules/clean/filepath","modules/clean/previews/file_viewer_utils","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/sprite","modules/clean/referrer_cleansing_redirect","modules/clean/web_timing_logger","modules/core/i18n","modules/core/uri"],function(e,t,n,i,o,r,s,a,l,u,c,d,p,_,h){var m,f,v,g,y,b,w,E,T;return v=n.LinkfileActivityLogger,T=r.filename_without_extension,E=r.file_extension,m=a.EventTypes,f=u.FilePreviewSession,b=e.addons.classSet,w=e.DOM,y=_._,g=e.createClass({displayName:"PreviewLinkfile",propTypes:{filename:e.PropTypes.string.isRequired,
"linkfile-data-link":e.PropTypes.string,"authenticated-data-link":e.PropTypes.bool.isRequired,source:e.PropTypes.string.isRequired,"log-time-to-interactive":e.PropTypes.bool},FILE_VIEWER_OPEN_PREVIEW_EVENT:"db:filepreview:open",FILE_VIEWER_CLOSE_PREVIEW_EVENT:"db:filepreview:close",SPINNER_FADE_DELAY_MSEC:150,MAX_DISPLAYED_FILENAME_CHARS:21,getInitialState:function(){return{description:null,hadError:!1,link:null}},_logEvent:function(e,t,n,i){var o;return null==i&&(i={}),o=null!=t?h.parse(t).getAuthority():null,v.log(e,E(this.props.filename),o,n,this.props.source,i)},_logPreviewEvent:function(e){return l.emit(e,f.currentSession)},_isFileDataFetched:function(){return null==this.state.description},componentDidMount:function(){var e;return this._logPreviewEvent(m.FILE_PREVIEW_SUPPORT_CONFIRMED),this.props["log-time-to-interactive"]&&(p.mark_time_to_view(),p.mark_time_to_interactive()),e=s.getFileViewerElement(),e.on(this.FILE_VIEWER_OPEN_PREVIEW_EVENT,this.handlePreviewOpen),e.on(this.FILE_VIEWER_CLOSE_PREVIEW_EVENT,this.handlePreviewClose),null!=this.props["linkfile-data-link"]?this.requestLinkfileData(this.props["linkfile-data-link"]):void 0},componentWillUnmount:function(){var e,t,n;return e=s.getFileViewerElement(),e.off("db:filepreview:open",this.handlePreviewOpen),e.off("db:filepreview:close",this.handlePreviewClose),this._logEvent("destroy",t=this.state.link,n=!0)},requestLinkfileData:function(e){var t,n,o;return this._logEvent("requestlinkdata",t=null,o=!0),n={url:e,dataType:"json",success:this.handleLinkDataSuccess,error:this.handleLinkDataError},this.props["authenticated-data-link"]?(n.xhrFields={withCredentials:!0},i.AuthenticatedRequest(n)):i.Request(n)},handlePreviewOpen:function(e,t,n,i){return null!=t.linkfile_link?this.requestLinkfileData(t.linkfile_link):this.handleLinkDataError()},handlePreviewClose:function(){var e,t;return this._logEvent("close",e=this.state.link,t=!0)},handleLinkDataSuccess:function(e){var t,n;return null==e.uri?void this.handleLinkDataError():(this._logEvent("displaylinkdata",t=e.uri,n=!0),this._logPreviewEvent(m.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),this.setState({description:e.uri,hadError:!1,link:e.uri}),this._logPreviewEvent(m.FILE_PREVIEW_RENDER_SUCCEEDED))},handleLinkDataError:function(){var e,t;return this._logEvent("displaylinkerror",e=null,t=!1),this._logPreviewEvent(m.FILE_PREVIEW_DOWNLOAD_FAILED),this.setState({description:y("Can’t show link. Something’s wrong with this file."),hadError:!0,link:null})},handleClickOpenLinkButton:function(e){var t,n,i;if(null!=this.state.link)return this._logEvent("navlink",t=this.state.link,i=!0),n=d.get_redirect_uri(this.state.link),window.open(n,"_blank")},render:function(){var e,t,n,i,r,s,a,l;return e={"preview-linkfile-content":!0,"loading-content":this._isFileDataFetched()},l={"preview-linkfile-button-openlink":!0,"button-primary":!0,"has-link":null!=this.state.link},i="-",s="",null!=this.props.filename&&(i=T(this.props.filename),s=E(this.props.filename),""!==s&&(s="."+s)),a=this.MAX_DISPLAYED_FILENAME_CHARS-s.length,r=o.em_snippet(i,a),n=null!=this.state.description?this.state.description:"-",t={"preview-linkfile-description":!0,"force-show-all-text":this.state.hadError},w.div({className:"flex-preview-container"},w.div({className:"preview-content preview-content--center"},w.div({className:"preview-linkfile-box"},w.div({className:b(e),ref:"content"},w.div({className:"preview-linkfile-icon"},w.img({src:"/static/images/icons128/page_white_linkfile-vfloEntlU.png"})),w.div({className:"preview-linkfile-title"},w.span({className:"preview-linkfile-filebase",ref:"fileBase"},r),w.span({className:"preview-linkfile-fileext",ref:"fileExt"},s)),w.div({className:"preview-linkfile-info"},w.div({className:b(t),ref:"description"},n),w.button({className:b(l),onMouseUp:this.handleClickOpenLinkButton,ref:"openLinkButton"},y("Open in new tab")))))))}}),{PreviewLinkfile:g}})}.call(this),function(){define("modules/clean/react/previews/preview_password_protected",["external/react","jquery","modules/clean/datetime","modules/clean/frame_messenger","modules/clean/react/previews/password_component","modules/clean/react/previews/preview_html","modules/clean/react/sprite","modules/core/i18n","modules/core/uri"],function(e,t,n,i,o,r,s,a,l){var u,c,d,p,_,h,m,f,v;return f=e.DOM,m=f.div,v=f.span,h=a._,d=e.createFactory(o),p=e.createFactory(r),c="previewhtml",u=["incorrect_password"],_=e.createClass({displayName:"PreviewPasswordProtected",propTypes:{icon:e.PropTypes.string,filename:e.PropTypes.string.isRequired,fileExtension:e.PropTypes.string.isRequired,created:e.PropTypes.object,size:e.PropTypes.string,fileUrl:e.PropTypes.instanceOf(l),previewType:e.PropTypes.string.isRequired},getDefaultProps:function(){return{icon:"page_white_picture_32"}},getInitialState:function(){return{hasLoadError:!1,passwordSubmitted:!1,passwordAttempts:0,passwordStr:null}},_passwordChanged:function(e){return this.setState({passwordSubmitted:!0,passwordStr:e})},_handleTrustedMessageFromChild:function(e){switch(e.action){case"incorrect_password":return this.setState({passwordSubmitted:!1,passwordAttempts:this.state.passwordAttempts+1})}},componentDidMount:function(){return this._frameMessenger=new i,this._frameMessenger.configureChildMessaging("iframe."+c,this._handleTrustedMessageFromChild,u),this._frameMessenger.startListening()},componentWillUnmount:function(){return this._frameMessenger.stopListening()},_onLoadError:function(){return this.setState({hasLoadError:!0,passwordSubmitted:!1})},_renderCreatedTime:function(){return[v({},n.format_date(this.props.created,"MMMM dd, yyyy hh:mm a")),v({className:"bottom-dot"}," · ")]},_renderSize:function(){return v({},this.props.size)},_renderLoadError:function(){return v({className:"preview-password-protected-error"},h("Failed to generate preview"))},_renderInvalidPassword:function(){return v({className:"preview-password-protected-error"},h("Invalid password, please try again."))},_renderPasswordMessage:function(){return v({className:"preview-blank-title"},h("Please enter this document’s password to view it."))},_renderHtml:function(){var e,t,n;return n=this.props.fileUrl,n.updateQuery({generate_preview:1}),n.updateQuery({password_str:this.state.passwordStr}),n.setAuthority(n.getAuthority().replace("dl-web","dl-doc")),e=this._onLoadError,t=this.props.previewType,p({src:n,previewType:t,onError:e,isFullscreen:!1,fileExtension:this.props.fileExtension})},render:function(){var e;return this.state.passwordSubmitted?this._renderHtml():m({className:"preview-blank-container"},m({className:"preview-blank-wrapper"},m({className:"preview-blank-icon"},s({group:"web",name:this.props.icon})),m({className:"preview-blank-title"},this.props.filename),m({className:"preview-blank-info"},null==this.props.created||isNaN(null!=(e=this.props.created)?e.getTime():void 0)?void 0:this._renderCreatedTime(),null!=this.props.size&&""!==this.props.size?this._renderSize():void 0),this.state.hasLoadError?this._renderLoadError():this.state.passwordAttempts>0?this._renderInvalidPassword():this._renderPasswordMessage(),this.state.hasLoadError?void 0:d({onPasswordSubmit:this._passwordChanged})))}})})}.call(this),function(){define("modules/clean/react/previews/preview_pdf",["external/react","jquery","modules/constants/legacy","modules/core/i18n","modules/core/uri","modules/clean/ajax","modules/clean/components/loading_indicator","modules/clean/filepath","modules/clean/keycode","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/previews/pdf_loader","modules/clean/previews/preview_actions_helper","modules/clean/previews/preview_status_watcher","modules/clean/previews/util","modules/clean/react/helpers","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/previews/preview_toolbar","modules/clean/web_timing_logger"],function(e,t,n,i,o,r,s,a,l,u,c,d,p,_,h,m,f,v,g,y){var b,w,E,T,C,S,k,I,A,P,N,R,O,D,x,L,M;return b=n.DOC_PREVIEW_AVAILABLE,w=n.DOC_PREVIEW_IN_PROGRESS,E=n.DOC_PREVIEW_UNAVAILABLE_BAD_FILE,O=i._,C=c.FilePreviewSession,I=p.PreviewActions,k=h.PermissionHelper,A=h.PreviewHelper,D=m.compareStateAndProps,T=f.EventTypes,S=v.FullscreenHelpers,R=g.ReactPreviewToolbarClass,M=e.DOM,x=M.div,L=M.iframe,N=e.createFactory(R),P=e.createClass({displayName:"PreviewPDF",propTypes:{src:e.PropTypes.string.isRequired,fileExtension:e.PropTypes.string.isRequired,fqPath:e.PropTypes.string,onCloseViewer:e.PropTypes.func,onError:e.PropTypes.func,onLogView:e.PropTypes.func,previewStatus:e.PropTypes.number,previewType:e.PropTypes.string,userId:e.PropTypes.number,isFullscreen:e.PropTypes.bool,forceServeFromDLDoc:e.PropTypes.bool,isSharedLink:e.PropTypes.bool},getDefaultProps:function(){return{fqPath:null,onError:null,onLogView:null,previewStatus:w,previewType:"",userId:0,forceServeFromDLDoc:!1}},getInitialState:function(){return{keydownRegistered:!1,loading:!0}},componentWillMount:function(){return this.pdfLoader=new d,this.pdfLoader.setIsFullscreen(this.props.isFullscreen),this.pdfLoader.setExitFullscreenCallback(this._exitFullscreenCallback),this.pdfLoader.setOnDownloadFailed(this._onDownloadFailed),this.pdfLoader.setOnDownloadSucceeded(this._onDownloadSucceeded),this.pdfLoader.setOnRenderFailed(this._onRenderFailed),this.pdfLoader.setOnRenderSucceeded(this._onRenderSucceeded)},componentDidMount:function(){var e,n,i,o,r;if(this._logPreviewSupportConfirmed(),this.pdfLoader.startListening(),o=A.extCanGeneratePreview(this.props.fileExtension),this.props.previewStatus===b)"function"==typeof(e=this.props).onLogView&&e.onLogView(!1),this.setState({loading:!1});else if(this.props.previewStatus!==E&&o)"function"==typeof(n=this.props).onLogView&&n.onLogView(!1),this.setState({loading:!1});else{if(this.props.previewStatus!==w||null==this.props.userId||null==this.props.fqPath)return void("function"==typeof(i=this.props).onError&&i.onError());this.statusWatcher=new _,this.statusWatcher.start(this.props.userId,this.props.fqPath,this._didFinishStatusCheck,this._failedStatusCheck)}return S.setupFullscreen(this.props.isFullscreen),this.state.loading||this.state.keydownRegistered?void 0:(t(document).on("keydown",null!=(r=this.refs.previewToolbar)?r.onKeydown:void 0),this.setState({keydownRegistered:!0}))},shouldComponentUpdate:D,componentWillReceiveProps:function(){return this._logPreviewSupportConfirmed()},componentDidUpdate:function(){var e;return this.state.loading||this.state.keydownRegistered?void 0:(t(document).on("keydown",null!=(e=this.refs.previewToolbar)?e.onKeydown:void 0),this.setState({keydownRegistered:!0}))},componentWillUnmount:function(){var e,n;return this.pdfLoader.stopListening(),null!=(e=this.statusWatcher)&&e.stop(),this.props.isFullscreen&&S.teardownExitFullscreenListeners(),t(document).off("keydown",null!=(n=this.refs.previewToolbar)?n.onKeydown:void 0)},_logPreviewSupportConfirmed:function(){return u.emit(T.FILE_PREVIEW_SUPPORT_CONFIRMED,C.currentSession)},_didFinishStatusCheck:function(){var e;return"function"==typeof(e=this.props).onLogView&&e.onLogView(!0),this.setState({loading:!1})},_failedStatusCheck:function(){var e,t;return"function"==typeof(e=this.props).onLogView&&e.onLogView(!0),"function"==typeof(t=this.props).onError?t.onError():void 0},_exitFullscreenCallback:function(){return S.setBrowserFullscreen(!1),I.exitFullscreen()},_onDownloadFailed:function(){var e;return u.emit(T.FILE_PREVIEW_DOWNLOAD_FAILED,C.currentSession),"function"==typeof(e=this.props).onError?e.onError():void 0},_onDownloadSucceeded:function(){return u.emit(T.FILE_PREVIEW_DOWNLOAD_SUCCEEDED,C.currentSession)},_onRenderFailed:function(){var e;return u.emit(T.FILE_PREVIEW_RENDER_FAILED,C.currentSession),"function"==typeof(e=this.props).onError&&e.onError(),y.mark_time_to_view(),y.mark_time_to_interactive()},_onRenderSucceeded:function(){return y.mark_time_to_view(),u.emit(T.FILE_PREVIEW_RENDER_SUCCEEDED,C.currentSession),y.mark_time_to_interactive()},_renderLoading:function(){var t;return t=e.createElement(s,{style:s.LoadingIndicatorStyle.BLUE_SPINNER,className:"preview-loading-indicator"}),x({className:"preview-loading-wrapper"})},_renderPreview:function(){var e,t,n,i;return e=A.normalize_extension(this.props.fileExtension),t=A.get_progressive_url(e,this.props.src),n={type:"application/pdf"},n.className="pdfjs",n.id="pdf-embed-iframe",(this.props.previewStatus!==b||this.props.forceServeFromDLDoc)&&(t=t.updateQuery({generate_preview:1}),this._serveFromDLDoc(t)),this.pdfLoader.openFile(t,{presentationMode:"ppt"===e}),i=A.get_pdf_js_url(t,e),i=A.update_url_with_user_id(i,this.props.userId),i=A.update_url_for_annotation(i),n.src=i,L(n)},_renderToolbar:function(){var e;return e=this.props.isSharedLink?this.props.src:null,N({actions:I,afterFileViewerExit:this.props.onCloseViewer,fileExtension:this.props.fileExtension,fileDocPreviewStatus:this.props.previewStatus,fileHref:this.props.src,filePreviewType:this.props.previewType,ref:"previewToolbar",pdfLink:e})},render:function(){return x({className:"preview-content"},this.state.loading?this._renderLoading():[this._renderToolbar(),this._renderPreview()])},_serveFromDLDoc:function(e){return e.setAuthority(e.getAuthority().replace("dl-web","dl-doc"))}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/previews/preview_quality_popup",["external/react","modules/core/i18n","modules/clean/react/modal","modules/clean/react/button","modules/clean/react/sprite","modules/clean/analytics","jquery","modules/clean/em_string","modules/clean/filepath","modules/core/notify","modules/clean/react/react_i18n","modules/clean/viewer","modules/constants/legacy","modules/core/exception","external/underscore"],function(t,n,i,o,r,s,a,l,u,c,d,p,_,h,m){var f,v,g,y,b,w,E,T,C;return w=n._,f=i.Modal,g=s.PreviewQualityPopupLogger,T=h.assert,E={ASK_IF_OK:0,ASK_TO_DONATE:1,THANK_YOU:2,FADEOUT_POPUP:3,HIDDEN:4},C=t.DOM,b=d.R_,y=t.createClass({displayName:"PreviewQualitySendFeedbackModal",statics:{showInstance:function(e){return f.showInstance(e)}},getInitialState:function(){return{file_selected:!0}},propTypes:{filename:t.PropTypes.string.isRequired,done_callback:t.PropTypes.func.isRequired,dismiss_callback:t.PropTypes.func.isRequired},render:function(){var e,t;return t=l.em_snippet(u.filename(this.props.filename),32),e=u.file_icon(this.props.filename),f({title:w("Tell us what’s wrong"),acceptButtonText:w("Send feedback"),dismissButtonText:w("Cancel"),autoClose:!1,showX:!0,onAccept:this._onDone,onDismiss:this._onDismiss,ref:"modal"},C.div({className:"send_feedback_modal_content"},C.textarea({className:"feedback",name:"feedback",id:"feedback",maxLength:255,readOnly:!1,placeholder:w("My document doesn’t look right because...")}),C.div({className:"file_selection",onClick:this._fileCheckClick},C.div({className:"file_check"},C.input({type:"checkbox",checked:this.state.file_selected,onClick:this._checkboxClick,id:"file_selection_checkbox"})),C.div({className:"file_image"},r({group:"web",name:e+"_32"})),C.div({className:"file_desc"},C.div({className:"file_desc_container"},C.div({className:"main"},b({filename:t},"Include <b>%(filename)s</b>")),C.div({className:"disclaimer"},w("The Dropbox team will review your document. It will only be used to help improve previews.")))))))},_onDone:function(){var e;return e=a("#feedback").val(),this.props.done_callback(this.state.file_selected,e),this.refs.modal.close()},_onDismiss:function(){return this.props.dismiss_callback(),this.refs.modal.close()},_checkboxClick:function(e){return this.setState({file_selected:!this.state.file_selected}),e.stopPropagation()},_fileCheckClick:function(e){return this.setState({file_selected:!this.state.file_selected}),e.stopPropagation()}}),v=t.createClass({displayName:"PreviewQualityPopup",propTypes:{showalways:t.PropTypes.bool,file:t.PropTypes.object},getDefaultProps:function(){return{showalways:!1,file:null}},_SHOW_THRESHOLD:1,_BLOCKED_FILE_EXTENSIONS:["url","webloc","website"],componentDidMount:function(){return null==this.props.file?a(document).on("db:filepreview:previewupdate",this._handleStateChange):this._handleFile(this.props.file)},componentWillUnmount:function(){return null==this.props.file?a(document).off("db:filepreview:previewupdate",this._handleStateChange):void 0},getInitialState:function(){return{page_state:E.HIDDEN,file_nsid:null,file_sjid:null,filename:null,doc_preview_status:null,feedback:"",is_file_donated:!1}},render:function(){return this.state.page_state===E.ASK_IF_OK?C.div({id:"preview-quality-popup",className:"preview-quality-bar fadeout"},C.div({className:"container"},C.div({className:"title"},w("Does this document look right?"),C.div({className:"resolution"},C.a({className:"looks-good-link",onMouseUp:this.handleLooksGood},w("Yes")),C.span({className:""},w("•")),C.a({className:"something-wrong-link",onMouseUp:this.handleMarkedBad},w("No")))),C.div({className:"hide_button"},C.a({onMouseUp:this.handleDismissPopup},r({group:"web",name:"x"})))),C.hr({className:"separator"})):C.div({id:"preview-quality-dummy",className:"hidden"})},handleDismissPopup:function(e){return this._logCurrentState("dismiss_popup"),this.setState({page_state:E.HIDDEN})},handleLooksGood:function(e){return this._logCurrentState("good"),this.setState({page_state:E.HIDDEN})},handleMarkedBad:function(e){var n;return this._logCurrentState("marked_bad"),this.setState({page_state:E.ASK_TO_DONATE}),n=t.createElement(y,{filename:this.state.filename,done_callback:this._modal_callback_ok,dismiss_callback:this._modal_callback_dismiss}),y.showInstance(n)},_modal_callback_ok:function(e,t){return e?this._logCurrentState("bad_donated",t):this._logCurrentState("bad_no_donate",t),c.success(w("Thanks! Your feedback will help improve Dropbox."),3),this.forceUpdate(),this.setState({page_state:E.THANK_YOU})},_modal_callback_dismiss:function(){return this._logCurrentState("cancel_dialog"),this.setState({page_state:E.ASK_IF_OK})},_randomNum:function(e,t){return null==t&&(t=0),Math.random()*(e-t)+t},_shouldShow:function(t){var n,i;return i=t.toLowerCase(),e.call(this._BLOCKED_FILE_EXTENSIONS,i)>=0?!1:this.props.showalways===!0?!0:(n=this._randomNum(100),n<=this._SHOW_THRESHOLD)},_handlePreviewOpen:function(e,t){return this._shouldShow(t)?(this.setState({page_state:E.ASK_IF_OK,file_nsid:e.ns_id,file_sjid:e.sjid,filename:u.filename(e.fq_path),doc_preview_status:e.doc_preview_status}),this._log("popup_shown",this._getActiveUser(e.ns_id),e.ns_id,e.sjid,t,e.doc_preview_status)):void 0},_handlePreviewFail:function(e,t){return this._log("popup_failed",this._getActiveUser(e.ns_id),e.ns_id,e.sjid,t,e.doc_preview_status)},_handleStateChange:function(t,n){var i,o,r,s,a;if(r=n.preview_state,i=n.file_obj,"open"===r){if(o=p.get_viewer().get_users(),a=m.pluck(o,"root_ns"),s=i.ns_id,e.call(a,s)>=0)return this._handleFile(i)}else if("closed"===r)return this.setState({page_state:E.HIDDEN,file_nsid:null,file_sjid:null,filename:null,doc_preview_status:null})},_handleFile:function(e){var t,n;return t=u.file_extension(u.filename(e.fq_path),!0),(n=e.doc_preview_status)===_.DOC_PREVIEW_AVAILABLE||n===_.DOC_PREVIEW_UNAVAILABLE_OTHER?this._handlePreviewOpen(e,t):this._handlePreviewFail(e,t)},_getActiveUser:function(e){var t,n,i,o,r;for(o=p.get_viewer().get_users(),n=t=0,i=o.length;i>t;n=++t)if(r=o[n],e===r.root_ns)return r;return T(!1,"bad state - must have a valid user to match ns_id")},_logCurrentState:function(e,t,n){return null==t&&(t=""),null==n&&(n=!1),this._log(e,this._getActiveUser(this.state.file_nsid),this.state.file_nsid,this.state.file_sjid,u.file_extension(this.state.filename,!0),this.state.doc_preview_status,t)},_log:function(e,t,n,i,o,r,s){return null==s&&(s=""),g.log(e,t,n,i,o,r,s)}}),{PreviewQualityPopup:v,CARD_TYPES:E}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/previews/preview_toolbar",["external/keymaster","external/react","jquery","modules/clean/analytics","modules/clean/frame_messenger","modules/clean/keycode","modules/clean/previews/file_view_rams_common","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/sprite","modules/core/dom","modules/core/exception","modules/core/i18n"],function(t,n,i,o,r,s,a,l,u,c,d,p,_){var h,m,f,v,g,y,b,w,E;return f=o.PreviewActivityLogger,h=u.FullscreenHelpers,b=p.assert,w=n.createElement,E=n.DOM,y=_._,v={DEFAULT:"default",SPP:"spp",SPREADSHEET:"spreadsheet",HTML:"html"},m={},m[s.ESC]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.SPACE]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.PAGE_UP]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.PAGE_DOWN]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.LEFT]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.UP]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.RIGHT]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.DOWN]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.EQUALS]={altKey:!0,ctrlKey:!0,metaKey:!0},m[70]={altKey:!1,ctrlKey:!1,metaKey:!1},m[80]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.PLUS_EQUALS_FF]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.MINUS_FF]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.PLUS_EQUALS_FF_GERMAN]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.MINUS_FF_MAC]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.PLUS_CHROME]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.MINUS_CHROME]={altKey:!0,ctrlKey:!0,metaKey:!0},g=n.createClass({displayName:"PreviewToolbar",propTypes:{actions:n.PropTypes.func.isRequired,fileExtension:n.PropTypes.string.isRequired,pdfLink:n.PropTypes.string,afterFileViewerExit:n.PropTypes.func,fileDocPreviewStatus:n.PropTypes.number,fileHref:n.PropTypes.string,filePreviewType:n.PropTypes.string},_TOOLBAR_ENTRY_CLASSES:{PAGE_INDICATOR:"page-indicator",ZOOM_IN:"zoom-in",ZOOM_OUT:"zoom-out",PAGE_UP:"page-up",PAGE_DOWN:"page-down",FULLSCREEN:"fullscreen",PRINT:"print"},_ELEMENT_CONFIGURATIONS:{default:["page-indicator","zoom-in","zoom-out","page-up","page-down","fullscreen","print"],spp:["page-indicator","page-up","page-down","fullscreen","print"],spreadsheet:["zoom-in","zoom-out","fullscreen","print"],html:["fullscreen","print"]},_PARENT_TO_IFRAME_ACTIONS:{ZOOM_IN:"zoom-in",ZOOM_OUT:"zoom-out",PAGE_UP:"page-up",PAGE_DOWN:"page-down",ENTER_FULLSCREEN:"enter-fullscreen",EXIT_VIEWER_FULLSCREEN:"exit-viewer-fullscreen",PRINT:"print",CLEAR_MOUSE_TRACKING:"clear-mouse-tracking",SCROLL_DOWN:"scroll-down",SCROLL_UP:"scroll-up",SCROLL_LEFT:"scroll-left",SCROLL_RIGHT:"scroll-right",SCREEN_DOWN:"screen-down",SCREEN_UP:"screen-up"},_FADE_TIME_MSEC:400,_IDLE_TIME_MSEC:1500,_trustedIframeDomain:null,_fadeTimeout:null,_fullscreeningTimeout:null,_idleTimeout:null,_previewOpen:!1,_frameMessenger:null,getInitialState:function(){var e;return e={pagesCount:0,currentPage:0,visible:!1,fadingOut:!1,fullscreening:!1,disabledClasses:[],docType:v.DEFAULT}},_reset:function(){return this._clearAllTimeouts(),this.setState({pagesCount:0,currentPage:0,visible:!1,fadingOut:!1,fullscreening:!1,disabledClasses:[],docType:v.DEFAULT})},_setFullscreen:function(e,t){var n,i;return(i=e?this.props.actions.enterFullscreen():this.props.actions.exitFullscreen())?(this._clearFullscreeningTimeout(),e?(l.openFullscreenLogging(t),this.fadeOut()):(l.closeFullscreenLogging(t),this.fadeIn(),this._startIdleTimeout()),this.setState({fullscreening:!0}),this._startFullscreeningTimeout(),h.setBrowserFullscreen(e),n=e?this._PARENT_TO_IFRAME_ACTIONS.ENTER_FULLSCREEN:this._PARENT_TO_IFRAME_ACTIONS.EXIT_VIEWER_FULLSCREEN,this._frameMessenger.postMessageToChildren(n)):void 0},_isViewerFullscreen:function(){return this.props.actions.isFullscreen()},_isBrowserFullscreen:function(){return null!=document.fullScreen?document.fullScreen:null!=document.webkitIsFullScreen?document.webkitIsFullScreen:null!=document.mozFullScreen?document.mozFullScreen:null!=document.msFullscreenElement||null!=document.fullscreenElement},_handleClick:function(e){var t,n,o,r,s,a;for(s={input_method:"click",file_ext:this.props.fileExtension},t=i(e.currentTarget),a=this.state.disabledClasses,o=0,r=a.length;r>o;o++)if(n=a[o],t.hasClass(n))return;return t.hasClass(this._TOOLBAR_ENTRY_CLASSES.ZOOM_IN)?this._zoomIn(s):t.hasClass(this._TOOLBAR_ENTRY_CLASSES.ZOOM_OUT)?this._zoomOut(s):t.hasClass(this._TOOLBAR_ENTRY_CLASSES.PAGE_UP)?this._pageUp(s):t.hasClass(this._TOOLBAR_ENTRY_CLASSES.PAGE_DOWN)?this._pageDown(s):t.hasClass(this._TOOLBAR_ENTRY_CLASSES.FULLSCREEN)?this._toggleFullscreen(s):t.hasClass(this._TOOLBAR_ENTRY_CLASSES.PRINT)&&this._printDocument(s),this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.CLEAR_MOUSE_TRACKING)},_handleMessageFromChild:function(e){var t,n,i,o,r;switch(i={input_method:"child-message",file_ext:this.props.fileExtension},e.action){case"page-change":if(r=this._isToolbarReadyToShow(),t=this._sanitizePageNumber(e.parameters.current_page),o=this._sanitizePageNumber(e.parameters.pages_count),0>=t||0>=o)return;if(null!=e.parameters.doc_type&&this.setState({docType:e.parameters.doc_type}),n=[],1>=t&&n.push(this._TOOLBAR_ENTRY_CLASSES.PAGE_UP),t>=o&&n.push(this._TOOLBAR_ENTRY_CLASSES.PAGE_DOWN),this.setState({currentPage:t,pagesCount:o,disabledClasses:n}),!r&&this._isToolbarReadyToShow())return this.fadeIn(),this._startIdleTimeout();break;case"idle-mouse":return this.fadeOut(),f.log("idle-mouse",i);case"active-mouse":return this.fadeIn(),f.log("active-mouse",i);case"exit-parent-fullscreen":return this._setFullscreen(!1,i);case"keydown":if(null!=e.parameters)return this.onKeydown(e.parameters);break;case"get-keydown-keys-handled-by-parent":return this._frameMessenger.postMessageToChildren("keydown-keys-handled-by-parent",{keycodes:m})}},onPreviewOpen:function(){return this._previewOpen?!0:(i(document).on("keydown",this.onKeydown),i(document).on("fullscreenchange",this.onBrowserFullscreenChange),i(document).on("webkitfullscreenchange",this.onBrowserFullscreenChange),i(document).on("msfullscreenchange",this.onBrowserFullscreenChange),i(document).on("mozfullscreenchange",this.onBrowserFullscreenChange),this._previewOpen=!0,!0)},onPreviewClose:function(){return this._previewOpen?(i(document).off("keydown",this.onKeydown),i(document).off("fullscreenchange",this.onBrowserFullscreenChange),i(document).off("webkitfullscreenchange",this.onBrowserFullscreenChange),i(document).off("msfullscreenchange",this.onBrowserFullscreenChange),i(document).off("mozfullscreenchange",this.onBrowserFullscreenChange),this._reset(),this._frameMessenger.resetOriginsForPosting(),this._previewOpen=!1,!0):!0},componentDidMount:function(){return window.addEventListener("message",this.handleViewerMessage),this._frameMessenger=new r,this._frameMessenger.configureChildMessaging(this.props.actions.getIframeQuery(),i.proxy(this._handleMessageFromChild,this),["page-change","idle-mouse","active-mouse","exit-parent-fullscreen","keydown","child-focus","get-keydown-keys-handled-by-parent"]),this._frameMessenger.startListening()},componentWillUnmount:function(){return this._clearAllTimeouts(),this._frameMessenger.stopListening(),window.removeEventListener("message",this.handleViewerMessage)},renderPageIndicatorText:function(){var e;return this.state.currentPage<1||this.state.pagesCount<1?"":(e=y(this.state.docType===v.SPP?"Slide %(current_page)s of %(pages_count)s":"Page %(current_page)s of %(pages_count)s"),e.format({current_page:this.state.currentPage,pages_count:this.state.pagesCount}))},_renderToolbarButton:function(t,n,i,o){var r,s;return e.call(this._ELEMENT_CONFIGURATIONS[this.state.docType],t)<0?E.span({style:{display:"none"}}):(r=t+" toolbar-button-entry",s=e.call(this.state.disabledClasses,t)>=0,E.div({className:r,onMouseUp:this._handleClick},E.div({className:"toolbar-tooltip"},E.div({className:"toolbar-tooltip-container"},E.div({className:"toolbar-tooltip-pointer-border"})),E.div({className:"toolbar-tooltip-container"},E.div({className:"toolbar-tooltip-body"},o)),E.div({className:"toolbar-tooltip-container"},E.div({className:"toolbar-tooltip-pointer"}))),w(c,{group:n,name:i,className:s?"disabled":"",alt:o})))},_renderPageIndicator:function(){var t;return t=this._TOOLBAR_ENTRY_CLASSES.PAGE_INDICATOR,e.call(this._ELEMENT_CONFIGURATIONS[this.state.docType],t)>=0?E.div({className:this._TOOLBAR_ENTRY_CLASSES.PAGE_INDICATOR},this.renderPageIndicatorText()):void 0},render:function(){var e,t,n,i,o,r;return e="preview-toolbar-overlay-container ",this.state.visible||(e+="hide "),this.state.fadingOut&&(e+="fadeout "),t={className:e},r=y(this.state.docType===v.SPP?"Previous slide":"Page up"),i=y(this.state.docType===v.SPP?"Next slide":"Page down"),o=this.state.docType===v.SPP?"left":"up",n=this.state.docType===v.SPP?"right":"down",E.div(t,E.div({className:"preview-toolbar-overlay",onMouseEnter:this.onMouseEnterToolbar},E.div({className:"preview-toolbar-content"},this._renderPageIndicator(),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.ZOOM_OUT,"web","zoomout",y("Zoom out")),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.ZOOM_IN,"web","zoom",y("Zoom in")),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.PAGE_UP,"web",o,r),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.PAGE_DOWN,"web",n,i),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.FULLSCREEN,"web","fullscreen",y("Fullscreen")),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.PRINT,"web","print",y("Print")))))},_sanitizePageNumber:function(e){var t;return null==e?0:(t=parseInt(e),isNaN(t)?0:t)},_getOriginFromUrl:function(e){var t;return t=document.createElement("a"),t.href=e,"https://"+t.hostname},fadeOut:function(){return this.state.fadingOut||this._clearFadeTimeout(),this.setState({fadingOut:!0,tooltipClass:null}),this._startFadeTimeout()},fadeIn:function(){return this._clearIdleTimeout(),this._isViewerFullscreen()||i("html").hasClass("no-flexbox")?void 0:this._isToolbarReadyToShow()?(this._clearFadeTimeout(),this.setState({visible:!0,fadingOut:!1})):void 0},onMouseEnterToolbar:function(){return this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.CLEAR_MOUSE_TRACKING),this._clearIdleTimeout()},onKeydown:function(e){var t,n,o,r;return n=!1,!this._frameMessenger.childIsValidated()||"dbmodal"===key.getScope()||d.focus_in_input()||d.is_input(e.target)||null!=e.target&&(t=i("#file-comments"),1!==t.length&&(t=i("#photo-comments")),1===t.length&&(e.target===t[0]||i.contains(t[0],e.target)))?void 0:(r={input_method:"keydown",file_ext:this.props.fileExtension,extra:JSON.stringify({keycode:e.keyCode})},o=e.keyCode,this.state.docType!==!v.SPP||o!==s.EQUALS&&o!==s.PLUS_EQUALS_FF&&o!==s.PLUS_CHROME&&o!==s.PLUS_EQUALS_FF_GERMAN?this.state.docType!==!v.SPP||o!==s.MINUS_FF_MAC&&o!==s.MINUS_FF&&o!==s.MINUS_CHROME?o===s.LEFT?(this.state.docType===v.SPP?this._pageUp(r):this._scrollLeft(r),n=!0):o===s.RIGHT?(this.state.docType===v.SPP?this._pageDown(r):this._scrollRight(r),n=!0):o===s.PAGE_UP?(this.state.docType===v.SPP?this._pageUp(r):this._screenUp(r),n=!0):o===s.SPACE||o===s.PAGE_DOWN?(this.state.docType===v.SPP?this._pageDown(r):this._screenDown(r),n=!0):o===s.UP?(this.state.docType===v.SPP?this._pageUp(r):this._scrollUp(r),n=!0):o===s.DOWN?(this.state.docType===v.SPP?this._pageDown(r):this._scrollDown(r),n=!0):70!==o||e.ctrlKey||e.metaKey?80===o?(this._printDocument(r),n=!0):o===s.ESC&&(this._isViewerFullscreen()?this._exitFullscreen(r):this.props.afterFileViewerExit&&!this._isAnnotationBubbleShown()&&this._exitPreview(r),n=!0):(this._isViewerFullscreen()?this._exitFullscreen(r):this._enterFullscreen(r),n=!0):(this._zoomOut(r),n=!0):(this._zoomIn(r),n=!0),n&&null!=e.preventDefault&&e.preventDefault(),!n)},_isAnnotationBubbleShown:function(){return i(".annotation-bubble-container .bubble-dropdown").length>0},_startFadeTimeout:function(){return this._fadeTimeout=setTimeout(function(e){return function(){return e._fadeTimeout=null,e.setState({visible:!1,fadingOut:!1})}}(this),this._FADE_TIME_MSEC)},_clearFadeTimeout:function(){return null!=this._fadeTimeout?(clearTimeout(this._fadeTimeout),
this._fadeTimeout=null):void 0},_startFullscreeningTimeout:function(){var e;return e=function(e){return function(){return e._fullscreeningTimeout=null,e.setState({fullscreening:!1})}}(this),this._fullscreeningTimeout=setTimeout(i.proxy(e,this),a.RAMS_FULLSCREEN_TRANSITION_TIME_MSEC)},_clearFullscreeningTimeout:function(){return null!=this._fullscreeningTimeout?(clearTimeout(this._fullscreeningTimeout),this._fullscreeningTimeout=null):void 0},onIdleTimeout:function(){return this._clearIdleTimeout(),this.fadeOut()},_startIdleTimeout:function(){return this._clearIdleTimeout(),this._idleTimeout=setTimeout(i.proxy(this.onIdleTimeout,this),this._IDLE_TIME_MSEC)},_clearIdleTimeout:function(){return null!=this._idleTimeout?(clearTimeout(this._idleTimeout),this._idleTimeout=null):void 0},_clearAllTimeouts:function(){return this._clearFadeTimeout(),this._clearFullscreeningTimeout(),this._clearIdleTimeout()},_isToolbarReadyToShow:function(){return this.state.currentPage>0&&this.state.pagesCount>0},onBrowserFullscreenChange:function(e){var t;return t={input_method:"browser-fullscreen-exit",file_ext:this.props.fileExtension},this._isViewerFullscreen&&!this._isBrowserFullscreen()?this._setFullscreen(!1,t):void 0},_logData:function(e,t){return"string"==typeof t.input_method?f.log(e,t):b(!1,"logData not correctly formed"),"string"==typeof t.input_method},_logAndPostMessage:function(e,t,n){return this._logData(t,n)?this._frameMessenger.postMessageToChildren(e):void 0},_zoomIn:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.ZOOM_IN,"zoom-in",e)},_zoomOut:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.ZOOM_OUT,"zoom-out",e)},_pageUp:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.PAGE_UP,"page-up",e)},_pageDown:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.PAGE_DOWN,"page-down",e)},_screenUp:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.SCREEN_UP,"screen-up",e)},_screenDown:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.SCREEN_DOWN,"screen-down",e)},_scrollUp:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.SCROLL_UP,"scroll-up",e)},_scrollDown:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.SCROLL_DOWN,"scroll-down",e)},_scrollRight:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.SCROLL_RIGHT,"scroll-right",e)},_scrollLeft:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.SCROLL_LEFT,"scroll-left",e)},_toggleFullscreen:function(e){return this._isViewerFullscreen()?this._exitFullscreen(e):this._enterFullscreen(e)},_enterFullscreen:function(e){return this._setFullscreen(!0,e)},_exitFullscreen:function(e){return this._setFullscreen(!1,e)},_exitPreview:function(e){var t;return this._logData("exit-preview",e)&&"function"==typeof(t=this.props).afterFileViewerExit?t.afterFileViewerExit():void 0},_printDocument:function(e){var t;return this._logData("print",e)&&(t=this.props.pdfLink?this.props.actions.nativePdfPrint(this.props.pdfLink):this.props.actions.nativePdfPrint({doc_preview_status:this.props.fileDocPreviewStatus,href:this.props.fileHref,preview_type:this.props.filePreviewType}),!t)?this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.PRINT):void 0}}),{ReactPreviewToolbarClass:g,PreviewToolbarDocType:v}})}.call(this),function(){define("modules/clean/react/previews/preview_video",["external/react","jquery","modules/clean/annotations/preview_image_annotations_toolbar","modules/clean/image_size","modules/clean/react/helpers","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/previews/preview_zoom_container","modules/clean/react/react_i18n","modules/clean/static_urls","modules/clean/web_timing_logger","modules/constants/viewer","modules/core/i18n","modules/core/uri"],function(e,t,n,i,o,r,s,a,l,u,c,d,p,_,h,m){var f,v,g,y,b,w,E,T,C,S;return C=i.image_best_fit_size,w=o.compareStateAndProps,f=s.EventTypes,v=l.FilePreviewSession,S=d.static_url,E=e.addons.classSet,T=e.DOM,b=c.R_,y=e.createFactory(u),g=e.createClass({displayName:"PreviewVideo",propTypes:{"preview-url":e.PropTypes.string,"thumbnail-url-tmpl":e.PropTypes.string,"video-metadata-url":e.PropTypes.string,onLoad:e.PropTypes.func,isFullscreen:e.PropTypes.bool,"log-time-to-interactive":e.PropTypes.bool,shouldDisplayAnnotationsToolbar:e.PropTypes.bool,index:e.PropTypes.number,count:e.PropTypes.number,onPrevious:e.PropTypes.func,onNext:e.PropTypes.func},getInitialState:function(){return{error:null}},_logPreviewEvent:function(e){return a.emit(e,v.currentSession)},_getSizedImageUrl:function(){return m.parse(this.props["thumbnail-url-tmpl"]).updateQuery({size:C(t(window).width(),t(window).height()),size_mode:2}).toString()},_shutdown:function(){var e,n,i;if(t(".vjs-big-play-button").blur(),null!=this._player){try{this._player.trigger("shutdown"),"Hls"===this._player.techName&&null!=(i=this._player.tech.sourceBuffer)&&i.abort(),this._player.dispose()}catch(t){e=t}return this._player=null}},_onReady:function(){var e;return e=function(){return t(".vjs-poster").show(),t(".vjs-big-play-button").show(),t(".vjs-big-play-button").focus()},setTimeout(e,0),this._logPreviewEvent(f.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),this._logPreviewEvent(f.FILE_PREVIEW_RENDER_SUCCEEDED)},_onPlay:function(){return t(".vjs-poster").hide(),t(".vjs-big-play-button").hide()},_onEnded:function(){return t(".vjs-poster").show(),t(".vjs-big-play-button").show(),t(".vjs-loading-spinner").hide()},_onError:function(e){return this._shutdown(),this.setState({error:e}),this._logPreviewEvent(f.FILE_PREVIEW_DOWNLOAD_FAILED)},_embedVideoUtil:function(){var e;return e=t(this.refs.previewVideoPlayer.getDOMNode()),require(["modules/clean/video_util"],function(n){return function(i){return n._player=i.embed(e,{src:n.props["preview-url"],type:_.transcoder_hls4web?"application/vnd.apple.mpegurl":"video/flv",width:"100%",height:"100%",controls:!0,preload:"auto",poster:n._getSizedImageUrl(),metadata_link:n.props["video-metadata-url"],metadata:null,onError:n._onError,onReady:n._onReady}),n._player.on("play",n._onPlay),n._player.on("ended",n._onEnded),t(".vjs-poster").hide(),t(".vjs-big-play-button").hide()}}(this))},componentDidMount:function(){var e;return this._embedVideoUtil(),"function"==typeof(e=this.props).onLoad&&e.onLoad(),this.props["log-time-to-interactive"]&&(p.mark_time_to_view(),p.mark_time_to_interactive()),this._logPreviewEvent(f.FILE_PREVIEW_SUPPORT_CONFIRMED)},componentWillUpdate:function(e){return e["preview-url"]!==this.props["preview-url"]?this._shutdown():void 0},componentDidUpdate:function(e){var t;return e["preview-url"]!==this.props["preview-url"]?(this._embedVideoUtil(),"function"==typeof(t=this.props).onLoad&&t.onLoad(),this._logPreviewEvent(f.FILE_PREVIEW_SUPPORT_CONFIRMED)):void 0},componentWillUnmount:function(){return this._shutdown()},shouldComponentUpdate:w,_renderAnnotationsToolbar:function(){return e.createElement(n,{index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onNext:this.props.onNext})},_renderPlayer:function(){return T.div({ref:"previewVideoPlayer",className:"video-player"})},_renderError:function(){return T.div({ref:"previewVideoError",className:"preview-video-error absolute-center"},[T.img({src:S("/static/images/preview_fail-vflc3IDxf.png")}),"needflash"===this.state.error?T.div({},b({},'Install <a href="http://get.adobe.com/flashplayer/">Adobe Flash Player</a> to preview this video.')):T.div({},b({},"Unable to preview this item."))])},_renderContent:function(){return null!=this.state.error?this._renderError():this._renderPlayer()},render:function(){var e;return e={"flex-preview-container":!0,"flex-preview-container--padded":!0,"has-annotations-toolbar":this.props.shouldDisplayAnnotationsToolbar},this.props.isFullscreen?y({isFlippable:!0,renderZoomControls:!1,onClose:function(){return r.closeFullscreen()},containerClass:null!=this.state.error?"preview-video-error":"video-player"},this._renderContent()):T.div({ref:"previewVideoContainer",className:E(e)},T.div({className:"preview-content"},T.div({className:"absolute-center"},this._renderContent())),this.props.shouldDisplayAnnotationsToolbar&&this.props.count>1?this._renderAnnotationsToolbar():void 0)}}),{PreviewVideo:g}})}.call(this),function(){define("modules/clean/react/previews/preview_zoom_container",["external/keymaster","external/react","external/underscore","jquery","modules/clean/components/title_bubble","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/file_viewer/store","modules/clean/react/sprite","modules/core/dom","modules/core/i18n"],function(e,t,n,i,o,r,s,a,l,u,c){var d,p,_,h,m,f,v;return f=t.addons.classSet,v=t.DOM,m=c._,d=t.createFactory(s),_="",p="previewzoomcontainer",h=t.createClass({displayName:"PreviewZoomContainer",propTypes:{isFlippable:t.PropTypes.bool.isRequired,renderZoomControls:t.PropTypes.bool.isRequired,onClose:t.PropTypes.func.isRequired,containerClass:t.PropTypes.string,zoomOutCallback:t.PropTypes.func,zoomInDisabled:t.PropTypes.bool,zoomOutDisabled:t.PropTypes.bool,dragDisabled:t.PropTypes.bool},getDefaultProps:function(){return{zoomInDisabled:!0,zoomOutDisabled:!0,dragDisabled:!0}},getInitialState:function(){return{controlsHidden:!1}},componentDidMount:function(){return this._flipNext=n.throttle(this._flipNext,100),this._flipPrevious=n.throttle(this._flipPrevious,100),key("esc",p,this.props.onClose),null!=this.props.zoomOutCallback&&key("space",p,this.props.zoomOutCallback),this.props.isFlippable&&(key("left",p,function(e){return function(){return e._startControlsTimer(),e._flipPrevious()}}(this)),key("right",p,function(e){return function(){return e._startControlsTimer(),e._flipNext()}}(this))),_=key.getScope(),key.setScope(p),this._startControlsTimer(),this._hideCursor()},componentWillUpdate:function(){return key.setScope(p)},componentWillUnmount:function(){return key.clearScope(p),key.setScope(_),clearTimeout(this.controlsHideTimer),this._showCursor()},_startControlsTimer:function(){return this._showControls(),clearTimeout(this.controlsHideTimer),this.controlsHideTimer=setTimeout(function(e){return function(){return e._hideControls()}}(this),3e3)},_showControls:function(){return this._showCursor(),this.setState({controlsHidden:!1})},_hideControls:function(){return this._hideCursor(),this.setState({controlsHidden:!0})},_showCursor:function(){return i("html").removeClass("no-cursor")},_hideCursor:function(){return i("html").addClass("no-cursor")},_flipNext:function(){return r.flipNext()},_flipPrevious:function(){return r.flipPrevious()},_onClick:function(e){var t;return t="."+this.props.containerClass+", .preview-toolbar-overlay, .preview-zoomer-close",i(e.target).is(t)||0!==i(e.target).parents(t).length?void 0:(e.preventDefault(),this.props.onClose())},_onMouseMove:function(e){return 0===i(e.target).parents(".preview-toolbar-overlay").length?this._startControlsTimer():clearTimeout(this.controlsHideTimer)},_renderControls:function(){var e,t,n;return t={"toolbar-button-entry":!0,"zoom-in":!0,disabled:this.props.zoomInDisabled},n={"toolbar-button-entry":!0,"zoom-out":!0,disabled:this.props.zoomOutDisabled},e={"preview-toolbar-overlay-container":!0,hidden:this.state.controlsHidden},v.div({ref:"previewZoomerToolbarContainer",className:f(e)},v.div({className:"preview-toolbar-overlay"},v.div({className:"preview-toolbar-content"},this.props.isFlippable?d({index:""+(a.currentIndex()+1),numFlippableFiles:a.files().length,onNext:this._flipNext,onPrevious:this._flipPrevious}):void 0,this.props.renderZoomControls?[v.div({ref:"zoomControlZoomOut",className:f(n)},l({alt:m("Zoom out"),group:"web",name:"zoomout"})),v.div({ref:"zoomLabelContainer",className:"toolbar-button-entry"},o({text:m("View actual size"),direction:"north"},v.span({ref:"zoomLabel",className:"zoom-label"}))),v.div({ref:"zoomControlZoomIn",className:f(t)},l({alt:m("Zoom in"),group:"web",name:"zoom"}))]:void 0)))},_renderClose:function(){var e;return e={"preview-zoomer-close":!0,hidden:this.state.controlsHidden},v.button({ref:"previewZoomerClose",className:f(e),onClick:this.props.onClose},l({alt:m("Close"),group:"web",name:"lightbox_close"}))},render:function(){var e;return e={"preview-zoomer-container":!0,"zoomer-drag-disabled":this.props.dragDisabled},v.div({ref:"previewZoomerContainer",className:f(e),onClick:this._onClick,onMouseMove:this._onMouseMove},this.props.children,this._renderClose(),this._renderControls())}})})}.call(this),function(){define("modules/clean/react/previews/responsive_image",["external/react","modules/clean/react/previews/image_helpers"],function(e,t){var n,i;return i=e.DOM,n=e.createClass({displayName:"ResponsiveImage",propTypes:{thumbnailUrlTmpl:e.PropTypes.string.isRequired,className:e.PropTypes.string,style:e.PropTypes.object,onLoad:e.PropTypes.func,onError:e.PropTypes.func},render:function(){return i.img({srcSet:t.getSrcSet(this.props.thumbnailUrlTmpl),sizes:t.IMG_SIZES_ATTR,src:t.getFallbackSrc(this.props.thumbnailUrlTmpl),className:this.props.className,style:this.props.style,onLoad:this.props.onLoad,onError:this.props.onError})}})})}.call(this),function(){define("modules/clean/react/select",["external/react","external/underscore","jquery","modules/clean/keycode","modules/clean/react/form_error_mixin","modules/clean/react/hidden","modules/clean/react/sprite","modules/clean/react/util"],function(e,t,n,i,o,r,s,a){var l,u,c,d,p,_,h,m,f;return l=r.HiddenSelect,d=e.addons.classSet,c=e.addons.cloneWithProps,p=e.DOM,u=e.createElement,_=function(e,t){var n,i,o,r;return r=e.scrollTop(),o=r+e.height(),i=t.position().top+r,n=i+t.height(),r>i?e.scrollTop(i):n>o?e.scrollTop(n-e.height()):void 0},f=e.PropTypes.oneOfType([e.PropTypes.string,e.PropTypes.number]),m=e.createClass({displayName:"selectOption",propTypes:{className:e.PropTypes.string,disabled:e.PropTypes.bool,title:e.PropTypes.string,value:f},render:function(){var e;return e={"list-item":!0,"select-option":!0,"select-option-disabled":this.props.disabled},null!=this.props.className&&(e[this.props.className]=!0),p.div(n.extend({"data-value":this.props.value},this.props,{className:d(e)}),this.props.children)}}),h=e.createClass({displayName:"selectInput",mixins:[o],mouseInput:!0,propTypes:{name:e.PropTypes.string,onChange:e.PropTypes.func,defaultValue:f,style:e.PropTypes.object,value:f,variant:e.PropTypes.string,className:e.PropTypes.string,valueLink:e.PropTypes.object,isDisabled:e.PropTypes.bool},getDefaultProps:function(){return{errorWrapperClassName:"select-input-error-wrapper",style:null}},getInitialState:function(){return{open:!1,focused:null,keyboarsSelectPrefix:"",value:this.props.defaultValue}},_getFilteredChildren:function(){return t.isArray(this.props.children)?t.filter(this.props.children,function(e){return e}):this.props.children},render:function(){var t,n;return t={"select-input":!0,"select-input-dropdown-shown":this.state.open,"select-input-disabled":this.props.isDisabled},this.props.variant&&(t[this.props.variant]=!0),this.props.className&&(t[this.props.className]=!0),n={"list-menu":!0,"select-input-dropdown":!0,"select-input-disable-error":this.props["disable-errors"]},p.div({className:d(t),style:this.props.style},u(l,{name:this.props.name,defaultValue:this.props.defaultValue,value:this.getValue(),options:function(t){return function(){var n;return n=[],e.Children.forEach(t._getFilteredChildren(),function(e){return n.push(e.props.value)}),n}}(this)()}),this.renderErrorIfEnabled(),p.div({className:"select-input-input",tabIndex:0,"aria-hidden":!0,onClick:this.toggle,onKeyDown:this.handleKeydown,onMouseMove:this.handleMouseMove,ref:"label"},this.selectedOption(),p.div({className:"select-input-dropdown-arrow"},u(s,{group:"web",name:"arrow-down-gray",alt:""}))),p.div({style:{position:"relative"}},p.div({className:d(n),"aria-hidden":!0,ref:"dropdown"},this.menuChildren())))},handleMouseMove:function(e){var t,n;if(!this.props.isDisabled)return e.pageX===t&&e.pageY===n||(this.mouseInput=!0),t=e.pageX,n=e.pageY},_commonPrefixLen:function(e,t){var i;for(e=n.trim(e).toLowerCase(),t=n.trim(t).toLowerCase(),i=0;i<e.length&&i<t.length&&e.charAt(i)===t.charAt(i);)i++;return i},_keyboardSelect:function(e){var n,i,o,r,s;return s=t.sortedIndex(this.sortedOptions,{text:e.toLowerCase()},"text"),o=this.sortedOptions[Math.max(s-1,0)],n=this.sortedOptions[Math.min(s,this.sortedOptions.length-1)],r=this._commonPrefixLen(e,o.text),i=this._commonPrefixLen(e,n.text),r>=i?this.setState({keyboarsSelectPrefix:e,focused:o.value}):this.setState({keyboarsSelectPrefix:e,focused:n.value})},handleKeydown:function(e){var n,o;if(!this.props.isDisabled){switch(this.mouseInput=!1,e.keyCode){case i.TAB:return this.setState({open:!1,focused:null}),!0;case i.ENTER:this.state.open&&this.state.focused?(this.setValue(this.state.focused),this.setState({open:!1})):this.toggle();break;case i.UP:this.state.open?this.setState({focused:this.prev(this.state.focused)}):this.setState({open:!0});break;case i.DOWN:this.state.open?this.setState({focused:this.next(this.state.focused)}):this.setState({open:!0});break;default:if(!this.state.open)return!0;t.contains(t.values(i),e.keyCode)||(n=String.fromCharCode(e.which),o=this.state.keyboarsSelectPrefix+n,this._keyboardSelect(o),this._keyboardSelect_timeout&&clearTimeout(this._keyboardSelect_timeout),this._keyboardSelect_timeout=setTimeout(function(e){return function(){return e.setState({keyboarsSelectPrefix:""}),e._keyboardSelect_timeout=null}}(this),500))}return!1}},prev:function(t){var n,i;return n=null,i=null,e.Children.forEach(this._getFilteredChildren(),function(e){return function(e){return i||(i=e),e.props.value===t&&(n=i),i=e}}(this)),null!=n?n.props.value:void 0},next:function(t){var n,i,o;return n=null,i=null,e.Children.forEach(this._getFilteredChildren(),function(e){return function(e){return(null!=i?i.props.value:void 0)===t&&(n=e),i=e}}(this)),null!=(o=n||i)?o.props.value:void 0},menuChildren:function(){var t,n;return n=this.getValue(),t=e.Children.map(this._getFilteredChildren(),function(e){return function(t){var i;return i=c(t,{onMouseEnter:function(){return e.mouseInput?e.setState({focused:t.props.value}):void 0},onClick:function(){return t.props.disabled?void 0:(e.setState({open:!1}),e.setValue(t.props.value))},className:d({"focused-option":e.state.focused===t.props.value,"selected-option":n===t.props.value})})}}(this))},componentWillMount:function(){var i;return i=e.Children.map(this._getFilteredChildren(),function(e){return{value:e.props.value,text:n.trim(a.getText(e).toLowerCase())}}),this.sortedOptions=t.sortBy(i,"text")},componentDidMount:function(){return this.globalMenuCloser=function(e){return function(t){var i;return e.state.open&&(i=n(t.target).closest(".select-input-input"),!i.length||i[0]!==e.refs.label.getDOMNode())?e.setState({open:!1,focused:null}):void 0}}(this),n(document).on("click",this.globalMenuCloser)},componentWillUnmount:function(){return n(document).off("click",this.globalMenuCloser)},componentDidUpdate:function(){var e,t;return this.state.open&&this.state.focused?(t=n(this.refs.dropdown.getDOMNode()),e=t.find("[data-value='"+this.state.focused+"']"),_(t,e)):void 0},selectedOption:function(){var t;return t=null,e.Children.forEach(this._getFilteredChildren(),function(e){return function(n){return t||(t=n),(null!=n?n.props.value:void 0)===e.getValue()?t=n:void 0}}(this)),t?c(t):null},toggle:function(){return this.props.isDisabled?void 0:this.setState({open:!this.state.open,focused:null})},getValue:function(){var e,t,n,i;return null!=(e=null!=(t=null!=(n=this.props.value)?n:null!=(i=this.props.valueLink)?i.value:void 0)?t:this.state.value)?e:this.props.defaultValue},setValue:function(e){var t,n;return n=this.getValue(),this.props.valueLink?this.props.valueLink.requestChange(e):this.setState({value:e}),n!==e&&"function"==typeof(t=this.props).onChange?t.onChange(n,e):void 0}}),{input:h,option:m}})}.call(this),function(){define("modules/clean/react/share_download/actions",["external/react","external/rsvp","modules/clean/downloads","modules/clean/multiaccount_login","modules/clean/react/copy_to_dropbox/modal","modules/clean/react/modal","modules/clean/sharing/signup_modal_proxy","modules/clean/viewer","modules/constants/env","modules/core/browser","modules/core/exception","modules/core/uri"],function(e,t,n,i,o,r,s,a,l,u,c,d){var p,_,h,m,f;return m=t.Promise,_=r.Modal,h=l.PUBSERVER,p=e.createFactory(o),new(f=function(){function e(){}return e.prototype.direct=function(){var e;return e=function(){var e;return e=d.parse(u.get_href()).updateQuery({dl:1}).toString(),n.get({url:e,expected_domain:h})},s.signupForDirectDownload().then(e)},e.prototype.toDropbox=function(e,t,n){var o;return o=new m(function(e){var t;return t=a.get_viewer(),t.is_user_signed_in(n)?e():i.show_modal({role:n.role,on_success:e})}),o.then(function(){var i;return i=p({shareToken:e,file:t,user:n}),_.showInstance(i)})},e}())})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/share_download/button",["external/classnames","external/react","modules/clean/react/bubble_menu","modules/clean/react/share_download/models","modules/clean/react/sprite","modules/clean/react/sprite_div","modules/clean/viewer","modules/constants/viewer","modules/core/i18n"],function(t,n,i,o,r,s,a,l,u){var c,d,p,_,h,m,f,v,g,y,b,w,E,T;return c=i.BubbleMenu,d=i.BubbleMenuItem,v=o.ShareDownloadActionOption,m=l.ROLE_PERSONAL,f=l.ROLE_WORK,b=u._,c=n.createFactory(c),d=n.createFactory(d),y=n.createFactory(s),T=n.DOM,E=T.div,w=T.button,_=n.createClass({displayName:"DownloadMainButton",propTypes:{onClick:n.PropTypes.func,className:n.PropTypes.string},render:function(){var e;return e=t([this.props.className,"button-secondary","download-button","control__button"]),w({id:"download-menu-button",className:e,onClick:this.props.onClick},this.props.children)}}),h=n.createClass({displayName:"DownloadSimpleButton",propTypes:{targetText:n.PropTypes.string.isRequired,option:n.PropTypes.instanceOf(v).isRequired},render:function(){var e;return e=function(e){return function(t){return t.preventDefault(),e.props.option.handler()}}(this),_({onClick:e},this.props.targetText)}}),p=n.createClass({displayName:"DownloadDropdown",propTypes:{targetText:n.PropTypes.string.isRequired,options:n.PropTypes.arrayOf(v).isRequired},_renderMoreOptionsButton:function(){return w({className:"button-secondary control__button split-dropdown"},r({group:"web",name:"control_menu",alt:b("More options")}))},render:function(){var e,n,i;return n=this.props.options[0],e=t({"split-button":!0,disabled:n.isDisabled}),E({className:"download-button__wrapper"},_({onClick:n.isDisabled?void 0:n.handler,className:e},this.props.targetText),c({targetButton:this._renderMoreOptionsButton(),arrow_position:"top-right",justify:!0,items:function(){var e,t,n,o;for(n=this.props.options,o=[],e=0,t=n.length;t>e;e++)i=n[e],o.push(d({onClick:i.handler,disabled:i.isDisabled},y({group:"web",name:i.spriteName,text:i.text})));return o}.call(this)}))}}),g=n.createClass({displayName:"ShareDownloadButton",propTypes:{shareToken:n.PropTypes.object.isRequired,sharePermissions:n.PropTypes.shape({canCopyToDropboxRoles:n.PropTypes.array.isRequired,canDownloadRoles:n.PropTypes.array.isRequired}),file:n.PropTypes.object.isRequired},_getOptions:function(){var t,n,i,o,r,s,l,u,c,d,p,_,h,m,f,g;if(d=this.props.sharePermissions,o=d.canDownloadRoles,i=d.canCopyToDropboxRoles,t=v.buildDirectOption,n=v.buildToDropboxOption,c=[],o.length>0&&c.push(t()),i.length>0)for(p=this.props,h=p.shareToken,r=p.file,g=a.get_viewer(),f=g.get_users(!0),s=0,u=f.length;u>s;s++)m=f[s],_=m.role,l=e.call(i,_)<0,c.push(n(h,r,g,m,l));return c},_getTargetText:function(){return b(this.props.sharePermissions.canDownloadRoles.length>0?"Download":"Add to my Dropbox")},render:function(){var e;return e=this._getOptions(),0===e.length?null:1===e.length?h({targetText:this._getTargetText(),option:e[0]}):p({targetText:this._getTargetText(),options:e})}})})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/react/share_download/models",["external/immutable","modules/clean/react/share_download/actions","modules/constants/viewer","modules/core/i18n"],function(t,n,i,o){var r,s,a,l,u,c;return r=i.ROLE_PERSONAL,s=i.ROLE_WORK,u=o._,c={},l=t.Record({text:void 0,handler:void 0,spriteName:void 0,isDisabled:void 0}),a=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.buildDirectOption=function(){return new i({text:u("Direct download"),handler:function(){return n.direct()},spriteName:"download_arrow"})},i.buildToDropboxOption=function(e,t,o,a,l){var c,d;if(null==l&&(l=!1),o.is_paired)switch(a.role){case r:d=u("Save to personal Dropbox"),c="s_house";break;case s:d=u("Save to %(team_name)s Dropbox").format({team_name:o.team_name}),c="s_briefcase"}else d=u("Save to my Dropbox"),c="dropbox";return new i({text:d,handler:function(){return n.toDropbox(e,t,a)},spriteName:c,isDisabled:l})},i}(l),c.ShareDownloadActionOption=a,c})}.call(this),function(){define("modules/clean/react/sharing/shared_with_view",["external/react","modules/clean/avatar/shared_link_avatar","modules/clean/avatar/size","modules/clean/components/title_bubble","modules/clean/datetime","modules/clean/react/browse/models","modules/clean/sharing/member_avatars","modules/clean/sharing/constants","modules/clean/viewer","modules/core/i18n"],function(e,t,n,i,o,r,s,a,l,u){var c,d,p,_,h,m,f,v,g,y,b;return d=n.AVATAR_DIMENSION_BY_SIZE,b=o.nice_date_with_month_name,p=r.File,m=a.SHMODEL_LINK_TOKEN_VISIBILITY,v=u._,y=e.DOM,g=e.createElement,_=5,c=d.SMALL,h="--",f=e.createClass({displayName:"SharedWithView",mixins:[s],propTypes:{user:e.PropTypes.object.isRequired,file:e.PropTypes.instanceOf(p),onOverflowCountClick:e.PropTypes.func,onAvatarClick:e.PropTypes.func,groups:e.PropTypes.array,invitations:e.PropTypes.array,joinedMembers:e.PropTypes.array,numUndisplayableUsersAndInvites:e.PropTypes.number,numInheritedMembers:e.PropTypes.number,animation:e.PropTypes.bool,titleButtonDirection:e.PropTypes.string,avatarDimension:e.PropTypes.number,maxVisibleAvatars:e.PropTypes.number,sharedLinkInfo:e.PropTypes.object,onSharedLinkClick:e.PropTypes.func},getDefaultProps:function(){return{titleButtonDirection:"south",avatarDimension:c,maxVisibleAvatars:_,file:null}},render:function(){return y.div({className:this.getClassName()},this.renderAvatars())},getClassName:function(){return e.addons.classSet({"shared-with-members":!0,clearfix:!0})},renderAvatars:function(){var e,t,n,i,o,r,s,a,l,u;return i=this.props.joinedMembers?this.props.joinedMembers:[],t=this.props.groups?this.props.groups.slice():[],n=this.props.invitations?this.props.invitations.slice():[],e=[],this.props.sharedLinkInfo&&e.push(this.renderSharedLink(this.props.sharedLinkInfo)),a=this.findOwnerAndMeInJoinedMembers(i),r=a[0],o=a[1],u=[],null!=r&&r===o&&(r=null),null!=r&&(u.push(r.user_id),e.push(this.renderJoinedMember(r))),null!=o&&u.push(o.user_id),this.addGroupsMembersInvitations(e,t,i,n,u),0===e.length?(s=(null!=(l=this.props.file)?l.isDeleted:void 0)?v("deleted"):h,y.span({"aria-hidden":!0},s)):this.renderAvatarList(e)},renderSharedLink:function(e){var n,o;return n=this.sharedLinkAccessTypeString(e),o=g(t,{alt:n,dimension:this.props.avatarDimension,onClick:function(t){return function(){return t.props.onSharedLinkClick(e)}}(this)}),g(i,{key:"shared_link",text:n,direction:"south"},o)},sharedLinkAccessTypeString:function(e){var t,n,i,o,r,s,a,u,c,d,p;if(p=e.visibility_type,i=e.expires_posix,c=e.shared_folder_link_policy,i){if(a=(new Date).getTime()/1e3,u=i-a,n=Math.floor(u/86400),0>u)return v("Link Disabled");t=new Date(1e3*i),d=!1,r=!0,o=n>180,t=b(t,o,d,r)}if(s="MEMBERS_ONLY"===c,t){if(p===m.PUBLIC)return e.is_editable?s?v("Folder members with the link can edit until %(date)s").format({date:t}):v("People with the link can edit until %(date)s").format({date:t}):s?v("Folder members with the link can view until %(date)s").format({date:t}):v("People with the link can view until %(date)s").format({date:t});if(p===m.PASSWORD)return e.is_editable?s?v("Folder members with the password can edit until %(date)s").format({date:t}):v("People with the password can edit until %(date)s").format({date:t}):s?v("Folder members with the password can view until %(date)s").format({date:t}):v("People with the password can view until %(date)s").format({date:t});if(p===m.TEAM_ONLY)return e.is_editable?s?v("Folder members at %(team_name)s can edit until %(date)s").format({team_name:l.get_viewer().team_name,date:t}):v("People at %(team_name)s can edit until %(date)s").format({team_name:l.get_viewer().team_name,date:t}):s?v("Folder members at %(team_name)s can view until %(date)s").format({team_name:l.get_viewer().team_name,date:t}):v("People at %(team_name)s can view until %(date)s").format({team_name:l.get_viewer().team_name,date:t})}else{if(p===m.PUBLIC)return v(e.is_editable?s?"Folder members with the link can edit":"People with the link can edit":s?"Folder members with the link can view":"People with the link can view");if(p===m.PASSWORD)return v(e.is_editable?s?"Folder members with the password can edit":"People with the password can edit":s?"Folder members with the password can view":"People with the password can view");if(p===m.TEAM_ONLY)return e.is_editable?s?v("Folder members at %(team_name)s with the link can edit").format({team_name:l.get_viewer().team_name}):v("People at %(team_name)s with the link can edit").format({team_name:l.get_viewer().team_name}):s?v("Folder members at %(team_name)s with the link can view").format({team_name:l.get_viewer().team_name}):v("People at %(team_name)s with the link can view").format({team_name:l.get_viewer().team_name})}}}),{SharedWithView:f}})}.call(this),function(){define("modules/clean/react/slider",["external/react","modules/clean/css"],function(e,t){var n,i,o,r,s,a,l;return l=t.require_css,a=e.DOM,s=e.addons.classSet,n=e.createClass({displayName:"IndicatorGroup",mixins:[e.addons.PureRenderMixin],propTypes:{className:e.PropTypes.string,currentSlideIndex:e.PropTypes.number.isRequired,slideCount:e.PropTypes.number.isRequired,onIndicatorClick:e.PropTypes.func},render:function(){var e;return a.ul({className:s("c-slider__indicator-group",this.props.className)},function(){e=[];for(var t=0,n=this.props.slideCount;n>=0?n>t:t>n;n>=0?t++:t--)e.push(t);return e}.apply(this).map(function(e){return function(t){return a.li({key:"indicator-"+t,className:s({"c-slider__indicator":!0,"is-active":t===e.props.currentSlideIndex}),onClick:function(){var n;return"function"==typeof(n=e.props).onIndicatorClick?n.onIndicatorClick(t):void 0}})}}(this)))}}),i=e.createClass({displayName:"NavButtonGroup",mixins:[e.addons.PureRenderMixin],propTypes:{className:e.PropTypes.string},render:function(){return a.div({className:s("c-slider__nav-button-group",this.props.className)},this.props.children)}}),r=e.createClass({displayName:"Slides",mixins:[e.addons.PureRenderMixin],propTypes:{currentSlideIndex:e.PropTypes.number.isRequired,width:e.PropTypes.number.isRequired,height:e.PropTypes.number},getSlideCount:function(){return e.Children.count(this.props.children)},render:function(){var t;return a.div({className:"c-slider__window",style:{width:this.props.width+"px",height:null!=(t=this.props.height)?t:"auto"}},a.div({className:"c-slider__slides"},e.Children.map(this.props.children,function(e){return function(t,n){return a.div({className:s({"c-slider__slide":"c-slider__slide","is-active":e.props.currentSlideIndex===n
}),style:{width:e.props.width+"px",transform:"translateX("+100*-e.props.currentSlideIndex+"%)"}},t)}}(this))))}}),o=e.createClass({displayName:"Slider",mixins:[e.addons.PureRenderMixin],propTypes:{className:e.PropTypes.string},componentWillMount:function(){return l("/static/css/components/slider-vflbeTc0k.css")},render:function(){return a.div({className:s("c-slider",this.props.className)},this.props.children)}}),{NavButtonGroup:i,Slider:o,IndicatorGroup:n,Slides:r}})}.call(this),function(){define("modules/clean/react/sprite_div",["external/classnames","external/react","modules/clean/react/sprite"],function(e,t,n){var i,o,r;return o=t.createElement,r=t.DOM.div,i=t.createClass({displayName:"SpriteDiv",propTypes:{group:t.PropTypes.string.isRequired,name:t.PropTypes.string.isRequired,text:t.PropTypes.string,alt:t.PropTypes.string,spritePosition:t.PropTypes.oneOf(["left","right"])},getDefaultProps:function(){return{alt:"",spritePosition:"left"}},render:function(){var t,i,s,a,l,u,c,d;switch(s=this.props.group,l=this.props.name,d=this.props.text,t=this.props.alt,c=e(["sprite-frame","small","icon-"+this.props.spritePosition]),u=r({className:c},o(n,{group:s,name:l,alt:t})),a=r({className:"sprite-text"},d),this.props.spritePosition){case"left":i=[u,a];break;case"right":i=[a,u]}return r({className:"sprite-div"},i)}})})}.call(this),function(){define("modules/clean/react/tabs/tab_bar",["jquery","external/classnames","external/underscore","external/react","modules/clean/css","modules/clean/keycode","modules/clean/react/tabs/tab_util"],function(e,t,n,i,o,r,s){var a;return a=i.PropTypes,i.createClass({displayName:"TabBar",propTypes:{tabs:a.arrayOf(a.oneOfType([a.string,a.number,a.shape({value:a.oneOfType([a.string,a.number]),label:a.string,rightAlign:a.bool})])).isRequired,selectedIndex:a.number,onChange:a.func,idPrefix:a.string},getDefaultProps:function(){return{selectedIndex:0,onChange:function(){}}},componentDidMount:function(){return this._fixTabWidth()},componentDidUpdate:function(){return this._fixTabWidth()},_cleanUpTabWidth:function(){return e("a",this.getDOMNode()).css("width","")},_fixTabWidth:function(){return this._cleanUpTabWidth(),e("a",this.getDOMNode()).width(function(){return e(this).width()})},_normalizedTabs:function(){return this.props.tabs.map(function(e){return"string"!=typeof e&&"number"!=typeof e||(e={value:e,label:e}),e})},_onKeydown:function(e){var t,n,i,o;return o=this._normalizedTabs(),t=null,(n=e.keyCode)===r.LEFT||n===r.UP?t=0===this.props.selectedIndex?o.length-1:this.props.selectedIndex-1:(i=e.keyCode)!==r.RIGHT&&i!==r.DOWN||(t=this.props.selectedIndex===o.length-1?0:this.props.selectedIndex+1),null!=t?(e.preventDefault(),this._selectTab(t,{focusOnTab:!0})):void 0},_selectTab:function(e,t){var n;return null==t&&(t={}),n=this._normalizedTabs()[e],this.props.onChange(n.value,e),t.focusOnTab===!0?this.refs[e].getDOMNode().focus():void 0},_onClick:function(e,t){return t.preventDefault(),e!==this.props.selectedIndex?this._selectTab(e,{focusOnTab:!0}):void 0},_renderTab:function(e,n,o){var r,a,l,u,c;return a=t({"c-tabs__tab":!0,"c-tabs__tab--selected":n===this.props.selectedIndex,"c-tabs__tab--fr":e.rightAlign,"c-tabs__tab--rightmost":o}),u=n===this.props.selectedIndex,l=e.contentId?e.contentId:u?s.getTabContentId(this.props.idPrefix):"",c=u?"0":"-1",r=i.createElement("a",{href:"#",ref:n,id:s.getTabId(this.props.idPrefix,n),onClick:this._onClick.bind(this,n),onKeyDown:this._onKeydown,role:"tab","aria-selected":u,"aria-controls":l,tabIndex:c,className:"c-tabs__label"},e.label),i.createElement("li",{key:e.value,className:a,role:"presentation","data-value":e.value},r)},render:function(){var e,t,n,o;return o=this._normalizedTabs(),t=function(){var t,i,r;for(r=[],e=t=0,i=o.length;i>t;e=++t)n=o[e],r.push(this._renderTab(n,e,e===o.length-1));return r}.call(this),i.createElement("ul",{className:"c-tabs__bar",role:"tablist",ref:"tablist"},t)}})})}.call(this),function(){define("modules/clean/react/tabs/tab_nav",["jquery","external/underscore","external/react","modules/clean/react/tabs/tab_bar","modules/clean/react/tabs/tab_util","modules/clean/react/tabs/tabs"],function(e,t,n,i,o,r){var s,a,l,u,c;return a=r.TabContent,c=n.DOM,u=n.addons.classSet,s=n.PropTypes,l=n.createClass({displayName:"TabNav",propTypes:{tabs:s.arrayOf(s.oneOfType([s.string,s.number,s.shape({value:s.oneOfType([s.string,s.number]),label:s.string,rightAlign:s.bool})])),defaultSelectedIndex:s.number,onChange:s.func,idPrefix:s.string,variant:s.string},getDefaultProps:function(){return{defaultSelectedIndex:0,variant:o.variants.DEFAULT,onChange:function(){}}},getInitialState:function(){return{selectedIndex:this.props.defaultSelectedIndex}},componentWillReceiveProps:function(e){return this.props.defaultSelectedIndex!==e.defaultSelectedIndex?this.setState({selectedIndex:e.defaultSelectedIndex}):void 0},_onChange:function(e,t){return this.props.onChange(e,t),this.setState({selectedIndex:t})},render:function(){var e;return e=this.props.idPrefix?this.props.idPrefix:"tabset"+t.uniqueId(),c.div({className:this.props.variant},n.createElement(i,{tabs:this.props.tabs,onChange:this._onChange,idPrefix:e,selectedIndex:this.state.selectedIndex}),n.createElement(a,{isSelected:!0,id:o.getTabContentId(e),tabId:o.getTabId(e,this.state.selectedIndex)},this.props.children))}})})}.call(this),function(){define("modules/clean/react/tabs/tab_util",[],function(){var e;return e={variants:{DEFAULT:"c-tabs",CENTER:"c-tabs c-tabs--center",MINIMAL:"c-tabs c-tabs--minimal",UNDERLINE:"c-tabs--underline"},getTabId:function(e,t){return e+"_tab"+(null!=t?t:"")},getTabContentId:function(e,t){return e+"_tabcontent"+(null!=t?t:"")}}})}.call(this),function(){define("modules/clean/react/tabs/tabs",["jquery","external/underscore","external/react","modules/clean/react/tabs/tab_bar","modules/clean/react/tabs/tab_util","modules/core/browser"],function(e,t,n,i,o,r){var s,a,l,u,c,d;return d=n.DOM,c=n.addons.classSet,s=n.PropTypes,u=n.addons.cloneWithProps,l=n.createClass({displayName:"Tabs",propTypes:{idPrefix:s.string,variant:s.string},getDefaultProps:function(){return{variant:o.variants.DEFAULT,onChange:function(){}}},getInitialState:function(){var e;return e=this.props.idPrefix?this.props.idPrefix:"tabset"+t.uniqueId(),{selectedIndex:0,idPrefix:e}},componentWillMount:function(){var t,i,r;return r=[],i=this.state.selectedIndex,t=this.state.idPrefix,n.Children.forEach(this.props.children,function(e,n){var s;return s=o.getTabContentId(t,n),r.push({label:e.props.title,contentId:s,hashPrefix:e.props.hashPrefix,hashURL:e.props.hashURL,rightAlign:e.props.rightAlign}),e.props.isSelected?i=n:void 0}),this.setState({tabs:r,selectedIndex:i}),e(window).on("hashchange",this._selectTabFromHash)},componentWillUnmount:function(){return e(window).off("hashchange",this._selectTabFromHash)},componentDidMount:function(){return this._selectTabFromHash()},_onChange:function(e,t){var n;return this.setState({selectedIndex:t}),n=this.state.tabs[t],n.hashURL?r.set_hash(n.hashURL):void 0},_selectTabFromHash:function(){var e,t,n,i,o,s,a,l,u;if(e=r.get_hash(),null!=e){for(u=this.state.tabs,a=[],i=o=0,s=u.length;s>o;i=++o){if(l=u[i],t=l.hashPrefix,n=l.hashURL,null!=t&&0===(null!=e?e.indexOf(t):void 0)||e===n){this.setState({selectedIndex:i});break}a.push(void 0)}return a}},render:function(){return d.div({className:this.props.variant},n.createElement(i,{tabs:this.state.tabs,onChange:this._onChange,idPrefix:this.state.idPrefix,selectedIndex:this.state.selectedIndex}),n.Children.map(this.props.children,function(e){return function(t,n){return u(t,{isSelected:n===e.state.selectedIndex,id:o.getTabContentId(e.state.idPrefix,n),tabId:o.getTabId(e.state.idPrefix,n)})}}(this)))}}),a=n.createClass({displayName:"TabContent",propTypes:{id:s.string,isSelected:s.bool,tabId:s.string,hashPrefix:s.string,hashURL:s.string},render:function(){var e;return e={"c-tabs__content":!0,"c-tabs__content--selected":this.props.isSelected},d.div({id:this.props.id,className:c(e),role:"tabpanel","aria-labelledby":this.props.tabId},this.props.children)}}),{Tabs:l,TabContent:a}})}.call(this),function(){define("modules/clean/react/tooltip",["external/react","external/underscore","jquery"],function(e,t,n){var i,o,r,s,a,l,u,c,d,p;return u={TOP:0,BOTTOM:1,LEFT:2,RIGHT:3},d=e.DOM,r="tooltip-holder",i=7,s=1e4,o="data-event-id",c=function(){var e,t;return e=r,t=n("#"+e),t.length||(t=n("<div />").attr({id:e,style:"z-index: "+s}).prependTo("body")),t[0]},l=e.createClass({displayName:"TooltipBubble",propTypes:{position:e.PropTypes.oneOf(function(){var e;e=[];for(p in u)e.push(u[p]);return e}()),tooltip_target_ref:e.PropTypes.object,contents:e.PropTypes.oneOfType([e.PropTypes.element,e.PropTypes.string]),className:e.PropTypes.string,mouse_move_cb:e.PropTypes.func,mouse_out_cb:e.PropTypes.func},_getDimensionsOfElement:function(e){var t,n,i;return n=e.offset(),i=e.outerWidth(),t=e.outerHeight(),{left_x:n.left,right_x:n.left+i,top_y:n.top,bottom_y:n.top+t,width:i,height:t}},render:function(){var e,t,o,r,s;return t=this._getDimensionsOfElement(n(this.props.tooltip_target_ref.getDOMNode())),o=n(window),s=n(window).scrollTop(),r=n(window).scrollLeft(),e=function(){switch(this.props.position){case u.TOP:return{bottom:o.height()-t.top_y+i+s};case u.BOTTOM:return{top:t.bottom_y+i-s};case u.LEFT:return{right:o.width()-t.left_x+i+r};case u.RIGHT:return{left:t.right_x+i-r}}}.call(this),d.div({className:"tooltip-bubble "+(this.props.className||""),ref:"tooltip",style:e,onMouseMove:this.props.mouse_move_cb?this.props.mouse_move_cb:void 0,onMouseLeave:this.props.mouse_out_cb?this.props.mouse_out_cb:void 0},d.div({className:"tooltip-inner"},this.props.contents))},componentDidMount:function(){return this._centerAndShow()},componentDidUpdate:function(){return this._centerAndShow()},_centerAndShow:function(){var e,t,i,o,r,s,a,l,c;return e=n(this.refs.tooltip.getDOMNode()),a=this._getDimensionsOfElement(n(this.props.tooltip_target_ref.getDOMNode())),l=this._getDimensionsOfElement(e),s=n(window).scrollTop(),r=n(window).scrollLeft(),(i=this.props.position)===u.TOP||i===u.BOTTOM?(t=a.left_x+a.width/2-l.width/2-r,e.css("left",t+"px")):(o=this.props.position)!==u.LEFT&&o!==u.RIGHT||(c=a.top_y+a.height/2-l.height/2-s,e.css("top",c+"px")),e.show()}}),a=e.createClass({displayName:"Tooltip",propTypes:{position:e.PropTypes.oneOf(function(){var e;e=[];for(p in u)e.push(u[p]);return e}()),tooltip_contents:e.PropTypes.element,tooltip_classname:e.PropTypes.string,hide_delay:e.PropTypes.number,interaction_enabled:e.PropTypes.bool},render:function(){return d.div({className:"tooltip-target",onMouseMove:function(e){return function(t){return e._show(t)}}(this),onMouseLeave:this._on_mouse_leave(),id:this.state.tooltip_id,ref:"tooltipTarget"},this.props.children)},componentDidMount:function(){return n(document).bind("scroll."+this.state.event_id,function(e){return function(t){return e._hide(t)}}(this))},componentDidUpdate:function(){return this.state.visible?this._render_tooltip():void 0},componentWillUnmount:function(){var t;return n(document).unbind("scroll."+this.state.event_id),t=c(),e.unmountComponentAtNode(t)},_on_mouse_leave:function(e){return function(e){return function(t){return e.props.hide_delay>0?e._scheduleHide(e.props.hide_delay):e._hide(t)}}(this)},_render_tooltip:function(){var t,i;return i=c(),n("#"+r).css("position","fixed"),n("#"+r).css("left","0"),n("#"+r).css("right","0"),this.props.hide_delay>0&&n("#"+r).attr(o,this.state.event_id),this.props.position===u.TOP?(n("#"+r).css("top","auto"),n("#"+r).css("bottom","0")):(n("#"+r).css("top","0"),n("#"+r).css("bottom","auto")),t=l({position:this.props.position,contents:this.props.tooltip_contents,tooltip_target_ref:this.refs.tooltipTarget,className:this.props.tooltip_classname,mouse_move_cb:this.props.interaction_enabled?this._clear_timeout:void 0,mouse_out_cb:this.props.interaction_enabled?this._on_mouse_leave():void 0}),e.unmountComponentAtNode(i),e.render(t,i)},_show:function(){return!this.state.visible||this._last_timeout?(this._render_tooltip(),this.setState({visible:!0}),this._clear_timeout()):void 0},_hide:function(){var t,i;if(this.state.visible)return i=c(),this._last_timeout?(t=n(i).attr(o),t===this.state.event_id&&(e.unmountComponentAtNode(i),null!=this._clear_timeout())):e.unmountComponentAtNode(i),this.setState({visible:!1})},_scheduleHide:function(e){return this.state.visible?this._last_timeout=setTimeout(this._hide,e):void 0},_clear_timeout:function(){return this._last_timeout?(clearTimeout(this._last_timeout),this._last_timeout=null):void 0},getInitialState:function(){return{visible:!1,event_id:t.uniqueId()}},getDefaultProps:function(){return{interaction_enabled:!1,hide_delay:0}}}),{Tooltip:a,TooltipPosition:u}})}.call(this),function(){define("modules/clean/react/user_notifications/actions",["external/underscore","modules/clean/loggers/notification_logger","modules/clean/notserver","modules/clean/react/user_notifications/api","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/dispatcher","modules/clean/react/user_notifications/store"],function(e,t,n,i,o,r,s){var a,l,u,c;return u=t.NotificationLogger,l=n.NotClients,a=o.ActionTypes,new(c=function(){function t(){}return t.prototype.load=function(){return r.dispatch({type:a.LOAD_REQUEST}),i.getAll().then(function(e){var t;return t=[],t=t.concat(e.notifications),e.metaNotification&&t.push(e.metaNotification),u.logReceive(t),r.dispatch({type:a.LOAD_SUCCESS,data:e}),e},function(){return r.dispatch({type:a.LOAD_FAILURE})})},t.prototype.loadOnceAndWatch=function(){return this._hasLoadedOnce?void 0:(this._hasLoadedOnce=!0,this.load(),this._watch())},t.prototype.acknowledge=function(){return 0!==s.getUnacknowledgedCount()?(r.dispatch({type:a.ACKNOWLEDGEMENT_REQUEST}),i.ackAll().then(function(e){return r.dispatch({type:a.ACKNOWLEDGEMENT_SUCCESS,data:{notifications:e}})},function(){return r.dispatch({type:a.ACKNOWLEDGEMENT_FAILURE})})):void 0},t.prototype.resetAcknowledgements=function(){return r.dispatch({type:a.RESET_ACKNOWLEDGEMENTS})},t.prototype._watch=function(){return e.each(l,function(e){return function(t,n){var i;return i=t.subscribe_user({name:"UserNotificationsActions",handler:function(){return e.load().then(function(e){return t.handler_success(i,{nid:e.latestNid[n]})},function(){return t.handler_failure(i)})}})}}(this))},t}())})}.call(this),function(){define("modules/clean/react/user_notifications/api",["modules/clean/ajax","modules/clean/react/user_notifications/models"],function(e,t){var n,i,o,r,s,a,l;return i=t.SharedFolderInviteData,o=t.UserNotification,r={},n=100,l=function(e){return new o({id:e.nid,userId:e.user_id,typeId:e.type_id,typeData:a(e),targetObjectKey:e.target_object_key,status:e.status,isSticky:e.sticky,feedTime:e.feed_time,rawDropdownRowHtml:e.notification_div})},a=function(e){switch(e.type_id){case o.TYPES.SHARED_FOLDER_INVITE:return s(e)}},s=function(e){return new i({overQuotaStatus:e.sf_invite_overquota})},r.getAll=function(){var t,i;return t={count:n},i=e.WebRequest({url:"/web/notifications/retrieve",data:t,dataType:"json"}),i.then(function(e){var t,n;return n=e.notifications.map(l),t=e.meta_notification&&l(e.meta_notification),{latestNid:e.latest_nid,metaNotification:t,notifications:n}})},r.ackAll=function(){var t;return t=e.WebRequest({url:"/web/notifications/ack_all",dataType:"json"}),t.then(function(e){var t;return t=e.map(l)})},r})}.call(this),function(){define("modules/clean/react/user_notifications/constants",function(){var e;return e={},e.ActionTypes={LOAD_REQUEST:"USER_NOTIFICATIONS_LOAD_REQUEST",LOAD_SUCCESS:"USER_NOTIFICATIONS_LOAD_SUCCESS",LOAD_FAILURE:"USER_NOTIFICATIONS_LOAD_FAILURE",ACKNOWLEDGEMENT_REQUEST:"USER_NOTIFICATIONS_ACKNOWLEDGEMENT_REQUEST",ACKNOWLEDGEMENT_SUCCESS:"USER_NOTIFICATIONS_ACKNOWLEDGEMENT_SUCCESS",ACKNOWLEDGEMENT_FAILURE:"USER_NOTIFICATIONS_ACKNOWLEDGEMENT_FAILURE",RESET_ACKNOWLEDGEMENTS:"USER_NOTIFICATIONS_RESET_ACKNOWLEDGEMENTS"},e.EventTypes={RENDERED_NOTIFICATIONS:"USER_NOTIFICATIONS_RENDERED_NOTIFICATIONS"},e})}.call(this),function(){define("modules/clean/react/user_notifications/dispatcher",["modules/clean/flux/dispatcher"],function(e){return e})}.call(this),function(){define("modules/clean/react/user_notifications/dropdown",["external/classnames","external/react","modules/clean/react/bubble_dropdown","modules/clean/react/css","modules/clean/react/user_notifications/actions","modules/clean/react/user_notifications/dropdown_bell","modules/clean/react/user_notifications/dropdown_body","modules/clean/react/user_notifications/store","modules/core/i18n"],function(e,t,n,i,o,r,s,a,l){var u,c,d,p,_,h,m,f;return _=l._,u=t.createFactory(n),d=t.createFactory(r),p=t.createFactory(s),f=t.DOM,h=f.button,m=f.div,c=t.createClass({displayName:"UserNotificationsDropdown",getInitialState:function(){return this._getStateFromStore()},componentDidMount:function(){return o.loadOnceAndWatch(),this._removeStoreListener=a.addListener(this._onUpdateFromStore)},componentWillUnmount:function(){return this._removeStoreListener()},_getStateFromStore:function(){return{unacknowledgedCount:a.getUnacknowledgedCount()}},_onUpdateFromStore:function(){return this.setState(this._getStateFromStore())},render:function(){var e;return e=h({className:"header-nav-link sprite-button notification-button"},d({unacknowledgedCount:this.state.unacknowledgedCount})),u({targetButton:e,arrow_position:"top-right",vertical_displacement:2,extra_css_class:"no-padding notifications-dropdown",bubbleDropdownScrollable:!0},m({className:"notifications-header"},_("Notifications")),p({}))}}),c=i(c,["/static/css/notifications-vflQ7TnA5.css"])})}.call(this),function(){define("modules/clean/react/user_notifications/dropdown_bell",["external/classnames","external/react","modules/clean/components/scooter/badge","modules/clean/css","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,i,o,r){var s,a,l,u,c,d,p;return c=r._,p=r.ungettext,s=t.createFactory(n),l=t.createFactory(o),d=t.DOM.span,a=500,u=t.createClass({displayName:"UserNotificationsDropdownBell",propTypes:{unacknowledgedCount:t.PropTypes.number.isRequired},getInitialState:function(){var e;return e=this.props.unacknowledgedCount>0,e&&this._scheduleShakeReset(),{isShaking:e}},componentWillMount:function(){return i.require_css("/static/css/scooter/scooter-scoped-vfljb_RbQ.css")},componentWillReceiveProps:function(e){var t;return t=e.unacknowledgedCount>0&&e.unacknowledgedCount!==this.props.unacknowledgedCount,t?(this.setState({isShaking:!0}),this._scheduleShakeReset()):void 0},_scheduleShakeReset:function(){return clearTimeout(this._shakeResetTimeout),this._shakeResetTimeout=setTimeout(function(e){return function(){return e.setState({isShaking:!1})}}(this),a)},render:function(){var t,i;return i=null,this.props.unacknowledgedCount>0&&(i=p("%(count)s new","%(count)s new",this.props.unacknowledgedCount,{comment:"new notification count"}).format({count:this.props.unacknowledgedCount})),t=e({web:!0,"notifications-bell":!0,shake:this.state.isShaking}),d({className:"notification-button-bell-container"},d({className:"ax-visually-hidden"},i),l({group:"web",name:"notifications_icon_blue",className:t,alt:c("Notifications")}),s({count:this.props.unacknowledgedCount,position:n.POSITIONS.TOP_RIGHT}))}})})}.call(this),function(){define("modules/clean/react/user_notifications/dropdown_body",["external/react","jquery","modules/clean/loggers/folder_invite_impression_logger","modules/clean/loggers/notification_logger","modules/clean/static_urls","modules/clean/react/user_notifications/actions","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/dropdown_row","modules/clean/react/user_notifications/event_emitter","modules/clean/react/user_notifications/store","modules/core/i18n"],function(e,t,n,i,o,r,s,a,l,u,c){var d,p,_,h,m,f,v,g,y,b,w,E,T;return h=i.NotificationLogger,T=o.static_url,d=s.EventTypes,v=c._,E=T,w=e.DOM,y=w.div,b=w.img,p=10,_=10,m=10,f=e.createClass({displayName:"UserNotificationsDropdownBody",componentWillMount:function(){return this._folderInviteImpressionLogger=new n,this._folderInviteImpressionLogger.listenTo(l)},componentDidMount:function(){return this._removeStoreListener=u.addListener(this._onUpdateFromStore),this._addEventHandlers(),this._setStateFromStore(),this._legacyRender(),r.acknowledge()},shouldComponentUpdate:function(){return!1},componentWillUnmount:function(){return this._removeStoreListener(),this._folderInviteImpressionLogger.unlistenTo(l),r.resetAcknowledgements()},_onUpdateFromStore:function(){return this._setStateFromStore(),this._legacyRender()},_addEventHandlers:function(){var e;return e=t(this.getDOMNode()),e.scroll(this._onScroll),e.on("mousewheel",this._onMouseScroll),e.on("DOMMouseScroll",this._onMouseScroll)},_setStateFromStore:function(){return this._notifications=u.getAll().sort(g),this._isLoading=u.isLoading()},_removeNotifications:function(){var e;return e=t(this.getDOMNode()),e.find("#event-feed").empty(),this._hasMore=this._notifications.length>0},_appendNotifications:function(e){var n,i,o,r;return null==e&&(e=_),require(["dropbox"]),n=t(this.getDOMNode()),o=n.find(".feed-row").size(),r=this._notifications.slice(o,o+e),h.logRender(r,o),r.forEach(function(e){var t,i,o;return o=u.isAcknowledged(e),t=a.buildLegacyElement(e,o),i=t,n.find("#event-feed").append(i)}),i=o+r.length,this._hasMore=i<this._notifications.length,n.toggleClass("empty",0===i),l.emit(d.RENDERED_NOTIFICATIONS,{notifications:r})},_onScroll:function(){return this._hasMore&&this._scrollWithinOffsetToBottom(m)?this._appendNotifications():void 0},_onMouseScroll:function(e){var t,n,i;return i=e.originalEvent||e,t=i.detail?-40*i.detail:i.wheelDelta,n=this.getDOMNode(),!this._hasMore&&0>=t&&this._scrollWithinOffsetToBottom(0)?e.preventDefault():t>=0&&0===n.scrollTop?e.preventDefault():void 0},_scrollWithinOffsetToBottom:function(e){var t,n;return t=this.getDOMNode(),n=t.scrollHeight-t.scrollTop-t.offsetHeight,e>=n},_legacyRender:function(){return this._isLoading?void 0:(this._removeNotifications(),this._appendNotifications(p))},render:function(){return y({id:"event-feed-container",className:"show"},y({id:"event-feed"},y({id:"notification-loading"},b({src:E("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:v("Loading...")}))),y({id:"event-feed-empty"},b({src:E("/static/images/empty_notifications-vflQy8YVJ.png"),alt:""}),y({id:"event-feed-empty-text"},v("We’ll let you know when we’ve got something new for you!"))))}}),g=function(e,t){return e.isSticky&&!t.isSticky?-1:t.isSticky&&!e.isSticky?1:e.isUnread&&!t.isUnread?-1:t.isUnread&&!e.isUnread?1:t.feedTime-e.feedTime},f})}.call(this),function(){define("modules/clean/react/user_notifications/dropdown_row",["external/underscore","jquery","modules/clean/react/user_notifications/legacy_thumb_loader","modules/clean/react/user_notifications/actions","modules/clean/react/user_notifications/models","modules/clean/sharing/notifications","modules/clean/sprite"],function(e,t,n,i,o,r,s){var a,l,u,c,d,p;return a=o.UserNotification,c=r.register_dismiss,d=r.register_mount,p=r.upgrade_to_mount,u=new n,l={buildLegacyElement:function(e,n){var i;return i=t(e.rawDropdownRowHtml),this._initImages(i),this._addClientStateClasses(i,e,n),this._initMetaNotificationHandlers(i),this._initSharedContentInviteActionHandlers(i),i},_initImages:function(e){return e.find("img").each(function(e){return function(n,i){var o;return o=t(i),o.attr("alt",""),e._loadImage(o)}}(this))},_loadImage:function(t){var n;return(n=t.data("src"))?u.load(n).progress(function(){return t.data("src",null),t.data("loading-src",n)}).then(function(n){var i;return t.data("loading-src",null),i=function(){return t.addClass("thumbnail"),t.parent(".feed-thumbnail").addClass("has-frame")},0===n.indexOf("data:image")?i():(t.load(i),t.error(e.once(function(){var e;return e=t.data("fail-src")||s.SPACER,t.attr("src",e)}))),t.attr("src",n)}):void 0},_addClientStateClasses:function(e,t,n){var i;return i=e.hasClass("feed-row")?e:e.find(".feed-row"),t.type===a.TYPES.META&&(i.addClass("meta-feed"),n&&i.addClass("read")),t.isInvisible&&i.addClass("invisible"),t.isRead&&!n?i.addClass("read"):void 0},_initMetaNotificationHandlers:function(e){return e.filter("a.meta-notification-sign-in-needed").on("click",function(e){return e.preventDefault(),require(["modules/clean/multiaccount_login"],function(e){return e.show_page_login_modal(function(){return i.load()})})})},_initSharedContentInviteActionHandlers:function(e){return e.on("click",".share-content-dismiss",function(){return c(this),!1}),e.on("click",".share-content-mount",function(){return d(this),!1}),e.on("click",".share-content-upgrade-mount",function(){return p(),!1})}}})}.call(this),function(){define("modules/clean/react/user_notifications/event_emitter",["modules/clean/event_emitter"],function(e){var t;return new(t=e)})}.call(this),function(){define("modules/clean/react/user_notifications/legacy_thumb_loader",["external/underscore","jquery","modules/clean/photos/batch_thumb_loader"],function(e,t,n){var i,o,r;return r=16,o=24,i=function(){function i(){var t;this._cache={},t=new n({batch_size:r,max_parallel_request:o}),this._queueThumb=function(e,n,i){return t.queue_thumb(e,n,{onrequest:i})},this._flushQueue=e.debounce(function(){return t.flush()},0)}return i.prototype.load=function(e){var n;return this._cache[e]||(n=new t.Deferred,this._queueThumb(e,n.resolve,n.notify),this._flushQueue(),this._cache[e]=n.promise()),this._cache[e]},i}()})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/react/user_notifications/models",["external/immutable"],function(t){var n,i,o,r,s,a,l,u,c;return c={},i={UNREAD:0,READ:1,INVISIBLE:2},o={0:"unread",1:"read",2:"invisible"},a={META:-1,SHARED_FOLDER_INVITE:100},u=t.Record({id:void 0,userId:void 0,typeId:void 0,typeData:void 0,targetObjectKey:void 0,status:void 0,isSticky:void 0,feedTime:void 0,rawDropdownRowHtml:void 0}),l=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.STATUSES=i,n.STATUS_STRINGS=o,n.TYPES=a,Object.defineProperties(n.prototype,{key:{get:function(){return this.userId+" "+this.typeId+" "+this.targetObjectKey}},isUnread:{get:function(){return this.status===i.UNREAD}},isRead:{get:function(){return this.status===i.READ}},isInvisible:{get:function(){return this.status===i.INVISIBLE}},type:{get:function(){return this.typeId}}}),n}(u),n={ALREADY_OVER:"overquota",WILL_BE_OVER:"will_be_overquota"},s=t.Record({overQuotaStatus:void 0}),r=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.OVER_QUOTA_STATUSES=n,i}(s),c.UserNotification=l,c.SharedFolderInviteData=r,c})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/react/user_notifications/store",["external/immutable","external/modernizr","modules/clean/flux/flux_store","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/dispatcher"],function(t,n,i,o,r){var s,a,l;return s=o.ActionTypes,a="last_acked_meta_id_key",new(l=function(i){function o(e){var n;o.__super__.constructor.call(this,e),this._isLoading=!1,this._metaNotification=null,this._userNotifications=new t.List,this._acknowledgedNotificationKeys=new t.Set,n=this._getAcknowledgedMetaNotificationKey(),n&&(this._acknowledgedNotificationKeys=this._acknowledgedNotificationKeys.add(n))}return e(o,i),o.prototype.isLoading=function(){return this._isLoading},o.prototype.getUnacknowledgedCount=function(){return this._getUnacknowledged().size},o.prototype.getAll=function(){return this._getAll().toArray()},o.prototype.isAcknowledged=function(e){return this._acknowledgedNotificationKeys.has(e.key)},o.prototype._getAll=function(){var e;return e=this._userNotifications,this._metaNotification&&(e=e.push(this._metaNotification)),e},o.prototype._getUnacknowledged=function(){var e;return e=this._getAll().filter(function(e){return e.isUnread}),e.filter(function(e){return function(t){return!e.isAcknowledged(t)}}(this))},o.prototype._onLoadRequest=function(){return this._isLoading?void 0:(this._isLoading=!0,this.__emitChange())},o.prototype._onLoadSuccess=function(e){var n,i;return this._isLoading&&(this._isLoading=!1,this.__emitChange()),i=new t.List(e.notifications),this._userNotifications.equals(i)||(this._userNotifications=i,this.__emitChange()),n=e.metaNotification,this._metaNotification&&!this._metaNotification.equals(n)||this._metaNotification!==n?(this._metaNotification=n,this.__emitChange()):void 0},o.prototype._onLoadFailure=function(){return this._isLoading?(this._isLoading=!1,this.__emitChange()):void 0},o.prototype._onAcknowledgementRequest=function(){var e;return e=new t.Set(this._getUnacknowledged().map(function(e){return e.key})),this._acknowledgedNotificationKeys.equals(e)?void 0:(this._acknowledgedNotificationKeys=e,this.__emitChange())},o.prototype._onAcknowledgementSuccess=function(e){var n,i;return i=new t.Set(e),this._metaNotification&&(i=i.add(this._metaNotification),this._setAcknowledgedMetaNotificationKey()),n=i.map(function(e){return e.key}),n.equals(this._acknowledgedNotificationKeys)?void 0:(this._acknowledgedNotificationKeys=n,this.__emitChange())},o.prototype._getAcknowledgedMetaNotificationKey=function(){return n.localstorage?window.localStorage.getItem(a):null},o.prototype._setAcknowledgedMetaNotificationKey=function(){return n.localstorage&&this._metaNotification?window.localStorage.setItem(a,this._metaNotification.key):void 0},o.prototype._onResetAcknowledgements=function(){var e;return e=new t.Set,this._metaNotification&&(e=e.add(this._metaNotification.key)),e.equals(this._acknowledgedNotificationKeys)?void 0:(this._acknowledgedNotificationKeys=e,this.__emitChange())},o.prototype.__onDispatch=function(e){switch(e.action.type){case s.LOAD_REQUEST:return this._onLoadRequest();case s.LOAD_SUCCESS:return this._onLoadSuccess(e.action.data);case s.LOAD_FAILURE:return this._onLoadFailure();case s.ACKNOWLEDGEMENT_REQUEST:return this._onAcknowledgementRequest();case s.ACKNOWLEDGEMENT_SUCCESS:return this._onAcknowledgementSuccess(e.action.data.notifications);case s.RESET_ACKNOWLEDGEMENTS:return this._onResetAcknowledgements()}},o}(i))(r)})}.call(this),function(){define("modules/clean/referrer_cleansing_redirect",["external/sjcl","modules/constants/request","modules/core/browser","modules/core/cookies","modules/core/uri"],function(e,t,n,i,o){var r,s,a,l;return l=function(n){var o,r,s,a;return o=e.codec.utf8String.toBits(i.read(t.JS_CSRF_COOKIE)),a=e.codec.utf8String.toBits(n),r=new e.misc.hmac(o),s=r.encrypt(n),e.codec.base64.fromBits(s)},s=function(e){var t,n;return t=o.parse(e).scheme,t&&"http"!==t&&"https"!==t?"#":(n=new o({path:"/referrer_cleansing_redirect"}),n.setQuery({url:e,hmac:l(e)}),n)},a=function(e){return n.redirect(s(e))},r={get_redirect_uri:s,redirect:a}})}.call(this),function(){define("modules/clean/revisions/file_revisions_iterator",["jquery","modules/clean/ajax","modules/clean/react/browse/models"],function(e,t,n){var i,o,r,s,a;return i=n.File,s=50,o=function(){function e(e){this.file=e.file}return e}(),a=function(e){return new o({file:i.fromServerObject(e.preview_info)})},r=function(){function n(e,t,n){this.fqPath=e,this.userId=t,null==n&&(n={}),this.cursor=n.initialCursor||null,this.deserializer=n.deserializer||a}return n.prototype.next=function(n){var i,o;return null==n&&(n=s),o=new e.Deferred,i={path:this.fqPath,limit:n},this.cursor&&(i.cursor=this.cursor),t.WebRequest({url:"/file_revisions",type:"GET",subject_user:this.userId,data:i,success:function(e){return function(t){var n,r;return i=JSON.parse(t),e.cursor=i.cursor,r=function(){var e,t,o,r;for(o=i.revisions,r=[],e=0,t=o.length;t>e;e++)n=o[e],
r.push(this.deserializer(n));return r}.call(e),o.resolve({revisions:r,hasMore:i.more})}}(this),error:function(e){return o.reject({errorText:e.error_text})}}),o.promise()},n}()})}.call(this),function(){define("modules/clean/search/search_helpers",["jquery","modules/clean/history"],function(e,t){var n;return n={buildSearchURL:function(e,i,o){var r;return r=n.queryParams(i,o),t.construct_url("/search/"+e.role,r)},queryParams:function(e,t){var n;return null==e&&(e=""),null==t&&(t=""),n=e.toLowerCase().trim().replace(/\ +/g," "),{query:n,query_unnormalized:e,last_fq_path:t}},highlightMatch:function(t,n){var i,o,r,s,a,l,u,c;for(r=0,a=0,o=e("<span />");r<t.length;)u=n[a],a>=n.length?(l=!1,s=r+t.length):u.pos>r?(l=!1,s=u.pos):(l=!0,s=u.pos+u.len),c=t.substring(r,s),i=e("<span/>").text(c),i.addClass(""),l&&(i.addClass("highlighted"),i.addClass("is-highlighted")),o.append(i),r=s,l&&a++;return o},highlightMatchString:function(e,t){return this.highlightMatch(e,t)[0].innerHTML}}})}.call(this),function(){define("modules/clean/search/search_type",function(){var e;return e={COMPLETION:"completion",DELETED:"deleted",FULLTEXT:"full-text"}})}.call(this),function(){define("modules/clean/sharing/action_types",["modules/clean/flux/action_type"],function(e){var t,n;return n=e.withActionNamespace,t=n("share-modal-actions",{SHARE_MODAL_OPEN:"share-modal-open",SHARE_MODAL_CLOSE:"share-modal-close",RESET_MODAL_STATE:"reset-modal-state",OPEN_LINK_SETTINGS_MODAL:"open-link-settings-modal",OPEN_FOLDER_SETTINGS_MODAL:"open-folder-settings-modal",OPEN_SHARED_LINK_MODAL:"open-shared-link-modal",CLOSE_LINK_SETTINGS_MODAL:"close-link-settings-modal",CLOSE_FOLDER_SETTINGS_MODAL:"close-folder-settings-modal",CLOSE_SHARED_LINK_MODAL:"close-shared-link-modal",CLEAR_METADATA:"clear-metadata",FETCH_METADATA_REQUEST:"metadata-request",FETCH_METADATA_SUCCESS:"metadata-success",FETCH_METADATA_FAILURE:"metadata-failure",CLEAR_LINK_METADATA:"clear-link-metadata",FETCH_LINK_METADATA_REQUEST:"link-metadata-request",FETCH_LINK_METADATA_SUCCESS:"link-metadata-success",FETCH_LINK_METADATA_FAILURE:"link-metadata-failure",ERROR_MESSAGE:"error-message",ERROR_MESSAGE_CLEAR:"error-message-clear",CLEAR_FILE_MEMBERSHIP:"clear-file-membership",FETCH_FILE_MEMBERSHIP_REQUEST:"fetch-file-membership-request",FETCH_FILE_MEMBERSHIP_SUCCESS:"fetch-file-membership-success",FETCH_FILE_MEMBERSHIP_FAILURE:"fetch-file-membership-failure",CLEAR_FOLDER_MEMBERSHIP:"clear-folder-membership",FETCH_FOLDER_MEMBERSHIP_REQUEST:"fetch-folder-membership-request",FETCH_FOLDER_MEMBERSHIP_SUCCESS:"fetch-folder-membership-success",FETCH_FOLDER_MEMBERSHIP_FAILURE:"fetch-folder-membership-failure",FETCH_USER_ACCOUNTS_REQUEST:"fetch-user-accounts-request",FETCH_USER_ACCOUNTS_SUCCESS:"fetch-user-accounts-success",FETCH_USER_ACCOUNTS_FAILURE:"fetch-user-accounts-failure",CHANGE_RECIPIENTS:"change-recipients",CHANGE_RECIPIENT_MESSAGE:"change-recipient-message",CHANGE_RECIPIENT_ACCESS:"change-recipient-access",CREATE_LINK_REQUEST:"create-link-request",CREATE_LINK_SUCCESS:"create-link-success",CREATE_LINK_FAILURE:"create-link-failure",SEND_SHARE_START:"send-share-start",SEND_SHARE_SUCCESS:"send-share-success",SEND_SHARE_FAILURE:"send-share-failure",SHARE_FILE_REQUEST:"share-file-request",SHARE_FILE_SUCCESS:"share-file-success",SHARE_FILE_FAILURE:"share-file-failure",SHARE_FOLDER_REQUEST:"share-folder-request",SHARE_FOLDER_SUCCESS:"share-folder-success",SHARE_FOLDER_FAILURE:"share-folder-failure",SEND_FOLDER_SHARE_REQUEST:"send-folder-share-request",SEND_FOLDER_SHARE_SUCCESS:"send-folder-share-success",SEND_FOLDER_SHARE_FAILURE:"send-folder-share-failure",SEND_FILE_SHARE_REQUEST:"send-file-share-request",SEND_FILE_SHARE_SUCCESS:"send-file-share-success",SEND_FILE_SHARE_FAILURE:"send-file-share-failure",CHANGE_MEMBER_ACCESS_REQUEST:"change-member-access-request",CHANGE_MEMBER_ACCESS_SUCCESS:"change-member-access-success",CHANGE_MEMBER_ACCESS_FAILURE:"change-member-access-failure",REMOVE_MEMBER_REQUEST:"remove-member-request",REMOVE_MEMBER_SUCCESS:"remove-member-success",REMOVE_MEMBER_FAILURE:"remove-member-failure",FETCH_TEAM_POLICY_REQUEST:"fetch-team-policy-request",FETCH_TEAM_POLICY_SUCCESS:"fetch-team-policy-success",CAN_RELINQUISH_MEMBERSHIP:"can-relinquish-membership"}),{ShareModalActionTypes:t}})}.call(this),function(){define("modules/clean/sharing/api",["modules/clean/ajax","modules/core/exception","jquery"],function(e,t,n){var i,o,r,s,a;return s=e.WebRequest,i=e.FormWebRequest,a=t.assert,o=function(){function e(e){this.user=e}return e.REQUEST_SUCCEEDED_EVENT="db:sharing_api:request_succeeded",e.prototype.invite_more_to_folder=function(e,t,n,i,o,r){var s;return s={ns_id:e,emails:t.emails||[],fb_ids:t.fb_ids||[],group_ids:t.group_ids||[],new_style_group_ids:t.new_style_group_ids||[],custom_message:n||"",access_type:i},this._make_request("/share_ajax/invite_more",s,o,r,!0)},e.prototype.update_member_access_type=function(e,t,n,i,o){var r;return r={ns_id:e,member_uid:t,access_type:n},this._make_request("/share_ajax/update_member_access_type",r,i,o)},e.prototype.update_team_folder_access_type=function(e,t,n,i){var o;return o={ns_id:e,can_edit:t},this._make_request("/team/admin/team_folder/update_access_type",o,n,i,!0,!1)},e.prototype.update_invite_access_type=function(e,t,n,i){var o;return o={invite_id:e,access_type:t},this._make_request("/share_ajax/update_invite_access_type",o,n,i)},e.prototype.share_folder=function(e,t,n,i,o,r,s,a,l,u,c){var d,p;return d={emails:n.emails||[],fb_ids:n.fb_ids||[],group_ids:n.group_ids||[],new_style_group_ids:n.new_style_group_ids||[],custom_message:i||"",audience:o,inviter:r,shared_link_policy:s,access_type:a,folder_settings:1},e?(d.folder_name=t,p="/share_ajax/new"):(d.path=t,p=l?"/share_ajax/existing_no_recipient":"/share_ajax/existing"),(o||r)&&(d.custom_folder_settings=1),this._make_request(p,d,u,c,!0)},e.prototype.share_path=function(e,t,n,i,o,r,s,a,l,u){var c,d;return c={emails:t.emails||[],fb_ids:t.fb_ids||[],group_ids:t.group_ids||[],new_style_group_ids:t.new_style_group_ids||[],custom_message:n||"",audience:i,inviter:o,shared_link_policy:r,access_type:s,folder_settings:1,path:e},d="/share_ajax/new_path",(i||o)&&(c.custom_folder_settings=1),this._make_request(d,c,l,u,!0)},e.prototype.unshare_folder=function(e,t,n){var i;return i={ns_id:e,async:!0},t&&(i.keep_files=!0),this._make_request("/share_ajax/unshare?long_running",i,n)},e.prototype.leave_folder=function(e,t,n){var i;return i={ns_id:e},t&&(i.keep_files=!0),this._make_request("/share_ajax/leave?long_running",i,n)},e.prototype.transfer_ownership=function(e,t,n){var i;return i={ns_id:e,user_id:t},this._make_request("/share_ajax/change_sf_owner",i,n)},e.prototype.cancel_invite=function(e,t,n){var i;return i={ns_id:e,invite_id:t},this._make_request("/share_ajax/cancel_invite",i,n)},e.prototype.kick=function(e,t,n,i){var o;return o={ns_id:e,user_id:t},n&&(o.keep_files=!0),this._make_request("/share_ajax/kick_user",o,i)},e.prototype.reinvite_user=function(e,t,n){var i;return i={ns_id:e,invite_id:t},this._make_request("/share_ajax/reinvite_user",i,n)},e.prototype.update_sf_permissions=function(e,t,n,i){var o;return o={ns_id:e,new_permissions:t},this._make_request("/share_ajax/change_sf_perm",o,n,i)},e.prototype.update_sf_team_permissions=function(e,t,n,i,o,r){var s;return s={ns_id:e,audience:t,inviter:n,shared_link_policy:i},void 0!==o&&(s.activity_feed_enabled=o),this._make_request("/share_ajax/save_folder_settings",s,r)},e.prototype.validate_new_sf_path=function(e,t,n){var i;return i={share_type:"new",folder_name:e},this._make_request("/share_ajax/validate_folder",i,t,n,!0)},e.prototype.validate_existing_sf_path=function(e,t,n){var i;return i={share_type:"existing",path:e},this._make_request("/share_ajax/validate_folder",i,t,n,!0)},e.prototype._make_request=function(t,o,r,a,l,u){var c,d,p;return null==l&&(l=!1),null==u&&(u=!0),c={url:t,data:o,success:function(i,s,a){return"function"==typeof r&&r(a),n(document).trigger(e.REQUEST_SUCCEEDED_EVENT,{request_url:t,ns_id:o.ns_id||null})},error:function(e){return"function"==typeof a?a(e):void 0},complete:function(e){return function(){var t;return null!=(t=e.loading_elem)?t.removeClass("ajax-loading"):void 0}}(this)},u&&(c.subject_user=this.user.id),null!=(d=this.loading_elem)&&d.addClass("ajax-loading"),(p=l?i:s)(c)},e}(),r=function(){function e(){}return e.prototype.get_inbox_counts=function(e){return new s({url:"/inbox_count",success:function(t,n,i){var o;return o=JSON.parse(i.responseText),a("object"==typeof o,"bad inbox_count"),e(o)}})},e.prototype.get_folder_info=function(e,t){return new s({url:"/share_ajax/list_folders",success:function(t,n,i){return"function"==typeof e?e(i):void 0},error:function(e){return"function"==typeof t?t(e):void 0}})},e}(),{SharingApi:o,UserlessSharingApi:r}})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/sharing/api/client",["external/immutable","external/underscore","modules/clean/api_v2/client","modules/clean/contacts/types","external/rsvp","modules/clean/sharing/constants","modules/clean/sharing/api/types/metadata","modules/clean/sharing/api/util/types","modules/core/exception","modules/core/user_i18n"],function(t,n,i,o,r,s,a,l,u,c){var d,p,_,h,m,f,v,g,y,b,w,E,T,C,S,k,I,A,P,N,R,O,D,x,L,M,F,U;return C=i.UserActionClient,y=r.Promise,d=s.ACCESS_LEVEL,f=s.MEMBER_ACTION,_=a.FolderPolicy,m=a.ListFilesResult,v=a.MemberPermission,E=a.SharingMembership,T=a.TeamSharingPolicies,S=l.accessLevelConstToApi,k=l.accountInfoApiToRecord,A=l.contactsToMembers,P=l.fileMetadataApiToRecord,N=l.folderMetadataApiToRecord,R=l.fullAccountApiToRecord,O=l.linkMetadataApiToRecord,D=l.makeMemberSelector,x=l.memberCountsApiToRecord,L=l.membershipApiToRecord,M=l.parseFolderPermissions,F=l.parseFolderPolicy,I=u.assert,w=function(t){function n(e){this.message=e,this.name="ShareError",this.stack=(new Error).stack}return e(n,t),n}(Error),b=function(){function e(e){this.userId=e.userId,this.client=new C}return e.prototype.addMembers=function(e){var t,n,i,o,r,s,a;throw n=e.contentId,o=e.members,t=e.accessLevel,i=null!=(s=e.customMessage)?s:null,r=null!=(a=e.quiet)?a:!1,new TypeError("Not implemented")},e.prototype.removeMember=function(e){var t,n;throw t=e.contentId,n=e.memberId,new TypeError("Not implemented")},e.prototype.changeMemberAccess=function(e){var t,n,i;throw t=e.contentId,n=e.memberId,i=e.newAccess,new TypeError("Not implemented")},e.prototype.getMetadata=function(e){var t,n,i;throw n=e.contentId,t=null!=(i=e.actions)?i:[],new TypeError("Not implemented")},e.prototype.getMetadataInternal=function(e){var t,n,i;throw n=e.contentId,t=null!=(i=e.actions)?i:[],new TypeError("Not implemented")},e.prototype.listMembers=function(e){var t;throw t=e.contentId,new TypeError("Not implemented")},e.prototype.listMembersContinue=function(e){var t,n,i;throw t=e.cursor,n=null!=(i=e.overrideIsInherited)?i:!1,new TypeError("Not implemented")},e.prototype.getMemberCounts=function(e){var t;throw t=e.contentId,new TypeError("Not implemented")},e.prototype.dismissInviteNotification=function(e){var t;return t=e.contentId,this.client.rpc(this.userId,"sharing/dismiss_invite_notification",{content_id:t})},e.prototype.claimMembership=function(e){var t;return t=e.contentUrl,this.client.rpc(this.userId,"sharing/claim_membership",{content_url:t})},e.prototype.checkJobStatus=function(e){var t;return t=e.jobId,this.client.rpc(this.userId,"sharing/check_job_status",{async_job_id:t})},e.prototype.getAccountBatch=function(e){var t;return t=e.accountIds,t.length>0?this.client.rpc(this.userId,"users/get_account_batch",{account_ids:t}).then(function(e){return e.map(k)}):y.resolve([])},e.prototype._getAccountBatchCache={},e.prototype.getAccountBatchCached=function(e){var t,i,o,r,s,a;return t=e.accountIds,r=this._getAccountBatchCache,s=n.partition(t,function(e){return e in r}),o=s[0],a=s[1],i=n.values(n.pick(r,o)),this.getAccountBatch({accountIds:a}).then(function(e){var t;return t=n.object(e.map(function(e){return[e.account_id,e]})),n.extendOwn(r,t),e.concat(i)})},e.prototype.resetGetAccountBatchCache=function(){return this._getAccountBatchCache={}},e.prototype.getCurrentAccount=function(e){return this.client.rpc(this.userId,"users/get_current_account").then(function(e){return R(e)})},e.prototype._getCurrentAccountCache=null,e.prototype.getCurrentAccountCached=function(e){return null==this._getCurrentAccountCache&&(this._getCurrentAccountCache=this.getCurrentAccount()),this._getCurrentAccountCache},e.prototype.resetGetCurrentAccountCache=function(){return this._getCurrentAccountCache={}},e.prototype.requestAccess=function(e){var t;return t=e.contentUrl,this.client.rpc(this.userId,"sharing/request_access",{content_url:t})},e.prototype.sharedLinkInfo=function(e){var t,n;return t=e.fileIdOrPath,I(null!=t,"an fqPath or fileId must be present to retrieve shared link info"),n=this.client.rpc(this.userId,"sharing/list_shared_links",{path:t,direct_only:!0}),n.then(function(e){return 0===e.links.length?null:O(e.links[0])})},e.prototype.createSharedLink=function(e){var t;return t=e.fileIdOrPath,this.client.rpc(this.userId,"sharing/create_shared_link_with_settings",{path:t}).then(O)},e.prototype._addAccountsToMembership=function(e){return this._addAccountsToMembershipBatch(t.Map([[1,e]])).then(function(e){return e.get(1)})},e.prototype._addAccountsToMembershipBatch=function(e){var n;return n=e.valueSeq().flatMap(function(e){return e.users.valueSeq()}).map(function(e){return e.memberId()}).toSet().toArray(),n.length>0?this.getAccountBatchCached({accountIds:n}).then(function(n){var i;return i=t.Map(n.map(function(e){return[e.account_id,e]})),e.map(function(e,t){return e.set("users",e.users.map(function(e){return function(e){var t;return t=i.get(e.account_id),null!=t?e.set("account",t):e}}(this)))})}):y.resolve(e)},e}(),g=function(t){function n(){n.__super__.constructor.apply(this,arguments),this._promises={}}return e(n,t),n.prototype.addMembers=function(e){var t,n,i,o,r,s,a;return n=e.contentId,o=e.members,t=e.accessLevel,i=null!=(s=e.customMessage)?s:null,r=null!=(a=e.quiet)?a:!1,this.createPromise("addMembers")},n.prototype.changeMemberAccess=function(e){var t,n,i;return t=e.contentId,n=e.memberId,i=e.newAccess,this.createPromise("changeMemberAccess")},n.prototype.getMetadata=function(e){var t,n,i;return n=e.contentId,t=null!=(i=e.actions)?i:[],this.createPromise("getMetadata")},n.prototype.getMetadataInternal=function(e){var t,n,i;return n=e.contentId,t=null!=(i=e.actions)?i:[],this.createPromise("getMetadataInternal")},n.prototype.dismissInviteNotification=function(e){var t,n,i;return t=e.contentId,n=null!=(i=e.cursor)?i:null,this.createPromise("dismissInviteNotification")},n.prototype.listMembers=function(e){var t;return t=e.contentId,this.createPromise("listMembers")},n.prototype.listMembersContinue=function(e){var t,n,i;return t=e.contentId,n=null!=(i=e.overrideIsInherited)?i:!1,this.createPromise("listMembers")},n.prototype.getMemberCounts=function(e){var t;return t=e.contentId,this.createPromise("getMemberCounts")},n.prototype.removeMember=function(e){var t,n;return t=e.contentId,n=e.memberId,this.createPromise("removeMember")},n.prototype.share=function(e){var t,n,i,o,r,s,a,l,u;return i=e.fqPath,o=null!=(r=e.memberPolicy)?r:null,t=null!=(s=e.aclUpdatePolicy)?s:null,u=null!=(a=e.sharedLinkPolicy)?a:null,n=null!=(l=e.forceAsync)?l:!1,this.createPromise("shareFolder")},n.prototype.requestAccess=function(e){var t;return t=e.contentUrl,this.createPromise("requestAccess")},n.prototype.sharedLinkInfo=function(e){var t;return t=e.fileIdOrPath,this.createPromise("sharedLinkInfo")},n.prototype.createSharedLink=function(e){var t;return t=e.fileIdOrPath,this.createPromise("createSharedLink")},n.prototype.updateMember=function(){return this.createPromise("updateMember")},n.prototype.validatePath=function(e){var t,n,i;return n=e.fqPath,t=null!=(i=e.actions)?i:[],this.createPromise("validatePath")},n.prototype.getCurrentAccountCached=function(e){return this.createPromise("getCurrentAccountCached")},n.prototype.createPromise=function(e){var t;return t=this._promises[e],null==t&&(t={},t.promise=new y(function(e,n){return t.resolve=e,t.reject=n}),this._promises[e]=t),t.promise},n.prototype.getPromise=function(e){var t;return null!=(t=this._promises[e])?t.promise:void 0},n.prototype.resolvePromise=function(e,t){var n;return this.createPromise(e),n=this._promises[e],n.resolve.apply(null,t),n.promise},n.prototype.rejectPromise=function(e,t){var n;return this.createPromise(e),n=this._promises[e],n.reject.apply(null,t),n.promise},n}(b),p=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype.addMembers=function(e){var t,n,i,o,r,s,a,l,u;return i=e.contentId,r=e.members,o=null!=(a=e.customMessage)?a:null,s=null!=(l=e.quiet)?l:!1,t=null!=(u=e.accessLevel)?u:d.READER,n=S(t),0===(null!=o?o.length:void 0)&&(o=null),this.client.rpc(this.userId,"sharing/add_file_member",{file:i,members:r,custom_message:o,quiet:s,access_level:n})},i.prototype.removeMember=function(e){var t,n;return t=e.contentId,n=e.memberId,this.client.rpc(this.userId,"sharing/remove_file_member",{file:t,member:D(n)})},i.prototype.changeMemberAccess=function(e){var t,n,i;throw t=e.contentId,n=e.memberId,i=e.newAccess,new w("Not permitted for files")},i.prototype.getMetadata=function(e){var t,n,i;return n=e.contentId,t=null!=(i=e.actions)?i:[],this.client.rpc(this.userId,"sharing/get_file_metadata",{file:n,actions:t},!1).then(P)},i.prototype.share=function(e){var t;return t=e.fqPath,this.client.rpc(this.userId,"sharing/share_file",{path:t})},i.prototype.listMembers=function(e){var t,n,i;return t=e.contentId,n=null!=(i=e.limit)?i:100,this.client.rpc(this.userId,"sharing/list_file_members",{file:t,actions:f.ALL,include_inherited:!0,limit:n},!1).then(L).then(this._addAccountsToMembership.bind(this))},i.prototype.listMembersContinue=function(e){var t,n,i;return t=e.cursor,n=null!=(i=e.overrideIsInherited)?i:!1,this.client.rpc(this.userId,"sharing/list_file_members/continue",{cursor:t}).then(function(e){return L(e,null,n)}).then(this._addAccountsToMembership.bind(this))},i.prototype.listMembersBatch=function(e){var n,i,o;return n=e.contentIds,i=null!=(o=e.limit)?o:10,this.client.rpc(this.userId,"sharing/list_file_members/batch",{files:n,limit:i}).then(function(e){var n,i,o,r;for(r={},i=0,o=e.length;o>i;i++)n=e[i],"result"===n.result[".tag"]&&(r[n.file]=L(n.result.members,n.result.member_count));return t.Map(r)}).then(this._addAccountsToMembershipBatch.bind(this))},i.prototype.getMemberCounts=function(e){var t;throw t=e.contentId,new w("Member counts not implemented for files yet")},i.prototype.relinquishMembership=function(e){var t;return t=e.contentId,this.client.rpc(this.userId,"sharing/relinquish_file_membership",{file:String(t)})},i.prototype.listReceivedFiles=function(e){var n,i,o,r;return i=null!=(o=e.limit)?o:100,n=null!=(r=e.actions)?r:[],this.client.rpc(this.userId,"sharing/list_received_files",{limit:i,actions:n}).then(function(e){return new m({entries:new t.Map(e.entries.map(function(e){return[e.id,P(e)]})),cursor:e.cursor})})},i.prototype.listReceivedFilesContinue=function(e){var n;return n=e.cursor,this.client.rpc(this.userId,"sharing/list_received_files/continue",{cursor:n}).then(function(e){return new m({entries:new t.Map(e.entries.map(function(e){return[e.id,P(e)]})),cursor:e.cursor})})},i}(b),h=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.share=function(e){var t,n,i,o,r,s;return o=e.fqPath,n=null!=(r=e.folderPolicy)?r:null,i=null!=(s=e.forceAsync)?s:!1,t={path:o},null!=n&&n.forEach(function(e,n){return null!=e&&"resolved_member_policy"!==n?t[n]={".tag":e}:void 0}),this.client.rpc(this.userId,"sharing/share_folder",t).then(function(e){return"complete"===e[".tag"]?y.resolve(e):U(this.checkShareJobStatus.bind({jobId:e.async_job_id}))}).then(N)},n.prototype.checkShareJobStatus=function(e){var t;return t=e.jobId,this.client.rpc(this.userId,"sharing/check_share_job_status",{async_job_id:t})},n.prototype.checkDowngradeTeamFolderJobStatus=function(e){var t;return t=e.jobId,this.client.rpc(this.userId,"sharing/check_downgrade_team_folder_job_status",{async_job_id:t})},n.prototype.addMembers=function(e){var t,n,i,o,r,s,a,l,u,c;return o=e.contentId,a=e.members,t=e.accessLevel,r=null!=(u=e.customMessage)?u:null,l=null!=(c=e.quiet)?c:!1,i=S(t),0===(null!=r?r.length:void 0)&&(r=null),n={shared_folder_id:String(o),members:function(){var e,t,n;for(n=[],e=0,t=a.length;t>e;e++)s=a[e],n.push({member:s,access_level:i});return n}(),custom_message:r,quiet:l},this.client.rpc(this.userId,"sharing/add_folder_member",n)},n.prototype.fetchNsId=function(e){return this.client.rpc(this.userId,"files/get_metadata",{path:e}).then(function(e){var t;return null!=(t=e.sharing_info)?t.shared_folder_id:void 0})},n.prototype.getMetadata=function(e){var t,n,i;return n=e.contentId,t=null!=(i=e.actions)?i:[],this._getMetadata({contentId:n,actions:t,metadataApi:"sharing/get_folder_metadata"})},n.prototype.getMetadataInternal=function(e){var t,n,i;return n=e.contentId,t=null!=(i=e.actions)?i:[],this._getMetadata({contentId:n,actions:t,metadataApi:"sharing/get_folder_metadata_2"})},n.prototype._getMetadata=function(e){var t,n,i,o;return n=e.contentId,t=null!=(o=e.actions)?o:[],i=e.metadataApi,this.client.rpc(this.userId,i,{shared_folder_id:String(n),actions:t}).then(N)},n.prototype.validatePath=function(e){var t,n,i,o,r;return n=e.fqPath,t=null!=(o=e.actions)?o:[],i=null!=(r=e.listMembersArg)?r:{},this.client.rpc(this.userId,"sharing/validate_folder_path",{path:n,actions:t,list_members_arg:i},!1).then(N).then(function(e){return function(t){var n;return n=t.members_cursor,n?e.listMembersContinue({cursor:n,overrideIsInherited:!0}).then(function(e){return{metadata:t,inheritedMembers:e}}):{metadata:t,inheritedMembers:new E}}}(this))},n.prototype.updatePolicy=function(e){var t,n,i;return n=e.contentId,i=e.newPolicy,t={shared_folder_id:String(n)},i.forEach(function(e,n){return null!=e&&"resolved_member_policy"!==n?t[n]={".tag":e}:void 0}),this.client.rpc(this.userId,"sharing/update_folder_policy",t).then(N)},n.prototype.unshare=function(e){var t,n,i;return t=e.contentId,n=null!=(i=e.leaveACopy)?i:!1,this.client.rpc(this.userId,"sharing/unshare_folder",{shared_folder_id:String(t),leave_a_copy:n}).then(function(e){return function(t){return"complete"===t[".tag"]?y.resolve(t):U(e.checkJobStatus.bind(e,{jobId:t.async_job_id}))}}(this))},n.prototype.downgradeTeamFolder=function(e){var t;return t=e.contentId,this.client.rpc(this.userId,"/sharing/downgrade_team_folder",{shared_folder_id:String(t)}).then(function(e){return function(t){return"complete"===t[".tag"]?y.resolve(t):U(e.checkDowngradeTeamFolderJobStatus.bind(e,{jobId:t.async_job_id}))}}(this))},n.prototype.listMembers=function(e){var t,n,i;return t=e.contentId,n=null!=(i=e.limit)?i:100,this.client.rpc(this.userId,"sharing/list_folder_members",{shared_folder_id:String(t),actions:f.ALL}).then(L).then(this._addAccountsToMembership.bind(this))},n.prototype.listMembersContinue=function(e){var t,n,i;return t=e.cursor,n=null!=(i=e.overrideIsInherited)?i:!1,this.client.rpc(this.userId,"sharing/list_folder_members/continue",{cursor:t}).then(function(e){return L(e,null,n)}).then(this._addAccountsToMembership.bind(this))},n.prototype.getMemberCounts=function(e){var t;return t=e.contentId,this.client.rpc(this.userId,"sharing/get_folder_member_counts",{shared_folder_id:String(t)}).then(x)},n.prototype.relinquishMembership=function(e){var t;return t=e.contentId,this.client.rpc(this.userId,"sharing/relinquish_folder_membership",{shared_folder_id:String(t)})},n.prototype.removeMember=function(e){var t,n,i,o;return t=e.contentId,i=e.memberId,n=null!=(o=e.leaveACopy)?o:!1,this.client.rpc(this.userId,"sharing/remove_folder_member",{shared_folder_id:String(t),member:D(i),leave_a_copy:n}).then(function(e){return function(t){return"complete"===t[".tag"]?y.resolve():U(e.checkJobStatus.bind(e,{jobId:t.async_job_id}))}}(this))},n.prototype.transferContent=function(e){var t,n;return t=e.contentId,n=e.memberId,this.client.rpc(this.userId,"sharing/transfer_folder",{shared_folder_id:String(t),to_dropbox_id:n})},n.prototype.updateMember=function(e){var t,n,i;return n=e.contentId,i=e.memberId,t=e.accessLevel,this.client.rpc(this.userId,"sharing/update_folder_member",{shared_folder_id:String(n),member:D(i),access_level:S(t)})},n.prototype.mount=function(e){var t;return t=e.contentId,this.client.rpc(this.userId,"sharing/mount_folder",{shared_folder_id:String(t)}).then(N)},n.prototype.unmount=function(e){var t;return t=e.contentId,this.client.rpc(this.userId,"sharing/unmount_folder",{shared_folder_id:String(t)})},n}(b),U=function(e,t){var n,i,o,r,s,a,l;return r=null!=t?t:{},o=null!=(s=r.interval)?s:1e3,l=null!=(a=r.timeout)?a:null,i=null!=l?Date.now()+l:null,n=function(t,r){return null!=i&&Date.now()>i?r():e().then(function(e){switch(e[".tag"]){case"failed":return r(e);case"complete":return t(e);case"in_progress":return window.setTimeout(n,o,t,r)}})},new y(n)},{contactsToMembers:A,FileShareApiClient:p,FolderPolicy:_,FolderShareApiClient:h,MemberPermission:v,MockShareApiClient:g,parseFolderPermissions:M,parseFolderPolicy:F,ShareError:w,ShareApiClient:b,TeamSharingPolicies:T}})}.call(this),function(){define("modules/clean/sharing/api/types/metadata",["external/immutable","modules/clean/api_v2/types"],function(e,t){var n,i,o,r,s,a,l,u,c,d,p,_,h,m,f,v,g,y,b,w,E,T,C,S,k,I,A,P,N,R;return P=t.UnionScalar,v={team:new P("team"),anyone:new P("anyone")},n={owner:new P("owner"),editors:new P("editors")},C={anyone:new P("anyone"),members:new P("members")},w={team:new P("team"),anyone:new P("anyone")},b={from_team_only:new P("from_team_only"),from_anyone:new P("from_anyone")},T={default_public:new P("default_public"),default_team_only:new P("default_team_only"),team_only:new P("team_only")},k=e.Record({id:null,name:null},"Team"),I=e.Record({display_name:null,member_id:null,team_info:null},"TeamMemberInfo"),l=e.Record({id:null,name:null,sharing_policies:null},"FullTeam"),A=e.Record({shared_folder_member_policy:null,shared_folder_join_policy:null,shared_link_create_policy:null}),i=e.Record({account_id:null,display_name:null,disabled:!1,email:null,email_verified:!1,familiar_name:null,given_name:null,is_teammate:!1,profile_photo_url:null,surname:null,team_member_id:null},"BasicAccount"),a=e.Record({account_id:null,display_name:null,disabled:!1,email:null,email_verified:!1,familiar_name:null,given_name:null,profile_photo_url:null,surname:null,team:null,team_member_id:null},"FullAccount"),g=e.Record({allow:!1,reason:null},"PermissionSetting"),E=e.Record({access_type:null,is_team_folder:!1,members_cursor:null,name:null,owner_team:null,parent_shared_folder_id:null,path_lower:null,permissions:null,policy:null,shared_folder_id:null},"SharedFolderMetadata"),E.prototype.contentId=function(){var e;return null!=(e=this.shared_folder_id)?e:this.path_lower},E.prototype.isSharedFolder=function(){return null!=this.shared_folder_id},E.prototype.isNewSharedFolder=function(){return null==this.shared_folder_id},s=e.Record({acl_update_policy:null,member_policy:null,resolved_member_policy:null,shared_link_policy:null},"FolderPolicy"),r=e.Record({change_options:null,edit_contents:null,invite_editor:null,invite_viewer:null,relinquish_membership:null,unmount:null,unshare:null,upgrade_to_team_folder:null},"FolderPermissions"),y=e.Record({access_type:null,id:null,name:null,owner_team:null,policy:null,parent_shared_folder_id:null,path_display:null,path_lower:null,permissions:null,preview_url:null},"SharedFileMetadata"),y.prototype.contentId=function(){return this.id},y.prototype.isSharedFolder=function(){return!1},y.prototype.isNewSharedFolder=function(){return!1},o=e.Record({edit_contents:null,invite_viewer:null,unshare:null,view_members:null},"FilePermissions"),_=e.Record({entries:new e.Map,cursor:null}),S=e.Record({cursor:null,invitees:new e.Map,groups:new e.Map,users:new e.Map,memberCount:null},"SharingMembership"),S.prototype.getMemberCount=function(){var e;return null!=(e=this.memberCount)?e:this.invitees.count()+this.groups.count()+this.users.count()},N=e.Record({access_type:null,account:null,account_id:null,initials:null,is_inherited:!1,permissions:null,same_team:null,team_member_id:null},"UserMembershipInfo"),c=e.Record({access_type:null,contact:null,contact_type:null,initials:!1,is_inherited:null,permissions:null},"InviteeMembershipInfo"),u=e.Record({access_type:null,group_external_id:null,group_id:null,group_name:null,group_type:null,initials:null,is_inherited:!1,is_owner:!1,member_count:null,permissions:null,same_team:!0},"GroupMembershipInfo"),N.prototype.memberId=function(){return this.account_id},N.prototype.memberKey=function(){return R(this.is_inherited,this.memberId())},N.prototype.displayName=function(){var e;return null!=(e=this.account)?e.display_name:void 0},N.prototype.type=function(){return"users"},c.prototype.memberId=function(){return this.contact_type+":"+this.contact},c.prototype.memberKey=function(){return R(this.is_inherited,this.memberId())},c.prototype.displayName=function(){return this.contact},c.prototype.type=function(){return"invitees"},u.prototype.memberId=function(){return this.group_id},u.prototype.memberKey=function(){return R(this.is_inherited,this.memberId())},u.prototype.displayName=function(){return this.group_name},u.prototype.type=function(){return"groups"},R=function(e,t){return e+":"+t},f=e.Record({make_editor:null,make_owner:null,make_viewer:null,remove:null},"MemberPermissions"),m=e.Record({action:null,allow:!1,reason:null},"MemberPermission"),h=e.Record({total_unique_users:null,users_outside_team:null}),d=e.Record({url:null,client_modified:null,content_owner_team_info:null,expires:null,file_type:null,id:null,link_permissions:null,name:null,path_lower:null,rev:null,server_modified:null,size:null,team_member_info:null},"LinkMetadata"),d.prototype.isFolder=function(){return"folder"===this.file_type},d.prototype.teamInfo=function(){var e,t;return null!=(e=this.content_owner_team_info)?e:null!=(t=this.team_member_info)?t.team_info:void 0},p=e.Record({can_revoke:null,requested_visibility:null,resolved_visibility:null,revoke_failure_reason:null},"LinkPermissions"),{AclUpdatePolicy:n,BasicAccount:i,FilePermissions:o,FolderPermissions:r,FolderPolicy:s,FullAccount:a,FullTeam:l,GroupMembershipInfo:u,InviteeMembershipInfo:c,LinkMetadata:d,LinkPermissions:p,ListFilesResult:_,MemberCounts:h,makeMemberKey:R,MemberPermission:m,MemberPermissions:f,MemberPolicy:v,PermissionSetting:g,SharedFileMetadata:y,SharedFolderMetadata:E,SharedLinkPolicy:C,SharingMembership:S,Team:k,TeamMemberInfo:I,TeamSharingPolicies:A,UserMembershipInfo:N}})}.call(this),function(){define("modules/clean/sharing/api/util/types",["external/immutable","external/underscore","modules/clean/api_v2/types","modules/clean/contacts/types","modules/clean/sharing/constants","modules/clean/sharing/link_info","modules/clean/sharing/api/types/metadata"],function(e,t,n,i,o,r,s){var a,l,u,c,d,p,_,h,m,f,v,g,y,b,w,E,T,C,S,k,I,A,P,N,R,O,D,x,L,M,F,U,B,q,W,V,H,j,G,z,K,$,Y,Z,Q,X,J,ee,te,ne,ie,oe,re;return R=n.Union,O=n.UnionScalar,a=o.ACCESS_LEVEL,b=o.MEMBER_ACTION,u=o.FOLDER_METADATA_PERMISSIONS,v=r.LinkInfo,l=s.BasicAccount,c=s.FilePermissions,d=s.FolderPermissions,p=s.FolderPolicy,_=s.FullAccount,h=s.FullTeam,m=s.GroupMembershipInfo,f=s.InviteeMembershipInfo,g=s.LinkMetadata,y=s.LinkPermissions,w=s.MemberCounts,E=s.MemberPermission,T=s.MemberPermissions,C=s.PermissionSetting,I=s.SharingMembership,S=s.SharedFileMetadata,k=s.SharedFolderMetadata,A=s.Team,P=s.TeamMemberInfo,N=s.TeamSharingPolicies,D=s.UserMembershipInfo,L=function(e){switch(e){case a.OWNER:return new O("owner");case a.WRITER:return new O("editor");case a.READER:
return new O("viewer")}},x=function(e){var t;switch(null!=(t=e.type)?t:e){case"owner":return a.OWNER;case"editor":return a.WRITER;case"viewer":return a.READER}},q=function(e){return new k({access_type:x(R.parse(e.access_type)),is_team_folder:e.is_team_folder,members_cursor:e.members_cursor,name:e.name,owner_team:null!=e.owner_team?new A(e.owner_team):null,parent_shared_folder_id:e.parent_shared_folder_id,path_lower:e.path_lower,permissions:null!=e.permissions?W(e.permissions):void 0,policy:ee(e.policy),shared_folder_id:e.shared_folder_id})},W=function(e){var t,n,i,o,r;for(i={},t=0,n=e.length;n>t;t++)o=e[t],i[o.action[".tag"]]=new C({allow:o.allow,reason:null!=(r=o.reason)?r[".tag"]:void 0});return new d(i)},V=function(e){var t,n,i,o;return null==e?new p:new p({acl_update_policy:null!=(t=e.acl_update_policy)?t[".tag"]:void 0,member_policy:null!=(n=e.member_policy)?n[".tag"]:void 0,resolved_member_policy:null!=(i=e.resolved_member_policy)?i[".tag"]:void 0,shared_link_policy:null!=(o=e.shared_link_policy)?o[".tag"]:void 0})},U=function(e){return new S({access_type:null!=e.access_type?x(R.parse(e.access_type)):a.READER,id:e.id,name:e.name,owner_team:null!=e.owner_team?new A(e.owner_team):null,policy:null!=e.policy?ee(e.policy):new p,parent_shared_folder_id:e.parent_shared_folder_id,path_display:e.path_display,path_lower:e.path_lower,permissions:B(e.permissions),preview_url:e.preview_url})},B=function(e){var t,n,i,o,r;if(i={},null!=e)for(t=0,n=e.length;n>t;t++)o=e[t],i[o.action[".tag"]]=new C({allow:o.allow,reason:null!=(r=o.reason)?r[".tag"]:void 0});return new c(i)},X=function(t,n,i){var o,r,s,a;return null==n&&(n=null),null==i&&(i=!1),new I({cursor:t.cursor,invitees:new e.Map(function(){var e,n,o,a;for(o=t.invitees,a=[],e=0,n=o.length;n>e;e++)r=o[e],s=G(r,i=i),a.push([s.memberKey(),s]);return a}()),groups:new e.Map(function(){var e,n,r,a;for(r=t.groups,a=[],e=0,n=r.length;n>e;e++)o=r[e],s=j(o,i=i),a.push([s.memberKey(),s]);return a}()),users:new e.Map(function(){var e,n,o,r;for(o=t.users,r=[],e=0,n=o.length;n>e;e++)a=o[e],s=re(a,i=i),r.push([s.memberKey(),s]);return r}()),memberCount:n})},G=function(e,t){var n;return null==t&&(t=!1),n=e.invitee[".tag"],new f({access_type:x(R.parse(e.access_type)),contact:e.invitee[n],contact_type:n,initials:e.initials,is_inherited:t?!0:e.is_inherited,permissions:Q(e.permissions)})},j=function(e,t){return null==t&&(t=!1),new m({access_type:x(R.parse(e.access_type)),group_external_id:e.group.group_external_id,group_id:e.group.group_id,group_name:e.group.group_name,group_type:e.group.group_type[".tag"],initials:e.initials,is_inherited:t?!0:e.is_inherited,is_owner:e.group.is_owner,member_count:e.group.member_count,permissions:Q(e.permissions),same_team:e.group.same_team})},re=function(e,t){return null==t&&(t=!1),new D({access_type:x(R.parse(e.access_type)),account_id:e.user.account_id,initials:e.initials,is_inherited:t?!0:e.is_inherited,permissions:Q(e.permissions),same_team:e.user.same_team,team_member_id:e.user.team_member_id})},Q=function(e){var t,n,i,o,r;if(i={},null!=e)for(t=0,n=e.length;n>t;t++)o=e[t],i[o.action[".tag"]]=new C({allow:o.allow,reason:null!=(r=o.reason)?r[".tag"]:void 0});return new T(i)},Z=function(e){return new w(e)},z=function(e){return new g({url:e.url,client_modified:null!=e.client_modified?new Date(e.client_modified):null,content_owner_team_info:null!=e.content_owner_team_info?new A(e.content_owner_team_info):null,expires:null!=e.expires?new Date(e.expires):null,file_type:e[".tag"],id:e.id,link_permissions:K(e.link_permissions),name:e.name,path_lower:e.path_lower,rev:e.rev,server_modified:null!=e.server_modified?new Date(e.server_modified):null,size:e.size,team_member_info:ie(e.team_member_info)})},K=function(e){var t,n,i;return null==e?new y:new y({can_revoke:e.can_revoke,requested_visibility:null!=(t=e.requested_visibility)?t[".tag"]:void 0,resolved_visibility:null!=(n=e.resolved_visibility)?n[".tag"]:void 0,revoke_failure_reaosn:null!=(i=e.revoke_failure_reason)?i[".tag"]:void 0})},ie=function(e){return null==e?null:new P({display_name:e.display_name,member_id:e.member_id,team_info:null!=e.team_info?new A(e.team_info):null})},M=function(e){return new l({account_id:e.account_id,disabled:e.disabled,display_name:e.name.display_name,email:e.email,email_verified:e.email_verified,familiar_name:e.name.familiar_name,given_name:e.name.given_name,is_teammate:e.is_teammate,profile_photo_url:e.profile_photo_url,surname:e.name.surname,team_member_id:e.team_member_id})},H=function(e){var t;return t=null!=e.team?new h({id:e.team.id,name:e.team.name,sharing_policies:oe(e.team.sharing_policies)}):null,new _({account_id:e.account_id,disabled:e.disabled,display_name:e.name.display_name,email:e.email,email_verified:e.email_verified,familiar_name:e.name.familiar_name,given_name:e.name.given_name,profile_photo_url:e.profile_photo_url,surname:e.name.surname,team_member_id:e.team_member_id,team:t})},oe=function(e){var t,n,i;return null==e?null:new N({shared_folder_member_policy:null!=(t=e.shared_folder_member_policy)?t[".tag"]:void 0,shared_folder_join_policy:null!=(n=e.shared_folder_join_policy)?n[".tag"]:void 0,shared_link_create_policy:null!=(i=e.shared_link_create_policy)?i[".tag"]:void 0})},$=function(e){return"email"===e.type?"email:"+e.value:e.value},Y=function(e){return e.startsWith("email:")?new O("email",e.substr(6)):new O("dropbox_id",e)},te=function(e){var t,n,i,o,r;if(i=[],null!=e)for(t=0,n=e.length;n>t;t++)o=e[t],i.push(new E({action:o.action[".tag"],allow:o.allow,reason:null!=(r=o.reason)?r[".tag"]:void 0}));return i},ne=function(e){var n,i,o;return null!=e?(o=R.parse(e.link_permissions.resolved_visibility).type,i=null!=e.team_member_info?{teamId:e.team_member_info.team_info.id,teamName:e.team_member_info.team_info.name}:{teamId:null,teamName:null},n={isFolder:"folder"===e[".tag"],url:e.url,name:e.name,expires:null!=e.expires?new Date(e.expires):null,visibility:o,isPackage:e.is_package},t.extend(n,i),new v(n)):null},ee=V,J=function(e){var t,n,i,o;for(i={},t=0,n=e.length;n>t;t++)o=e[t],i[u[o.action[".tag"]]]=o.allow;return i},F=function(e){var t;return function(){var n,o,r;for(r=[],n=0,o=e.length;o>n;n++)if(t=e[n],t.type===i.NEW_STYLE_GROUP)r.push(new O("dropbox_id",t.getContactID()));else{if(t.type===i.INVALID)throw new Error("Unknown contact type");r.push(new O("email",t.getContactID()))}return r}()},{accessLevelApiToConst:x,accessLevelConstToApi:L,accountInfoApiToRecord:M,contactsToMembers:F,fileMetadataApiToRecord:U,filePermissionsApiToRecord:B,folderMetadataApiToRecord:q,folderPermissionsApiToRecord:W,folderPolicyApiToRecord:V,fullAccountApiToRecord:H,groupMembershipApiToRecord:j,inviteeMembershipApiToRecord:G,linkMetadataApiToRecord:z,linkPermissionsApiToRecord:K,makeMemberId:$,makeMemberSelector:Y,memberCountsApiToRecord:Z,memberPermissionsApiToRecord:Q,membershipApiToRecord:X,parseFolderPermissions:J,parseFolderPolicy:ee,parseMemberPermissions:te,parseSharedLinkMetadata:ne,teamMemberInfoApiToRecord:ie,teamSharingPoliciesApiToRecord:oe,userMembershipApiToRecord:re}})}.call(this),function(){define("modules/clean/sharing/constants",["external/underscore","modules/constants/sharing"],function(e,t){var n,i,o;return n={ACCESS_NO_ACCESS:0,ACCESS_READER:1,ACCESS_WRITER:2,ACCESS_OWNER:3},i={PUBLIC:1,TEAM_ONLY:2,PASSWORD:3},o={ACCESS_LEVEL:{OWNER:"owner",WRITER:"writer",READER:"reader"},MEMBER_ACTION:{MAKE_EDITOR:"make_editor",MAKE_OWNER:"make_owner",MAKE_VIEWER:"make_viewer",REMOVE:"remove",ALL:["make_editor","make_owner","make_viewer","remove"]},SNIPPET_SIZES:{FILENAME:30,DISPLAY_NAME:30,EMAIL:30},NameSpaceAccess:n,SHMODEL_LINK_TOKEN_VISIBILITY:i,VALIDATE_PATH_PERMISSIONS:{change_options:"canChangeOptions",invite_editor:"canInviteEditor",invite_viewer:"canInviteViewer",unshare:"canUnshareFolder",relinquish_membership:"canRelinquishMembership"},FOLDER_METADATA_PERMISSIONS:{change_options:"canChangeOptions",invite_editor:"canInviteEditor",invite_viewer:"canInviteViewer",unshare:"canUnshareFolder",relinquish_membership:"canRelinquishMembership"},FOLDER_METADATA_PERMISSIONS_INTERNAL:{change_options:"canChangeOptions",invite_editor:"canInviteEditor",invite_viewer:"canInviteViewer",unshare:"canUnshareFolder",relinquish_membership:"canRelinquishMembership",upgrade_to_team_folder:"canConvertToGoldenGateFolder"},FILE_METADATA_PERMISSIONS:{invite_viewer:"canInviteViewer"}},o.ACCESS_VALUES=e.values(o.ACCESS_LEVEL),e.extend(o,t),o})}.call(this),function(){define("modules/clean/sharing/content_info",["external/immutable","modules/clean/filepath","modules/clean/react/browse/constants","modules/clean/sharing/api/types/metadata","modules/clean/sharing/stores/shared_content"],function(e,t,n,i,o){var r,s,a,l,u,c,d,p,_;return _=t.file_icon,a=n.FileTypes,l=i.SharedFileMetadata,u=i.SharedFolderMetadata,r=e.Record({extras:null,id:null,metadata:null},"ContentInfo"),s=e.Record({exists:!0,fileId:null,fqPath:null,icon:null,isFolder:null,isTeamSharedFolder:!1,modalSessionId:null,nsId:null,nsPath:null,origin:null,shouldFetchNsId:!1,targetNsId:null,userRootNs:null},"ContentInfoExtras"),r.prototype.canShareLink=function(e){return null==e&&(e=!1),this.pathExists()?this.isFile()?!0:null!=this.metadata||e?!this.isTeamSharedFolder():!1:!1},r.prototype.shouldFetchNsId=function(){var e;return(null!=(e=this.extras)?e.shouldFetchNsId:void 0)&&this.isFileFolder()},r.prototype.setNsId=function(e){var t;return t=this.setIn(["extras","targetNsId"],e),t.set("id",d(t.extras))},r.prototype.isFolder=function(){return null!=this.metadata?this.metadata instanceof u:this.extras.isFolder},r.prototype.isFile=function(){return!this.isFolder()},r.prototype.isFileFolder=function(){return this.isFolder()&&!this.isSharedFolder()},r.prototype.isSharedFolder=function(){var e,t;return Boolean((null!=(e=this.metadata)?e.shared_folder_id:void 0)||(null!=(t=this.extras)?t.targetNsId:void 0))},r.prototype.isTeamSharedFolder=function(){var e;return null!=this.metadata?Boolean(this.isSharedFolder()&&(null!=(e=this.metadata)?e.is_team_folder:void 0)):this.extras.isTeamSharedFolder},r.prototype.isInSharedFolder=function(){var e;return Boolean((null!=(e=this.metadata)?e.parent_shared_folder_id:void 0)||null!=this.extras.nsId&&this.extras.nsId!==this.extras.userRootNs)},r.prototype.isNestedSharedFolder=function(){return this.isInSharedFolder()&&this.isSharedFolder()},r.prototype.pathExists=function(){if(null!=this.extras)return this.extras.exists;if(null!=this.metadata)return!0;throw new Error("Can't determine deleted state")},r.prototype.name=function(){var e,t,n;return null!=(e=null!=(t=this.displayPath())?t.split("/").pop():void 0)?e:null!=(n=this.metadata)?n.name:void 0},r.prototype.idForLink=function(){var e;if(e=null,null!=this.metadata?this.metadata instanceof u?null!=this.metadata.path_lower&&(e=this.metadata.path_lower):e=this.metadata.id||this.metadata.path_lower:e=this.extras.fileId||this.extras.fqPath,!e)throw new Error("No identifiers for getting links");return e},r.prototype.sharedFolderId=function(){var e,t,n;if(e=(null!=(t=this.metadata)?t.shared_folder_id:void 0)||(null!=(n=this.extras)?n.targetNsId:void 0),!e)throw new Error("No shared folder ID");return e},r.prototype.displayPath=function(){var e,t,n;return(null!=(e=this.extras)?e.fqPath:void 0)||(null!=(t=this.metadata)?t.path_display:void 0)||(null!=(n=this.metadata)?n.path_lower:void 0)},r.prototype.nsId=function(){var e;if(null==(null!=(e=this.extras)?e.nsId:void 0))throw new Error("Can't determine nsId");return this.extras.nsId},r.prototype.nsPath=function(){var e;if(null==(null!=(e=this.extras)?e.nsPath:void 0))throw new Error("Can't determine nsPath");return this.extras.nsPath},r.prototype.icon=function(){var e,t,n,i,o;if(null!=(t=this.extras)?t.icon:void 0)return this.extras.icon;if(this.isFolder()){try{o=this.isTeamSharedFolder()?"_team":this.isSharedFolder()?"_user":""}catch(e){o=""}return e=null!=(null!=(n=this.metadata)&&null!=(i=n.permissions)?i.edit_contents:void 0)?this.metadata.permissions.edit_contents.allow?"":"_locked":"","folder"+o+e+"_32"}return _(this.name())+"_32"},r.createWithMetadata=function(e,t){return null==t&&(t=null),new r({id:p(e),metadata:e,extras:t})},r.createFromParams=function(e){var t;return t=new s(e),new r({extras:t,id:d(t),metadata:c(t)})},p=function(e){var t;if(t=e instanceof l?e.id||e.path_lower:e.shared_folder_id||e.path_lower,!t)throw new Error("Not enough fields provided for metadata");return t},d=function(e){var t;if(t=e.isFolder?e.targetNsId||e.fqPath:e.fileId||e.fqPath,!t)throw new Error("Not enough fields provided for extras");return t},c=function(e){var t;return t=d(e),e.isFolder?o.getFolderMetadata(t):o.getFileMetadata(t)},{ContentInfo:r,ContentInfoExtras:s}})}.call(this),function(){define("modules/clean/sharing/folder_convert_gg_modal",["external/classnames","external/immutable","external/purify","external/react","modules/clean/ajax","modules/clean/em_string","modules/clean/react/modal","modules/core/i18n","modules/clean/user","modules/core/notify"],function(e,t,n,i,o,r,s,a,l,u){var c,d,p,_,h;return d=s.Modal,_=i.createElement,h=i.DOM,p=a.i18n_default_project("sharing")._,c=i.createClass({displayName:"ConvertToGoldenGateFolderModal",propTypes:{folderId:i.PropTypes.string.isRequired,user:i.PropTypes.instanceOf(l).isRequired,onCancel:i.PropTypes.func},getDefaultProps:function(){return{onCancel:null}},getInitialState:function(){return{groupName:"",didConfirmTerms:!1,isRequestToConvertPending:!1}},render:function(){return this.state.didConfirmTerms?this._renderSelectGroups():this._renderTerms()},_renderTerms:function(){return _(d,{autoClose:!1,title:p("Confirm converting to Golden Gate folder"),acceptButtonText:p("Confirm and Proceed"),dismissButtonText:p("Cancel"),onAccept:this._onAcceptClick,onDismissCompleted:this.props.onCancel},this._renderTermsContent())},_renderTermsContent:function(){return h.div({},h.div({},h.b({style:{fontSize:14}},p("This Change is irreversible!"))),h.div({},h.h3({},p("Who should use this?")),h.ul({},h.li({},p("Golden Gate Folders are meant for organizing stuff that belongs to your team")),h.li({},p("You should be a team lead or a designated manager of your team’s stuff")),h.li({},p("Other experimental uses won’t be officially supported by the Golden Gate team")))),h.div({},h.h3({},p("What can I do with a Golden Gate folder?")),h.ul({},h.li({},p("Create Nested Shared Folders within the Golden Gate Folder")),h.li({},p("Nested Shared Folders can be shared with other Dropboxers or external parties, and must inherit their parent’s member list")),h.li({},p("Nested Shared Folders look just like normal Shared Folders to recipients (keep Golden Gate confidential!)")),h.li({},p("More nesting options are coming later")))),h.div({},h.h3({},p("What will happen to this Shared Folder?")),h.ul({},h.li({},p("This Shared Folder will become a Golden Gate Folder")),h.li({},p("This change is irreversible")),h.li({},p("The member list of this folder will be replaced with a Group that should consist of your team members (you may have to create this Group separately before proceeding)")))),h.div({},h.b({},p("Issues or feedback? Reach us at goldengate@"))))},_renderSelectGroups:function(){return _(d,{autoClose:!1,title:p("Enable converting to Golden Gate folder"),acceptButtonText:p("Enable Golden Gate"),acceptButtonDisabled:this.state.isRequestToConvertPending,dismissButtonText:p("Back"),ref:"modal",onAccept:this._onAcceptClick,onDismissCompleted:this.props.onCancel},this._renderSelectGroupsContent())},_renderSelectGroupsContent:function(){return h.div({},h.div({},p("Enter the name of the group this shared folder belongs to. The members of this shared folder will be replaced by the members of the group you select.")),h.div({},h.label({htmlFor:"group_name"},h.input({type:"text",name:"group_name",id:"group_name","aria-label":p("Group name"),onChange:function(e){return function(t){return e.setState({groupName:t.target.value})}}(this),placeholder:p("Group name")}))))},_onAcceptClick:function(){var e,t;return this.state.didConfirmTerms?(e=this.state.groupName,e.length>0?(this.setState({isRequestToConvertPending:!0}),t=this.props,o.WebRequest({url:"/share_ajax/enable_golden_gate_step_one",type:"POST",data:{group_name:e,ns_id:t.folderId,_subject_uid:t.user.id},success:function(){return o.WebRequest({url:"/share_ajax/enable_golden_gate_step_two",type:"POST",data:{ns_id:t.folderId,_subject_uid:t.user.id},success:function(){return u.success("Golden Gate enabled for this folder"),window.location.reload()},error:function(e){return function(){return e.isMounted()?e.setState({isRequestToConvertPending:!1}):void 0}}(this)})},error:function(e){return function(){return e.isMounted()?e.setState({isRequestToConvertPending:!1}):void 0}}(this)})):void 0):this.setState({didConfirmTerms:!0})}}),{ConvertToGoldenGateFolderModal:c}})}.call(this),function(){define("modules/clean/sharing/folder_settings_modal",["external/classnames","external/immutable","external/purify","external/react","external/rsvp","modules/clean/em_string","modules/clean/flux/dispatcher","modules/clean/react/browse/constants","modules/clean/react/modal","modules/clean/react/util","modules/clean/sharing/constants","modules/clean/sharing/ui_util","modules/clean/sharing/keep_a_copy_modal","modules/clean/sharing/api/client","modules/clean/user","modules/core/i18n","modules/core/notify"],function(e,t,n,i,o,r,s,a,l,u,c,d,p,_,h,m,f){var v,g,y,b,w,E,T,C,S,k,I,A,P,N,R,O,D,x,L,M,F;return C=o.Promise,v=a.BrowseActionTypes,N=a.SharedWithActionTypes,T=l.Modal,R=l.SimpleModal,M=u.setStatePromise,k=c.SNIPPET_SIZES,E=d.GoldenGate,w=_.FolderShareApiClient,b=_.FolderPolicy,I=_.ShareApiClient,O=_.TeamSharingPolicies,x=i.createElement,L=i.DOM,D=m.i18n_default_project("sharing")._,g={shared_folder_member_policy:"team"},y={shared_folder_member_policy:"team"},S={member_policy:"shared_folder_member_policy"},A=i.createClass({displayName:"SharedFolderSettingsModal",propTypes:{folderName:i.PropTypes.string.isRequired,folderId:i.PropTypes.string,folderPath:i.PropTypes.string,initialHasParentSharedFolder:i.PropTypes.bool,initialIsTeamSharedFolder:i.PropTypes.bool,initialOwnerTeam:i.PropTypes.shape({id:i.PropTypes.string.isRequired,name:i.PropTypes.string.isRequired}),initialPermissions:i.PropTypes.shape({canChangeOptions:i.PropTypes.bool,canUnshareFolder:i.PropTypes.bool}),initialPolicy:i.PropTypes.instanceOf(b),isSharedFolder:i.PropTypes.bool,onCancel:i.PropTypes.func,onPolicySet:i.PropTypes.func,onUnshare:i.PropTypes.func,teamPolicy:i.PropTypes.instanceOf(O),user:i.PropTypes.instanceOf(h).isRequired},getInitialState:function(){return{currentPolicy:this.props.initialPolicy,folderPermissions:this.props.initialPermissions,hasParentSharedFolder:this.props.initialHasParentSharedFolder,isLoading:!(null!=this.props.initialPolicy&&null!=this.props.initialPermissions),isPolicyChangeRecursive:this._hasRecursivePolicyChanges(this.props.initialIsTeamSharedFolder,this.props.initialHasParentSharedFolder),isSubmitting:!1,isTeamSharedFolder:this.props.initialIsTeamSharedFolder,teamPolicy:this.props.teamPolicy,newPolicy:this.props.initialPolicy,ownerTeam:this.props.initialOwnerTeam}},componentDidMount:function(){return this.state.isLoading?this._fetchInitialState():void 0},render:function(){var t,n;return t=null!=(n=this.state.folderPermissions)?n.canChangeOptions:void 0,x(T,{autoClose:!1,className:e({"shared-folder-settings-modal":!0,"shared-folder-settings-modal--no-permissions":!t}),buttonComponent:L.span(),onDismissCompleted:this._handleDismissCompleted,title:this.state.isTeamSharedFolder?D("“%(folder_name)s” team folder settings").format({folder_name:this.props.folderName}):D("“%(folder_name)s” settings").format({folder_name:this.props.folderName})},this.state.isLoading?L.div({className:"shared-folder-settings-modal__loading-text"},D("Loading...")):x(P,{currentPolicy:this.state.currentPolicy,folderId:this.props.folderId,folderName:this.props.folderName,folderPermissions:this.state.folderPermissions,hasParentSharedFolder:this.state.hasParentSharedFolder,isAccepting:this.state.isSubmitting,isSharedFolder:this.props.isSharedFolder,isTeamSharedFolder:this.state.isTeamSharedFolder,onAccept:this._handleAcceptClick,onDismiss:this._handleDismissClick,onPolicyUpdate:this._handlePolicyUpdate,onUnshare:this._handleUnshareFolder,ownerTeam:this.state.ownerTeam,teamPolicy:this.state.teamPolicy,policyUpdate:this._getPolicyUpdate()}))},_getClient:function(){return new w({userId:this.props.user.id})},_fetchFolderMetadata:function(){var e;return e=[{".tag":"change_options"},{".tag":"unshare"}],null!=this.props.folderId?this._getClient().getMetadata({contentId:this.props.folderId,actions:e}):this._getClient().validatePath({fqPath:this.props.folderPath,actions:e}).then(function(e){var t;return t=e.metadata})},_fetchInitialState:function(){return this._fetchFolderMetadata().then(function(e){return function(t){var n,i,o,r,s,a;return e.isMounted()?(n=t.policy,i={hasParentSharedFolder:null!=t.parent_shared_folder_id,isTeamSharedFolder:t.is_team_folder,isLoading:!1,folderPermissions:{canChangeOptions:null!=(o=t.permissions)&&null!=(r=o.change_options)?r.allow:void 0,canUnshareFolder:null!=(s=t.permissions)&&null!=(a=s.unshare)?a.allow:void 0},newPolicy:n,ownerTeam:t.owner_team},null!=e.props.folderId&&(i.currentPolicy=n),i.isPolicyChangeRecursive=e._hasRecursivePolicyChanges(i.isTeamSharedFolder,i.hasParentSharedFolder),M(e,i)):void 0}}(this)).catch(function(){return T.close()})},_hasRecursivePolicyChanges:function(e,t){return E.canDeepNest(this.props.user.id)&&(e||t)},_handlePolicyUpdate:function(e,t){return this.setState({newPolicy:this.state.newPolicy.set(e,t)})},_handleAcceptClick:function(){var e,t,i;return t=this._getPolicyUpdate(),null!=t?(e=function(e){return function(){var n;return n=e.props.onPolicySet,(e.isMounted()?M(e,{isSubmitting:!0}):C.resolve()).then(function(){var n;return n=function(e){return f.success(D("Folder settings updated")),C.resolve({policyUpdate:t,sharedFolderMetadata:e})},null!=e.props.folderId?e._getClient().updatePolicy({contentId:e.props.folderId,newPolicy:t}).then(n):e.state.hasParentSharedFolder?e._getClient().share({fqPath:e.props.folderPath,folderPolicy:t}).then(n):C.resolve({policyUpdate:t})}).then(function(e){var t,n;return t=e.policyUpdate,n=e.sharedFolderMetadata,T.close(),{policyUpdate:t,sharedFolderMetadata:n}}).then(function(e){var t,i;return t=e.policyUpdate,i=e.sharedFolderMetadata,"function"==typeof n?n(t,i):void 0}).catch(function(){return e.isMounted()?e.setState({isSubmitting:!1}):void 0})}}(this),this.state.isPolicyChangeRecursive?(i=this.props,R.show({title_text:D("Save settings?"),body_html:this.state.isTeamSharedFolder?n.sanitize(D("Your changes will be applied to this team folder and any folders inside it.")):n.sanitize(D("Your changes will be applied to this folder and any folders inside it.")),confirm_text:D("Save settings"),cancel_text:D("Cancel"),autoclose:!1,confirm_callback:e,cancel_completed_callback:function(){return T.showInstance(x(A,i))}})):e()):void 0},_handleDismissClick:function(){var e;return T.close(),"function"==typeof(e=this.props).onCancel?e.onCancel():void 0},_handleDismissCompleted:function(){var e;return"function"==typeof(e=this.props).onCancel?e.onCancel():void 0},_handleUnshareFolder:function(){var e,t,n;return null!=this.props.folderId&&(null!=(n=this.state.folderPermissions)?n.canUnshareFolder:void 0)?(e=function(e){return function(t){var n,i;return n=e.state.isTeamSharedFolder,i=n?e._getClient().downgradeTeamFolder({contentId:e.props.folderId}):e._getClient().unshare({contentId:e.props.folderId,leaveACopy:t}),i.then(function(){return T.close(),n?(s.dispatch({type:v.TEAM_FOLDER_DOWNGRADE,data:{nsId:e.props.folderId}}),s.dispatch({type:N.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE,data:{}})):void 0})}}(this),t=function(e){return function(){return T.showInstance(x(A,e))}}(this.props),F(this.props,this.state,e,t)):void 0},_getPolicyUpdate:function(){var e,t,n;return n=null,null==this.state.newPolicy&&null==this.state.currentPolicy?null:(t=0,e={},this.state.newPolicy.forEach(function(n){return function(i,o){var r,s,a;return r=null!=(s=n.state.currentPolicy)?s.get(o):void 0,null!=r&&r===i||(t+=1),e[o]=null!=(a=n.state.newPolicy.get(o))?a:r}}(this)),t>0&&(n=new b(e)),n)}}),P=i.createClass({displayName:"SharedFolderSettingsModalContents",propTypes:{currentPolicy:i.PropTypes.instanceOf(b),folderId:i.PropTypes.string,folderName:i.PropTypes.string.isRequired,folderPermissions:i.PropTypes.shape({canChangeOptions:i.PropTypes.bool,canUnshareFolder:i.PropTypes.bool}).isRequired,hasParentSharedFolder:i.PropTypes.bool,isAccepting:i.PropTypes.bool,isSharedFolder:i.PropTypes.bool,isTeamSharedFolder:i.PropTypes.bool,onAccept:i.PropTypes.func,onCancel:i.PropTypes.func,onPolicyUpdate:i.PropTypes.func,onUnshare:i.PropTypes.func,ownerTeam:i.PropTypes.shape({id:i.PropTypes.string.isRequired,name:i.PropTypes.string.isRequired}),teamPolicy:i.PropTypes.instanceOf(O),policyUpdate:i.PropTypes.instanceOf(b)},getDefaultProps:function(){return{currentPolicy:null,folderId:null,isAccepting:!1,hasParentSharedFolder:!1,isTeamSharedFolder:!1,onPolicyUpdate:null,onUnshareFolder:null,ownerTeam:null,teamPolicy:null,policyUpdate:null}},render:function(){return L.div({className:"shared-folder-settings-form__contents"},this._renderHeader(),this._renderPolicies(),this._renderButtons())},_renderHeader:function(){return this.props.isTeamSharedFolder||this.props.hasParentSharedFolder?L.div({className:"shared-folder-settings-form__team-folder-banner u-pad-xs u-font-center u-mar-bottom-s"},D(this.props.isTeamSharedFolder?"Only admins can change team folder settings.":"Only admins can change these folder settings.")):this.props.folderPermissions.canChangeOptions?void 0:L.div({className:"shared-folder-settings-form__no-permissions-banner u-pad-xs u-font-center u-mar-bottom-s"},D("You don’t have permission to change the settings on this folder."))},_renderPolicies:function(){var e;return e=null!=this.props.ownerTeam,L.div({className:"shared-folder-settings-form__policies"},e?this._renderPolicy("member_policy",D(this.props.isTeamSharedFolder?"Who can be invited to shared folders inside this team folder?":"Who can be invited to this folder?"),[{label:D("Anyone on your Dropbox team"),value:"team"},{label:D("Anyone"),value:"anyone"}]):void 0,this._renderPolicy("acl_update_policy",D(this.props.isTeamSharedFolder?"Who can manage access to shared folders inside this team folder?":"Who can manage access to this folder?"),[{label:D(e?"Anyone on your Dropbox team with edit permissions":"People with edit permissions"),value:"editors"},{label:D("Only owners"),value:"owner"}]),e?this._renderPolicy("shared_link_policy",D(this.props.isTeamSharedFolder?"Allow links to be shared with people outside this team folder?":"Allow links to be shared with people outside of this folder?"),[{label:D("Yes"),value:"anyone"},{label:D("No"),value:"members"}]):void 0)},_renderPolicy:function(t,n,i){var o,r,s,a,l,u,c,d;return c=S[t],null!=c&&null!=this.props.teamPolicy&&(d=null!=(a=this.props.teamPolicy)?a.get(c):void 0),r=null!=(l=null!=(u=this.props.policyUpdate)?u.get(t):void 0)?l:this.props.currentPolicy.get(t),o=this.props.folderPermissions.canChangeOptions,null!=d&&g[c]===d&&(o=!1,r=y[c]),L.fieldset({className:e({"shared-folder-settings-form__entry":!0,"shared-folder-settings-form__entry--no-permissions":!o})},L.legend({className:"shared-folder-settings-form__entry__explanation u-trim-margin"},n),L.div({className:"shared-folder-settings-form__entry__options"},function(){var e,n,a;for(a=[],e=0,n=i.length;n>e;e++)s=i[e],a.push(L.label({key:s.value},L.input({checked:s.value===r,disabled:!o,name:t,onChange:this._handleOptionChange,type:"radio",value:s.value}),s.label));return a}.call(this)))},_renderButtons:function(){var e,t,n,i;return e=null!=(n=this.props.folderPermissions)?n.canChangeOptions:void 0,t=null!=(i=this.props.folderPermissions)?i.canUnshareFolder:void 0,L.div({className:"u-mar-top-m clearfix"},this.props.isSharedFolder&&t?L.div({className:"u-l-fl"},L.button({className:"button-as-link",style:{lineHeight:"32px"},onClick:this.props.onUnshare},D(this.props.hasParentSharedFolder?"Reset membership":"Unshare folder"))):void 0,e?L.div({className:"u-l-fr"},L.button({className:"c-btn c-btn--primary",disabled:null==this.props.policyUpdate||this.props.isAccepting,onClick:this.props.onAccept},D(this.props.isAccepting?"Saving...":"Save settings")),L.button({className:"c-btn c-btn--secondary u-mar-left-xs",onClick:this.props.onDismiss},D("Cancel"))):void 0)},_handleOptionChange:function(e){var t,n;return this.props.folderPermissions.canChangeOptions&&(null!=(n=this.props.policyUpdate)?n.get(e.target.name):void 0)!==e.target.value&&"function"==typeof(t=this.props).onPolicyUpdate?t.onPolicyUpdate(e.target.name,e.target.value):void 0}}),F=function(e,t,i,o){var s,a,l;return a=!0,t.hasParentSharedFolder&&null!=t.ownerTeam?l={body:D("Resetting membership will remove people outside of your Dropbox team. People on your Dropbox team will still have access."),confirm:D("Reset membership"),title:D("Reset membership for “%(folder_name)s”").format({folder_name:r.em_snippet(e.folderName,k.FILENAME)})}:t.isTeamSharedFolder?(l={body:D("Only admins will be able to see the folder or access its contents. Unsharing will also convert this team folder into a regular shared folder, and you’ll be the owner."),confirm:D("Unshare"),title:D("Unshare “%(folder_name)s” team folder?").format({folder_name:r.em_snippet(e.folderName,k.FILENAME)})},a=!1):l={body:D("Nobody else will be able to sync this folder to their Dropboxes. You’ll still keep a copy of this folder in your Dropbox."),confirm:D("Unshare"),title:D("Permanently unshare “%(folder_name)s”").format({folder_name:r.em_snippet(e.folderName,k.FILENAME)})},s={autoclose:!1,body_html:n.sanitize(l.body),cancel_completed_callback:o,cancel_text:D("Cancel"),confirm_callback:i,confirm_text:l.confirm,option_text:D("I want my collaborators to keep a copy of these files."),title_text:l.title},a?p.show(s):R.show(s)},{SharedFolderSettingsModal:A,SharedFolderSettingsModalContents:P}})}.call(this),function(){define("modules/clean/sharing/get_editable_link_prompt",["external/react","jquery","modules/clean/react/sprite_div","modules/core/i18n"],function(e,t,n,i){var o,r,s,a;return r=i.i18n_default_project("sharing")._,a=e.DOM,s=e.createElement,o=e.createClass({statics:{showInstance:function(n,i){var o,r;return o=i?t(i):t("<div />").attr({class:"editable-link-prompt-mount"}).appendTo("body"),r=o[0],e.unmountComponentAtNode(r),e.render(n,r)}},propTypes:{onDismiss:e.PropTypes.func.isRequired,shouldShow:e.PropTypes.bool.isRequired,targetedButton:e.PropTypes.object.isRequired},getInitialState:function(){return{arrowLeft:0,closed:!this.props.shouldShow,left:0,top:0}},componentDidMount:function(){return t(window).on("resize",this._updateOffset),t(document).on("modalClosed",this._closeModal),t(document).on("collab:m2:prompt:hide",this._closeModal),t(document).on("collab:m2:prompt:dismiss",this._dismissModal),this._updateOffset()},componentWillUnmount:function(){return t(window).off("resize",this._updateOffset),t(document).off("modalClosed",this._closeModal),t(document).off("collab:m2:prompt:hide",this._closeModal),t(document).off("collab:m2:prompt:dismiss",this._dismissModal)},render:function(){return this.state.closed?a.div({}):a.div({className:"get-editable-link-prompt",ref:"prompt",style:{left:this.state.left,top:this.state.top},onClick:function(e){return e.stopPropagation(),e.nativeEvent.stopPropagation()}},a.a({href:"#",onClick:this._dismissModal,className:"close-button"},s(n,{group:"web",name:"xclose"})),a.div({className:"content"},a.span({className:"new"},r("New!")),r("Invite people to your shared folder with a link.")),a.div({className:"learn-more"},a.a({href:"/help/9139"},r("Learn more"))),a.div({className:"prompt-arrow-border",style:{left:this.state.arrowLeft}}),a.div({className:"prompt-arrow",style:{
left:this.state.arrowLeft}}))},_closeModal:function(){return this.isMounted()?this.setState({closed:!0}):void 0},_dismissModal:function(){var e;return this._closeModal(),"function"==typeof(e=this.props).onDismiss?e.onDismiss():void 0},_updateOffset:function(){var e,n,i,o,r,s,a;if(this.isMounted()&&!this.state.closed)return o=this.refs.prompt.getDOMNode(),e=t(this.props.targetedButton),s=e.offset(),r=parseInt(e.css("marginTop"),10),n=t("body").offset(),a=s.top+r-n.top-o.offsetHeight-10,i=s.left+(e.outerWidth()-o.offsetWidth)/2,this.setState({arrowLeft:o.offsetWidth/2-9,top:a,left:i})}})})}.call(this),function(){define("modules/clean/sharing/inband_link_settings_modal",["external/react","modules/clean/ajax","modules/clean/css","modules/clean/em_string","modules/clean/filepath","modules/clean/form","modules/clean/react/button","modules/clean/react/modal","modules/clean/static_urls","modules/core/i18n","modules/core/notify"],function(e,t,n,i,o,r,s,a,l,u,c){var d,p,_,h,m,f,v;return p=a.Modal,v=l.static_url,h=u._,m=e.createElement,f=e.DOM,_={ALL:"all",INVITED:"invited",TEAM:"team"},d=e.createClass({displayName:"InBandLinkSettingsModal",statics:{showInstance:function(e){return p.showInstance(e)}},propTypes:{user:e.PropTypes.object.isRequired,fqPath:e.PropTypes.string.isRequired,teamName:e.PropTypes.string.isRequired,doneCallback:e.PropTypes.func.isRequired},getInitialState:function(){return{hasLoaded:!1}},componentWillMount:function(){return n.require_css("/static/css/sharing_settings_modal-vfl00u9MT.css"),t.WebRequest({subject_user:this.props.user,url:"/simple_sharing_ajax/get_member_link_settings",data:{fq_path:this.props.fqPath},success:function(e){return function(t){var n;if(e.isMounted())return n=JSON.parse(t),e.setState({hasLoaded:!0,keyToRecipients:n.key_to_recipients,memberOnly:n.member_only})}}(this),error:function(e){return function(t,n,i){return e.isMounted()?e._onDone():void 0}}(this)})},render:function(){var e;return e=i.em_snippet(o.filename(this.props.fqPath),16),m(p,{acceptButtonText:h("Save settings"),autoClose:!1,dismissButtonText:h("Cancel"),onAccept:this._onSave,onDismiss:this._onDone,ref:"modal",title:h("‘%(filename)s’ settings").format({filename:e})},this.state.hasLoaded?f.div({className:"sharing-settings-modal-content"},f.table({className:"permission-settings-table"},f.tr({className:"audience-selection"},f.td({className:"prompt"},h("Who can be invited to view this folder?")),f.td({},this._renderOption("audience-all",_.ALL,h("Anyone")),this._renderOption("audience-invited",_.INVITED,h("People you’ve explicitly invited")),this._renderOption("audience-team",_.TEAM,h("People at %(team)s").format({team:this.props.teamName||"your team"})))))):this._renderLoadingSpinner())},_renderLoadingSpinner:function(){return f.div({className:"member-container spinner-div"},f.img({className:"member-loading-spinner",src:v("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif")}))},_renderOption:function(e,t,n){return f.div({className:"option"},f.input({checked:this._mapSettingsToLocal()===t,className:"audience-input",id:e,name:"audience",onChange:this._handleOptionChanged,type:"radio",value:t}),f.label({className:"audience-label",htmlFor:e},n))},_onDone:function(){return this.refs.modal.close(),this.props.doneCallback()},_onSave:function(){return t.WebRequest({subject_user:this.props.user,url:"/simple_sharing_ajax/set_member_link_settings",data:{fq_path:this.props.fqPath,key_to_recipients:this.state.keyToRecipients,member_only:this.state.memberOnly},success:function(e){return function(t){var n,i,o;return i=r.parse_response(t),o=i[0],n=i[1],o?(c.success(h("Settings updated.")),e._onDone()):c.error(n)}}(this)})},_handleOptionChanged:function(e){return this.setState({keyToRecipients:e.currentTarget.value===_.INVITED,memberOnly:e.currentTarget.value===_.TEAM})},_mapSettingsToLocal:function(){return this.state.keyToRecipients?_.INVITED:this.state.memberOnly?_.TEAM:_.ALL}})})}.call(this),function(){define("modules/clean/sharing/keep_a_copy_modal",["external/purify","external/react","external/underscore","modules/clean/react/modal"],function(e,t,n,i){var o,r;return r=i.Modal,o=t.createClass({displayName:"KeepACopyModal",statics:{show:function(e){var n;return n={acceptButtonText:e.confirm_text,bodyHtml:e.body_html,dismissButtonText:e.cancel_text,optionText:e.option_text,onInputAccept:e.confirm_callback,onInputDismiss:e.cancel_callback,onInputDismissCompleted:e.cancel_completed_callback,title:e.title_text,width:e.width,autoClose:e.autoclose,style:e.style},r.showInstance(t.createElement(o,n))}},propTypes:{acceptButtonText:t.PropTypes.string,autoClose:t.PropTypes.bool,bodyHtml:t.PropTypes.string,dismissButtonText:t.PropTypes.string,optionText:t.PropTypes.string,onInputAccept:t.PropTypes.func,onInputDismiss:t.PropTypes.func,onInputDismissCompleted:t.PropTypes.func,style:t.PropTypes.oneOf(["default","clean","simple","lightbox","bare"]),title:t.PropTypes.string,width:t.PropTypes.number},getInitialState:function(){return{checked:!1}},render:function(){var i;return i=n.extend({},this.props,{className:"simple-modal",onAccept:function(e){return function(){var t;return"function"==typeof(t=e.props).onInputAccept?t.onInputAccept(e.state.checked):void 0}}(this),onDismiss:function(e){return function(){var t;return"function"==typeof(t=e.props).onInputDismiss?t.onInputDismiss(e.state.checked):void 0}}(this),onDismissCompleted:function(e){return function(){var t;return"function"==typeof(t=e.props).onInputDismissCompleted?t.onInputDismissCompleted(e.state.checked):void 0}}(this)}),t.createElement(r,i,t.DOM.div({className:"simple-modal-content"},t.DOM.div({dangerouslySetInnerHTML:{__html:e.sanitize(this.props.bodyHtml)}}),t.DOM.div({className:"u-mar-vertical-s"},t.DOM.input({checked:this.state.checked,onClick:this._handleOptionClick,type:"checkbox"},this.props.optionText))))},_handleOptionClick:function(){return this.setState({checked:!this.state.checked})}})})}.call(this),function(){define("modules/clean/sharing/link_description",["modules/clean/react/react_i18n"],function(e){var t,n,i,o,r,s;return s=e.setReactI18nDefaultProject("sharing"),n=s.R_,t=s.RP_,r=function(e){return null!=e.expires?o(e):i(e)},i=function(e){return function(){if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return n({},"Anyone with the link and password can <strong>view</strong> this folder");case"public":return n({},"Anyone with the link can <strong>view</strong> this folder");case"shared_folder_only":return n({},"Members of this folder with this link can <strong>view</strong> this folder");case"team_and_password":return n({},"Anyone on your Dropbox team with the link and the password can <strong>view</strong> this folder");case"team_only":return n({},"Anyone on your Dropbox team with the link can <strong>view</strong> this folder");default:throw Error("Unknown visibility setting")}else switch(e.link_permissions.resolved_visibility){case"password":return n({},"Anyone with the link and password can <strong>view</strong> this file");case"public":return n({},"Anyone with the link can <strong>view</strong> this file");case"shared_folder_only":return n({},"Members of the containing shared folder with the link can <strong>view</strong> this file");case"team_and_password":return n({},"Anyone on your Dropbox team with the link and the password can <strong>view</strong> this file");case"team_only":return n({},"Anyone on your Dropbox team with the link can <strong>view</strong> this file");default:throw Error("Unknown visibility setting")}}()},o=function(e){var n,i,o,r;return n=null!=e.expires?(i=e.expires-new Date,0>i?i=0:void 0,Math.floor(i/864e5)):null,r=null!=(o=e.teamInfo())?o.name:void 0,function(){if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return t({expires_days:n,n:n},"Anyone with the link and the password can <strong>view</strong> this folder (expires in <strong><strong>a day</strong></strong>)","Anyone with the link and the password can <strong>view</strong> this folder (expires in <strong><strong>%(expires_days)s days</strong></strong>)");case"public":return t({expires_days:n,n:n},"Anyone with the link can <strong>view</strong> this folder (expires in <strong>a day</strong>)","Anyone with the link can <strong>view</strong> this folder (expires in <strong><strong>%(expires_days)s days</strong></strong>)");case"shared_folder_only":return t({expires_days:n,n:n},"Members of this folder with the link can <strong>view</strong> this folder (expires in <strong>a day</strong>)","Members of this folder with the link can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>)");case"team_and_password":return t({expires_days:n,n:n},"Anyone on your Dropbox team with the link and the password can <strong>view</strong> this folder (expires in <strong>a day</strong>)","Anyone on your Dropbox team with the link and the password can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>)");case"team_only":return t({expires_days:n,n:n},"Anyone on your Dropbox team with the link can <strong>view</strong> this folder (expires in <strong>a day</strong>)","Anyone on your Dropbox team with the link can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>)");default:throw Error("Unknown visibility setting")}else switch(e.link_permissions.resolved_visibility){case"password":return t({expires_days:n,n:n},"Anyone with the link and the password can <strong>view</strong> this file (expires in <strong>a day</strong>)","Anyone with the link and the password can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>)");case"public":return t({expires_days:n,n:n},"Anyone with the link can <strong>view</strong> this file (expires in <strong>a day</strong>)","Anyone with the link can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>)");case"shared_folder_only":return t({expires_days:n,n:n},"Members of the containing shared folder with the link can <strong>view</strong> this file (expires in <strong>a day</strong>)","Members of the containing shared folder with the link can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>)");case"team_and_password":return t({expires_days:n,n:n},"Anyone on your Dropbox team with the link and the password can <strong>view</strong> this file (expires in <strong>a day</strong>)","Anyone on your Dropbox team with the link and the password can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>)");case"team_only":return t({expires_days:n,n:n},"Anyone on your Dropbox team with the link can <strong>view</strong> this file (expires in <strong>a day</strong>)","Anyone on your Dropbox team with the link can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>)");default:throw Error("Unknown visibility setting")}}()},{formatLinkDescription:r}})}.call(this),function(){define("modules/clean/sharing/link_info",[],function(){var e;return e=function(){function e(e){this.expires=e.expires,this.isFolder=e.isFolder,this.name=e.name,this.teamId=e.teamId,this.teamName=e.teamName,this.url=e.url,this.visibility=e.visibility,this.isPackage=e.isPackage}return e}(),{LinkInfo:e}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/sharing/member_avatars",["external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/photo_avatar","modules/clean/avatar/viewer_avatar","modules/clean/avatar/list","modules/clean/components/title_bubble","modules/clean/viewer","modules/constants/viewer","modules/core/i18n","modules/clean/static_urls"],function(t,n,i,o,r,s,a,l,u,c,d,p){var _,h,m,f,v;return h=d._,v=d.ungettext,f=p.static_url,m=t.createElement,_={getInitialState:function(){return{paired_users_in_sf:!1}},componentWillMount:function(){var e;return e=this.arePairedUsersInSf(this.props.joinedMembers),this.setState({paired_users_in_sf:e,paired_users_in_sf:e})},componentWillReceiveProps:function(e){var t;return t=this.arePairedUsersInSf(e.joinedMembers),this.setState({paired_users_in_sf:t,paired_users_in_sf:t})},_wrap_with_avatar_type_and_data:function(e,t,n){return function(){return e(t,n)}},arePairedUsersInSf:function(t){var n,i,o,r,s,a,l;return t?(l=u.get_viewer(),!!(l.is_paired&&(a=l.get_user_ids(n=!0),i=function(){var e,n,i;for(i=[],e=0,n=t.length;n>e;e++)o=t[e],i.push(o.user_id);return i}(),r=a[0],e.call(i,r)>=0&&(s=a[1],e.call(i,s)>=0)))):!1},findOwnerAndMeInJoinedMembers:function(e){var t,n,i,o,r,s;for(s=null,o=null,t=n=0,i=e.length;i>n&&(r=e[t],"owner"===r.access_type&&(s=r),r.user_id===this.props.user.id&&(o=r),null==s||null==o);t=++n);return[s,o]},addGroupsMembersInvitations:function(t,n,i,o,r){var s,a,l,u,c,d,p,_,h,m,f;for(null==r&&(r=[]),l=0,d=n.length;d>l;l++)s=n[l],t.push(this.renderGroup(s));for(u=0,p=i.length;p>u;u++)h=i[u],m=h.user_id,e.call(r,m)<0&&t.push(this.renderJoinedMember(h));for(f=[],c=0,_=o.length;_>c;c++)a=o[c],f.push(t.push(this.renderInvitedPerson(a)));return f},renderAvatarList:function(e){return m(a,{avatars:e,avatarDimension:this.props.avatarDimension,maxVisible:this.props.maxVisibleAvatars,undisplayableCount:this.props.numUndisplayableUsersAndInvites||0,onOverflowCountClick:this.props.onOverflowCountClick,animation:this.props.animation})},renderJoinedMember:function(t){var i,r,a,d,p,_,h,f,v,g,y,b;return y=u.get_viewer(),g=t.user_id,h=e.call(y.get_user_ids(r=!0),g)>=0,p=null,h&&this.state.paired_users_in_sf?(_=t.user_id,v=y.get_user_by_role(c.ROLE_PERSONAL,!0),b=y.get_user_by_role(c.ROLE_WORK,!0),_===v.id?p="Personal":_===b.id&&null!=y.team_name&&(p=y.team_name)):p=t.display_name,i=this.individualAccessTypeString(p,t.access_type,h,this.state.paired_users_in_sf),f=this._wrap_with_avatar_type_and_data(this.props.onAvatarClick,"member",t),d={alt:i,dimension:this.props.avatarDimension,onPhotoClick:f,photoUrl:t.photo_url,defaultAvatar:m(o,{alt:i,dimension:this.props.avatarDimension,name:t.display_name,initials:t.initials,shape:"CIRCLE",onClick:f})},a=h?m(s,d):m(n,d),m(l,{key:"user:"+t.user_id+":"+t.photo_url,text:i,direction:this.props.titleButtonDirection},a)},renderGroup:function(e){var t,n,i;return n=this._wrap_with_avatar_type_and_data(this.props.onAvatarClick,"group",e),e.is_automatic?(i=this.teamAccessTypeString(e.name,e.access_type),t=m(r,{alt:i,dimension:this.props.avatarDimension,photoUrl:f("/static/images/icons/team_32-vflk8mBzO.png"),shape:"SQUARE",onClick:n})):(i=this.groupAccessTypeString(e.name,e.access_type,e.num_users),t=m(o,{alt:i,dimension:this.props.avatarDimension,name:e.name,shape:"SQUARE",initials:this.getInitials(e.name),onClick:n})),m(l,{key:"group:"+e.gid+":"+e.name,text:i,direction:this.props.titleButtonDirection},t)},renderInvitedPerson:function(e){var t,n;return n=this._wrap_with_avatar_type_and_data(this.props.onAvatarClick,"invited",e),t=this.individualAccessTypeString(e.email_or_fbname,"pending",!1),m(l,{key:"invitation:"+e.invitation_id,text:t,direction:this.props.titleButtonDirection},m(i,{alt:t,dimension:this.props.avatarDimension,color:"#aaa",initials:this.getInitials(e.email_or_fbname),shape:"CIRCLE",onClick:n}))},getInitials:function(e){var t,n,i;return null!=e&&e.length>0?(i=e.split(" "),t=function(){var e,t,o;for(o=[],e=0,t=i.length;t>e;e++)n=i[e],o.push(n.charAt(0).toLowerCase());return o}(),t.length>2&&(t=t.splice(0,2)),t.join("")):""},teamAccessTypeString:function(e,t){var n;return n=h("editor"===t?"%(team_group_name)s can edit":"%(team_group_name)s can view"),n.format({team_group_name:e})},groupAccessTypeString:function(e,t,n){var i;return i="editor"===t?v("%(num_users)s person in %(group_name)s can edit","%(num_users)s people in %(group_name)s can edit",n):v("%(num_users)s person in %(group_name)s can view","%(num_users)s people in %(group_name)s can view",n),i.format({group_name:e,num_users:n})},individualAccessTypeString:function(e,t,n,i){var o,r,s,a;return null==i&&(i=!1),o={viewer:h("You can view"),editor:h("You can edit"),owner:h("You’re the owner"),team:h("You’re a member of this team folder"),default:h("You")},a={viewer:h("%(name)s can view"),editor:h("%(name)s can edit"),owner:h("%(name)s is the owner"),pending:h("%(name)s hasn’t added this to their Dropbox yet"),team:h("%(name)s is a member of this team folder"),default:h("%(name)s"),"no access":h("No access")},r={viewer:h("You (%(name)s) can view"),editor:h("You (%(name)s) can edit"),owner:h("You (%(name)s) are the owner")},s=n?i&&null!=e?r:o:a,s[t].format({name:e})}}})}.call(this),function(){define("modules/clean/sharing/members_list/members_list_modal",["jquery","external/react","modules/clean/ajax","modules/clean/analytics","modules/clean/avatar/shared_link_avatar","modules/clean/avatar/size","modules/clean/browse_events","modules/clean/em_string","modules/clean/filepath","modules/clean/react/button","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/sharing/members_list/members_list_row","modules/clean/sharing/non_namespace_manage_access_modal","modules/clean/sharing/inband_link_settings_modal","modules/clean/sharing/share_inband","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,i,o,r,s,a,l,u,c,d,p,_,h,m,f,v,g){var y,b,w,E,T,C,S,k,I,A;return y=r.AVATAR_DIMENSION_BY_SIZE,T=c.Modal,C=m.ShareInband,S=f._,k=t.createElement,I=t.addons.classSet,A=t.DOM,b=t.createFactory(o),w=function(){function e(){}return e.createAndShowModal=function(e,t,n,o,r,s,a,l,u){var c;return c=function(){return C.createAndShowModal(e,t,n,o,r,s,a,l,u)},i.SimpleSharingLogger.log(e.id,19,"viewed"),T.showInstance(k(E,{user:e,fqPath:t,isDir:o,isSharedFolder:s,nsId:r,showUnshareFolderModal:n.show_unshare_folder_modal,showKickUserModal:n.show_kick_user_modal,showKickGroupModal:n.show_kick_group_modal,showUninviteModal:n.show_uninvite_modal,showLeaveFolderModal:n.show_leave_folder_modal,addPeopleCallback:c}))},e}(),E=t.createClass({propTypes:{user:t.PropTypes.object.isRequired,fqPath:t.PropTypes.string.isRequired,isDir:t.PropTypes.string.isRequired,isSharedFolder:t.PropTypes.bool.isRequired,nsId:t.PropTypes.number,showUnshareFolderModal:t.PropTypes.func,showKickUserModal:t.PropTypes.func,showKickGroupModal:t.PropTypes.func,showUninviteModal:t.PropTypes.func,showLeaveFolderModal:t.PropTypes.func,doneCallback:t.PropTypes.func,addPeopleCallback:t.PropTypes.func.isRequired},getInitialState:function(){return{hasLoaded:!1}},componentDidMount:function(){var e;return e=this.props.isSharedFolder?"/members_list":"/sm/members_list",n.WebRequest({subject_user:this.props.user,url:e,data:{fq_path:this.props.fqPath},success:function(e){return function(t){var n;if(e.isMounted())return n=JSON.parse(t),e.setState({hasLoaded:!0,amOwner:n.am_owner,hasOutOfBandLinks:n.has_out_of_band_links,isOutOfBandLinkEditable:n.is_out_of_band_link_editable,members:n.members,groups:n.groups,sharedContentMembers:n.shared_content_members,invitations:n.invitations,teamName:n.team_name,canOnlyInviteTeam:n.can_only_invite_team})}}(this)})},render:function(){return k(T,{className:"share_show_modal",autoClose:!1,title:this._renderTitle(),ref:"modal",showX:!1,buttonComponent:this._renderButtons()},this.state.hasLoaded?this._renderMemberSections():A.div({},this._renderLoadingHeader(),this._renderLoadingSpinner()))},_renderTitle:function(){var e;return e=S(this.props.isDir?"Folder management for ‘%(name)s’":"File management for ‘%(name)s’"),e=e.format({name:a.em_snippet(l.filename(this.props.fqPath),13)})},_renderTeamFolderSettings:function(){return A.div({className:"folder-settings"},this.state.canOnlyInviteTeam?A.span({className:"share-team-only"},S("This folder can only be shared with members of %(team_name)s.").format({team_name:this.state.teamName})):A.span({className:"share-anyone"},S("This folder can be shared with anyone.")))},_renderMemberCount:function(){var e,t;return t=this.state.sharedContentMembers.length+(this.state.members?this.state.members.length:0),e=this.state.groups?this.state.groups.length:0,A.h5({},A.span({},e?1===t&&1===e?S("%(num_members)s member and %(num_groups)s group").format({num_members:t,num_groups:e}):1===t&&e>1?S("%(num_members)s member and %(num_groups)s groups").format({num_members:t,num_groups:e}):t>1&&1===e?S("%(num_members)s members and %(num_groups)s group").format({num_members:t,num_groups:e}):t>1&&e>1?S("%(num_members)s members and %(num_groups)s groups").format({num_members:t,num_groups:e}):void 0:1===t?S("%(num)s member").format({num:t}):S("%(num)s members").format({num:t})))},_renderHeader:function(){return A.table({className:"member-info"},A.tr({},A.td({},this.state.amOwner&&this.props.user.is_team?this._renderTeamFolderSettings():this._renderMemberCount())))},_renderLoadingHeader:function(){return A.div({className:"member-info header-loading"})},_renderButtons:function(){var e,t,n;return A.div({className:"action-panel"},A.div({className:"clearfix folder-management-buttons"},this.state.hasLoaded?(n=this.props.isSharedFolder&&this.state.amOwner,e=this.state.sharedContentMembers.length>0||this.state.hasOutOfBandLinks,t=!this.props.isSharedFolder&&e,A.div({},n||t?k(u.button,{importance:"tertiary",onClick:this._unshareButtonClicked},S("Remove all access")):void 0,k(u.button,{importance:"tertiary",onClick:this._addPeopleButtonClicked},S("Add people")))):void 0,k(u.button,{importance:"primary",onClick:this._onDone},S("Done"))))},_addPeopleButtonClicked:function(){return this.refs.modal.close(),this.props.addPeopleCallback()},_onDone:function(){return this.refs.modal.close(),this.props.doneCallback?this.props.doneCallback():void 0},_showLeaveFolderModal:function(){return this.refs.modal.close(),this.props.showLeaveFolderModal(this.props.user,this.props.fqPath,this.props.nsId)},_showKickUserModal:function(e,t){return this.refs.modal.close(),this.props.showKickUserModal(this.props.user,this.props.fqPath,this.props.nsId,e,t)},_showUninviteModal:function(e,t){return this.refs.modal.close(),this.props.showUninviteModal(this.props.user,this.props.fqPath,this.props.nsId,e,t)},_showKickGroupModal:function(e,t){return this.refs.modal.close(),this.props.showKickGroupModal(this.props.user,this.props.fqPath,this.props.nsId,e,t)},_unshareButtonClicked:function(){return this.props.isSharedFolder?(T.close(),this.props.showUnshareFolderModal(this.props.user,this.props.fqPath,this.props.nsId)):n.WebRequest({url:g({path:"/sm/unshare_content"+l.normalize(this.props.fqPath)}),subject_user:this.props.user.id,type:"POST",success:function(t){return function(){return e(document).trigger(s.UPDATE),v.success(S("Content unshared")),t._onDone()}}(this),error:function(){return v.error(S("An error occurred when unsharing content"))}})},_removeOOBLinkButtonClicked:function(){return n.WebRequest({url:g({path:"/sm/disable_token_at_path"+l.normalize(this.props.fqPath)}),subject_user:this.props.user.id,type:"POST",success:function(t){return function(){return e(document).trigger(s.UPDATE),t.isMounted()?t.setState({hasOutOfBandLinks:!1}):void 0}}(this),error:function(){return v.error(S("An error occurred when removing links."))}})},_renderMembersListRow:function(e,t){return p({key:t,user:this.props.user,memberUid:e.member_uid,inviteId:e.invite_id,groupId:e.group_id,amOwner:this.state.amOwner,sharedContentMemberId:e.shared_content_member_id,icon:e.icon,emailOrFbname:e.email_or_fbname,name:e.name,hasJoined:e.has_joined,isMemberActive:e.is_member_active,accessType:e.access_type,showRemoveButton:e.show_remove_button,hideAccessTypeDropdown:e.hide_access_type_dropdown,canMakeEditor:e.can_make_editor,canMakeViewer:e.can_make_viewer,canMakeOwner:e.can_make_owner,showUpsell:e.show_upsell,upsellUrl:e.upsell_url,avatarPhotoUrl:e.avatar_photo_url,avatarInitials:e.avatar_initials,showKickUserModal:this._showKickUserModal,showKickGroupModal:this._showKickGroupModal,showUninviteModal:this._showUninviteModal,showLeaveFolderModal:this._showLeaveFolderModal})},_renderMembers:function(){var e,t,n,i,o;if(this.state.members){for(i=this.state.members,o=[],e=0,t=i.length;t>e;e++)n=i[e],o.push(this._renderMembersListRow(n,n.member_uid));return o}},_renderInvitations:function(){var e,t,n,i,o;if(this.state.invitations){for(i=this.state.invitations,o=[],e=0,n=i.length;n>e;e++)t=i[e],o.push(this._renderMembersListRow(t,t.invite_id));return o}},_renderGroups:function(){var e,t,n,i,o;if(this.state.groups){for(i=this.state.groups,o=[],t=0,n=i.length;n>t;t++)e=i[t],o.push(this._renderMembersListRow(e,e.group_id));return o}},_renderSharedContentMembers:function(){var e,t,n,i,o;if(this.state.sharedContentMembers){for(n=this.state.sharedContentMembers,i=[],e=0,t=n.length;t>e;e++)o=n[e],i.push(this._renderMembersListRow(o,o.shared_content_member_id));return i}},_renderCollabLink:function(){return this.state.hasOutOfBandLinks?A.div({className:"bs-row clearfix clear no-hover"},b({alt:"",dimension:y.SMALL}),S(this.state.isOutOfBandLinkEditable?"Anyone with the link can edit":"Anyone with the link can view"),A.div({className:"bs-actions remove-button"},A.a({},d({onClick:this._removeOOBLinkButtonClicked,group:"web",name:"xclose"})))):void 0},_getMemberHeaderClassName:function(e){return(I=t.addons.classSet)({"member-info":!0,"follow-on":"oob-link"===e||"shared-link"===e&&this.props.isSharedFolder})},_getMemberListClassName:function(){var e;return(I=t.addons.classSet)({"member-container":!0,"react-rendered":!0,"dual-pane":this.props.isSharedFolder&&(null!=(e=this.state.sharedContentMembers)?e.length:void 0)>0})},_renderMemberSections:function(){var e;return A.div({},this.props.isSharedFolder?A.div({className:this._getMemberHeaderClassName("shared-folder")},S("People who can view and edit"),A.div({className:this._getMemberListClassName()},A.div({className:"clearfix"},this._renderGroups(),this._renderMembers(),this._renderInvitations()))):void 0,!this.props.isSharedFolder||(null!=(e=this.state.sharedContentMembers)?e.length:void 0)>0?A.div({className:this._getMemberHeaderClassName("shared-link")},A.span,S("People who can view")," • ",this._renderSettingsLink(),A.div({className:this._getMemberListClassName()},A.div({className:"clearfix"},this._renderSharedContentMembers()))):void 0,this.state.hasOutOfBandLinks?A.div({className:this._getMemberHeaderClassName("oob-link")},S("Link to folder"),A.div({className:"clearfix"},this._renderCollabLink())):void 0)},_renderLoadingSpinner:function(){return A.div({className:"member-container spinner-div"},A.img({className:"member-loading-spinner",src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"}))},_renderSettingsLink:function(){return k(u.link_button,{className:"settings-link",importance:"standard",onClick:function(e){return function(t){return h.showInstance(k(h,{user:e.props.user,fqPath:e.props.fqPath,teamName:e.state.teamName}))}}(this)},S("Change settings"))}}),{MemberList:w,MembersListModal:E}})}.call(this),function(){define("modules/clean/sharing/members_list/members_list_row",["external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/size","modules/clean/em_string","modules/clean/react/select","modules/clean/react/sprite","modules/core/i18n","modules/core/notify"],function(e,t,n,i,o,r,s,a,l){var u,c,d,p,_,h,m;return u=i.AVATAR_DIMENSION_BY_SIZE,_=a._,m=e.DOM,h=e.addons.classSet,d=r.input,p=r.option,c=e.createClass({propTypes:{key:e.PropTypes.any.isRequired,memberUid:e.PropTypes.number,inviteId:e.PropTypes.number,groupId:e.PropTypes.string,sharedContentMemberId:e.PropTypes.string,user:e.PropTypes.object.isRequired,amOwner:e.PropTypes.bool,avatarPhotoUrl:e.PropTypes.string,avatarInitials:e.PropTypes.string,icon:e.PropTypes.string.isRequired,emailOrFbname:e.PropTypes.string.isRequired,name:e.PropTypes.string.isRequired,hasJoined:e.PropTypes.bool.isRequired,isMemberActive:e.PropTypes.bool,accessType:e.PropTypes.string.isRequired,hideAccessTypeDropdown:e.PropTypes.bool.isRequired,canMakeEditor:e.PropTypes.bool.isRequired,canMakeViewer:e.PropTypes.bool.isRequired,canMakeOwner:e.PropTypes.bool.isRequired,showUpsell:e.PropTypes.bool.isRequired,upsellUrl:e.PropTypes.string,showRemoveButton:e.PropTypes.bool.isRequired,showKickUserModal:e.PropTypes.func,showKickGroupModal:e.PropTypes.func,showUninviteModal:e.PropTypes.func,showLeaveFolderModal:e.PropTypes.func},_renderAvatar:function(){return t({dimension:u.SMALL,photoUrl:this.props.avatarPhotoUrl,defaultAvatar:n({dimension:u.SMALL,shape:this.props.groupId?"SQUARE":"CIRCLE",initials:this.props.avatarInitials,name:this.props.name})})},_renderDisplayName:function(){var e,t,n,i;return n=!this.props.inviteId&&this.props.name?this.props.name:this.props.emailOrFbname,this.props.memberUid===this.props.user.id?t=" "+_("(me)",i="web",e="this row represents the viewer herself."):this.props.sharedContentMemberId?t=" "+_("(link member)",i="web",e="inband view-only link member"):this.props.hasJoined||(t=" "+_("(pending)",i="web",e="this row represents one pending invitation.")),m.div({},m.a({className:"sf-display-name"},n),t?m.em({},t):void 0)},_renderAccessTypeSettings:function(){return this.props.hideAccessTypeDropdown?m.div({className:"sf-can-edit-text"},this.props.accessType):m.div({className:"sf-can-edit sf-can-edit-text"},d({name:"access_type","disable-errors":!0,defaultValue:this.props.accessType},this.props.canMakeEditor?p({value:"can edit"},_("can edit")):void 0,p({value:"can view",disabled:!this.props.canMakeViewer},_("can view")),this.props.canMakeOwner?p({value:"make owner"},_("make owner")):void 0,this.props.showUpsell?p({value:"upsell"},_("Upgrade to enable viewer permission")):void 0))},_removeButtonClicked:function(){return this.props.inviteId?this.props.showUninviteModal(this.props.inviteId,this.props.emailOrFbname):this.props.memberUid?this.props.memberUid===this.props.user.id?this.props.amOwner?l.error(_("You can’t leave this folder because you’re the owner. You must transfer ownership to another member before you can leave.")):this.props.showLeaveFolderModal():this.props.showKickUserModal(this.props.memberUid,this.props.name):this.props.groupId?this.props.showKickGroupModal(this.props.groupId,this.props.name):void 0},_renderRemoveButton:function(){return m.div({className:"bs-actions remove-button"},this.props.showRemoveButton?m.a({},s({group:"web",name:"xclose",onClick:this._removeButtonClicked})):void 0)},render:function(){return m.div({className:h({"bs-row clearfix clear no-hover":!0,"avatars-enabled":!0,unmounted:this.props.memberUid&&!this.props.isMemberActive,unjoined:!this.props.hasJoined})},m.div({className:"sf-name"},this._renderAvatar(),this._renderDisplayName()),this._renderAccessTypeSettings(),this._renderRemoveButton())}})})}.call(this),function(){define("modules/clean/sharing/namespace_conversion_alert_modal",["external/react","modules/clean/ajax","modules/clean/analytics","modules/clean/dbmodal","modules/clean/react/modal","modules/core/i18n"],function(e,t,n,i,o,r){var s,a,l,u,c;return s=i.DBModalStack,a=o.Modal,u=r._,c=e.DOM,l=e.createClass({statics:{showInstance:function(e){return a.showInstance(e)}},propTypes:{user:e.PropTypes.object.isRequired,req_url:e.PropTypes.string.isRequired,req_data:e.PropTypes.object.isRequired,success_callback:e.PropTypes.func.isRequired},getInitialState:function(){return{converting_to_shared_folder:!1}},render:function(){return a({title:u("Convert to shared folder?"),acceptButtonText:u("Continue"),acceptButtonDisabled:this.state.converting_to_shared_folder,dismissButtonText:u("Cancel"),autoClose:!1,onAccept:this._onAccept,onDismiss:this.close,submitting:this.state.converting_to_shared_folder,ref:"modal"},c.div({},u("For other people to edit files in this folder, you have to convert it into a shared folder. Do you want to continue?")))},_onAccept:function(){return this.state.converting_to_shared_folder?void 0:(n.SimpleSharingLogger.log(this.props.user.id,24),
t.FormWebRequest({subject_user:this.props.user.id,url:this.props.req_url,data:this.props.req_data,skipErrorHandling:!0,success:function(e){return function(t){return e.isMounted()?(e.setState({converting_to_shared_folder:!1}),e.props.success_callback(t)):void 0}}(this),error:function(e){return function(){return e.isMounted()?e.setState({converting_to_shared_folder:!1}):void 0}}(this)}),this.setState({converting_to_shared_folder:!0}))},close:function(){return this.refs.modal.close()},componentDidMount:function(){return n.SimpleSharingLogger.log(this.props.user.id,23)}})})}.call(this),function(){define("modules/clean/sharing/non_namespace_manage_access_modal",["jquery","external/react","modules/clean/analytics","modules/clean/ajax","modules/clean/browse_events","modules/clean/dbmodal","modules/clean/em_string","modules/clean/filepath","modules/clean/react/button","modules/clean/react/modal","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,i,o,r,s,a,l,u,c,d,p){var _,h,m,f,v;return _=r.DBModalStack,h=u.Modal,f=c._,v=t.DOM,m=t.createClass({statics:{showInstance:function(e){return h.showInstance(e)}},propTypes:{user:t.PropTypes.object.isRequired,fq_path:t.PropTypes.string.isRequired,done_callback:t.PropTypes.func.isRequired},render:function(){var e;return e=s.em_snippet(a.filename(this.props.fq_path),16),h({title:f("Remove access to ‘%(filename)s’?").format({filename:e}),autoClose:!1,showX:!1,buttonComponent:this._renderButtons(),ref:"modal"},v.div({},f("You previously shared this folder and gave people permission to view it. If you remove their access, only you will be able to see it.")))},_renderButtons:function(){return v.div({className:"db-modal-buttons"},v.button({className:"dbmodal-button button-primary",onClick:this._remove_link_button_clicked},f("Remove access")),v.button({className:"dbmodal-button button-tertiary",onClick:function(e){return function(){return e._onDone(!1)}}(this)},f("Cancel")))},_onDone:function(e){return this.refs.modal.close(),this.props.done_callback.bind(null,!e)()},_remove_link_button_clicked:function(){return i.WebRequest({url:p({path:"/sm/disable_token_at_path"+a.normalize(this.props.fq_path)}),subject_user:this.props.user.id,type:"POST",success:function(t){return function(){return e(document).trigger(o.UPDATE),d.success(f("Link removed")),n.SimpleSharingLogger.log(t.props.user.id,25),t._onDone(!0)}}(this),error:function(e){return function(){return d.error(f("An error occurred when removing link"))}}(this)})}})})}.call(this),function(){define("modules/clean/sharing/notifications",["jquery","modules/clean/browse_interface","modules/clean/sharing/api/client","modules/clean/viewer","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,i,o,r,s,a){var l,u,c,d,p,_;return u=n.ShareApiClient,l=n.FolderShareApiClient,c=r._,d=function(t){var n,i;return n=e(t).closest("form"),null!=(i=n.closest(".sc-invite-action"))&&i.addClass("loading"),n.length&&new u({userId:n[0]._subject_uid.value}).dismissInviteNotification({contentId:n[0].content_id.value}).finally(function(){return n.closest(".sc-invite-action").removeClass("loading"),n.closest(".feed-row").remove()}),!1},p=function(n){var r,u;return r=e(n),r.closest(".sc-invite-action").addClass("loading"),u=i.get_viewer().get_user_by_id(n._subject_uid.value),new l({userId:u.id}).mount({contentId:n.sf_id.value,origin:"NOTIFICATION_WEB"}).then(function(e){var n,i,l;return n=r.closest(".sc-invite-action"),n.addClass("sf-mounted"),i=e.path_lower,l=a({path:t.get_browse_root(u)+i}).toString(),o.redirect(l),s.success(c("Added the shared folder %(folder_name)s.").format({folder_name:e.name}))}).finally(function(){return r.closest(".sc-invite-action").removeClass("loading")}),!1},_=function(){var e;return s.info(c("Continue upgrading to add the shared folder to your Dropbox.")),e=a({path:"/pro/buy"}),e.updateQuery({cont:"sf",oqa:"sf_aoq_b_n"}),o.redirect(e.toString()),!1},{register_dismiss:d,register_mount:p,upgrade_to_mount:_}})}.call(this),function(){define("modules/clean/sharing/share_inband",["jquery","external/underscore","modules/clean/ajax","modules/clean/analytics","modules/clean/account/email","modules/clean/account/email_verify_reasons","modules/clean/contacts/tokenizer","modules/clean/contacts/types","modules/clean/em_string","modules/clean/file_events","modules/clean/filepath","modules/clean/form","modules/clean/react/button","modules/clean/react/modal","modules/clean/react/select","modules/clean/sharing/inband_link_settings_modal","modules/clean/sharing/namespace_conversion_alert_modal","modules/clean/sharing/shared_folder_settings_modal","modules/clean/sharing/shared_link_for_sf","modules/clean/sharing/constants","modules/clean/viewer","modules/core/exception","modules/core/i18n","modules/core/notify","external/react"],function(e,t,n,i,o,r,s,a,l,u,c,d,p,_,h,m,f,v,g,y,b,w,E,T,C){var S,k,I,A,P,N,R,O,D,x,L,M,F;return A=o.EmailVerification,I=s.ContactsTokenizer,k=s.ContactTokenValidator,S=s.ContactTokenState,P=_.Modal,N=y.NameSpaceAccess,x=w.assert,D=E._,F=E.ungettext,L=C.createElement,M=C.DOM,R=function(){function t(){}return t.createAndShowModal=function(t,i,o,s,p,_,h,g,y){var b,w,E,C,S,k;if(A.get_for_user(t).verified_or_show(r.SHARE_FOLDER))return S=l.em_snippet(c.filename(i),16),k=D("Share ‘%(filename)s’ with others").format({filename:S}),b=D(s?"Who do you want to share this folder with?":"Who do you want to share this file with?"),E=function(e,t,n,i,o,r){return P.showInstance(L(v,{user:e,fq_path:t,is_shared_folder:n,ns_id:i,initial_allows_editor_manage_membership:o,done_callback:r,isPolicyChangeRecursive:!1}))},C=function(e,t,n,i){return P.showInstance(L(m,{user:e,fqPath:t,teamName:n,doneCallback:i}))},w=function(o,r,l,c,m,v,g){var y,b,w,E,C,k,I;if(w=function(){var e,t,n;for(n=[],e=0,t=o.length;t>e;e++)y=o[e],y.type===a.EMAIL&&n.push(y.email);return n}(),E=function(){var e,t,n;for(n=[],e=0,t=o.length;t>e;e++)y=o[e],y.type===a.FB&&n.push(y.fb_id);return n}(),C=function(){var e,t,n;for(n=[],e=0,t=o.length;t>e;e++)y=o[e],y.type===a.NEW_STYLE_GROUP&&n.push(y.group_id);return n}(),k=w.length+E.length+C.length,I=function(t,n,i){var o,r,s,a,l,c;return s=d.parse_response(t),l=s[0],r=s[1],l?(n&&e(document).trigger(u.SF_NEW),i?T.success(r):(c=F("Shared ‘%(filename)s’!","Shared ‘%(filename)s’ with %(num_recipients)s people!",k),T.success(c.format({filename:S,num_recipients:k}))),e(document).trigger("db:sharing_api:request_succeeded",{request_url:"",ns_id:p}),P.close()):(a=d.parse_error(r),l=a[0],o=a[1],l?T.error(o):T.error())},"edit"===r)if(_)n.FormWebRequest({subject_user:t.id,url:"/share_ajax/invite_more",data:{ns_id:p,emails:w,fb_ids:E,new_style_group_ids:C,custom_message:l,access_type:N.ACCESS_WRITER,is_simple_sharing:!0},skipErrorHandling:!0,success:function(e){return I(e,!1,!0)}});else{if(!h)return s?x(!1,"Tried to share unshareable folder with edit access"):T.error(D("Not implemented yet!"));b={path:i,emails:w,fb_ids:E,new_style_group_ids:C,custom_message:l,access_type:N.ACCESS_WRITER,is_simple_sharing:!0,folder_settings:1,shared_link_policy:g?g:void 0,audience:m?m:void 0,inviter:v?v:c?void 0:"me"},(b.audience||b.inviter)&&(b.custom_folder_settings=1),P.showInstance(L(f,{user:t,req_url:"/share_ajax/existing",req_data:b,success_callback:function(e){var t;return t=JSON.parse(e),null!=t.invite_message?I(t.invite_message,!0,!0):I(e,!0,!1)}}))}else n.FormWebRequest({subject_user:t.id,url:"/sm/share_inband",data:{fq_path:i,emails:w,fb_ids:E,new_style_group_ids:C,is_simple_sharing:!0,custom_message:l},skipErrorHandling:!0,success:function(e){return I(e,!1,!0)}})},P.showInstance(L(O,{user:t,fq_path:i,is_dir:s,title:k,recipient_prompt:b,send_handler:w,show_dfb_existing_folder_settings_modal:o.show_dfb_existing_folder_settings_modal,show_dfb_new_folder_settings_modal:o.show_dfb_new_folder_settings_modal,show_personal_folder_settings_modal:E,show_view_settings_modal:C,initial_access_type:"view",allows_edit:_||h,target_ns_id:p,is_shared_folder:_,sf_perm_role:g,could_be_shared_folder:h,initial_allows_editor_manage_membership:!_,initial_message:"",initial_show_message_field:!1}))},t}(),O=C.createClass({displayName:"ShareInbandModal",propTypes:{title:C.PropTypes.string.isRequired,user:C.PropTypes.object.isRequired,fq_path:C.PropTypes.string.isRequired,is_dir:C.PropTypes.bool.isRequired,recipient_prompt:C.PropTypes.string.isRequired,initial_access_type:C.PropTypes.string.isRequired,allows_edit:C.PropTypes.bool.isRequired,send_handler:C.PropTypes.func.isRequired,show_dfb_existing_folder_settings_modal:C.PropTypes.func.isRequired,show_dfb_new_folder_settings_modal:C.PropTypes.func.isRequired,show_personal_folder_settings_modal:C.PropTypes.func.isRequired,show_view_settings_modal:C.PropTypes.func.isRequired,target_ns_id:C.PropTypes.number,is_shared_folder:C.PropTypes.bool.isRequired,sf_perm_role:C.PropTypes.number.isRequired,could_be_shared_folder:C.PropTypes.bool.isRequired,tokenizer_input:C.PropTypes.shape,initial_allows_editor_manage_membership:C.PropTypes.bool,initial_audience_restriction:C.PropTypes.string,initial_inviter_restriction:C.PropTypes.string,initial_shared_link_policy_restriction:C.PropTypes.string,initial_message:C.PropTypes.string,initial_show_message_field:C.PropTypes.bool},getInitialState:function(){return{access_type:this.props.initial_access_type,tokens:[],show_message_field:this.props.initial_show_message_field,allows_editor_manage_membership:this.props.initial_allows_editor_manage_membership,audience_restriction:this.props.initial_audience_restriction,inviter_restriction:this.props.initial_inviter_restriction,shared_link_policy_restriction:this.props.initial_shared_link_policy_restriction}},componentDidMount:function(){var e;return e="m1",i.SimpleSharingLogger.log(this.props.user.id,14,null,e),this.props.is_shared_folder&&this._updateAllowingEditorManageMembership(),this.state.show_message_field?this.refs.message_field.getDOMNode().value=this.props.initial_message:void 0},shouldComponentUpdate:function(e,n){return!t.isEqual(e,this.props)||!t.isEqual(n,this.state)},render:function(){var e;return e=this._getCustomContactValidator(),L(P,{autoClose:!1,title:this.props.title,ref:"modal",buttonComponent:this._renderButtons()},M.div({className:"share-inband-container"},M.div({className:"prompt-line"},this.props.recipient_prompt),M.div({className:"recipients-container o-flag o-flag--rev o-flag--top"},L(I,{ref:"tokenizer",customClass:"recipients-tokenizer o-flag__flex",user:this.props.user,onContentsChange:this._setTokens,populatedInputData:this.props.tokenizer_input,customContactValidator:e,showContactImport:!0}),this.props.is_dir?this._renderEditDropdown():void 0),this.state.show_message_field?M.div({className:"custom-message-container sick-input small"},M.textarea({ref:"message_field",className:"textinput act_as_block",placeholder:D("Message (optional)")}),this._renderSettingsLink()):void 0,this._renderExternalTokenWarning(e)))},close:function(){return this.refs.modal.close()},get_message:function(){var e;return e=this.refs.message_field,e?e.getDOMNode().value:""},generate_share_inband_restore_callback:function(){var e,t,n,i,o;return i=this._getSerializedData(),e=this.state.access_type,t=this.get_message(),o=this.state.show_message_field,n=this.restore_inband_modal.bind(null,i,e,t,o)},_renderEditDropdown:function(){return L(h.input,{ref:"access",className:"invite-access o-flag__fix",value:this.state.access_type,onChange:function(e){return function(t,n){return e.props.allows_edit||"edit"!==n||(T.error(D("Can’t invite others to edit this folder.")),n="view"),e.setState({access_type:n})}}(this)},L(h.option,{value:"view"},D("can view")),L(h.option,{value:"edit",disabled:!this._can_edit()},D("can edit")))},_getCustomContactValidator:function(){return k.basic},_renderButtons:function(){return M.div({className:"db-modal-buttons share-inband-buttons"},L(g,{fq_path:this.props.fq_path,user:this.props.user,is_dir:this.props.is_dir,is_shared_folder:this.props.is_shared_folder,could_be_shared_folder:this.props.could_be_shared_folder,can_edit:this._can_edit(),generate_share_inband_restore_callback:this.generate_share_inband_restore_callback.bind(this)}),M.button({className:"dbmodal-button button-primary send-button",onClick:function(e){return function(t){var n;return n=e._getRecipients(),0===n.length?void T.error(D("No one to share with! Please enter a valid recipient.")):e.props.send_handler(n,e.state.access_type,e.get_message(),e.state.allows_editor_manage_membership,e.state.initial_audience_restriction,e.state.initial_inviter_restriction,e.state.initial_shared_link_policy_restriction)}}(this)},D("Send")))},_setTokens:function(e,t){return this.setState({tokens:e}),this._validate_input(e)?this.setState({show_message_field:!0}):void 0},_validate_input:function(e){var t,n,i;for(n=0,i=e.length;i>n;n++)if(t=e[n],!t.invalid)return!0},_renderExternalTokenWarning:function(e){var t,n,i,o,r,s,a;if(!this.props.user.is_team)return!1;for(o=0,r=this.state.tokens,n=0,i=r.length;i>n;n++)t=r[n],t.invalid||e(t).state!==S.warn||(o+=1);return o>0?(s=b.get_viewer().team_name,a=D("Sharing with %(warned_tokens)s people outside of %(team_name)s").format({warned_tokens:o,team_name:s}),1===o&&(a=D("Sharing with 1 person outside of %(team_name)s").format({team_name:s})),M.span({className:"external-token-warning"},M.img({src:"/static/images/teams/sharefolder_warning-vflzbBoRL.png"}),a)):!1},_renderSettingsLink:function(){var e;return e="",e=D("edit"===this.state.access_type?this.props.is_dir?"You’re sending a link to edit this folder.":"You’re sending a link to edit this file.":this.props.is_dir?"You’re sending a link to view this folder.":"You’re sending a link to view this file."),this._can_see_settings_for_shared_folder()?M.div({className:"settings-line"},e,L(p.link_button,{className:"settings-link",importance:"standard",onClick:function(e){return function(t){return e._showSettings()}}(this)},D("Change settings"))):this.props.is_dir?void 0:M.div({className:"settings-line"},e)},_showSettings:function(){var e,t,n,i,o,r,s;return r=this._getSerializedData(),e=this.state.access_type,t=this.get_message(),s=this.state.show_message_field,n=this.restore_inband_modal.bind(null,r,e,t,s),i=this.restore_inband_modal_with_allows_editor_manage_membership.bind(null,r,e,t,s),o=this.restore_inband_modal_with_saved_state.bind(null,r,e,t,s),P.close(),"edit"===this.state.access_type?"work"===this.props.user.role?this.props.is_shared_folder?this.props.show_dfb_existing_folder_settings_modal(this.props.user,this.props.fq_path,this.props.target_ns_id,n):this.props.show_dfb_new_folder_settings_modal(this.props.user,this.props.fq_path,{audience:this.props.initial_audience_restriction,inviter:this.props.initial_inviter_restriction,shared_link_policy:this.props.initial_shared_link_policy_restriction},o):this.props.show_personal_folder_settings_modal(this.props.user,this.props.fq_path,this.props.is_shared_folder,this.props.target_ns_id,this.props.initial_allows_editor_manage_membership,i):"view"===this.state.access_type?this.props.show_view_settings_modal(this.props.user,this.props.fq_path,b.get_viewer().team_name,n):void 0},_updateAllowingEditorManageMembership:function(){return this.props.is_shared_folder?n.WebRequest({url:"/share_ajax/members_can_invite",data:{ns_id:this.props.target_ns_id},subject_user:this.props.user.id,dataType:"json",success:function(e){return function(t){return e.isMounted()?e.setState({allows_editor_manage_membership:t.allows_editor_manage_membership}):void 0}}(this)}):void 0},_can_see_settings_for_shared_folder:function(){return this.props.could_be_shared_folder||this.props.is_shared_folder&&this.props.sf_perm_role===N.ACCESS_OWNER},_can_edit:function(){return!this.props.is_shared_folder||this.props.sf_perm_role===N.ACCESS_OWNER||this.props.sf_perm_role===N.ACCESS_WRITER&&this.state.allows_editor_manage_membership},_getSerializedData:function(){return this.refs.tokenizer.serializeInputData()},_getRecipients:function(){return this.refs.tokenizer.getContacts()},restore_inband_modal:function(e,t,n,i){return this.restore_inband_modal_with_settings(e,t,n,i,this.state.allows_editor_manage_membership,this.state.audience_restriction,this.state.inviter_restriction,this.state.shared_link_policy_restriction)},restore_inband_modal_with_allows_editor_manage_membership:function(e,t,n,i,o){return this.restore_inband_modal_with_settings(e,t,n,i,o,this.state.audience_restriction,this.state.inviter_restriction,this.state.shared_link_policy_restriction)},restore_inband_modal_with_saved_state:function(e,t,n,i,o,r,s){return this.restore_inband_modal_with_settings(e,t,n,i,this.state.allows_editor_manage_membership,o,r,s)},restore_inband_modal_with_settings:function(e,t,n,i,o,r,s,a){var l;return l=L(O,{user:this.props.user,fq_path:this.props.fq_path,is_dir:this.props.is_dir,title:this.props.title,recipient_prompt:this.props.recipient_prompt,send_handler:this.props.send_handler,show_dfb_existing_folder_settings_modal:this.props.show_dfb_existing_folder_settings_modal,show_dfb_new_folder_settings_modal:this.props.show_dfb_new_folder_settings_modal,show_personal_folder_settings_modal:this.props.show_personal_folder_settings_modal,show_view_settings_modal:this.props.show_view_settings_modal,initial_access_type:t,allows_edit:this.props.is_shared_folder||this.props.could_be_shared_folder,target_ns_id:this.props.target_ns_id,is_shared_folder:this.props.is_shared_folder,sf_perm_role:this.props.sf_perm_role,could_be_shared_folder:this.props.could_be_shared_folder,tokenizer_input:e,initial_allows_editor_manage_membership:o,initial_audience_restriction:r,initial_inviter_restriction:s,initial_shared_link_policy_restriction:a,initial_message:n,initial_show_message_field:i}),P.showInstance(l)}}),{ShareInband:R,ShareInbandModal:O}})}.call(this),function(){define("modules/clean/sharing/share_modal",["external/immutable","external/purify","external/react","external/underscore","modules/clean/api_v2/error","modules/clean/contacts/tokenizer","modules/clean/em_string","modules/clean/flux/dispatcher","modules/clean/flux/store_listener","modules/clean/js_environment","external/rsvp","modules/clean/react/browse/constants","modules/clean/react/modal","modules/clean/react/util","modules/clean/sharing/actions/share_modal","modules/clean/sharing/constants","modules/clean/sharing/content_info","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/folder_convert_gg_modal","modules/clean/sharing/folder_settings_modal","modules/clean/sharing/keep_a_copy_modal","modules/clean/sharing/link_settings_modal","modules/clean/sharing/stores/sharing_info","modules/clean/sharing/ui_util","modules/clean/sharing/views/modal_content","modules/clean/user","modules/clean/viewer","modules/core/exception","modules/core/i18n","modules/core/notify"],function(e,t,n,i,o,r,s,a,l,u,c,d,p,_,h,m,f,v,g,y,b,w,E,T,C,S,k,I,A,P,N){var R,O,D,x,L,M,F,U,B,q,W,V,H,j,G,z,K,$,Y,Z,Q,X,J,ee,te,ne,ie,oe,re,se,ae,le,ue,ce,de,pe,_e,he,me,fe,ve,ge,ye,be,we,Ee;return D=o.AppError,M=r.ContactTokenState,ge=l.listenToStores,Q=c.Promise,oe=d.SharedWithActionTypes,Y=p.Modal,re=p.SimpleModal,we=_.setStatePromise,R=m.ACCESS_LEVEL,O=m.ACCESS_VALUES,B=m.FILE_METADATA_PERMISSIONS,q=m.FOLDER_METADATA_PERMISSIONS,W=m.FOLDER_METADATA_PERMISSIONS_INTERNAL,K=m.MEMBER_ACTION,le=m.VALIDATE_PATH_PERMISSIONS,F=f.ContentInfo,_e=v.contactsToMembers,V=v.FileShareApiClient,j=v.FolderShareApiClient,X=v.ShareApiClient,se=v.TeamSharingPolicies,H=g.FolderPolicy,z=g.LinkMetadata,be=g.makeMemberKey,Z=g.PermissionSetting,te=g.SharedFolderMetadata,U=y.ConvertToGoldenGateFolderModal,ne=b.SharedFolderSettingsModal,ve=E.isSharedLinkSettingsModalAllowed,ie=E.SharedLinkSettingsModal,x=C.CONTACT_ERROR_LEVEL,L=C.CONTACT_ERROR_MESSAGES,G=C.GoldenGate,ae=C.Tiburon,me=C.getContactValidator,ye=C.logTiburonEvent,he=C.genAddMemberErrorMessage,Ee=C.showZendeskFlyoutIfAllowed,ee=S.ShareModalContent,$=S.MODES,de=A.assert,pe=n.createElement,ue=P.i18n_default_project("sharing")._,fe=function(e){var t,n;return n=e.actionHandler.getSharingInfo(),t={areMembersLoaded:n.areMembersLoaded(),canRelinquishMembership:n.canRelinquishMembership(),isTeamPolicyLoaded:n.isTeamPolicyLoaded(),members:n.members(),pendingRemoval:n.pendingRemoval(),teamPolicy:n.teamPolicy()},i.extend(i.extend({},e),t)},ce=n.createClass({displayName:"ShareModal",propTypes:{actionHandler:n.PropTypes.instanceOf(h),areMembersLoaded:n.PropTypes.bool,canRelinquishMembership:n.PropTypes.bool,client:n.PropTypes.instanceOf(X),contentInfo:n.PropTypes.instanceOf(F).isRequired,contentMetadata:n.PropTypes.oneOfType([n.PropTypes.instanceOf(te)]),defaultAccess:n.PropTypes.oneOf(O),initialRecipientRawInput:n.PropTypes.string,initialRecipientTokens:n.PropTypes.array,initialState:n.PropTypes.object,linkMetadata:n.PropTypes.instanceOf(z),onFolderSettingsClick:n.PropTypes.func,onLinkSettingsClick:n.PropTypes.func,pendingRemoval:n.PropTypes.instanceOf(e.Set).isRequired,renderedClass:n.PropTypes.any.isRequired,showLegacyShareModal:n.PropTypes.func,teamPolicy:n.PropTypes.instanceOf(se),user:n.PropTypes.instanceOf(k).isRequired,viewer:n.PropTypes.object},getDefaultProps:function(){return{defaultAccess:R.WRITER,initialRecipientRawInput:"",initialRecipientTokens:[],viewer:I.get_viewer()}},getInitialState:function(){var e;return null!=this.props.initialState?this.props.initialState:{contentInfo:this.props.contentInfo,canConvertToGoldenGateFolder:!1,customMessage:"",errorLevel:null,errorMessage:null,hasParentSharedFolder:!1,isLinkDataLoaded:null!=this.props.linkMetadata,isMetadataLoaded:null!=this.props.contentInfo.metadata,isTeamSharedFolder:!1,linkMetadata:this.props.linkMetadata,memberCounts:null,recipientAccess:this.props.contentInfo.isFolder()||ae.editableFilesUI(this.props.user.id)?this.props.defaultAccess:R.READER,uiMode:$.MEMBERSHIP,canChangeOptions:!1,canInviteEditor:!1,canInviteViewer:!1,canUnshareFolder:!1,ownerTeam:null,folderPolicy:null!=(e=this.props.contentInfo.metadata)?e.policy:void 0}},componentWillMount:function(){return this.beginTime=Date.now()},componentDidMount:function(){var e;return this.client=this.props.client||(this.state.contentInfo.isFolder()?new j({userId:this.props.user.id}):new V({userId:this.props.user.id})),u.isBrowser()&&(e=[],null!=this.state.contentInfo.metadata?(this._handleGetMetadataSuccess(this.state.contentInfo.metadata),this.props.areMembersLoaded||this.updateMembers()):this.state.contentInfo.shouldFetchNsId()?e.push(this.client.fetchNsId(this.state.contentInfo.displayPath()).then(function(e){return function(t){return we(e,{contentInfo:e.state.contentInfo.setNsId(t)})}}(this)).then(function(e){return function(){return e._getMetadata()}}(this))):e.push(this._getMetadata()),this.state.contentInfo.canShareLink(!0)&&!this.state.isLinkDataLoaded&&e.push(this.client.sharedLinkInfo({fileIdOrPath:this.state.contentInfo.idForLink()}).then(this._handleSharedLinkInfoSuccess)),this.initialLoadingPromise=Q.all(e)),null},_getMetadata:function(){var e;return e=[],!this.state.contentInfo.isFolder()||this.state.contentInfo.pathExists()&&!this.state.contentInfo.isFileFolder()?this.state.contentInfo.isSharedFolder()?G.canConvertToGGFolder(this.props.user.id)?Array.prototype.push.apply(e,[this.client.getMetadataInternal({contentId:this.state.contentInfo.id,actions:Object.keys(W)}).then(this._handleGetMetadataSuccess),this.updateMembers(),this.getMemberCounts()]):Array.prototype.push.apply(e,[this.client.getMetadata({contentId:this.state.contentInfo.id,actions:Object.keys(q)}).then(this._handleGetMetadataSuccess),this.updateMembers(),this.getMemberCounts()]):Array.prototype.push.apply(e,[this.client.getMetadata({contentId:this.state.contentInfo.id,actions:Object.keys(B)}).then(this._handleGetMetadataSuccess).catch(this._handleLoadingError),this.updateMembers()]):Array.prototype.push.apply(e,[this.client.validatePath({fqPath:this.state.contentInfo.displayPath(),actions:Object.keys(le),list_folder_members_arg:{actions:K.ALL}}).then(function(e){return function(t){var n,i;return i=t.metadata,n=t.inheritedMembers,e.props.actionHandler.setMembers(n),e._handleGetMetadataSuccess(i)}}(this)).catch(this._handleLoadingError),this.getMemberCounts()]),Q.all(e)},render:function(){var e;return e={actionHandler:this.props.actionHandler,canChangeOptions:this.state.canChangeOptions,canConvertToGoldenGateFolder:this.state.canConvertToGoldenGateFolder,canInviteEditor:this.state.canInviteEditor,canInviteViewer:this.state.canInviteViewer,canRelinquishMembership:this.props.canRelinquishMembership,canShareLink:this.state.contentInfo.canShareLink(),contentInfo:this.state.contentInfo,customMessage:this.state.customMessage,errorLevel:this.state.errorLevel,errorMessage:this.state.errorMessage,folderPolicy:this._getFolderPolicy(),hasParentSharedFolder:this.state.hasParentSharedFolder,headerId:"unified-share-modal-title",initialRecipientTokens:this.props.initialRecipientTokens,initialRecipientRawInput:this.props.initialRecipientRawInput,isLinkDataLoaded:this.state.isLinkDataLoaded,isMembershipLoaded:this.props.areMembersLoaded,isMetadataLoaded:this.state.isMetadataLoaded,isTeamSharedFolder:this.state.isTeamSharedFolder,linkMetadata:this.state.linkMetadata,memberCounts:this.state.memberCounts,members:this.props.members,onContactsChange:this._handleRecipientChange,onCreateLinkClick:this._handleCreateLinkClick,onFolderSettingsClick:this._handleFolderSettingsClick,onConvertToGoldenGateClick:this._handleConvertToGoldenGateClick,onMemberAccessChange:this._handleMemberAccessChange,onMessageChange:this._handleMessageChange,onRecipientAccessChange:this._handleRecipientAccessChange,onLinkSettingsClick:this._handleLinkSettingsClick,onSend:this._handleSend,ownerTeam:this.state.ownerTeam,mode:this._getUIMode(),pendingRemoval:this.props.pendingRemoval,recipientAccess:this.state.recipientAccess,recipientRawInput:this.state.recipientRawInput,recipientTokens:this.state.recipientTokens,ref:"content",user:this.props.user,viewer:I.get_viewer()},i.extend(e,i.omit(this.props,i.keys(e))),pe(Y,{style:"bare",acceptButtonText:null,dismissButtonText:null,headerId:"unified-share-modal-title",ref:"modal"},pe(ee,e))},_getRecipientTokens:function(){var e,t;return(null!=(e=this.refs.content)&&null!=(t=e.getWrappedComponent())?t.getRecipientTokens():void 0)||[]},_getUIMode:function(){return this.state.uiMode},_handleLoadingError:function(e){return e instanceof D?(ye(this.state.contentInfo,this.props.user.id,"VIEW_LINK_ONLY_MODAL",{timing:Date.now()-this.beginTime}),this.setState({uiMode:$.LINK_ONLY})):(N.error(e.message||N.DEFAULT_ERROR),Y.close())},_handleMemberAccessChange:function(e,n){var i,o,r,a,l,u,c,d,p;return r=e.displayName(),n===K.REMOVE||n===R.OWNER?(a={name:s.em_snippet(r,40)},l=!1,n===K.REMOVE?(l=e.memberId()===this.props.user.account_id,l?(this.state.contentInfo.isFolder()?(p=ue("Remove your access to this folder?"),i=ue(this.state.contentInfo.isNestedSharedFolder()?"You may still have access to this folder through a company group or parent folder.":"If you continue, you won’t be able to access this folder anymore.")):(p=ue("Remove your access to this file?"),i=ue("If you continue, you won’t be able to access this file anymore.")),o=ue("Remove my access")):(p=ue("Remove access for %(name)s?").format(a),this.state.contentInfo.isFolder()?(i=this.state.contentInfo.isNestedSharedFolder()?ue("<strong>%(name)s</strong> may still have access to this folder through a company group or parent folder.").format(a):ue("If you remove <strong>%(name)s</strong>, they won’t be able to see future changes to these files.").format(a),u=ue("%(name)s should be able to keep a copy of these files").format(a)):i=ue("If you continue, <strong>%(name)s</strong> will lose access to this file.").format(a),o=ue("Remove"))):(p=ue("Make %(name)s the owner of this folder?").format(a),i=ue("Only <strong>%(name)s</strong> will be able to unshare this folder or change folder settings.").format(a),o=ue("Make owner")),d=this._getReopenModalProps(),c={autoclose:!1,title_text:p,body_html:t.sanitize(i),option_text:u,confirm_text:o,cancel_text:ue("Cancel"),confirm_callback:function(t){return function(i){return t._changeAccess(e,n,d,i)}}(this),cancel_completed_callback:function(){return Y.showInstance(pe(d.renderedClass,d))}},u?w.show(c):re.show(c)):this._changeAccess(e,n)},_changeAccess:function(e,t,n,i){var o,r;return null==i&&(i=!1),o=e.memberId(),t===K.REMOVE?o===this.props.user.account_id?r=this.client.relinquishMembership({contentId:this.state.contentInfo.id}).then(function(e){return function(){return e.state.contentInfo.isFolder()?N.success(ue("You have left the folder")):N.success(ue("You have left the file")),Y.close()}}(this)):(r=this.props.actionHandler.removeMember(this.state.contentInfo.id,e,i),Y.showInstance(pe(n.renderedClass,n))):r=t===R.OWNER?this.client.transferContent({contentId:this.state.contentInfo.id,memberId:o}).then(function(){return N.success(ue("Made %(name)s the owner").format({name:e.displayName()})),n.initialState=null,n.actionHandler.initializeShareModal(n.contentInfo),Y.showInstance(pe(n.renderedClass,n))}):this.props.actionHandler.changeMemberAccess(this.state.contentInfo.id,e,t),r.then(this._refreshSharedWithColumnContentData)},_handleRecipientAccessChange:function(e){if(this.isMounted()){if("writer"===e&&!this.state.canInviteEditor)return;if("reader"===e&&!this.state.canInviteViewer)return;return this.setState({recipientAccess:e})}},_handleRecipientChange:function(e,t){var n,i,o,r;return this.isMounted()?(o={recipientTokens:e,recipientRawInput:t},e.length>0||t.length>0?this.state.uiMode===$.MEMBERSHIP&&(o.uiMode=$.SHARE):this.state.uiMode===$.SHARE&&(o.uiMode=$.MEMBERSHIP),r=this._validateContacts(e),n=r.errorLevel,i=r.errorMessage,o.errorLevel=n,o.errorMessage=i,this.setState(o)):void 0},_validateContacts:function(e){var t,n,i,o,r,s,a,l,u,c;for(r=this._getFolderPolicy(),i=null,o=null,n=me(this.state.isTeamSharedFolder),s=0,a=e.length;a>s;s++){if(t=e[s],u=n(r,this.props.user,this.state.ownerTeam,t),c=u.state,l=u.msg,c===M.invalid){if(i=x.ERROR,l===L.SINGLE_INVALID){o=L.GENERAL_INVALID;break}l===L.SINGLE_OUT_OF_TEAM&&(o=L.GENERAL_OUT_OF_TEAM),l===L.NONGROUP_INVITEE&&(o=L.NONGROUP_INVITEE)}c===M.warn&&l===L.SINGLE_OUT_OF_TEAM&&(i||(i=x.WARN,o=L.GENERAL_OUT_OF_TEAM))}return{errorLevel:i,errorMessage:o}},_refreshSharedWithColumnLinkData:function(){return a.dispatch({type:oe.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE,data:{fileFqPaths:[this.props.contentInfo.displayPath()]}})},_refreshSharedWithColumnContentData:function(){return this.state.contentInfo.isFolder()?this._refreshSharedWithColumnFolderMemberData():this._refreshSharedWithColumnFileMemberData(this.state.contentInfo.id)},_refreshSharedWithColumnFolderMemberData:function(){return a.dispatch({type:oe.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE,data:{}})},_refreshSharedWithColumnFileMemberData:function(e){return null==e&&(e=null),a.dispatch({type:oe.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE,data:{fileIds:[null!=e?e:this.state.contentInfo.id]}})},_handleMessageChange:function(e){return this.isMounted()?this.setState({customMessage:e}):void 0},_handleSend:function(){var e,t,n,i,o,r;return ye(this.state.contentInfo,this.props.user.id,"CLICK_TIB_SEND_BUTTON"),e=Date.now(),i=this._getRecipientTokens(),i.length>0?(r=this._validateContacts(i),t=r.errorLevel,n=r.errorMessage,t===x.ERROR?void this.setState({errorLevel:t,errorMessage:n}):(o=_e(i),we(this,{uiMode:$.SHARE_SENDING}).then(function(t){return function(){return(t.state.contentInfo.isFileFolder()&&!t.state.contentInfo.isSharedFolder()?t.client.share({fqPath:t.state.contentInfo.displayPath(),folderPolicy:t._getFolderPolicy(!0)}).then(function(e){return t.isMounted()?we(t,{contentInfo:t.state.contentInfo.setNsId(e.shared_folder_id)}):void 0}):!t.state.contentInfo.isFolder()&&ae.editableFilesUI(t.props.user.id)?t.client.share({fqPath:t.state.contentInfo.displayPath()}):Q.resolve()).then(function(){return t.client.addMembers({
accessLevel:t.state.recipientAccess,contentId:t.state.contentInfo.id,customMessage:t.state.customMessage,members:o})}).then(function(){var n;return N.success(ue("Shared %(name)s").format({name:t.state.contentInfo.name()})),ye(t.state.contentInfo,t.props.user.id,"SHARE_MODAL_SEND_SUCCESS",{timing:Date.now()-e,num_recipients:i.length}),null!=(n=t.refs.modal)&&n.close(),"OFFICE_INTEGRATION"!==t.state.contentInfo.extras.origin&&Ee("tiburon_send",ue("You just shared a file or a folder with Dropbox")),t._refreshSharedWithColumnContentData()}).catch(function(n){return N.error(he(n)),ye(t.state.contentInfo,t.props.user.id,"SHARE_MODAL_SEND_FAIL",{timing:Date.now()-e,num_recipients:i.length}),t.isMounted()?we(t,{uiMode:$.SHARE}):void 0})}}(this)))):void 0},_handleGetMetadataSuccess:function(e){var t,n,i;return n={isMetadataLoaded:!0},null!=e&&(t=this.state.contentInfo.set("metadata",e),n.contentInfo=t,!this.state.contentInfo.canShareLink(!0)&&n.contentInfo.canShareLink()&&this.client.sharedLinkInfo({fileIdOrPath:t.idForLink()}).then(this._handleSharedLinkInfoSuccess),null!=e.permissions&&(null!=e.permissions.change_options&&(n.canChangeOptions=e.permissions.change_options.allow),null!=e.permissions.invite_editor&&(n.canInviteEditor=e.permissions.invite_editor.allow),null!=e.permissions.invite_viewer&&(n.canInviteViewer=e.permissions.invite_viewer.allow),null!=e.permissions.unshare&&(n.canUnshareFolder=e.permissions.unshare.allow),(null!=(i=e.permissions.relinquish_membership)?i.allow:void 0)&&this.props.actionHandler.canRelinquishMembership(),null!=e.permissions.upgrade_to_team_folder&&(n.canConvertToGoldenGateFolder=e.permissions.upgrade_to_team_folder.allow)),n.folderPolicy=e.policy,n.ownerTeam=e.owner_team,n.hasParentSharedFolder=null!=e.parent_shared_folder_id,n.isTeamSharedFolder=e.is_team_folder,G.canDeepNest(this.props.user.id)||ae.goldenGateUI(this.props.user.id)||(n.isTeamSharedFolder||n.hasParentSharedFolder)&&t.isFolder()&&this.props.showLegacyShareModal(this.props.user,t)),this.isMounted()?(ye(this.state.contentInfo,this.props.user.id,"VIEW_SHARE_MODAL",{timing:(new Date).getTime()-this.beginTime}),we(this,n)):Q.resolve()},_handleGetMemberCountsSuccess:function(e){return this.isMounted()?we(this,{memberCounts:e}):void 0},updateMembers:function(){return this.props.actionHandler.updateMembers(this.state.contentInfo.id).then(function(e){return function(){var t;return ye(e.state.contentInfo,e.props.user.id,"MEMBER_LIST_LOADED",{timing:(new Date).getTime()-e.beginTime,member_count:null!=(t=e.props.members)?t.getMemberCount():void 0})}}(this))},getMemberCounts:function(){var e,t;return e=this.state.contentInfo.isFileFolder()&&!this.state.contentInfo.isInSharedFolder(),this.state.contentInfo.isFolder()&&!e?(t=this.state.contentInfo.isSharedFolder()?this.state.contentInfo.sharedFolderId():this.state.contentInfo.nsId(),this.client.getMemberCounts({contentId:t}).then(this._handleGetMemberCountsSuccess)):Q.resolve()},_getFolderPolicy:function(e){return null==e&&(e=!1),null!=this.state.folderPolicy?e?new H({acl_update_policy:this.state.folderPolicy.acl_update_policy,member_policy:this.state.folderPolicy.resolved_member_policy,shared_link_policy:this.state.folderPolicy.shared_link_policy}):this.state.folderPolicy:null},_handleCreateLinkClick:function(){return ye(this.state.contentInfo,this.props.user.id,"CLICK_TIB_CREATE_LINK"),this.client.createSharedLink({fileIdOrPath:this.state.contentInfo.displayPath()}).then(function(e){return function(t){return e._refreshSharedWithColumnLinkData(),e.isMounted()?e.setState({linkMetadata:t}):void 0}}(this))},_handleSharedLinkInfoSuccess:function(e){return this.isMounted()?we(this,{linkMetadata:e,isLinkDataLoaded:!0}):void 0},_handleLinkSettingsClick:function(){var e,t,n,i,o;return o=function(e){return function(){var t;return t=e._getReopenModalProps(),Y.showInstance(pe(t.renderedClass,t))}}(this),t=function(e){return function(){return e.setState({linkMetadata:null})}}(this),n=function(e){return function(t){return e.setState({linkMetadata:t})}}(this),ve(this.props.user)?null!=this.state.linkMetadata?Y.showInstance(pe(ie,{client:this.client,linkMetadata:this.state.linkMetadata,onClose:o,onDeleteLink:t,onPolicySet:n,ownerTeamName:null!=(i=this.state.ownerTeam)?i.name:void 0})):void 0:"function"==typeof(e=this.props).onLinkSettingsClick?e.onLinkSettingsClick(this.state.linkMetadata,function(e){return function(){var t;return t=e._getReopenModalProps(),t.initialState.isLinkDataLoaded=!1,Y.showInstance(pe(t.renderedClass,t))}}(this)):void 0},_getReopenModalProps:function(){var e,t,n,o,r,s,a,l;return t=[i.extend({},this.props),i.extend({},this.state)],e=t[0],r=t[1],s=null!=(n=this.refs.content)?n.getWrappedComponent().refs.tokenizer:void 0,s&&(o=s.serializeInputData(),a=o.tokens,l=o.value),i.extend(e,{initialState:r,initialRecipientTokens:a,initialRecipientRawInput:l})},_handleFolderSettingsClick:function(){var e,t;return t=this._getReopenModalProps(),e=function(e,n){return null!=n&&(t.initialState.contentInfo=t.initialState.contentInfo.set("metadata",n)),Y.showInstance(pe(t.renderedClass,t))},Y.showInstance(pe(ne,{folderMetadata:this.state.metadata,folderName:this.state.contentInfo.name(),folderId:this.state.contentInfo.isSharedFolder()?this.state.contentInfo.sharedFolderId().toString():void 0,folderPath:this.state.contentInfo.displayPath(),hasParentSharedFolder:this.state.hasParentSharedFolder,initialHasParentSharedFolder:this.state.hasParentSharedFolder,initialOwnerTeam:this.state.ownerTeam,initialPermissions:this.state.isMetadataLoaded?{canChangeOptions:this.state.canChangeOptions,canUnshareFolder:this.state.canUnshareFolder}:null,initialPolicy:this.state.isMetadataLoaded?this._getFolderPolicy():null,isSharedFolder:this.state.contentInfo.isSharedFolder(),initialIsTeamSharedFolder:this.state.isTeamSharedFolder,onCancel:e,onPolicySet:e,teamPolicy:this.props.teamPolicy,user:this.props.user}))},_handleConvertToGoldenGateClick:function(){var e,t;return t=this.props,e=function(){return Y.showInstance(pe(t.renderedClass,t))},Y.showInstance(pe(U,{folderId:this.props.contentInfo.id.toString(),user:this.props.user,onCancel:e}))}}),J=ge(ce,{SharingInfoStore:T},fe),{ShareModal:J}})}.call(this),function(){define("modules/clean/sharing/shared_content_link_sync_modal",["external/react","modules/clean/em_string","modules/clean/react/button","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/sharing/views/hover_close_button","modules/clean/static_urls","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,n,i,o,r,s,a,l,u){var c,d,p,_,h,m,f;return _=n.button,c=i.Modal,f=s.static_url,p=l.i18n_default_project("sharing")._,m=e.DOM,h=e.createElement,d=e.createClass({statics:{showInstance:function(e){return c.showInstance(e)}},displayName:"SharedContentLinkSyncModal",ASK:"ask",ASKING:"asking",propTypes:{accessLevel:e.PropTypes.string.isRequired,folderName:e.PropTypes.string.isRequired,folderSize:e.PropTypes.string.isRequired,syncSharedFolderCallback:e.PropTypes.func.isRequired,outOfQuotaQP:e.PropTypes.string,senderName:e.PropTypes.string,usageRemaining:e.PropTypes.string,usageShortage:e.PropTypes.string},getInitialState:function(){return{state:this.ASK}},render:function(){return h(c,{autoClose:!1,buttonComponent:this.renderButtons(),className:"content-link-sync-modal",clickOutToClose:!1,ref:"modal",showX:!1,title:""},m.div({className:"content-link-sync-modal__content u-mar-bottom-xs"},m.div({className:"content-link-sync-modal__top-panel u-pad-s"},m.div({className:"content-link-sync-modal__icon"},h(o,{alt:"",group:"web",name:"folder_user_32"})),m.div({className:"content-link-sync-modal__name-size u-pad-left-xs o-flag__flex"},m.h3({className:"u-font-strong"},t.em_snippet(this.props.folderName,15)),m.h4({className:"u-trim-margin u-font-meta"},this.props.folderSize)),m.div({className:"content-link-sync-modal__close u-pad-xs o-flag__fix"},h(r,{onClick:function(e){return function(){return e.refs.modal.close()}}(this)}))),m.div({className:"content-link-sync-modal__tip-panel"},m.div({className:"content-link-sync-modal__access-text"},this.props.outOfQuotaQP?p("Not enough space"):null!=this.props.senderName?"can_view"===this.props.accessLevel?p("%(name)s gave you access to view this folder").format({name:this.props.senderName}):p("%(name)s gave you access to edit this folder").format({name:this.props.senderName}):p("can_view"===this.props.accessLevel?"You have access to view this folder":"You have access to edit this folder")),m.div({className:"content-link-sync-modal__tip-body"},this.props.outOfQuotaQP?this.props.usageRemaining?p("To add this folder, you’ll need %(shortage)s of space in your Dropbox. You currently have %(remaining)s of space left.").format({remaining:this.props.usageRemaining,shortage:this.props.usageShortage}):p("To add this folder, you’ll need %(shortage)s of space in your Dropbox. You currently have no space left.").format({shortage:this.props.usageShortage}):this.state.state===this.ASKING?m.img({src:f("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:p("Loading")}):p("can_view"===this.props.accessLevel?"For easy access to this folder in the future, add it to your Dropbox.":"To start working on this folder, you need to add it to your Dropbox first.")))))},renderButtons:function(){return m.div({className:"content-link-sync-modal__buttons u-mar-bottom-s"},h(_,{importance:"primary",className:"content-link-sync-modal__add-to-dropbox-button",disabled:this.state.state===this.ASKING,onClick:this.onSyncButtonClicked},p(this.props.outOfQuotaQP?"Upgrade to add folder":"Add to my Dropbox")),"can_view"===this.props.accessLevel?m.div({},m.span({className:"content-link-sync-modal__or"},p("Or")),m.button({className:"content-link-sync-modal__not-now-label button-as-link",onClick:this.onPreviewButtonClicked},p("Preview this folder"))):void 0)},onSyncButtonClicked:function(){return this.setState({state:this.ASKING}),this.props.outOfQuotaQP?a.redirect(u({path:"/pro/buy"}).updateQuery({oqa:this.props.outOfQuotaQP})):this.props.syncSharedFolderCallback()},onPreviewButtonClicked:function(){var e;return e=a.get_uri().removeQuery("sm"),e.updateQuery({from_sync_modal:!0}),a.redirect(e)}})})}.call(this),function(){define("modules/clean/sharing/shared_folder_settings_modal",["external/react","modules/clean/ajax","modules/clean/em_string","modules/clean/filepath","modules/clean/form","modules/clean/react/modal","modules/core/i18n","modules/core/notify"],function(e,t,n,i,o,r,s,a){var l,u,c,d;return l=r.Modal,c=s._,d=e.DOM,u=e.createClass({displayName:"SharedFolderSettingsModal",statics:{showInstance:function(e){return l.showInstance(e)}},propTypes:{user:e.PropTypes.object.isRequired,fq_path:e.PropTypes.string.isRequired,is_shared_folder:e.PropTypes.bool.isRequired,ns_id:e.PropTypes.number,initial_allows_editor_manage_membership:e.PropTypes.bool.isRequired,done_callback:e.PropTypes.func.isRequired},getInitialState:function(){return{allows_manage_membership:this.props.initial_allows_editor_manage_membership}},render:function(){var e;return e=n.em_snippet(i.filename(this.props.fq_path),16),l({title:c("‘%(filename)s’ settings").format({filename:e}),acceptButtonText:c("Done"),autoClose:!1,showX:!1,onAccept:this._onDone,ref:"modal"},d.div({},d.input({type:"checkbox",onChange:this._checkboxUpdated,checked:this.state.allows_manage_membership,id:"allows-manage-membership-setting"}),d.label({className:"simple-sharing-allows-manage-membership-label",htmlFor:"allows-manage-membership-setting"},c("Allow anyone who can edit to manage membership of this folder"))))},_onDone:function(){return this.refs.modal.close(),this.props.done_callback.bind(null,this.state.allows_manage_membership)()},_checkboxUpdated:function(e){var n;return this.props.is_shared_folder?(n=e.target.checked?1:0,t.WebRequest({subject_user:this.props.user.id,url:"/share_ajax/change_sf_perm",data:{ns_id:this.props.ns_id,new_permissions:n},success:function(e){return function(t){var i,r,s;if(r=o.parse_response(t),s=r[0],i=r[1],s){if(1===n?a.success(c("Editors can now manage membership of this folder.")):a.success(c("Editors can no longer manage membership of this folder")),!e.isMounted())return;return e.setState({allows_manage_membership:1===n})}return a.error(i)}}(this)})):this.setState({allows_manage_membership:e.target.checked})}})})}.call(this),function(){define("modules/clean/sharing/shared_link_for_sf",["external/react","modules/clean/react/button","modules/clean/react/sprite_div","modules/clean/sharing/shared_link_modal","modules/core/i18n"],function(e,t,n,i,o){var r,s,a;return s=o._,a=e.DOM,r=e.createClass({statics:{showInstance:function(t,n){return e.render(t,n)}},propTypes:{fq_path:e.PropTypes.string.isRequired,user:e.PropTypes.object.isRequired,is_dir:e.PropTypes.bool.isRequired,is_shared_folder:e.PropTypes.bool.isRequired,could_be_shared_folder:e.PropTypes.bool.isRequired,can_edit:e.PropTypes.bool.isRequired,generate_share_inband_restore_callback:e.PropTypes.func},render:function(){return a.div({className:"get-link-button-spinner"},a.button({className:"get-link-button dbmodal-button button-tertiary",onClick:function(e){return function(){var t;return t=e.props.generate_share_inband_restore_callback(),i.showInstance(i({needsFetchingTokenInfo:!0,user:e.props.user,fqPath:e.props.fq_path,isDir:e.props.is_dir,canReaderSync:!1,isSharedFolder:e.props.is_shared_folder,couldBeSharedFolder:e.props.could_be_shared_folder,canEdit:e.props.can_edit,editableLinksM2Enabled:!1,onGoBackButtonClicked:t}))}}(this)},n({group:"web",name:"s_link",text:s("Get link")})))}})})}.call(this),function(){define("modules/clean/sharing/shared_link_modal",["jquery","external/flash_detect","external/react","modules/clean/ajax","modules/clean/analytics","modules/clean/browse_events","modules/clean/clipboard","modules/clean/dbmodal","modules/clean/em_string","modules/clean/file_events","modules/clean/filepath","modules/clean/form","modules/clean/react/modal","modules/clean/sharing/namespace_conversion_alert_modal","modules/clean/sharing/constants","modules/clean/react/select","modules/clean/react/sprite_div","modules/clean/viewer","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,i,o,r,s,a,l,u,c,d,p,_,h,m,f,v,g,y,b){var w,E,T,C,S,k,I,A,P;return w=a.DBModalStack,E=p.Modal,S=p.SimpleModal,T=h.SHMODEL_LINK_TOKEN_VISIBILITY,k=g._,P=n.DOM,A=n.addons.classSet,I=t.installed,C=n.createClass({statics:{showInstance:function(e){return w.pop(),E.showInstance(e)}},propTypes:{needsFetchingTokenInfo:n.PropTypes.bool.isRequired,user:n.PropTypes.object.isRequired,fqPath:n.PropTypes.string.isRequired,isDir:n.PropTypes.bool.isRequired,canReaderSync:n.PropTypes.bool.isRequired,isSharedFolder:n.PropTypes.bool.isRequired,couldBeSharedFolder:n.PropTypes.bool.isRequired,canEdit:n.PropTypes.bool.isRequired,initialLink:n.PropTypes.string,initialTkey:n.PropTypes.string,initialEditable:n.PropTypes.bool,initialVisibility:n.PropTypes.number,initialExpiryPosix:n.PropTypes.string,initialExpiryDays:n.PropTypes.string,initialExpiryText:n.PropTypes.string,editableLinksM2Enabled:n.PropTypes.bool,showSharedLinkSettingsModal:n.PropTypes.func,onGoBackButtonClicked:n.PropTypes.func},getInitialState:function(){return{hasFetchedTokenInfo:!this.props.needsFetchingTokenInfo,link:this.props.initialLink,tkey:this.props.initialTkey,editable:this.props.initialEditable,visibility:this.props.initialVisibility,expiryPosix:this.props.initialExpiryPosix,expiryDays:this.props.initialExpiryDays,expiryText:this.props.initialExpiryText}},componentDidMount:function(){return this.props.needsFetchingTokenInfo?this._fetchTokenInfo():void this._setupCopyToClipboard()},_fetchTokenInfo:function(){return i.WebRequest({url:b({path:"/sm/token_for_sf"+c.normalize(this.props.fqPath)}),subject_user:this.props.user.id,data:{ask_for_editable:this.props.editableLinksM2Enabled},type:"POST",dataType:"json",success:function(t){return function(n){return e(document).trigger(r.UPDATE),t.isMounted()?"ok"===n.status?(t.setState({hasFetchedTokenInfo:!0,link:n.link,tkey:n.tkey,editable:n.editable,visibility:n.visibility,expiryPosix:n.expiry_posix,expiryDays:n.expiry_days,expiryText:n.expiry_text}),t._setupCopyToClipboard(),t.refs.input.getDOMNode().select()):"error"===n.status?(y.error(n.msg),t.refs.modal.close()):void 0:void 0}}(this),error:function(e){return function(){return e.isMounted()?e.refs.modal.close():void 0}}(this)})},render:function(){var e,t;return t=l.em_snippet(c.filename(this.props.fqPath),16),e=k(I?"Copy Link":"Done"),E({title:k("Share ‘%(filename)s’ with others").format({filename:t}),buttonComponent:this._renderButtons(e),ref:"modal"},this.state.hasFetchedTokenInfo?P.div({className:"simple-sharing-share-link-modal-content"},this.props.editableLinksM2Enabled?P.div({},this._renderTopLabelForM2()):P.div({className:"simple-sharing-access-label"},this._renderAccessLabel()),P.div({className:"simple-sharing-link-field o-flag o-flag--rev o-flag--top"},P.div({className:"text-input small o-flag__flex"},P.div({className:"text-input-wrapper"},P.input({readOnly:!0,type:"text",value:this.state.link,ref:"input",className:A({"text-input-input":!0,"editable-link-m2-input":this.props.editableLinksM2Enabled}),onClick:this._selectAllText}),this.props.editableLinksM2Enabled?P.a({href:"#",onClick:this._onRemoveLinkButtonClicked,className:"close-button"},f({group:"web",name:"xclose"})):void 0)),!this.props.editableLinksM2Enabled&&this.props.isDir?this._renderEditDropdown():void 0),this.props.editableLinksM2Enabled?this._renderBottomLabelForM2():void 0):this._renderLoadingSpinner())},_renderButtons:function(e){return P.div({className:"db-modal-buttons simple-sharing-link-modal-buttons"},this.props.onGoBackButtonClicked&&this.props.editableLinksM2Enabled?P.button({className:"button-tertiary go-back-button",onClick:function(e){return function(t){return e.refs.modal.close(),e.props.onGoBackButtonClicked(e.props.fqPath)}}(this)},k("Go back")):void 0,P.button({className:"dbmodal-button button-primary",onClick:function(e){return function(){return I?void 0:e.refs.modal.close()}}(this)},e))},_renderTopLabelForM2:function(){return P.h2({className:"simple-sharing-top-label"},k("Link to folder"))},_renderAccessLabel:function(){return P.label({className:"access-label"},this.state.editable?this._renderWhoCanAccessEditLabel(this.state.visibility):this._renderWhoCanAccessViewLabel(this.state.visibility))},_renderBottomLabelForM2:function(){return P.div({className:"simple-sharing-bottom-label"},this._renderAccessLabel(),this._renderExpiryInfo(),P.span({className:"change-settings",onClick:this._onClickChangeSettings},k("Change password / add expiration")),P.span({className:"access-label"},k(".")))},_renderExpiryInfo:function(){return this.state.expiryPosix?P.label({className:"expiry-info"},k("The link will expire in %(expiry_days)s days (%(expiry_text)s).").format({expiry_days:this.state.expiryDays,expiry_text:this.state.expiryText})):void 0},_setupCopyToClipboard:function(){var t,n;return t=e(".simple-sharing-link-field").parent().parent(),I?(n=function(e){return function(){var t;return y.success(k("Link copied.")),t=e.props.editableLinksM2Enabled?"m2":"m1",o.SimpleSharingLogger.log(e.props.user.id,17,e.state.editable,t),e.refs.modal.close()}}(this),s.clipboard_overlay(t.find(".simple-sharing-link-field .text-input-wrapper input").val(),t.find(".button-primary"),n,t.find(".simple-sharing-link-field"))):void 0},_renderLoadingSpinner:function(){return P.div({className:"member-container spinner-div"},P.img({className:"member-loading-spinner",src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"}))},_renderEditDropdown:function(){return m.input({className:"oob-invite-access o-flag__fix","disable-errors":!0,value:this.state.editable?"edit":"view",onChange:function(e){return function(t,n){return e._permissionChanged(n)}}(this)},m.option({value:"view"},k("can view")),m.option({value:"edit",disabled:!this.props.canEdit},k("can edit")))},_renderWhoCanAccessViewLabel:function(e){return e===T.PUBLIC?k(this.props.isDir?"Anyone with the link can view the folder.":"Anyone with the link can view the file."):e===T.TEAM_ONLY?this.props.isDir?(k("%(team_name)s members with the link can view the folder.").format,{team_name:v.get_viewer().team_name}):(k("%(team_name)s members with the link can view the file.").format,{team_name:v.get_viewer().team_name}):e===T.PASSWORD?k(this.props.isDir?"Anyone with the password and the link can view the folder.":"Anyone with the password and the link can view the file."):void 0},_renderWhoCanAccessEditLabel:function(e){return e===T.PUBLIC?k("Anyone with the link can join the folder and edit files."):e===T.TEAM_ONLY?k("%(team_name)s members with the link can join the folder and edit files.").format({team_name:v.get_viewer().team_name}):e===T.PASSWORD?k("Anyone with the password and the link can join the folder and edit files."):void 0},_onRemoveLinkButtonClicked:function(e){var t,n,r;return o.SimpleSharingLogger.log(this.props.user.id,33),r=l.em_snippet(c.filename(this.props.fqPath),16),t=function(e){return function(){var t;return t=b({path:"/sm/disable/"+e.state.tkey}),i.WebRequest({url:t,subject_user:e.props.user.id,success:function(){var t;return y.success(k("Removed link for ‘%(filename)s‘").format({filename:r})),o.SimpleSharingLogger.log(e.props.user.id,25),"function"==typeof(t=e.props).onGoBackButtonClicked?t.onGoBackButtonClicked(e.props.fqPath):void 0},error:function(){return y.Error(k("Failed removing link"))}})}}(this),n=function(e){return function(){return e._restoreSharedLinkModal(e.props.isSharedFolder,e.state.editable)}}(this),S.show({title_text:k("Remove link to ‘%(filename)s‘").format({filename:r}),body_html:k("Are you sure you want to remove this link? People with this link will no longer be able to join the shared folder."),cancel_text:k("Cancel"),confirm_text:k("Remove link"),confirm_callback:t,cancel_completed_callback:n})},_selectAllText:function(t){var n;return e(t.currentTarget)[0].select(),n=this.props.editableLinksM2Enabled?"m2":"m1",o.SimpleSharingLogger.log(this.props.user.id,18,this.state.editable,n)},_changeSfAccess:function(e,t,n){return i.WebRequest({url:"/sm/change_sf_access",data:{link_url:this.state.link,editable:e,can_sync:this.props.canReaderSync},subject_user:this.props.user.id,type:"POST",success:t,error:n})},_updateSfAccess:function(e){return this._changeSfAccess(e,function(t){return function(){var n;return n=k(e?"Anyone with the link can edit":"Anyone with the link can view"),y.success(n),t.setState({editable:e})}}(this))},_onClickChangeSettings:function(e){return this.refs.modal.close(),this.props.showSharedLinkSettingsModal(this.props.user.id,this.state.tkey,this._restoreSharedLinkModal.bind(this,this.props.isSharedFolder,this.state.editable,!0))},_restoreSharedLinkModal:function(e,t,n){var i,o,r,s;return r=!!e,i=!r,o=!(!e||!t),s=C({needsFetchingTokenInfo:!!n,user:this.props.user,fqPath:this.props.fqPath,isDir:this.props.isDir,canReaderSync:!1,isSharedFolder:r,couldBeSharedFolder:i,canEdit:e||this.props.canEdit,initialLink:this.state.link,initialTkey:this.state.tkey,initialEditable:o,initialVisibility:this.state.visibility,initialExpiryPosix:this.state.expiryPosix,initialExpiryDays:this.state.expiryDays,initialExpiryText:this.state.expiryText,editableLinksM2Enabled:this.props.editableLinksM2Enabled,showSharedLinkSettingsModal:this.props.showSharedLinkSettingsModal,onGoBackButtonClicked:this.props.onGoBackButtonClicked}),E.close(),C.showInstance(s)},_permissionChanged:function(e){var t,n,i;if(t="edit"===e,this.state.editable||t!==!0){if(this.state.editable&&t===!1)return this._updateSfAccess(t)}else{if(this.props.couldBeSharedFolder)return i=function(e){return function(n){var i,o,r,s,a,l,c;return s=d.parse_response(String(n)),l=s[0],r=s[1],l?(c=function(){var t;return document.fire(u.SF_NEW),e._restoreSharedLinkModal(!0,!0),t=JSON.parse(r),y.success(t.success_msg)},o=function(){return e._restoreSharedLinkModal(!0,!1)},e._changeSfAccess(t,c,o)):(e._restoreSharedLinkModal(!1,!1),a=d.parse_error(r),l=a[0],i=a[1],l?y.error(i):y.error())}}(this),n={path:this.props.fqPath,emails:[],fb_ids:[],new_style_group_ids:[],custom_message:"",access_type:2,is_simple_sharing:!0,folder_settings:1,shared_link_policy:void 0,audience:void 0,inviter:void 0},_.showInstance(_({user:this.props.user,req_url:"/share_ajax/existing_no_recipient",req_data:n,success_callback:i}));if(this.props.isSharedFolder)return this._updateSfAccess(t);if(!this.props.isDir)return this._updateSfAccess(t)}}})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/sharing/signup_modal_proxy",["external/rsvp"],function(t){var n,i;return n=t.Promise,new(i=function(){function t(){this.signupForDirectDownload=e(this.signupForDirectDownload,this),this._directDownloadSignupPromiseResolver=e(this._directDownloadSignupPromiseResolver,this),this.disconnectModal=e(this.disconnectModal,this),this.connectModal=e(this.connectModal,this),this._signupModal=null,this._directDownloadPromise=null}return t.prototype.connectModal=function(e){return this._signupModal=e},t.prototype.disconnectModal=function(){return this._signupModal=null},t.prototype._directDownloadSignupPromiseResolver=function(e,t){var n,i;return i=function(t){return function(){return t._directDownloadPromise=null,e()}}(this),n=function(e){return function(){return e._directDownloadPromise=null,t()}}(this),this._signupModal.handle_direct_download(i),this._signupModal.handle_direct_download_cancel(n)},t.prototype.signupForDirectDownload=function(){var e;return null==this._signupModal?new n(function(e){return e()}):(null==this._directDownloadPromise&&(this._directDownloadPromise=new n(this._directDownloadSignupPromiseResolver)),e=this._directDownloadPromise,this._signupModal.on_request_direct_download(),e)},t}())})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/sharing/stores/members",["external/immutable","modules/clean/flux/base_store"],function(t,n){var i;return new(i=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype._new_payload=function(e){var t;switch(null!=e&&null!=(t=e.action)?t.type:void 0){case"store":return this.emit_change()}},i.prototype._init=function(){return this.state=new t.Map({sharedFileMembership:new t.Map,sharedFolderMembership:new t.Map,accountInfo:new t.Map})},i}(n))})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/sharing/stores/share_modal",["external/immutable","modules/clean/flux/base_store","modules/clean/sharing/action_types"],function(t,n,i){var o,r;return o=i.ShareModalActionTypes,new(r=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype._init=function(){return this.state=new t.Map({customMessage:"",errorLevel:null,errorMessage:null,hasRecipientInput:!1,isFetchingLinkMetadata:!0,isFetchingMembers:!0,isFetchingMetadata:!0,isSendingShare:!1,sharingContentType:!1,user:null})},i.prototype._new_payload=function(e){var t;switch(null!=e&&null!=(t=e.action)?t.type:void 0){case o.SHARE_MODAL_OPEN:return this.state=this.state.withMutations(function(t){return t.set("user",e.action.user).set("shareType",e.action.shareType).set("contentInfo",e.action.contentInfo)}),this.emit_change();case o.FETCH_FILE_METADATA_REQUEST:return this.state=this.state.set("isFetchingMetadata",!0),this.emit_change();case o.FETCH_FOLDER_METADATA_REQUEST:return this.state=this.state.set("isFetchingMetadata",!0),this.emit_change();case o.FETCH_LINK_METADATA_REQUEST:return this.state=this.state.set("isFetchingLinkMetadata",!0),this.emit_change();case o.FETCH_FILE_METADATA_SUCCESS:return this.state=this.state.set("isFetchingMetadata",!1),this.emit_change();case o.FETCH_FOLDER_METADATA_SUCCESS:return this.state=this.state.set("isFetchingMetadata",!1),this.emit_change();case o.FETCH_LINK_METADATA_SUCCESS:return this.state=this.state.set("isFetchingLinkMetadata",!1),this.emit_change()}},i}(n))})}.call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/sharing/stores/shared_content",["external/immutable","modules/clean/flux/base_store","modules/clean/sharing/action_types"],function(t,n,i){var o,r;return o=i.ShareModalActionTypes,new(r=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,n),i.prototype._init=function(){return this.state=new t.Map({sharedFileMetadatas:new t.Map,sharedFolderMetadatas:new t.Map,sharedLinks:new t.Map})},i.prototype._new_payload=function(e){var t;switch(null!=e&&null!=(t=e.action)?t.type:void 0){case o.FETCH_FILE_METADATA_SUCCESS:return this.setFileMetadata(e.action.contentId,e.action.metadata),this.emit_change();case o.FETCH_FOLDER_METADATA_SUCCESS:return this.setFolderMetadata(e.action.contentId,e.action.metadata),this.emit_change();case o.FETCH_LINK_METADATA_SUCCESS:return this.setLinkMetadata(e.action.contentId,e.action.metadata),this.emit_change()}},i.prototype.hasMetadata=function(e){return e.isFolder()?this.state.hasIn(["sharedFolderMetadatas",e.id]):this.state.hasIn(["sharedFileMetadatas",e.id])},i.prototype.hasFileMetadata=function(e){return this.state.hasIn(["sharedFileMetadatas",e])},i.prototype.hasFolderMetadata=function(e){return this.state.hasIn(["sharedFolderMetadatas",e])},i.prototype.hasLinkMetadata=function(e){return this.state.hasIn(["sharedLinks",e.idForLink()])},i.prototype.getMetadata=function(e){return e.isFolder()?this.state.getIn(["sharedFolderMetadatas",e.id]):this.state.getIn(["sharedFileMetadatas",e.id])},i.prototype.getFileMetadata=function(e){return this.state.getIn(["sharedFileMetadatas",e])},i.prototype.getFolderMetadata=function(e){return this.state.getIn(["sharedFolderMetadatas",e])},i.prototype.getLinkMetadata=function(e){return this.state.getIn(["sharedLinks",e.idForLink()])},i.prototype.setMetadata=function(e,t){return e.isFolder()?this.state.setIn(["sharedFolderMetadatas",e.id],t):this.state.setIn(["sharedFileMetadatas",e.id],t)},i.prototype.setFileMetadata=function(e,t){return this.state=this.state.setIn(["sharedFileMetadatas",e],t)},i.prototype.setFolderMetadata=function(e,t){return this.state=this.state.setIn(["sharedFolderMetadatas",e],t)},i.prototype.setLinkMetadata=function(e,t){return this.state=this.state.setIn(["sharedLinks",e.idForLink()],t)},i.prototype.clearMetadata=function(e){return e.isFolder()?this.state.removeIn(["sharedFolderMetadatas",e.id]):this.state.removeIn(["sharedFileMetadatas",e.id])},i.prototype.clearFileMetadata=function(e){return this.state=this.state.removeIn(["sharedFileMetadatas",e])},i.prototype.clearFolderMetadata=function(e){return this.state=this.state.removeIn(["sharedFolderMetadatas",e])},i.prototype.clearLinkMetadata=function(e){return this.state=this.state.removeIn(["sharedLinks",e.idForLink()])},i}(n))})}.call(this),function(){define("modules/clean/sharing/strings",["modules/clean/sharing/constants","modules/core/i18n"],function(e,t){var n,i,o,r;return n=e.ACCESS_LEVEL,o=t.i18n_default_project("sharing")._,r={},r[""+n.OWNER]=o("Owner"),r[""+n.WRITER]=o("Can edit"),r[""+n.READER]=o("Can view"),i=r,{ACCESS_NAME:i}})}.call(this),function(){define("modules/clean/sharing/ui_util",["external/underscore","modules/clean/ajax","modules/clean/analytics","modules/clean/api_v2/error","modules/clean/contacts/tokenizer","modules/clean/react/browse/constants","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/zendesk_feedback","modules/core/i18n","modules/core/notify","modules/core/user_i18n"],function(e,t,n,i,o,r,s,a,l,u,c,d){
var p,_,h,m,f,v,g,y,b,w,E,T,C,S,k,I,A,P,N,R,O,D,x,L,M,F,U,B,q;return E=n.ShareTibEventLogger,_=i.AppError,f=o.ContactTokenState,v=r.FileTypes,b=s.GroupMembershipInfo,p=a.ACCESS_LEVEL,g=a.GOLDEN_GATE,T=a.TIBURON,B=l.showZendeskFlyout,S=u.i18n_default_project("sharing")._,y={canDeepNest:function(e){return g.CAN_DEEP_NEST[e]},canConvertToGGFolder:function(e){return g.CAN_CONVERT_TO_GG_FOLDER[e]},canUseRecursiveCopy:function(e){return g.CAN_USE_RECURSIVE_COPY[e]},hasGoldenGateIconography:function(e){return g.HAS_GOLDEN_GATE_ICONOGRAPHY[e]}},C={filesFacesUI:function(e){return T.FILE_FACES_UI[e]},filesUI:function(e){return T.FILE_UI[e]},foldersUI:function(e){return T.FOLDER_UI[e]},goldenGateUI:function(e){return T.GOLDEN_GATE_UI[e]},editableFilesUI:function(e){return T.EDITABLE_FILES_UI[e]}},w={SHARED_FILE:"shared-file",SHARED_FOLDER:"shared-folder",SHARED_LINK:"shared-link",TEAM_FOLDER:"team-folder",PUBLIC:"public",NO_SHARE:"no-share"},m={SINGLE_INVALID:S("The email address you entered is invalid"),SINGLE_OUT_OF_TEAM:S("This person isn’t on your Dropbox team"),GENERAL_INVALID:S("One or more names or email addresses you entered are invalid."),GENERAL_OUT_OF_TEAM:S("One or more invitees are outside your Dropbox team."),NONGROUP_INVITEE:S("Only groups can be invited to team folders.")},h={ERROR:"error",WARN:"warn"},x=function(e,t){var n,i,o,r,s;return n=null!=(r=t.allowLegacyPublicLinks)?r:!1,i=null!=(s=t.hasLegacyPublicAppToken)?s:!1,o=e.fq_path.toLowerCase(),i||n&&o.startsWith("/public/")?w.PUBLIC:e.is_deleted?w.NO_SHARE:e.is_team_shared_folder()?w.TEAM_FOLDER:e.is_shared_folder()||e.could_be_shared_folder()?w.SHARED_FOLDER:e.dir&&e.type!==v.PACKAGE?e.could_be_shared_link()?w.SHARED_LINK:w.NO_SHARE:w.SHARED_FILE},k=function(e,t){var n,i,o,r,s;return r=t.memberId()===e?"0":"1",o=t.access_type===p.OWNER?"0":"1",i=t.is_inherited?"0":"1",n=t instanceof b?"0":"1",s=t.displayName().toLowerCase(),""+r+o+i+n+"-"+s},U=function(e){return function(t,n){var i,o;return i=k(e,t),o=k(e,n),o>i?-1:i===o?0:1}},M=function(e){return e?I:A},A=function(e,t,n,i){var o;if(o={state:f.ok},i.invalid)o={state:f.invalid,msg:m.SINGLE_INVALID};else{if(i.email===t.email)return o;null!=n&&t.is_team&&i.dbx_team_id!==n.id&&!i.group_id&&(o={msg:m.SINGLE_OUT_OF_TEAM},"team"===(null!=e?e.member_policy:void 0)||"team"===(null!=e?e.resolved_member_policy:void 0)?o.state=f.invalid:o.state=f.warn)}return o},I=function(e,t,n,i){return i.group_id?A(e,t,n,i):{state:f.invalid,msg:m.NONGROUP_INVITEE}},P=function(e){switch(e){case"reader":return"viewer";case"writer":return"editor";case"owner":return"owner";default:return"default"}},D=function(e){var t,n,i;return t=e.displayName(),{access_type:P(e.access_type),display_name:t,initials:null!=(n=e.initials)?n:d.getInitials(t),photo_url:null!=(i=e.account)?i.profile_photo_url:void 0,user_id:e.memberId()}},R=function(e){return{access_type:P(e.access_type),gid:e.memberId(),is_automatic:"team"===e.group_type,name:e.displayName(),num_users:e.member_count}},O=function(e){return{access_type:P(e.access_type),invitation_id:e.memberId(),email_or_fbname:e.displayName()}},F=function(t,n,i,o){return null==o&&(o={}),E.log(n,i,t.extras.origin,e.extend(o,{fq_path:t.displayPath(),ns_id:t.isSharedFolder()?t.sharedFolderId():void 0,modal_session_id:t.extras.modalSessionId}))},N={access_error:S("You don’t have access to this content."),email_unverified:S("You haven’t verified your email. Check your email and try again."),bad_member:S("You entered an invalid name or email address."),cant_share_outside_team:S("Your team settings don’t allow sharing outside your team."),too_many_members:S("You’re sharing with too many people."),too_many_pending_invites:S("You’re sharing with too many people."),rate_limit:S("You’ve hit the limit of invites for today. Try again later."),insufficient_plan:S("You need a Dropbox Pro or Business account to do this."),team_folder:S("You can’t add members to a team folder. Contact your team admin."),no_permission:S("You don’t have permission to do this. Contact the owner.")},L=function(e){return e.message?e.message:e instanceof _&&e.error[".tag"]&&N[e.error[".tag"]]?N[e.error[".tag"]]:c.DEFAULT_ERROR},q=function(e,n){var i;return i=function(){return t.BackgroundRequest({url:"/sharing/show_feedback_flyout",data:{dont_show_again:!0}})},t.WebRequest({url:"/sharing/show_feedback_flyout",success:function(t){return JSON.parse(t)?B({title:n,zendeskTag:e,onCloseClick:i}):void 0}})},{apiInviteeMemberToAvatarInfo:O,apiGroupMemberToAvatarInfo:R,apiUserMemberToAvatarInfo:D,CONTACT_ERROR_LEVEL:h,CONTACT_ERROR_MESSAGES:m,makeMemberSortCmp:U,chooseShareUIType:x,GoldenGate:y,Tiburon:C,SHARE_UI_TYPE:w,genAddMemberErrorMessage:L,getContactValidator:M,logTiburonEvent:F,showZendeskFlyoutIfAllowed:q}})}.call(this),function(){define("modules/clean/sharing/views/hover_close_button",["external/classnames","external/react","external/underscore","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,i,o){var r,s,a,l;return s=o.i18n_default_project("sharing")._,a=t.createElement,l=t.DOM,r=t.createClass({displayName:"HoverCloseButton",propTypes:{className:t.PropTypes.string},getInitialState:function(){return{hover:!1}},render:function(){var t;return t={className:e("c-borderless-button",this.props.className),onMouseOver:function(e){return function(){return e.setState({hover:!0})}}(this),onMouseOut:function(e){return function(){return e.setState({hover:!1})}}(this)},l.button(n.extend(t,n.omit(this.props,Object.keys(t))),a(i,{group:"web",name:this.state.hover?"xclose":"xclose_light_gray",alt:s("Close Modal")}))}})})}.call(this),function(){define("modules/clean/sharing/views/member_list",["external/immutable","external/react","external/underscore","modules/clean/flux/store_listener","modules/clean/sharing/actions/share_modal","modules/clean/sharing/api/types/metadata","modules/clean/sharing/content_info","modules/clean/sharing/stores/sharing_info","modules/clean/sharing/views/member_list_item","modules/clean/sharing/ui_util","modules/clean/user","modules/clean/viewer","modules/core/i18n"],function(e,t,n,i,o,r,s,a,l,u,c,d,p){var _,h,m,f,v,g,y,b,w;return b=i.listenToStores,f=r.SharingMembership,_=s.ContentInfo,m=l.SharingMemberListItem,w=u.makeMemberSortCmp,v=p.i18n_default_project("sharing")._,g=t.createElement,y=t.DOM,h=t.createClass({displayName:"SharingMemberList",propTypes:{actionHandler:t.PropTypes.instanceOf(o),canInviteMembers:t.PropTypes.bool,canRelinquishMembership:t.PropTypes.bool,contentInfo:t.PropTypes.instanceOf(_).isRequired,membership:t.PropTypes.instanceOf(f).isRequired,onMemberAccessChange:t.PropTypes.func,ownerTeam:t.PropTypes.shape({id:t.PropTypes.string.isRequired,name:t.PropTypes.string.isRequired}),pendingRemoval:t.PropTypes.instanceOf(e.Set).isRequired,user:t.PropTypes.instanceOf(c).isRequired,viewer:t.PropTypes.instanceOf(d).isRequired},render:function(){var e,t,n,i,o,r;return n=w(this.props.user.account_id),i=this._membersByInheritance(),e=null!=(o=i.get(!1))?o.sort(n):void 0,t=null!=(r=i.get(!0))?r.sort(n):void 0,y.div({className:"sharing-member-list"},(null!=e?e.count():void 0)>0?y.ul({className:"o-list-ui u-trim-margin"},e.map(this._renderMembersListItem).toArray()):void 0,(null!=t?t.count():void 0)>0?[y.h5({className:"sharing-member-list__inherited-separator u-pad-vertical-xs u-pad-horizontal-s u-font-meta u-font-strong",key:"separator"},v("Can access via parent folders")),y.ul({className:"o-list-ui u-trim-margin",key:"inherited-members"},t.map(this._renderMembersListItem).toArray())]:void 0)},_renderMembersListItem:function(e){var t;return t=e.memberKey(),g(m,{canInviteMembers:this.props.canInviteMembers,canRelinquishMembership:this.props.canRelinquishMembership,contentInfo:this.props.contentInfo,key:t,isPendingRemoval:this.props.pendingRemoval.has(t),member:e,onMemberAccessChange:this.props.onMemberAccessChange,user:this.props.user,viewer:this.props.viewer})},_membersByInheritance:function(){return null==this.props.membership?e.Map():this.props.membership.groups.valueSeq().concat(this.props.membership.invitees.valueSeq()).concat(this.props.membership.users.valueSeq()).groupBy(function(e){return e.is_inherited})}})})}.call(this),function(){define("modules/clean/sharing/views/member_list_item",["external/classnames","external/immutable","external/react","external/underscore","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/size","modules/clean/em_string","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/content_info","modules/clean/sharing/views/sharing_bubble_menu","modules/clean/static_urls","modules/clean/user","modules/clean/viewer","modules/core/i18n","modules/core/user_i18n"],function(e,t,n,i,o,r,s,a,l,u,c,d,p,_,h,m,f){var v,g,y,b,w,E,T,C,S,k,I,A,P,N,R,O;return g=s.AVATAR_DIMENSION_BY_SIZE,b=l.GroupMembershipInfo,w=l.InviteeMembershipInfo,T=l.MemberPermissions,k=l.UserMembershipInfo,v=u.ACCESS_VALUES,E=u.MEMBER_ACTION,C=u.SNIPPET_SIZES,y=c.ContentInfo,R=p.static_url,N=m.i18n_default_project("sharing"),I=N._,O=N.ungettext,A=n.createElement,P=n.DOM,S=n.createClass({displayName:"SharingMemberListItem",propTypes:{canInviteMembers:n.PropTypes.bool,canRelinquishMembership:n.PropTypes.bool,isPendingRemoval:n.PropTypes.bool,member:n.PropTypes.oneOfType([n.PropTypes.instanceOf(b),n.PropTypes.instanceOf(w),n.PropTypes.instanceOf(k)]),contentInfo:n.PropTypes.instanceOf(y).isRequired,onMemberAccessChange:n.PropTypes.func,ownerTeam:n.PropTypes.shape({id:n.PropTypes.string.isRequired,name:n.PropTypes.string.isRequired}),pendingAccessChange:n.PropTypes.oneOf(v),user:n.PropTypes.instanceOf(_).isRequired,viewer:n.PropTypes.instanceOf(h).isRequired},_shouldLinkMemberName:function(e){return this.props.contentInfo.isTeamSharedFolder()&&!this.props.canInviteMembers&&"group"===e&&this.props.member.is_owner},render:function(){var t,n,i,s,l,u,c;if(this.props.member instanceof k){if(c=this.props.member.account,s="user",null==c)return null;l=c.profile_photo_url}else this.props.member instanceof b?(c=null,s="group",l="team"===this.props.member.group_type?R("/static/images/icons/team_24@2x-vflR8kGKs.png"):void 0):(c=null,s="invitee");return t=this.props.member.displayName(),i=this.props.member.initials||f.getInitials(t),u="group"===s?"SQUARE":"CIRCLE",P.li({className:"sharing-member-list__item o-flag u-mar-s"},P.div({className:"o-flag__flex"},P.div({className:"sharing-member-info o-flag"},P.div({className:"o-flag__fix"},A(o,{dimension:g.MEDIUM,photoUrl:l,shape:u,defaultAvatar:A(r,{dimension:g.MEDIUM,shape:u,initials:i,name:t})})),P.div({className:"o-flag__flex u-pad-left-xs u-pad-right-xs"},P.div({className:e([this.props.isPendingRemoval?"u-font-meta":null,"u-font-strong","u-ellip"])},t?(n=a.em_snippet(t,C.DISPLAY_NAME),this._shouldLinkMemberName(s)?P.a({href:"/team#groups/"+this.props.member.group_id,target:"_blank",className:"sharing-member-info__group-name-link"},n):n):void 0,(null!=c?c.disabled:void 0)?[P.span({className:"dot"},"•"),P.span({className:"u-font-danger"},I("Deleted"))]:null==this.props.ownerTeam||null==this.props.viewer.team_name||null==c||(null!=c?c.is_teammate:void 0)?void 0:[P.span({className:"dot"},"•"),P.span({className:"u-font-danger"},I("Outside of your Dropbox team"))]),P.div({className:"u-font-meta u-ellip"},"group"===s&&this.props.member.member_count?O("%(member_num)s member","%(member_num)s members",this.props.member.member_count).format({member_num:this.props.member.member_count}):(null!=c?c.email:void 0)&&(null!=c?c.email_verified:void 0)?a.em_snippet(c.email,C.EMAIL):void 0)))),P.div({className:"o-flag__fix"},this.props.isPendingRemoval?P.img({src:R("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:I("Removing")}):A(d,{allowRelinquishMembership:this.props.member.memberId()===this.props.user.account_id&&this.props.canRelinquishMembership,canInviteMembers:this.props.canInviteMembers,contentInfo:this.props.contentInfo,currentAccess:this.props.member.access_type,isInherited:this.props.member.is_inherited,memberPermissions:this.props.member.permissions,onAccessChange:function(e){return function(t){var n;return"function"==typeof(n=e.props).onMemberAccessChange?n.onMemberAccessChange(e.props.member,t):void 0}}(this),pendingAccessChange:this.props.pendingAccessChange})))}}),{SharingMemberListItem:S}})}.call(this),function(){define("modules/clean/sharing/views/modal_content",["external/classnames","external/immutable","external/react","external/underscore","modules/clean/contacts/tokenizer","modules/clean/em_string","modules/clean/js_environment","modules/clean/react/css","modules/clean/react/image","modules/clean/react/sprite","modules/clean/sharing/actions/share_modal","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/content_info","modules/clean/sharing/ui_util","modules/clean/sharing/views/hover_close_button","modules/clean/sharing/views/member_list","modules/clean/sharing/views/modal_link_info","modules/clean/sharing/views/sharing_bubble_menu","modules/clean/static_urls","modules/clean/user","modules/clean/viewer","modules/core/i18n"],function(e,t,n,i,o,r,s,a,l,u,c,d,p,_,h,m,f,v,g,y,b,w,E){var T,C,S,k,I,A,P,N,R,O,D,x,L,M,F,U,B,q,W,V,H,j,G,z,K,$;return I=o.ContactsTokenizer,k=o.ContactTokenState,P=d.FolderPolicy,N=d.LinkMetadata,x=d.MemberCounts,L=d.MemberPermissions,F=d.PermissionSetting,q=d.SharingMembership,T=p.ACCESS_LEVEL,C=p.ACCESS_VALUES,R=p.MEMBER_ACTION,U=p.SNIPPET_SIZES,A=_.ContentInfo,S=h.CONTACT_ERROR_LEVEL,G=h.getContactValidator,M=v.ModalLinkInfo,K=y.static_url,H=n.createElement,j=n.DOM,z=E.i18n_default_project("sharing"),W=z._,$=z.ungettext,O={LINK_ONLY:"link-only",LOADING:"loading",MEMBERSHIP:"membership",SHARE:"share",SHARE_SENDING:"share-sending"},D=i.values(O),V=n.createClass({displayName:"ShareModalContent",statics:{MODES:O},propTypes:{actionHandler:n.PropTypes.instanceOf(c),canChangeOptions:n.PropTypes.bool.isRequired,canConvertToGoldenGateFolder:n.PropTypes.bool.isRequired,canInviteEditor:n.PropTypes.bool.isRequired,canInviteViewer:n.PropTypes.bool.isRequired,canRelinquishMembership:n.PropTypes.bool,canShareLink:n.PropTypes.bool.isRequired,contentInfo:n.PropTypes.instanceOf(A).isRequired,customMessage:n.PropTypes.string,errorLevel:n.PropTypes.string,errorMessage:n.PropTypes.string,folderPolicy:n.PropTypes.instanceOf(P),headerId:n.PropTypes.string,initialRecipientRawInput:n.PropTypes.string,initialRecipientTokens:n.PropTypes.array,isLinkDataLoaded:n.PropTypes.bool.isRequired,isMembershipLoaded:n.PropTypes.bool.isRequired,isMetadataLoaded:n.PropTypes.bool.isRequired,isTeamSharedFolder:n.PropTypes.bool,linkMetadata:n.PropTypes.instanceOf(N),memberCounts:n.PropTypes.instanceOf(x),members:n.PropTypes.instanceOf(q),name:n.PropTypes.string,mode:n.PropTypes.oneOf(D),onContactsChange:n.PropTypes.func,onCreateLinkClick:n.PropTypes.func,onFolderSettingsClick:n.PropTypes.func,onConvertToGoldenGateClick:n.PropTypes.func,onLinkSettingsClick:n.PropTypes.func,onMemberAccessChange:n.PropTypes.func,onMessageChange:n.PropTypes.func,onRecipientAccessChange:n.PropTypes.func,onSend:n.PropTypes.func,ownerTeam:n.PropTypes.shape({id:n.PropTypes.string.isRequired,name:n.PropTypes.string.isRequired}),pendingRemoval:n.PropTypes.instanceOf(t.Set).isRequired,recipientAccess:n.PropTypes.oneOf(C).isRequired,user:n.PropTypes.instanceOf(b).isRequired,viewer:n.PropTypes.instanceOf(w).isRequired},getDefaultProps:function(){return{customMessage:null,headerId:"unified-share-modal-title",linkMetadata:null,members:null,initialRecipientRawInput:"",initialRecipientTokens:[],isTeamSharedFolder:!1,mode:O.MEMBERSHIP,onContactsChange:null,onCreateLinkClick:null,onFolderSettingsClick:null,onConvertToGoldenGateClick:null,onLinkSettingsClick:null,onMemberAccessChange:null,onMessageChange:null,onRecipientAccessChange:null,onSend:null}},getInitialState:function(){return{isTokenizerEmpty:0===this.props.initialRecipientRawInput.length&&0===this.props.initialRecipientTokens.length}},render:function(){return j.div({className:"unified-share-modal unified-share-modal--"+this.props.mode},this._renderHeaderSection(),this._renderToSection(),this._renderErrorMessageSection(),this._renderMainSection(),this._renderFooterSection(),this._renderConvertToGoldenGateSection())},_renderHeaderSection:function(){var t,n,i,o,s,a;return t=this.props.contentInfo.icon(),i=this._getMemberNum(),o=this.props.user.is_team&&(null!=(s=this.props.memberCounts)?s.users_outside_team:void 0)>0&&null!=this.props.ownerTeam?$("%(outside_team_count)s outside of your Dropbox team","%(outside_team_count)s outside of your Dropbox team",this.props.memberCounts.users_outside_team).format({outside_team_count:this.props.memberCounts.users_outside_team}):void 0,n=i?o?$("%(member_num)s member (%(outside_team_string)s)","%(member_num)s members (%(outside_team_string)s)",i,{comment:'Description of the count of total folder members and count of outside-of-team folder members, like "10 members (3 outside of your Dropbox team)"'}):$("%(member_num)s member","%(member_num)s members",i):"",n=n.format({member_num:i,outside_team_string:o}),j.div({className:"unified-share-modal__section u-pad-s o-flag"},j.div({className:"unified-share-modal__title-icon o-flag__fix"},H(u,{alt:"",group:"web",name:t})),j.div({className:e("unified-share-modal__title","u-pad-left-xs",i?"unified-share-modal__title--member-count":void 0,"o-flag__flex")},j.h3({className:"u-font-strong",id:this.props.headerId},r.em_snippet(this.props.contentInfo.name(),U.FILENAME)),i?j.h4({className:"u-trim-margin u-font-meta",id:this.props.headerId},n):void 0),j.div({className:"unified-share-modal__close o-flag__fix"},H(m,{className:"u-mar-left-s",onClick:null!=(a=this.props.actionHandler)?a.closeModal:void 0})))},_renderToSection:function(){return this.props.mode===O.LINK_ONLY?this._renderNoPermissionSection():this.props.isMetadataLoaded?this.props.canInviteEditor||this.props.canInviteViewer?j.div({className:"unified-share-modal__section u-pad-horizontal-s u-pad-vertical-xs"},j.div({className:"o-flag"},j.label({className:"o-flag__fix u-font-strong",htmlFor:"unified-share-modal-contacts-tokenizer"},W("To:",{comment:"Label for with whom to share"})),j.div({className:"unified-share-modal__to-input-box o-flag__flex"},H(I,{ref:"tokenizer",customContactFilter:this.props.isTeamSharedFolder?function(e){return e.group_id}:function(e){return function(t){return t.email!==e.props.user.email}}(this),focusOnMount:!0,id:"unified-share-modal-contacts-tokenizer",onContentsChange:this._handleRecipientChange,populatedInputData:{tokens:this.props.initialRecipientTokens,value:this.props.initialRecipientRawInput},customContactValidator:G(this.props.isTeamSharedFolder).bind(null,this.props.folderPolicy,this.props.user,this.props.ownerTeam),placeholder:W(this.props.isTeamSharedFolder?"Group name":this.props.user.is_team?"Email, name, or group":"Email or name"),showContactImport:!this.props.isTeamSharedFolder,user:this.props.user})),j.div({className:e({"o-flag__fix":!0,"c-title-bubble":this.props.contentInfo.isFile()&&!this.props.canInviteEditor}),"data-title":W("Only folders can be shared with edit access")},this.props.contentInfo.isFile()&&!this.props.canInviteEditor?j.span({className:"ax-visually-hidden"},W("Only folders can be shared with edit access")):void 0,H(g,{asButton:!0,contentInfo:this.props.contentInfo,currentAccess:this.props.recipientAccess,memberPermissions:new L({make_editor:new F({allow:this.props.canInviteEditor}),make_viewer:new F({allow:this.props.canInviteViewer})}),onAccessChange:this.props.onRecipientAccessChange})))):this._renderNoPermissionSection():j.div({className:"unified-share-modal__section u-pad-horizontal-s u-pad-vertical-xs"},j.div({className:"unified-share-modal__to-placeholder"}," "))},_shouldRenderFooterSection:function(){var e;return this.props.isMetadataLoaded&&(this.props.contentInfo.isSharedFolder()||this.props.contentInfo.isFileFolder()&&this.props.hasParentSharedFolder||(e=this.props.mode)===O.SHARE||e===O.SHARE_SENDING)},_renderConvertToGoldenGateSection:function(){return this.props.canConvertToGoldenGateFolder?j.button({className:"unified-share-modal__convert-team-folder-banner u-font-center",onClick:this.props.onConvertToGoldenGateClick},W("Enable nesting by upgrading to Golden Gate Folder (EXPERIMENTAL!)")):null},_renderFooterSection:function(){return this._shouldRenderFooterSection()?j.div({className:"unified-share-modal__section clearfix u-pad-horizontal-s u-pad-vertical-xs"},j.div({className:"u-l-fl"},this.props.contentInfo.isSharedFolder()||this.props.contentInfo.isFileFolder()&&this.props.hasParentSharedFolder?j.button({className:"unified-share-modal__folder-settings u-font-strong u-font-meta c-borderless-button",onClick:this.props.onFolderSettingsClick},H(u,{alt:"",className:"u-mar-right-xs u-l-ib u-l-ib--m",group:"web",name:"settings"}),W("Folder settings")):void 0),j.div({className:"u-l-fr"},function(){switch(this.props.mode){case O.SHARE:case O.SHARE_SENDING:return j.button({className:"unified-share-modal__share-send c-btn c-btn--primary",disabled:this.props.mode===O.SHARE_SENDING||this.state.isTokenizerEmpty||this.props.errorLevel===S.ERROR,onClick:this._handleSendClick},W(this.props.mode===O.SHARE_SENDING?"Sharing...":"Share"));default:return null}}.call(this))):void 0},_renderErrorMessageSection:function(){return this.props.errorMessage?j.div({className:e(["unified-share-modal__section","unified-share-modal__error-message","u-pad-s","u-font-center",this.props.errorLevel===S.WARN?"unified-share-modal__warn":void 0,this.props.errorLevel===S.ERROR?"unified-share-modal__error":void 0])},this.props.errorMessage):null},_renderMainSection:function(){if(this.props.mode===O.LINK_ONLY)return this._renderMainLinkOnly();if(!this.props.isMetadataLoaded||!this.props.isMembershipLoaded)return this._renderMainLoading();switch(this.props.mode){case O.MEMBERSHIP:return this._renderMainMembership();case O.SHARE:case O.SHARE_SENDING:return this._renderMainShare();default:return null}},_renderNoPermissionSection:function(){return j.div({className:"unified-share-modal__section unified-share-modal__no-permission u-pad-s u-font-center"},this.props.mode===O.LINK_ONLY?j.span({},W("This folder can only be shared as a link.")+" ",j.a({href:"/help/1931",target:"_blank"},W("Learn more"))):this.props.isTeamSharedFolder&&this._shouldRenderTeamFolderNoPermissionMessage(this.props.members)?W("This folder is automatically shared with all members of %(team_name)s").format({team_name:this.props.ownerTeam.name}):W(this.props.isTeamSharedFolder&&this._isOwnerOfAtLeastOneGroup(this.props.members)?"You can add or remove group members by clicking on the group name below.":"You don’t have permission to manage membership of this folder"))},_shouldRenderTeamFolderNoPermissionMessage:function(e){return null!=e&&null!=e.groups&&e.groups.some(function(e,t){var n,i;return"team"===e.group_type&&(null!=(n=e.permissions.make_editor)?n.allow:void 0)&&(null!=(i=e.permissions.make_viewer)?i.allow:void 0)})},_isOwnerOfAtLeastOneGroup:function(e){return null!=e&&null!=e.groups&&e.groups.some(function(e,t){return e.is_owner})},_renderMainLoading:function(){return j.div({className:e(["unified-share-modal__main","unified-share-modal__section",this._shouldRenderFooterSection()?void 0:"unified-share-modal__main--no-footer"])},this._renderLinkRow(),j.div({className:"u-font-center u-font-meta u-pad-top-xl"},j.div({className:"c-loader"},W("Loading..."))))},_renderMainLinkOnly:function(){return j.div({className:e(["unified-share-modal__main","unified-share-modal__main--link-only","unified-share-modal__section"])},this._renderLinkRow())},_renderMainMembership:function(){return j.div({className:e(["unified-share-modal__main","unified-share-modal__section",this._shouldRenderFooterSection()?void 0:"unified-share-modal__main--no-footer"])},this._renderLinkRow(),this._hasNonOwnerMembers()?H(f,{actionHandler:this.props.actionHandler,canInviteMembers:this.props.canInviteEditor||this.props.canInviteViewer,canRelinquishMembership:this.props.canRelinquishMembership,contentInfo:this.props.contentInfo,viewerAccountId:this.props.user.account_id,membership:this.props.members,onMemberAccessChange:this.props.onMemberAccessChange,ownerTeam:this.props.ownerTeam,pendingRemoval:this.props.pendingRemoval,user:this.props.user,viewer:this.props.viewer}):j.div({className:"unified-share-modal__no-members u-font-center u-font-meta u-mar-top-xl u-font-center u-font-meta"},H(l,{src:K("/static/images/sharing/sharing-invite-users-vflfTH_fj.png"),srcHiRes:K("/static/images/sharing/sharing-invite-users@2x-vflgGHzXi.png")}),j.p({className:"u-mar-top-s"},W("Invite others to collaborate with you!"))))},_renderMainShare:function(){return j.div({className:"unified-share-modal__main unified-share-modal__section u-pad-s"},j.textarea({placeholder:W("Add a message (optional)"),onChange:this._handleMessageChange,ref:"customMessage",value:this.props.customMessage}))},_renderMainShareSending:function(){return j.div({className:"unified-share-modal__main unified-share-modal__main--text unified-share-modal__section u-pad-s u-font-center u-font-meta u-mar-top-xl"},W("Sending..."))},_renderLinkRow:function(){return this.props.isLinkDataLoaded&&(this.props.isMetadataLoaded||this.props.mode===O.LINK_ONLY)?H(M,{canShareLink:this.props.canShareLink||this.props.mode===O.LINK_ONLY,contentInfo:this.props.contentInfo,linkMetadata:this.props.linkMetadata,onCreateLinkClick:this.props.onCreateLinkClick,onLinkSettingsClick:this.props.onLinkSettingsClick,user:this.props.user}):this.props.contentInfo.isTeamSharedFolder()?void 0:j.div({className:"unified-share-modal__link-filler"})},_getMemberNum:function(){var e;return null!=this.props.memberCounts?this.props.memberCounts.total_unique_users:null!=(e=this.props.members)?e.getMemberCount():void 0},_hasNonOwnerMembers:function(){var e,t,n;return e=null!=(n=this.props.members)?n.getMemberCount():void 0,e?1===e&&1===this.props.members.users.count()?(t=this.props.members.users.first(),t.account_id!==this.props.user.account_id):!0:!1},_handleMessageChange:function(e){var t;return"function"==typeof(t=this.props).onMessageChange?t.onMessageChange(e.target.value):void 0},_handleSendClick:function(e){var t,n,i;return e.preventDefault(),e.stopPropagation(),"function"==typeof(t=this.props).onSend?t.onSend(null!=(n=this.refs.accessLevel)?n.value:void 0,null!=(i=this.refs.customMessage)?i.value:void 0):void 0},_handleRecipientChange:function(e,t){var n;return this.setState({isTokenizerEmpty:0===e.length&&0===t.length}),"function"==typeof(n=this.props).onContactsChange?n.onContactsChange(e,t):void 0},getRecipientTokens:function(){var e;return null!=(e=this.refs.tokenizer)?e.getContacts():void 0}}),B=a(V,["/static/css/react/contacts_tokenizer-vflR5K70C.css","/static/css/scooter/scooter-scoped-vfljb_RbQ.css","/static/css/sharing/share_modal-vflvVUXVg.css"]),{ShareModalContent:B,MODES:O}})}.call(this),function(){define("modules/clean/sharing/views/modal_link_info",["jquery","external/classnames","external/flash_detect","external/react","modules/clean/clipboard_v2","modules/clean/react/sprite","modules/clean/react/util","modules/clean/sharing/api/types/metadata","modules/clean/sharing/content_info","modules/clean/sharing/link_description","modules/clean/sharing/ui_util","modules/clean/user","modules/core/i18n","modules/core/notify"],function(e,t,n,i,o,r,s,a,l,u,c,d,p,_){var h,m,f,v,g,y,b,w,E;return E=s.setStatePromise,m=a.LinkMetadata,h=l.ContentInfo,b=u.formatLinkDescription,w=c.logTiburonEvent,v=p.i18n_default_project("sharing")._,g=i.createElement,y=i.DOM,f=i.createClass({displayName:"ModalLinkInfo",propTypes:{canShareLink:i.PropTypes.bool.isRequired,contentInfo:i.PropTypes.instanceOf(h).isRequired,linkMetadata:i.PropTypes.instanceOf(m),onCopyLinkClick:i.PropTypes.func,onCreateLinkClick:i.PropTypes.func,onLinkSettingsClick:i.PropTypes.func,user:i.PropTypes.instanceOf(d).isRequired},getInitialState:function(){return{showingUrl:!1}},componentWillMount:function(){var e;return this.clipboard=new o(null!=(e=this.props.linkMetadata)?e.url:void 0,function(){return _.success(v("Link copied to clipboard"))},function(){return _.error(v("Unable to copy the link, please copy manually"))},this._handleCopyLinkClicked)},componentDidMount:function(){return this.setupCopy()},componentDidUpdate:function(){return this.setupCopy()},setupCopy:function(){var t;return t=e(".copy-link-button"),t.length?this.clipboard.setupCopy(t,e(".copy-link-container")):void 0},render:function(){return null!=this.props.linkMetadata?this._renderLink():this.props.canShareLink?this._renderNoLink():null},_renderLink:function(){return y.div({className:"unified-share-modal-link-info o-flag u-mar-horizontal-s u-mar-bottom-s u-pad-top-s"},y.div({className:"o-flag__fix"},y.div({className:"unified-share-modal-link-info__icon"},g(r,{alt:"",group:"web",name:"shared_link_white"}))),y.div({className:"unified-share-modal-link-info__details o-flag__flex u-pad-left-xs"},this.state.showingUrl?[y.label({className:"ax-visually-hidden",htmlFor:"unified-share-modal-link-url",key:"link-label"},v("Shared link URL")),y.input({className:"unified-share-modal-link-info__url",id:"unified-share-modal-link-url",key:"link-url-input",onClick:this._handleUrlClick,readOnly:!0,ref:"urlField",type:"text",value:this.props.linkMetadata.url})]:b(this.props.linkMetadata)),y.ul({className:"unified-share-modal-link-info__actions o-flag__fix"},this.state.showingUrl?void 0:y.li({className:"u-l-ib"},y.button({className:"button-as-link",onClick:this.props.onLinkSettingsClick},v("Link settings")),y.span({className:"u-l-ib u-mar-left-xs u-mar-right-xs"},"•")),y.li({className:"u-l-ib"},y.button({className:"button-as-link copy-link-container",onClick:this._handleCopyLinkClicked},this.state.showingUrl?v("Hide link"):o.is_supported()?y.span({className:"copy-link-button"},v("Copy link")):v("Show link")))))},_renderNoLink:function(){return y.div({className:"unified-share-modal-link-info unified-share-modal-link-info--no-link o-flag u-mar-horizontal-s u-mar-bottom-s u-pad-top-s"},y.div({className:"o-flag__fix"},y.div({className:"unified-share-modal-link-info__icon"},g(r,{alt:"",group:"web",name:"shared_link_gray"}))),y.div({className:"unified-share-modal-link-info__details u-pad-left-xs o-flag__flex"},v("No link created yet")),y.div({className:"unified-share-modal-link-info__actions o-flag__fix"},y.a({href:"#",onClick:this.props.onCreateLinkClick},v("Create a link"))))},_handleCopyLinkClicked:function(){return this.state.showingUrl||w(this.props.contentInfo,this.props.user.id,"CLICK_TIB_COPY_LINK"),E(this,{showingUrl:!this.state.showingUrl}).then(function(e){return function(){var t;return null!=e.refs.urlField?(t=e.refs.urlField.getDOMNode(),t.focus(),t.select(),e.clipboard.do_copy()):void 0}}(this))},_handleUrlClick:function(e){return e.target.select()}}),{ModalLinkInfo:f}})}.call(this),function(){define("modules/clean/sharing/views/sharing_bubble_menu",["external/classnames","external/react","modules/clean/react/bubble_menu","modules/clean/react/sprite","modules/clean/react/tooltip","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/content_info","modules/clean/sharing/strings","modules/core/i18n"],function(e,t,n,i,o,r,s,a,l,u){var c,d,p,_,h,m,f,v,g,y,b,w,E,T,C;return _=n.BubbleMenu,h=n.BubbleMenuItem,b=o.Tooltip,w=o.TooltipPosition,v=r.MemberPermissions,g=r.PermissionSetting,c=s.ACCESS_LEVEL,p=s.ACCESS_VALUES,f=s.MEMBER_ACTION,m=a.ContentInfo,d=l.ACCESS_NAME,E=u.i18n_default_project("sharing")._,T=t.createElement,C=t.DOM,y=t.createClass({displayName:"SharingBubbleMenu",propTypes:{allowRelinquishMembership:t.PropTypes.bool,asButton:t.PropTypes.bool,canInviteMembers:t.PropTypes.bool,contentInfo:t.PropTypes.instanceOf(m).isRequired,currentAccess:t.PropTypes.oneOf(p).isRequired,isInherited:t.PropTypes.bool,memberPermissions:t.PropTypes.instanceOf(v).isRequired,onAccessChange:t.PropTypes.func.isRequired,
pendingAccessChange:t.PropTypes.oneOf(p)},getDefaultProps:function(){return{allowRelinquishMembership:!1,asButton:!1,canInviteMembers:!1,pendingAccessChange:null}},_getMemberActionInfo:function(){return[[f.MAKE_EDITOR,{value:c.WRITER,title:d[c.WRITER],description:E("People can edit, delete, and add the files to their Dropbox")}],[f.MAKE_VIEWER,{value:c.READER,title:d[c.READER],description:E("People can view and download the files, but can’t edit them")}],[f.MAKE_OWNER,{value:c.OWNER,title:E("Make owner")}],[f.REMOVE,{value:"remove",title:this.props.allowRelinquishMembership?C.div({className:"u-font-danger"},E("Remove my access")):C.div({className:"u-font-danger"},E("Remove"))}]]},_renderMenuItem:function(e){var t,n,o;return o=e.value,n=e.title,t=e.description,T(h,{className:"sharing-access-menu-item",key:o,onClick:function(e){return function(){return o!==e.props.currentAccess?e.props.onAccessChange(o):void 0}}(this)},C.div({className:"sharing-access-menu-item__left-margin u-l-ib u-l-ib--t"},o===this.props.currentAccess?T(i,{alt:"",group:"web",name:"check_gray"}):void 0),C.div({className:"sharing-access-menu-item__label u-l-ib u-l-ib--t"},C.div({className:"u-font-nowrap u-font-black sharing-access-menu-item__title"},n),C.div({className:"u-font-wrap u-font-meta sharing-access-menu-item__description"},t)))},_renderCurrentAccessText:function(t){return C.button({className:e(["sharing-access-menu__current-access","u-font-nowrap",this.props.asButton?["sharing-access-menu__current-access--button","c-btn","c-btn--secondary","u-trim-margin"]:{"c-borderless-button":!0,"change-access-button":!t}]),disabled:t},d[this.props.currentAccess],t?void 0:[C.div({className:"gray-arrow",key:"gray"},T(i,{alt:"",className:"u-l-ib u-l-ib--m u-mar-left-xs",group:"web",name:"arrow-down-gray"})),C.div({className:"blue-arrow",key:"blue"},T(i,{alt:"",className:"u-l-ib u-l-ib--m u-mar-left-xs",group:"web",name:"arrow-down-blue"}))])},render:function(){var e,t,n,i,o,r,s,a;for(o=[],r=this._getMemberActionInfo(),t=0,i=r.length;i>t;t++)s=r[t],e=s[0],n=s[1],(n.value===this.props.currentAccess||(null!=(a=this.props.memberPermissions.get(e))?a.allow:void 0)||n.value===f.REMOVE&&this.props.allowRelinquishMembership)&&o.push(this._renderMenuItem(n));return o.length<=1&&this.props.isInherited&&this.props.canInviteMembers?T(b,{position:w.RIGHT,tooltip_contents:E("This member’s permissions can only be changed from a parent folder."),tooltip_classname:"sharing-access-menu__tooltip"},C.span({className:"ax-visually-hidden"},E("This member’s permissions can only be changed from a parent folder.")),this._renderCurrentAccessText(!0)):o.length<=1||this.props.pendingAccessChange?this._renderCurrentAccessText(!0):T(_,{arrow_position:"top-right",className:"sharing-access-menu o-list-ui o-list-ui--dividers",items:o,show_arrow:!1,targetButton:this._renderCurrentAccessText(!1)})}})})}.call(this),function(){define("modules/clean/sharing/wizard/share_new_folder_wizard_modal",["external/react","modules/clean/react/css","modules/clean/react/input","modules/clean/react/modal","modules/core/i18n","modules/clean/user","modules/clean/viewer","modules/constants/viewer"],function(e,t,n,i,o,r,s,a){var l,u,c,d,p,_,h,m;return m=n.text,l=i.Modal,u=a.ROLE_PERSONAL,c=a.ROLE_WORK,_=e.createElement,h=e.DOM,p=o.i18n_default_project("sharing")._,d=e.createClass({displayName:"ShareNewFolderWizardModal",propTypes:{onBack:e.PropTypes.func,onSubmit:e.PropTypes.func,user:e.PropTypes.instanceOf(r).isRequired},getInitialState:function(){return{newFolderName:"",errorMsg:""}},render:function(){return _(l,{autoClose:!1,className:"new-shared-folder-wizard",buttonComponent:h.span(),onDismissCompleted:function(){return l.close()},title:function(){switch(this.props.user.role){case c:return p("Create a shared folder in your %(team_name)s Dropbox").format({team_name:s.get_viewer().team_name});case u:return p("Create a shared folder in your personal Dropbox")}}.call(this)},this._renderContent())},_renderContent:function(){return h.div({className:"new-shared-folder-wizard__contents"},this._renderHeader(),this._renderInput(),this._renderButtons())},_renderHeader:function(){return h.div({},p("What is the name of your new shared folder?"))},_renderInput:function(){return h.div({className:"text-input"},this._renderError(),h.div({className:"text-input-wrapper"},m({label:p("New folder name"),onChange:this._handleChange})))},_renderButtons:function(){return h.div({className:"u-mar-top-m clearfix"},h.div({className:"u-l-fl"},h.button({className:"button-as-link",style:{lineHeight:"32px"},onClick:function(e){return function(){var t;return l.close(),"function"==typeof(t=e.props).onBack?t.onBack():void 0}}(this)},p("Back"))),h.div({className:"u-l-fr"},h.button({className:"c-btn c-btn--primary",disabled:!this._isValid(),onClick:function(e){return function(){return e.props.onSubmit(e.state.newFolderName,e._setError)}}(this)},p("Next"))))},_setError:function(e){var t;return this.setState({errorMsg:null!=e&&null!=(t=e.folder_name)?t.message_text:void 0})},_renderError:function(){var e;return this.state.newFolderName.length>0&&(null!=(e=this.state.errorMsg)?e.length:void 0)>0?h.div({className:"text-input-error-wrapper"},h.div({className:"text-input-error"},this.state.errorMsg)):void 0},_handleChange:function(e){return this.setState({newFolderName:e.target.value,errorMsg:""})},_isValid:function(){var e;return this.state.newFolderName.length>0&&!(null!=(e=this.state.errorMsg)?e.length:void 0)>0}}),d=t(d,["/static/css/sharing/wizard_modals-vflYWjNGE.css"]),{ShareNewFolderWizardModal:d}})}.call(this),function(){define("modules/clean/teams/limited_team_invite_form",["external/underscore","external/react","modules/core/uri","modules/core/i18n","modules/clean/react/react_i18n","modules/clean/ajax","modules/clean/css","modules/clean/contacts/data","modules/clean/contacts/tokenizer","modules/clean/contacts/types","modules/clean/react/input","modules/clean/react/modal"],function(e,t,n,i,o,r,s,a,l,u,c,d){var p,_,h,m,f,v,g,y,b,w,E,T,C,S,k,I,A,P;w=i._,b=o.RP_,p=a.Contact,h=l.ContactsTokenizer,_=l.ContactTokenState,y=d.Modal,C=t.DOM,T=t.addons.classSet,A=t.PropTypes,m=function(){function e(){this.inFlight=!0,this.canInvite=!1,this.reason="checking",this.callbacks=[]}return e.prototype.whenReady=function(e){return this.inFlight?this.callbacks.push(e):e()},e.prototype.resultArrived=function(e,t){var n,i,o,r;if(this.inFlight){for(this.inFlight=!1,this.canInvite=e,this.reason=t,r=this.callbacks,i=0,o=r.length;o>i;i++)(n=r[i])();return delete this.callbacks}},e}(),f=function(){function e(e){this.checkUrl=e,this.checkedEmails={}}return e.prototype.checkEmails=function(e,t){var n,i,o,s,a,l;if(a={},l=e.length,0===l)return t(a);for(o=0,s=e.length;s>o;o++)i=e[o],n=this.checkedEmails[i],n||(n=this.checkedEmails[i]=new m,function(e){return function(t){return r.WebRequest({url:e.checkUrl,data:{email:i},success:function(e){var n,i,o;return o=JSON.parse(e),n=o.can_invite,i=o.reason,t.resultArrived(n,i)},error:function(){return delete e.checkedEmails[i]}})}}(this)(n)),n.whenReady(function(){return a[i]=n,0===--l?t(a):void 0})},e.prototype.getEmailCheckResult=function(e){return this.checkedEmails[e]},e}(),v={existingTeam:{id:"existingTeam",checkUrl:"/team/manage/check_can_invite"},createLimitedTeam:{id:"createLimitedTeam",checkUrl:"/team/create_limited/check_can_invite"}},S={};for(I in v)P=v[I],k=P.id,E=P.checkUrl,S[k]=new f(E);return g=t.createClass({displayName:"LimitedTeamInviteForm",propTypes:{user:A.object.isRequired,invitationContext:A.oneOf(e.values(v)),populatedCustomMessage:A.string,populatedContacts:A.arrayOf(A.instanceOf(p)),customClass:A.string,onChange:A.func,emailPlaceholder:A.string,messagePlaceholder:A.string,errorMessageSpaceFixed:A.bool,emailCheckerStore:A.object,includeCustomMessage:A.bool,autofocusTokenizer:A.bool,memberInviteLimit:A.number,maxTeamSize:A.number,tokenSpacing:A.number},statics:{InvitationContexts:v},getDefaultProps:function(){return{customClass:"",invitationContext:v.existingTeam,populatedContacts:[],emailPlaceholder:w("Name or email"),messagePlaceholder:w("Add a message (optional)"),includeCustomMessage:!0,autofocusTokenizer:!0}},getInitialState:function(){return{errorMessage:null}},componentWillMount:function(){return s.require_css("/static/css/teams/limited_team_invite_form-vflX7ACyW.css"),s.require_css("/static/css/react/contacts_tokenizer-vflR5K70C.css"),this.emailCheckerStore=this.props.emailCheckerStore||S[this.props.invitationContext.id],this.props.populatedContacts.length>0?this._ensureContactsStateUpdated(this.props.populatedContacts,function(e){return function(){var t;return e._updateErrorMessage(),"function"==typeof(t=e.props).onChange?t.onChange():void 0}}(this)):void 0},getContacts:function(){return this.refs.tokenizer.getContacts()},getFinalData:function(t){var n,i;return this.refs.tokenizer.tokenizeAll(),n=this.getContacts(),this.props.includeCustomMessage&&(i=this.refs.message.getValue()),this._ensureContactsStateUpdated(n,function(o){return function(){var r,s;return r=e.filter(n,function(e){return e.type===u.EMAIL}),s=e.map(r,function(e){return e.email}),o._updateErrorMessage(),t({emails:s,custom_message:i})}}(this))},areAllContactsValid:function(){var t;return this._overInviteLimit()?!1:(t=this.refs.tokenizer.serializeInputData().tokens,0===t.length?!0:e.all(t,function(e){return function(t){return e._validateContact(t).state===_.ok}}(this)))},isEmpty:function(){var e,t,n;return e=this.refs.tokenizer.serializeInputData(),t=e.tokens,n=e.value,0===t.length&&0===n.length},_ensureContactsStateUpdated:function(t,n){var i;return t=e.filter(t,function(e){return e.type===u.EMAIL&&!e.invalid&&!e.on_team}),i=e.map(t,function(e){return e.email}),this.emailCheckerStore.checkEmails(i,function(e){return function(){return e.isMounted()?n():void 0}}(this))},_validateContact:function(e){var t,n;return e.invalid?n={state:_.invalid,msg:w("Invalid email.")}:e.on_team?n={state:_.invalid,msg:w("User is already a member of this team.")}:(t=this.emailCheckerStore.getEmailCheckResult(e.email),n=t?t.inFlight?{state:_.pending}:t.canInvite?{state:_.ok}:{state:_.invalid,msg:function(){switch(t.reason){case"team_member":return w("This person is already on another team.");case"already_on_this_team":return w("User is already invited to this team.");case"error":return w("User isn’t eligible to join this team.");default:return null}}()}:{state:_.invalid}),n},_overInviteLimit:function(){var e;return e=this.refs.tokenizer.serializeInputData().tokens,null!=this.props.memberInviteLimit&&e.length>this.props.memberInviteLimit},_updateErrorMessage:function(){var e,t,i,o,r,s,a,l,u;for(s=this.refs.tokenizer.serializeInputData().tokens,t=0,i=s.length;i>t;t++)if(e=s[t],a=this._validateContact(e),l=a.state,o=a.msg,l!==_.ok)return void this.setState({errorMessage:o});return this._overInviteLimit()?(r={tk:this.props.maxTeamSize,_camp:"invite"},u=n({path:"/team/upgrade",query:r}),void this.setState({errorMessage:b({num_rem:this.props.memberInviteLimit,n:this.props.memberInviteLimit,upsell_url:u.toString()},"You have %(num_rem)s invite remaining. <a href='%(upsell_url)s'>Upgrade</a> now to add as many members as you like to your team.","You have %(num_rem)s invites remaining. <a href='%(upsell_url)s'>Upgrade</a> now to add as many members as you like to your team.")})):this.setState({errorMessage:null})},onContentsChange:function(e,t){return this._ensureContactsStateUpdated(e,function(e){return function(){var t;return e._updateErrorMessage(),"function"==typeof(t=e.props).onChange?t.onChange():void 0}}(this))},render:function(){var e;return e={"limited-team-invite-form":!0,"error-message-fixed":this.props.errorMessageSpaceFixed,"has-custom-message":this.props.includeCustomMessage},this.props.customClass&&(e[this.props.customClass]=!0),C.div({className:T(e)},C.div({className:"error-message"},this.state.errorMessage),t.createElement(h,{ref:"tokenizer",user:this.props.user,placeholder:this.props.emailPlaceholder,onContentsChange:this.onContentsChange,autofocus:this.props.autofocusTokenizer,populatedInputData:{tokens:this.props.populatedContacts,value:""},tokenSpacing:this.props.tokenSpacing,customContactValidator:this._validateContact,customContactFilter:function(e){return function(t){return t.type===u.EMAIL&&!t.team&&t.name&&t.email!==e.props.user.email}}(this)}),this.props.includeCustomMessage?t.createElement(c.textarea,{ref:"message",className:"custom-message","disable-errors":!0,placeholder:this.props.messagePlaceholder,value:this.props.populatedCustomMessage}):void 0)}})})}.call(this),function(){define("modules/clean/teams/modals/suggest_team_invite_modal",["external/react","external/underscore","modules/core/html","modules/core/i18n","modules/core/notify","modules/clean/analytics","modules/clean/ajax","modules/clean/contacts/data","modules/clean/contacts/types","modules/clean/teams/limited_team_invite_form","modules/clean/react/modal","modules/clean/react/input","modules/clean/viewer"],function(e,t,n,i,o,r,s,a,l,u,c,d,p){var _,h,m,f,v,g,y,b;return v=i._,f=r.TeamsWebActionsLogger,_=a.Contact,h=c.Modal,g=e.DOM,y=e.PropTypes,b=p.get_viewer(),m=e.createClass({displayName:"SuggestTeamInviteModal",statics:{showIfNeeded:function(n,i){return m.showInviteModal(function(o){return o?m.validateSuggestions(n,function(o){var r;return o.length>0?("function"==typeof i.onCheckCompleted&&i.onCheckCompleted(!0),i=t.extend({},i,{usersSharedOnFolder:n.emails,suggestedUsersToInviteToTeam:o}),r=e.createElement(m,i),h.showInstance(r)):"function"==typeof i.onCheckCompleted?i.onCheckCompleted(!1):void 0}):"function"==typeof i.onCheckCompleted?i.onCheckCompleted(!1):void 0})},validateSuggestions:function(e,t){return s.WebRequest({url:"/team/validate_emails_to_suggest_inviting",data:{emails_to_verify:JSON.stringify(e.emails)},success:function(e){return e=JSON.parse(e),t(e)}})},showInviteModal:function(e){var t;return(null!=(t=b.work_user)?t.is_team:void 0)?m._getShouldShowInviteModalData(function(t){return e(t.isOnLimitedTeam&&!t.hasSeenSuggestTeamInviteModal)}):e(!1)},_getShouldShowInviteModalData:function(e){return s.WebRequest({url:"/team/should_show_invite_modal",success:function(t){return t=JSON.parse(t),e(t)}})}},propTypes:{sharingType:y.string.isRequired,suggestedUsersToInviteToTeam:y.arrayOf(y.string).isRequired,usersSharedOnFolder:y.arrayOf(y.string),teamName:y.string,onDidAccept:y.func,onDidDismiss:y.func,onDidClose:y.func},getDefaultProps:function(){return{onDidAccept:function(){},onDidDismiss:function(){},teamName:b.team_name}},getInitialState:function(){return{canAccept:this.props.suggestedUsersToInviteToTeam.length>0,submitting:!1,errors:null}},_canAccept:function(){var e,t;return(null!=(e=this.refs.members)?e.areAllContactsValid():void 0)&&!(null!=(t=this.refs.members)?t.isEmpty():void 0)},onAccept:function(e){return this.refs.members.getFinalData(function(e){return function(i){var r,a,l;return l=i.emails,a=i.custom_message,r=e._canAccept(),e.setState({canAccept:r}),r?(e.setState({submitting:!0}),s.WebRequest({url:"/account/team/add_users",subject_user:b.work_user,data:{emails:l,custom_message:a,team_id:b.team_id},complete:function(){return null!=e.refs.modal?e.setState({submitting:!1}):void 0},success:function(n){var i,r,s,a,u;return n=JSON.parse(n),a=t.values(n.users),u=void 0,1===a.length?u=v("Member invited."):a.length>1&&(u=v("Members invited.")),u?(o.success(u),f.log("team_member_invited_to_team_while_sharing",s={sharing_type:e.props.sharingType,num_users_invited_to_team:null!=l?l.length:void 0}),"function"==typeof(i=e.props).onDidAccept&&i.onDidAccept(),e.refs.modal.close(),"function"==typeof(r=e.props).onDidClose?r.onDidClose():void 0):o.error()},error:function(e){return"rate-limit"===e.getResponseHeader("x-dropbox-app-error")?o.error(new n(v('%(team_name)s has reached the maximum number of team members allowed on Dropbox Basic. Please <a href="/business/contact">contact sales</a> to add more members to your team.').format({team_name:b.team_name}))):o.error()}})):void 0}}(this))},onDidDismiss:function(){var e,t;return"function"==typeof(e=this.props).onDidDismiss&&e.onDidDismiss(),"function"==typeof(t=this.props).onDidClose?t.onDidClose():void 0},onMembersFormChange:function(){return this.setState({canAccept:this._canAccept()})},componentDidMount:function(){var e,t,n;return f.log("team_member_saw_suggestions_while_sharing",e={sharing_type:this.props.sharingType,num_users_shared:null!=(t=this.props.usersSharedOnFolder)?t.length:void 0,num_users_suggested_to_team:null!=(n=this.props.suggestedUsersToInviteToTeam)?n.length:void 0}),s.WebRequest({url:"/team/saw_suggest_team_invite_modal"})},render:function(){var t,n;return n=function(){var e,n,i,o;for(i=this.props.suggestedUsersToInviteToTeam,o=[],e=0,n=i.length;n>e;e++)t=i[e],o.push(new _({email:t,type:l.EMAIL}));return o}.call(this),e.createElement(h,{className:"suggest-team-invite-modal",title:v("Do you want to invite these people to join your “%(team_name)s” team?").format({team_name:this.props.teamName}),acceptButtonText:v("Invite"),dismissButtonText:v("No thanks"),acceptButtonDisabled:!this.state.canAccept,submitting:this.state.submitting,onAccept:this.onAccept,onDismissCompleted:this.onDidDismiss,autoClose:!1,ref:"modal"},e.createElement(u,{ref:"members",errorMessageSpaceFixed:!0,invitationContext:u.InvitationContexts.existingTeam,onChange:this.onMembersFormChange,user:b.work_user,populatedContacts:n,autofocusTokenizer:!0}))}})})}.call(this),function(){define("modules/clean/teams/team_assume_user_personal_locked_modal",["external/react","modules/core/i18n","modules/clean/react/modal"],function(e,t,n){var i,o,r,s,a,l,u;return s=t._,l=t.render_sentences,u=t.ungettext,o=n.Modal,r=n.SimpleModal,a=e.DOM,i=e.createClass({displayName:"AssumePersonalLockedModal",statics:{show:function(e){return o.showInstance(i(e))}},propTypes:{displayName:e.PropTypes.string,teamName:e.PropTypes.string},_close:function(e){return e.preventDefault(),o.close()},_getModalProps:function(){return{title:s("Personal account not accessible"),acceptButtonText:s("Close"),dismissButtonText:null,onAccept:this._close}},render:function(){return o(this._getModalProps(),a.div({className:"team-assume-user-modal"},s("%(display_name)s’s personal account isn’t managed by the %(team_name)s team, so its contents aren’t accessible to admins.").format({display_name:this.props.displayName,team_name:this.props.teamName})))}}),{AssumePersonalLockedModal:i}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function i(){this.constructor=e}for(var o in t)n.call(t,o)&&(e[o]=t[o]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},n={}.hasOwnProperty;define("modules/clean/teams/team_folder_modal",["modules/core/browser","modules/clean/components/ajax_form","modules/clean/dbmodal"],function(n,i,o){var r,s;return r=o.DBModal,s=function(o){function r(){return this.on_confirm_button_click=e(this.on_confirm_button_click,this),this._$form=e(this._$form,this),r.__super__.constructor.apply(this,arguments)}return t(r,o),r.prototype._$form=function(){return this.$modal_window.find(".new_team_folder_form")},r.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this._$form().submit()},r.prototype.on_show=function(){var e;return e=this._$form(),new i(e),e.on(i.SUCCESS_EVENT,function(e){return function(t,i){return e.options.open_created_folder?n.redirect(i.sf_info.href):n.reload()}}(this)),this.options.back_fn?this.$modal_window.find("a.back").on("click",function(e){return function(t){return e.options.back_fn(t,e)}}(this)):void 0},r}(r)})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/tokenizer",["external/react","jquery","external/underscore","modules/clean/keycode","modules/clean/typeahead"],function(t,n,i,o,r){var s,a,l,u,c;return l=r.TypeaheadSelector,c=t.DOM,u=t.addons.classSet,s=t.createClass({displayName:"Token",propTypes:{className:t.PropTypes.string,data:t.PropTypes.any,onRemove:t.PropTypes.func},render:function(){var e;return e={"tokenizer-token":!0},e[this.props.className]=!0,c.a(n.extend({tabIndex:-1},this.props,{className:u(e)}),String(this.props.data),this._makeCloseButton())},_makeCloseButton:function(){return this.props.onRemove?c.span({className:"tokenizer-token-close",onClick:function(e){return function(){return e.props.onRemove(),!1}}(this),dangerouslySetInnerHTML:{__html:"&nbsp;"}}):""}}),a=t.createClass({displayName:"Tokenizer",propTypes:{customClass:t.PropTypes.string,dataSource:t.PropTypes.object.isRequired,initialInputText:t.PropTypes.string,logTokenChangeEvent:t.PropTypes.func,onContentsChange:t.PropTypes.func,onTokensAdd:t.PropTypes.func,onTokenRemove:t.PropTypes.func,placeholderText:t.PropTypes.string,populatedTokenData:t.PropTypes.array,renderToken:t.PropTypes.func.isRequired,renderTokenHover:t.PropTypes.func,renderInput:t.PropTypes.func.isRequired,renderSelector:t.PropTypes.func.isRequired,stringTokenizer:t.PropTypes.func.isRequired,tokenSpacing:t.PropTypes.number,focusOnMount:t.PropTypes.bool,tabIndex:t.PropTypes.number},getDefaultProps:function(){return{initialInputText:"",renderInput:function(){return c.input()},renderSelector:function(){return l()},renderToken:function(e){return s({data:e})},stringTokenizer:function(e,t){var n,i;return n=e.split(","),i=t?"":n.pop(),{tokens:n,value:i}},tokenSpacing:3,focusOnMount:!1}},getInitialState:function(){return this.tokenData=[],{queryResults:null,tokenData:this.tokenData,selectedTokenIndex:null,inputWidth:150,numLines:1}},componentDidMount:function(){var e,t;return setTimeout(this._resizeTokenizerInput,0),this.refs.input.getDOMNode().value=this.props.initialInputText,n(this.refs.tokenizer_input.getDOMNode()).on("keydown",this._proxyKeys),document.addEventListener("click",this._handleDocumentClick,!1),this.props.focusOnMount&&this.refs.input.getDOMNode().focus(),"function"==typeof(e=this.props.dataSource).registerForUpdates&&e.registerForUpdates(this._dataUpdatedCallback),(null!=(t=this.props.populatedTokenData)?t.length:void 0)>0?this._addTokens(this.props.populatedTokenData,!1,null):void 0},componentWillUnmount:function(){return n(this.refs.tokenizer_input.getDOMNode()).off("keydown",this._proxyKeys),document.removeEventListener("click",this._handleDocumentClick,!1)},componentDidUpdate:function(){return this._resizeTokenizerInput()},render:function(){var e,n;return e={"react-tokenizer":!0},null!=this.props.customClass&&(e[this.props.customClass]=null!=this.props.customClass),n={padding:this.props.tokenSpacing,paddingRight:0,maxHeight:this.props.tokenSpacing+3*(this.props.tokenSpacing+29)+14+2},this.state.numLines>3&&(n.overflowY="auto",n.overflowX="visible"),c.div({onClick:this._handleMyClick,className:t.addons.classSet(e)},c.div({className:"tokenizer-input",ref:"tokenizer_input",style:n},c.div({className:"token-container",style:{marginLeft:-this.props.tokenSpacing,marginBottom:-this.props.tokenSpacing}},this._renderTokens(),this._renderInput())),this._renderSelector())},serializeInputData:function(){return{tokens:this.tokenData,value:this.refs.input.getDOMNode().value}},tokenizeAll:function(){var e,t;return e=this.refs.input.getDOMNode(),t=this.props.stringTokenizer(e.value,!0).tokens,t.length>0&&this._addTokens(t,!1),e.value="",this.refs.selector.close()},addExternalTokens:function(e){this._addTokens(e,!1,null),this.refs.selector.close()},queryDataSource:function(t){return this.props.dataSource.query(t,function(n){return function(o){var r,s;return t||(o=null),r=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},s=i.map(n.tokenData,r),o=null!=o?o.filter(function(t){var n;return n=r(t),e.call(s,n)<0}):null,n.setState({queryResults:o})}}(this))},_dataUpdatedCallback:function(){var e;return this.isMounted()?(null!=(e=this.refs.selector)&&"function"==typeof e.reset&&e.reset(),this.refs.input.getDOMNode().focus(),this.queryDataSource(this.refs.input.getDOMNode().value)):void 0},_addTokens:function(t,n,o){var r,s,a,l,u,c,d,p,_,h,m,f,v,g,y,b,w;for(null==n&&(n=!1),null==o&&(o=null),u=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},w=i.map(this.tokenData,u),m=[],c=0,_=t.length;_>c;c++)b=t[c],p=u(b),e.call(w,p)<0&&(m.push(b),w.push(p));for(this.tokenData=this.tokenData.concat(m),this.setState({tokenData:this.tokenData}),"function"==typeof(r=this.props).onTokensAdd&&r.onTokensAdd(m),"function"==typeof(s=this.props).onContentsChange&&s.onContentsChange(this.tokenData,null!=(f=this.refs.input)?f.getDOMNode().value:void 0),l=n?{search_expr:o,selected_pos:(null!=(v=this.refs.selector)?v.state.selectionIndex:void 0)||0,num_query_results:null!=(g=this.state.queryResults)?g.length:void 0,did_select_suggestion:!0}:{did_select_suggestion:!1},y=[],d=0,h=m.length;h>d;d++)b=m[d],y.push("function"==typeof(a=this.props).logTokenChangeEvent?a.logTokenChangeEvent(b,!1,l):void 0);return y},_addToken:function(e,t,n){return null==t&&(t=!1),null==n&&(n=null),this._addTokens([e],t,n)},removeTokens:function(e){var t,n,i,o,r,s,a,l,u,c,d,p,_,h;for(h=this.state.selectedTokenIndex,_=[],s=0,u=e.length;u>s;s++)o=e[s],p=this.tokenData.indexOf(o),-1!==p&&(h===p?h=null:h>p&&(h-=1),this.tokenData.splice(p,1),_.push(o));for(r=this.refs.input.getDOMNode(),r.focus(),this._setSelectedToken(h),this.setState({tokenData:this.tokenData,queryResults:null}),a=0,c=_.length;c>a;a++)o=_[a],"function"==typeof(t=this.props).onTokenRemove&&t.onTokenRemove(o);for(l=0,d=_.length;d>l;l++)o=_[l],"function"==typeof(n=this.props).logTokenChangeEvent&&n.logTokenChangeEvent(o,!0);return"function"==typeof(i=this.props).onContentsChange?i.onContentsChange(this.tokenData,r.value):void 0},removeToken:function(e){return this.removeTokens([e])},replaceTokens:function(e){var t,n,o,r;return o=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},n=function(e){var t,n;return t=e[0],n=e[1],o(t)===o(n)},e.length===this.tokenData.length&&i.every(i.zip(this.tokenData,e),n)?void 0:(this.tokenData=e,this.setState({tokenData:e}),"function"==typeof(t=this.props).onContentsChange?t.onContentsChange(this.tokenData,null!=(r=this.refs.input)?r.getDOMNode().value:void 0):void 0)},_renderTokens:function(){var e,n,i,o,r,s,a,l,u,c,d,p;for(c=[],a=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},u=this.state.tokenData,r=s=0,l=u.length;l>s;r=++s)i=u[r],p=this.props.renderToken(i),d=this.state.selectedTokenIndex===r,o="function"==typeof(e=this.props).renderTokenHover?e.renderTokenHover(i):void 0,n=t.addons.classSet({selected:d,"c-title-bubble":null!=o,"c-title-bubble--s":null!=o}),c.push(t.addons.cloneWithProps(p,{ref:"token"+r,key:"token"+a(i),style:{margin:"0 0 "+this.props.tokenSpacing+"px "+this.props.tokenSpacing+"px"},className:n,"data-title":o,onClick:this._setSelectedToken.bind(this,r),onRemove:this.removeToken.bind(this,i),tokenSpacing:this.props.tokenSpacing}));return c},_renderSelector:function(){return t.addons.cloneWithProps(this.props.renderSelector(),{ref:"selector",queryOptions:this.state.queryResults,onSelect:this._onSelect,onClose:this._clearResults})},_renderInput:function(){var e;return e=this.state.tokenData.length?"":this.props.placeholderText,t.addons.cloneWithProps(this.props.renderInput(),{ref:"input",style:{width:this.state.inputWidth,marginLeft:this.props.tokenSpacing,marginBottom:this.props.tokenSpacing},onChange:this._textUpdated,placeholder:e,tabIndex:this.props.tabIndex,onClick:this._setSelectedToken.bind(this,null)})},_getTokenizerInput:function(){return this.refs.tokenizer_input},_getTokenComponents:function(){var e;return function(){var t,n,i;for(i=[],e=t=0,n=this.state.tokenData.length;n>=0?n>t:t>n;e=n>=0?++t:--t)i.push(this.refs["token"+e]);return i}.call(this).filter(function(e){return e})},_setSelectedToken:function(e){return null!=e?(this.refs["token"+e].getDOMNode().focus(),this.refs.selector.close()):this.refs.input.getDOMNode().focus(),this.setState({selectedTokenIndex:e})},_resizeTokenizerInput:function(){var e,t,n,i,o,r,s,a,l,u,c,d,p;for(i=function(e){return e.getDOMNode().clientWidth},t=80,d=i(this._getTokenizerInput()),n=this.props.tokenSpacing+2,e=this.props.tokenSpacing,a=0,p=this._getTokenComponents(),l=1,r=0,s=p.length;s>r;r++)u=p[r],c=i(u)+n,a+c+e>d&&(l+=1,a=0),a+=c;return o=d-a-e-2,t>o&&(l+=1,o=d-e),o!==this.state.inputWidth?this.setState({inputWidth:o,numLines:l}):void 0},_onSelect:function(e){var t;return t=this.refs.input.getDOMNode(),t.focus(),this._addToken(e,!0,t.value),t.value="",this.setState({queryResults:null})},_handleMyClick:function(e){var t;return"function"==typeof(t=e.nativeEvent).stopImmediatePropagation?t.stopImmediatePropagation():void 0},_handleDocumentClick:function(e){return this.refs.selector.close()},_proxyKeys:function(e){var t;if(this._shouldListenForTokenNavigation())switch(t=this.state.selectedTokenIndex,e.keyCode){case o.BACKSPACE:return void(null===t?this._setSelectedToken(this.state.tokenData.length-1):this.removeToken(this.state.tokenData[t]));case o.LEFT:return void(null===t?this._setSelectedToken(this.state.tokenData.length-1):t>0&&this._setSelectedToken(t-1));case o.RIGHT:if(null!==t)return void(t>=this.state.tokenData.length-1?this._setSelectedToken(null):this._setSelectedToken(t+1));break;case o.DELETE:if(null!==t)return void this.removeToken(this.state.tokenData[t])}return this.refs.selector.onKeyDown(e),e.isDefaultPrevented()?void 0:e.keyCode===o.TAB&&""!==this.refs.input.getDOMNode().value?(this.tokenizeAll(),e.preventDefault()):void 0},_shouldListenForTokenNavigation:function(){var e;return this.state.tokenData.length?(e=this.refs.input.getDOMNode(),0===e.selectionStart&&0===e.selectionEnd):!1},_textUpdated:function(){var e,t,n,i,o,r;return t=this.refs.input.getDOMNode(),n=t.value,i=this.props.stringTokenizer(n),o=i.tokens,r=i.value,r!==n&&(t.value=r,r||this.refs.selector.close()),o.length>0?this._addTokens(o,!1):"function"==typeof(e=this.props).onContentsChange&&e.onContentsChange(this.tokenData,r),this.queryDataSource(r)},_clearResults:function(){return this.setState({queryResults:null})}}),{Token:s,Tokenizer:a}})}.call(this),function(){define("modules/clean/top_notif",["jquery","modules/clean/ajax"],function(e,t){var n,i,o,r,s;return s={HIDE_EVENT:"db:topnotificationbar:hide",hide:function(){return e("#top-notification-bar-container").hide(),e("body").removeClass("top-notification-bar"),e(document).trigger(this.HIDE_EVENT)}},n={init:function(){return e(".eu-bar-dismiss").on("click",function(e){return e.preventDefault(),s.hide(),t.AuthenticatedRequest({url:"/dismiss_eu_cookie_notification"})})}},i={init:function(){return e(".expired-ios-bar-dismiss").on("click",function(e){return e.preventDefault(),s.hide(),t.AuthenticatedRequest({url:"/dismiss_expired_ios_notification"})})}},o={init:function(){return e("#locale-switch-banner-dismiss").on("click",function(e){return e.preventDefault(),s.hide(),t.AuthenticatedRequest({url:"/dismiss_locale_switch_banner"})})}},r={init:function(){return e("#super-inactive-recover-bar-dismiss").on("click",function(e){return e.preventDefault(),s.hide(),t.AuthenticatedRequest({url:"/dismiss_super_inactive_recover_bar"})})}},{TopNotificationBar:s,EUCookieNotificationBar:n,ExpiredIOSNotificationBar:i,LocaleSwitchBar:o,SuperInactiveRecoverBar:r}})}.call(this),function(){define("modules/clean/typeahead",["external/react","external/underscore","modules/clean/fuzzy","modules/clean/keycode"],function(e,t,n,i){var o,r,s,a,l;return l=e.DOM,r=function(){function e(e){this.local=(null!=e?e:{}).local}return e.prototype.query=function(e,i){var o;return o=t.map(n.filter(e,this.local),function(e){return e.original}),i(o)},e}(),a={getInitialState:function(){return{selectionIndex:0}},getOptions:function(){var e;return this.props.queryOptions?(e=this.props.maxVisible||this.props.queryOptions.length,this.props.queryOptions.slice(0,e)):[]},renderOptions:function(){var t,n,i,o,r,s,a,l,u;
for(u=[],l=this.getOptions(),r=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},o=i=0,s=l.length;s>i;o=++i)n=l[o],t={selected:this.state.selectionIndex===o,"typeahead-option":!0,"u-pad-xs":!0},a=this.renderOption(n),u.push(e.addons.cloneWithProps(a,{className:e.addons.classSet(t),key:"option"+r(n),onMouseEnter:this._hover.bind(this,o),onClick:this.onSelect.bind(this,n)}));return u},onSelect:function(e){return this.props.onSelect(e),this.reset()},renderOption:function(e){return this.props.renderQueryOption(e)},onKeyDown:function(e){switch(e.keyCode){case i.UP:return this._navigate(-1),e.preventDefault();case i.DOWN:return this._navigate(1),e.preventDefault();case i.ENTER:return this._selectSelectionIndex(e);case i.ESC:if(Boolean(this.props.queryOptions))return this.close(),e.preventDefault();break;case i.TAB:return this._selectSelectionIndex(e);default:return this.reset()}},_selectSelectionIndex:function(e){var t,n;return n=this.getOptions(),n.length&&(t=this.state.selectionIndex,-1!==t)?(this.onSelect(n[t]),e.preventDefault()):void 0},reset:function(){return this._changeSelectionIndex(0)},close:function(){var e;return"function"==typeof(e=this.props).onClose&&e.onClose(),this.reset()},_hover:function(e){return this._changeSelectionIndex(e)},_navigate:function(e){var t,n,i;return(n=this.getOptions().length)?(t=this.state.selectionIndex+e,i=n+1,-1>t?t+=i:t>=n&&(t-=i),this._changeSelectionIndex(t)):void 0},_changeSelectionIndex:function(e){return e!==this.state.selectionIndex&&"function"==typeof this.onSelectionIndexChange&&this.onSelectionIndexChange(e),this.setState({selectionIndex:e})}},o=e.createClass({displayName:"Autocomplete",propTypes:{customClass:e.PropTypes.string,dataSource:e.PropTypes.object.isRequired,onSelect:e.PropTypes.func,onChange:e.PropTypes.func,placeholder:e.PropTypes.string,renderCompletionText:e.PropTypes.func.isRequired,renderInput:e.PropTypes.func.isRequired,renderSelector:e.PropTypes.func.isRequired},getDefaultProps:function(){return{onSelect:function(e){},onChange:function(e){},renderCompletionText:function(e){return String(e)},renderInput:function(){return l.input()},renderSelector:function(){return e.createElement(s)}}},getInitialState:function(){return{queryResults:null}},render:function(){var t;return t={},t[this.props.customClass]=null!=this.props.customClass,l.div({className:e.addons.classSet(t)},this._renderInput(),this._renderSelector())},_renderInput:function(){return e.addons.cloneWithProps(this.props.renderInput(),{ref:"input",onChange:this._inputChanged,onKeyDown:this._proxyKeys,placeholder:this.props.placeholder})},_renderSelector:function(){return e.addons.cloneWithProps(this.props.renderSelector(),{ref:"selector",queryOptions:this.state.queryResults,onSelect:this._autocomplete,onClose:this._clearResults})},_inputChanged:function(){var e;return e=this.refs.input.getDOMNode().value,this.props.onChange(e),this.props.dataSource.query(e,function(t){return function(n){return e||(n=[]),t.setState({queryResults:n})}}(this)),this.refs.selector.reset()},_proxyKeys:function(e){return this.refs.selector.onKeyDown(e)},_autocomplete:function(e){var t;return t=this.refs.input.getDOMNode(),t.focus(),t.value=this.props.renderCompletionText(e),this.props.onSelect(e),this._clearResults()},_clearResults:function(){return this.setState({queryResults:null})}}),s=e.createClass({displayName:"TypeaheadSelector",mixins:[a],propTypes:{customClass:e.PropTypes.string,maxVisible:e.PropTypes.number,onClose:e.PropTypes.func.isRequired,onSelect:e.PropTypes.func.isRequired,queryOptions:e.PropTypes.array,renderQueryOption:e.PropTypes.func.isRequired},getDefaultProps:function(){return{maxVisible:7,onClose:function(){},onSelect:function(e){},renderQueryOption:function(e){return l.li({},String(e))}}},render:function(){var t;return this.getOptions().length?(t={"typeahead-selector":!0},t[this.props.customClass]=null!=this.props.customClass,l.ul({className:e.addons.classSet(t)},this.renderOptions())):l.div({})}}),{Autocomplete:o,DataSource:r,TypeaheadSelector:s,TypeaheadSelectorMixin:a}})}.call(this),function(){define("modules/clean/unity/check_file_cache",["modules/clean/unity/features"],function(e){var t;if(null!=e)return t=function(){function t(){}return t._cache={},t.is_cached_and_locally_available=function(t,n){var i;return i=this._cache[e.server_path(t,n)],null!=i&&i.is_locally_available},t.get=function(t,n){return this._cache[e.server_path(t,n)]},t.set=function(e,t){return this._cache[e]=t},t.set_batch=function(e){var t,n,i;n=[];for(i in e)t=e[i],n.push(this._cache[i]=t);return n},t.clear=function(){return this._cache={}},t}(),__CONDITIONAL_JS__.UnityCheckFileCache=t,t})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/unity/connection",["jquery","modules/core/exception","modules/core/uri","modules/clean/ajax","modules/clean/gandalf_util","modules/clean/unity/connection_error","modules/clean/unity/logger","modules/clean/unity/versions","modules/clean/unity/web_socket","modules/clean/viewer"],function(n,i,o,r,s,a,l,u,c,d){var p;if(c.web_sockets_supported())return p=function(){function p(){this._on_response_timeout=e(this._on_response_timeout,this),this._on_message=e(this._on_message,this),this._set_connection_state=e(this._set_connection_state,this),this._on_error=e(this._on_error,this),this._on_close=e(this._on_close,this),s.getGandalfRule("unity-web-debug")&&(window.uc=this),this.client_version=null,this._on_open_callbacks=[],this._on_open_failed_callbacks=[],this._on_close_callbacks=[],this._pending_callbacks=[],this._response_callbacks={},this._ws=null,this._port=null,this._active_ports={},this._connection_state=p._CONNECTION_PENDING,this._current_message_id=1,this._permission_level=null,this.logger=new l,this._routes={check_unity_version:this._check_unity_version.bind(this),fetch_unity_nonce:this._fetch_unity_nonce.bind(this),complete_handshake:this._complete_handshake.bind(this)}}return p._CONNECTION_OPENED_STATE=0,p._VERSION_CHECK_STATE=1,p._FETCHING_NONCE_STATE=2,p._NONCE_RETURNED_TO_CLIENT_STATE=3,p._HANDSHAKE_COMPLETED_STATE=4,p._CONNECTION_PENDING=0,p._CONNECTION_ESTABLISHED=1,p._CONNECTION_CLOSED=2,p._CONNECTION_RETRYING=3,p._RESPONSE_TIMEOUT=5e3,p._MIN_PORT=17600,p._MAX_PORT=17602,p.SECURE_PERMISSION="secure",p.INSECURE_WEB_PERMISSION="insecure_web",p.INSECURE_CLIENT_PERMISSION="insecure_client",p.INSECURE_PERMISSION="insecure",p.prototype.start=function(){return c.load_flash_policy_if_needed()?this._attempt_handshake():void this._set_connection_state(p._CONNECTION_CLOSED)},p.prototype._attempt_handshake=function(){var e,t,n,r,s,a,l,u;try{for(r=n=s=p._MIN_PORT,a=p._MAX_PORT;a>=s?a>=n:n>=a;r=a>=s?++n:--n)this._active_ports[r]=!0,l={scheme:"ws",authority:"127.0.0.1:"+r.toString(),path:"/ws"},u=c.create(o(l).toString()),u.onmessage=this._on_message({ws:u,port:r,state:p._CONNECTION_OPENED_STATE,client_version:null,client_has_auth:null}),u.onclose=this._on_close(r),u.onerror=this._on_error(r)}catch(t){e=t,this.logger.report_event("unity_failure",{message:"WebSocket creation failed. Message: "+e.message,error_name:e.name,port:r,stack:i.stackTrace()}),this._set_connection_state(p._CONNECTION_CLOSED)}return this.logger.report_event("handshake_started")},p.prototype._on_close=function(e){return function(t){return function(n){var i;return 1e3===(i=n.code)||1001===i||1005===i||1006===i||t.logger.report_event("unity_failure",{message:"WebSocket closed. Code: "+n.code+". Reason: "+n.reason,port:e}),t._close_port(e)}}(this)},p.prototype._on_error=function(e){return function(t){return function(n){return t.logger.report_event("unity_failure",{message:"WebSocket error. Message: "+n.data,port:e}),t._close_port(e)}}(this)},p.prototype._close_port=function(e){return e in this._active_ports&&(delete this._active_ports[e],n.isEmptyObject(this._active_ports))?this._connection_state===p._CONNECTION_ESTABLISHED?this._retry_connection():this._set_connection_state(p._CONNECTION_CLOSED):void 0},p.prototype._retry_connection=function(){return this.logger.report_event("connection_retrying"),this._set_connection_state(p._CONNECTION_RETRYING),this.client_version=this._ws=this._port=null,this._attempt_handshake()},p.prototype._set_connection_state=function(e){var t,n,o,r,s,l,u,c,d,_,h,m,f,v,g,y,b,w,E,T;if(e!==this._connection_state){if(_=this._connection_state,i.assert(_!==p._CONNECTION_CLOSED,"Shouldn't unclose a closed connection."),this._connection_state=e,e===p._CONNECTION_ESTABLISHED){if(i.assert(this._is_connection_in_progress(_),"Can only establish from pending or retrying."),this.logger.report_event("handshake_complete"),_===p._CONNECTION_PENDING)for(v=this._on_open_callbacks,r=0,u=v.length;u>r;r++)(m=v[r])();for(E=[];this._pending_callbacks.length;)g=this._pending_callbacks.pop(),n=g[0],o=g[1],this.is_ready()?E.push(n()):E.push("function"==typeof o?o(a.UNEXPECTED_ERROR):void 0);return E}if(e!==p._CONNECTION_RETRYING){if(e===p._CONNECTION_CLOSED){if(_===p._CONNECTION_PENDING)for(this.logger.report_event("connection_not_established"),y=this._on_open_failed_callbacks,s=0,c=y.length;c>s;s++)(f=y[s])();else if(_===p._CONNECTION_RETRYING)for(this.logger.report_event("connection_terminated"),b=this._on_close_callbacks,l=0,d=b.length;d>l;l++)(h=b[l])();else i.assert(!1,"CONNECTION_CLOSED can only be set from PENDING or RETRYING");for(T=[];this._pending_callbacks.length;)w=this._pending_callbacks.pop(),t=w[0],o=w[1],T.push("function"==typeof o?o(a.CONNECTION_CLOSED):void 0);return T}return i.assert(!1,"Changing connection_state to CONNECTION_PENDING not supported.")}}},p.prototype._on_message=function(e){return function(t){return function(n){var i,o,r,s,a,l;return o=JSON.parse(n.data),null==o.func||null==(null!=(r=o.header)?r.message_id:void 0)||null==(null!=(s=o.header)?s.should_respond:void 0)?void t._terminate_handshake(e.ws,"Malformed message from client.",{message:n.data}):(null!=(null!=(a=o.header)?a.log_data:void 0)&&t.logger.update(o.header.log_data),t.logger.update({port:e.port}),"response"===o.func?t._on_response(o.header.message_id,o.data):(i=t._routes[o.func],null==i?void t._terminate_handshake(e.ws,"Unknown function.",{function:o.func}):(l=t.is_ready()?i(o.data):i(e,o.data),o.header.should_respond?t.send("response",l,null,null,o.header.message_id):void 0)))}}(this)},p.prototype.send=function(e,t,n,i,o){return null==t&&(t=null),null==n&&(n=null),null==i&&(i=null),null==o&&(o=null),this._send_with_ws(this._ws,e,t,n,i,o)},p.prototype._send_with_ws=function(e,t,n,o,r,s){var l,u,c,d;null==n&&(n=null),null==o&&(o=null),null==r&&(r=null),null==s&&(s=null),null==s&&(s=this._current_message_id,i.assert(this._current_message_id%2===1,"Web-initiated message_ids should remain odd"),this._current_message_id+=2),null!==o&&(d=window.setTimeout(this._on_response_timeout(s),p._RESPONSE_TIMEOUT),this._response_callbacks[s]=[o,r,d]),c={func:t,header:{message_id:s,should_respond:null!==o,log_data:this.logger.get_log_data_for_client()}},null!=n&&(c.data=n);try{return e.send(JSON.stringify(c))}catch(e){return l=e,this.logger.report_event("unity_failure",{message:"WebSocket send failed. Message: "+l.message,error_name:l.name}),"function"==typeof r?r(a.COULD_NOT_SEND):void 0}},p.prototype._on_response=function(e,t){var n,i,o,r;return e in this._response_callbacks?(i=this._response_callbacks[e],o=i[0],n=i[1],r=i[2],delete this._response_callbacks[e],window.clearTimeout(r),o(t)):void 0},p.prototype._on_response_timeout=function(e){return function(t){return function(){var n,i,o;return o=t._response_callbacks[e],n=o[0],i=o[1],n=o[2],delete t._response_callbacks[e],"function"==typeof i?i(a.CONNECTION_TIMEOUT):void 0}}(this)},p.prototype._check_unity_version=function(e,t){var n;return e.state!==p._CONNECTION_OPENED_STATE?void this._terminate_handshake(e.ws,"Handshake version check at wrong time of protocol."):(e.state=p._VERSION_CHECK_STATE,e.client_version=t.client_version,t.client_version<u.UNITY_HANDSHAKE?void this._terminate_handshake(e.ws,"Client version is too old."):(n=d.get_viewer().is_signed_in,t.client_version<u.PERMISSION_LEVELS&&!n?void this._terminate_handshake(e.ws,"Client version is too old to support insecure web connections."):(this.logger.report_event("handshake_version_check"),t.client_version>=u.PERMISSION_LEVELS?this._send_with_ws(e.ws,"initiate_handshake",{secure_web:n}):this._send_with_ws(e.ws,"initiate_handshake"))))},p.prototype._fetch_unity_nonce=function(e,t){return e.state===p._VERSION_CHECK_STATE?(e.state=p._FETCHING_NONCE_STATE,this.logger.report_event("handshake_fetch_nonce"),this._retrieve_unity_nonce(e,t.nonce_key)):this._terminate_handshake(e.ws,"Fetch Unity nonce at wrong time of protocol.")},p.prototype._retrieve_unity_nonce=function(e,t){return r.WebRequest({url:o({path:"/retrieve_unity_nonce"}),dataType:"json",data:{nonce_key:t},success:function(t){return function(n){var o;switch(n.status){case"OK":return e.state=p._NONCE_RETURNED_TO_CLIENT_STATE,e.client_version>=u.PORT_CHECK&&(i.assert(n.message.client_port,"Port check must happen in version "+e.client_version),n.message.client_port!==e.port)?void t._terminate_handshake(e.ws,"Mismatched ports.",{client_port:n.message.client_port,web_port:e.port}):(e.client_has_auth=n.message.client_has_auth,o=d.get_viewer().is_signed_in,e.client_has_auth&&o?t._permission_level=p.SECURE_PERMISSION:(i.assert(e.client_version>=u.PERMISSION_LEVELS,"Insecure connections only supported by client_version >= "+u.PERMISSION_LEVELS+"."),t._permission_level=e.client_has_auth?p.INSECURE_WEB_PERMISSION:o?p.INSECURE_CLIENT_PERMISSION:p.INSECURE_PERMISSION),t.logger.update({unity_permission_level:t._permission_level}),t.logger.report_event("handshake_nonce_sent_to_unity_server"),t._send_with_ws(e.ws,"verify_unity_nonce",{nonce:n.message.nonce}));case"MISMATCHED_USER_IDS":return t._terminate_handshake(e.ws,"Mismatched user_ids.",{client_user_ids:n.message.client_user_ids,web_user_ids:n.message.web_user_ids});case"INVALID":return t._terminate_handshake(e.ws,"Could not find nonce with given nonce_key.");case"AUTH_REQUIRED":return t._terminate_handshake(e.ws,"Did not have the necessary authentication to retrieve nonce.")}}}(this),error:function(t){return function(n,i,o){return t._terminate_handshake(e.ws,"Unable to retrieve nonce from server",{status:i,error_string:o})}}(this)})},p.prototype._complete_handshake=function(e,t){var n;return e.state===p._NONCE_RETURNED_TO_CLIENT_STATE&&t.is_success?(e.state=p._HANDSHAKE_COMPLETED_STATE,this._connection_state===p._CONNECTION_CLOSED?this._terminate_handshake(e.ws,"No more handshakes are allowed to complete."):null!=this._ws?(n="Only one Unity handshake can succeed! There's likely a MITM attack, so close all connections.",this._terminate_handshake(e.ws,n),this._terminate_handshake(this._ws,n),this.client_version=null,this._ws=null,this._port=null,this._set_connection_state(p._CONNECTION_CLOSED)):(this.client_version=e.client_version,this._ws=e.ws,this._port=e.port,this._set_connection_state(p._CONNECTION_ESTABLISHED))):this._terminate_handshake(e.ws,"Unable to complete handshake.")},p.prototype._terminate_handshake=function(e,t,i){var o;return null==i&&(i=null),o={message:t},null!=i&&n.extend(o,i),s.getGandalfRule("unity-web-debug")&&console.error(o),this.logger.report_event("unity_failure",o),e.close()},p.prototype._is_connection_in_progress=function(e){return e===p._CONNECTION_PENDING||e===p._CONNECTION_RETRYING},p.prototype.add_on_open_callback=function(e){return this._on_open_callbacks.push(e)},p.prototype.add_on_open_failed_callback=function(e){return this._on_open_failed_callbacks.push(e)},p.prototype.add_on_close_callback=function(e){return this._on_close_callbacks.push(e)},p.prototype.call_when_ready=function(e,t){return null==t&&(t=null),this.is_ready()?e():this._is_connection_in_progress(this._connection_state)?this._pending_callbacks.push([e,t]):"function"==typeof t?t(a.CONNECTION_CLOSED):void 0},p.prototype.is_ready=function(){var e;return(null!=(e=this._ws)?e.readyState:void 0)===WebSocket.OPEN&&this._connection_state===p._CONNECTION_ESTABLISHED},p.prototype.feature_supported=function(e,n){var o;return i.assert(null!==this._permission_level,"Connection is not ready."),this.client_version<e?!1:(o=this._permission_level,t.call(n,o)>=0)},p}()})}.call(this),function(){define("modules/clean/unity/connection_error",[],function(){var e;return e=function(){function e(){}return e.CONNECTION_TIMEOUT="connection_timeout",e.CONNECTION_CLOSED="connection_closed",e.COULD_NOT_SEND="could_not_send",e.UNEXPECTED_ERROR="unexpected_error",e}()})}.call(this),function(){define("modules/clean/unity/features",["jquery","modules/clean/ajax","modules/clean/filepath","modules/clean/unity/connection","modules/clean/unity/versions","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,i,o,r,s,a,l){var u;if(null!=i)return u=function(){function u(){}return u._uc=new i,u._has_handshake_started=!1,u._start_handshake_if_needed=function(){return this._has_handshake_started?void 0:(this._uc.start(),this._has_handshake_started=!0)},u._cached_file_browser_display_name=null,u.continue_as_user=function(e,t,n,r){return null==r&&(r=null),this._start_handshake_if_needed(),this._uc.call_when_ready(function(s){return function(){return s._uc.feature_supported(o.WEB_DESTINY,[i.INSECURE_WEB_PERMISSION])?(s._uc.logger.report_event("continue_as_user",{browser:e,refresh_token:t}),s._uc.send("continue_as_user",{browser:e,refresh_token:t},n,r)):void 0}}(this),r)},u.continue_as_user_direct=function(e,t){return null==t&&(t=null),this._start_handshake_if_needed(),this._uc.call_when_ready(function(n){return function(){return n._uc.feature_supported(o.WEB_DESTINY_V2,[i.INSECURE_WEB_PERMISSION])?(n._uc.logger.report_event("continue_as_user_direct"),n._uc.send("continue_as_user_direct",null,e,t)):void 0}}(this),t)},u.web_destiny_info=function(e,t){return null==t&&(t=null),this._start_handshake_if_needed(),this._uc.call_when_ready(function(n){return function(){return n._uc.feature_supported(o.WEB_DESTINY_V2,[i.INSECURE_WEB_PERMISSION])?(n._uc.logger.report_event("web_destiny_info"),n._uc.send("web_destiny_info",null,e,t)):void 0}}(this),t)},u.client_supports_open_in_file_browser=function(){return this._uc.feature_supported(o.OPEN_IN_FILE_BROWSER,[i.SECURE_PERMISSION])},u.open_file=function(e,s,a,u,c,d){var p;return null==c&&(c=null),null==d&&(d=!1),this._start_handshake_if_needed(),p=this.server_path(e,s),this._uc.call_when_ready(function(e){return function(){var s;return e._uc.feature_supported(o.UNITY_HANDSHAKE,[i.SECURE_PERMISSION])?(e._uc.logger.report_event("open_file",{user_id:a,path_id:p,file_extension:n.file_extension_for_logging(p),in_file_browser:d}),t.AuthenticatedRequest({url:l({path:"/unity_open_log"}),data:{user_id:a,server_path:p,file_extension:n.file_extension_for_logging(p),in_file_browser:d,unity_session_id:e._uc.logger.unity_session_id(),buildno:e._uc.logger._data.buildno,host_id:e._uc.logger._data.host_id}}),s={server_path:p,user_id:a},e._uc.client_version>=o.OPEN_IN_FILE_BROWSER?s.in_file_browser=d:r.assert(!d,"The connected client doesn't support opening in file browser."),e._uc.send("open_file",s,u,c)):void 0}}(this),c)},u.standard_open_file_handler=function(e){return e?void 0:a.error(s._("Error opening file"))},u.check_file=function(e,t,r,s,a){var l,u;return null==a&&(a=null),this._start_handshake_if_needed(),u=this.server_path(e,t),l=function(e){return function(t){return e._check_file_deprecated_on_client()&&(t={is_locally_available:t}),s(t)}}(this),this._uc.call_when_ready(function(e){return function(){return e._uc.feature_supported(o.UNITY_HANDSHAKE,[i.SECURE_PERMISSION])?(e._uc.logger.report_event("check_file",{user_id:r,path_id:u,file_extension:n.file_extension_for_logging(u)}),e._uc.send("check_file",{server_path:u,user_id:r},l,a)):void 0}}(this),a)},u.add_on_ready_callback=function(e){return this._uc.call_when_ready(e)},u.check_file_batch=function(t,r,s,a){var l,u,c,d,p;return null==a&&(a=null),l=e.Deferred(),this._start_handshake_if_needed(),p=function(){var e,n,i;for(i=[],e=0,n=t.length;n>e;e++)c=t[e],i.push(this.server_path(c.ns_id,c.ns_path));return i}.call(this),d=function(e){return function(t){var n,i;if(e._check_file_deprecated_on_client())for(n in t)i=t[n],t[n]={is_locally_available:i};return s(t),l.resolve(t)}}(this),u=function(e){return"function"==typeof a&&a(e),l.reject(e)},this._uc.call_when_ready(function(e){return function(){var t;return e._uc.feature_supported(o.UNITY_HANDSHAKE,[i.SECURE_PERMISSION])?(e._uc.logger.report_event("check_file_batch",{user_id:r,path_ids:p,file_extensions:function(){var e,i,o;for(o=[],e=0,i=p.length;i>e;e++)t=p[e],o.push(n.file_extension_for_logging(t));return o}()}),e._uc.send("check_file_batch",{server_paths:p,user_id:r},d,u)):void 0}}(this),u),l.promise()},u.file_browser_display_name=function(e,t){var n,r;return null==t&&(t=null),null!=this._cached_file_browser_display_name?void e(this._cached_file_browser_display_name):(n=function(t){return function(n){return t._cached_file_browser_display_name=n,e(n)}}(this),this._start_handshake_if_needed(),r=function(r){return function(){return r._uc.feature_supported(o.CHECK_FILE_RETURNS_OBJ,[i.SECURE_PERMISSION])?(r._uc.logger.report_event("file_browser_display_name"),r._uc.send("file_browser_display_name",null,n,t)):e(null)}}(this),this._uc.call_when_ready(r,t))},u._check_file_deprecated_on_client=function(){return o.UNITY_HANDSHAKE<=this._uc.client_version&&this._uc.client_version<o.CHECK_FILE_RETURNS_OBJ},u.server_path=function(e,t){return e+":"+t},u}(),__CONDITIONAL_JS__.UnityFeatures=u,u})}.call(this),function(){define("modules/clean/unity/flash_config",["external/flash_detect","modules/clean/gandalf_util","modules/constants/static","modules/core/browser"],function(e,t,n,i){return window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0,window.DefaultWebSocket=window.WebSocket,!i.safari_version_at_most(8)&&e.versionAtLeast(10,3)&&(window.WEB_SOCKET_FORCE_FLASH=!0),window.WEB_SOCKET_SWF_LOCATION=n.static_url_web_socket_swf,t.getGandalfRule("unity-web-debug")?void 0:window.WEB_SOCKET_LOGGER={log:function(){},error:function(){}}})}.call(this),function(){define("modules/clean/unity/logger",["jquery","modules/core/uri","modules/clean/ajax","modules/clean/gandalf_util","modules/clean/unity/versions"],function(e,t,n,i,o){var r;return r=function(){function r(){this._data={logging_source:"web",web_unity_version:o.LATEST}}return r.prototype.update=function(t){return e.extend(this._data,t)},r.prototype.report_event=function(e,o){return null==o&&(o=null),this._data.event_name=e,this._data.local_ts=(new Date).getTime()/1e3,this._data.extra=JSON.stringify(o||{}),n.WebRequest({url:t({path:"/unity_connection_log"}),data:this._data}),i.getGandalfRule("unity-web-debug")?console.log(this._data):void 0},r.prototype.get_log_data_for_client=function(){return{web_unity_version:this._data.web_unity_version,user_agent:window.navigator.userAgent}},r.prototype.unity_session_id=function(){return this._data.unity_session_id},r}()})}.call(this),function(){define("modules/clean/unity/versions",function(){var e;return e=function(){function e(){}return e.LATEST=9,e.INITIAL_UNITY=1,e.UNITY_HANDSHAKE=2,e.REUNITY=3,e.OPEN_IN_FILE_BROWSER=4,e.CHECK_FILE_RETURNS_OBJ=5,e.PERMISSION_LEVELS=6,e.WEB_DESTINY=7,e.WEB_DESTINY_V2=8,e.PORT_CHECK=9,e}()})}.call(this),function(){define("modules/clean/unity/web_socket",["modules/constants/env","modules/core/browser","modules/clean/unity/logger","external/web_socket"],function(e,t,n,i){var o,r;return o=e.IS_PROD?17603:17604,r=function(){function e(){}return e.create=function(e){return"function"==typeof i.__initialize&&i.__initialize(),new i(e)},e.load_flash_policy_if_needed=function(){var e;if(e=new n,null!=(null!=i?i.loadFlashPolicyFile:void 0))e.report_event("load_flash_policy_file"),i.loadFlashPolicyFile("xmlsocket://127.0.0.1:"+o);else{if(!t.safari_version_at_most(8))return e.report_event("unity_failure",{message:"Could not use WebSockets."}),!1;e.report_event("using_default_web_socket")}return!0},e.web_sockets_supported=function(){return null!=i},e}()})}.call(this),function(){define("modules/clean/unity_browse_interface",["jquery","modules/clean/unity/check_file_cache","modules/clean/unity/features"],function(e,t,n){var i;if(null!=t&&null!=n)return i=function(){function e(){}return e.BATCH_SIZE_LIMIT=100,e.CHECK_FILES_PADDING=50,e.check_file_callback=function(e){return t.set_batch(e)},e.browse_visible_change_callback=function(t,i,o,r){var s,a,l,u,c,d;if(t.length&&(u=Math.max(0,o-e.CHECK_FILES_PADDING),d=Math.min(t.length-1,r+e.CHECK_FILES_PADDING),a=t.slice(u,+d+1||9e9),l=e._get_files_to_check(a),l.length)){for(e._remove_unneeded_items_from_cache(a),c=[];l.length;)s=l.splice(0,e.BATCH_SIZE_LIMIT),c.push(n.check_file_batch(s,i,e.check_file_callback));return c}},e._get_files_to_check=function(e){var n;return function(){var i,o,r;for(r=[],i=0,o=e.length;o>i;i++)n=e[i],n.bytes>=0&&t.is_cached_and_locally_available(n.ns_id,n.ns_path)!==!0&&r.push(n);return r}()},e._remove_unneeded_items_from_cache=function(e){var i,o,r,s,a;for(o={},s=0,a=e.length;a>s;s++)r=e[s],t.is_cached_and_locally_available(r.ns_id,r.ns_path)===!0&&(i=t.get(r.ns_id,r.ns_path),o[n.server_path(r.ns_id,r.ns_path)]=i);return t.clear(),t.set_batch(o)},e}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/upsell/prompt_loader",["jquery","modules/clean/uirequest","modules/constants/viewer"],function(t,n,i){var o,r,s;return o=function(){function o(o,r,s,a){this._show_if_possible=e(this._show_if_possible,this),this._hide=e(this._hide,this),this._show=e(this._show,this),this._show_without_image=e(this._show_without_image,this),this._can_fit_without_image=e(this._can_fit_without_image,this),o&&(this.$ha_container=t("#ha-container"),this.$footer=t("#page-footer"),this.$window=t(window),this.$ha=null,this.$ha_clone=null,new n(this.$ha_container,"/prompt/ha",{data:{ref_controller:r,ref_action:s,campaign_id:a},subject_user:o,success:function(e){return function(n){var o,r;return e.$ha=e.$ha_container.find(".ha"),e.$ha.length?i.prompt_ha_hiding?(e.$ha_clone=e.$ha.clone(),e.$ha_container.append(e.$ha_clone),e._can_fit_without_image()?e._show_without_image():e._hide(),o=e.$ha_container.find("img"),r=0,o.load(function(){return r++,r===o.length?(t(window).resize(e._show_if_possible),e._show_if_possible()):void 0})):e._show():void 0}}(this)}))}return o.prototype._element_or_parent_is_fixed=function(e){return e.add(e.parents()).is(function(){return"fixed"===t(this).css("position")})},o.prototype._can_fit=function(){var e,t,n,i;return n=this.$ha.offset().top+this.$ha_clone.outerHeight(),t=this.$footer.outerHeight(),i=this.$window.height(),e=i>n+5+t,e||!this._element_or_parent_is_fixed(this.$ha)},o.prototype._can_fit_without_image=function(){return this.$ha_clone.addClass("no-image"),this._can_fit()},o.prototype._show_without_image=function(){return this.$ha.addClass("no-image"),this._show()},o.prototype._can_fit_with_image=function(){return this.$ha_clone.removeClass("no-image"),this._can_fit()},o.prototype._show_with_image=function(){return this.$ha.removeClass("no-image"),this._show()},o.prototype._show=function(){return this.$ha.css("visibility","visible")},o.prototype._hide=function(){return this.$ha.css("visibility","hidden")},o.prototype._show_if_possible=function(){return this._can_fit_with_image()?this._show_with_image():this._can_fit_without_image()?this._show_without_image():this._hide()},o}(),r={init:function(e,i,o,r,s){return new n(t("#outer-frame"),"/prompt/main_campaign",{data:{ref_controller:i,ref_action:o,in_app:r,sprite_group:s},dataType:"json",subject_user:e,success:function(e){return t(".db-modal-overlay").is(":visible")?void 0:t("#db-modal-upsell-home-modal").addClass("show-upsell-modal").trigger("show-upsell-modal")}})}},s={init:function(e,i){return new n(t("#page-header"),"/prompt/top_notification_bar",{data:{ref_controller:e,ref_action:i},success:function(e){return t("body").addClass(t("[data-body-class]").data("body-class"))}})}},{HALoader:o,PromptLoader:r,TopNotificationBarLoader:s}})}.call(this),function(){define("modules/clean/uuid",["modules/clean/crypto"],function(e){var t,n,i,o,r,s,a,l,u;return n=/generator isn't seeded/,o={},t=function(){var e,t;for(t=[],a=e=0;255>=e;a=++e)t.push((a+256).toString(16).substr(1));return t}(),i=function(e){var n,i;return i=function(){var i,o,r;for(r=[],i=0,o=e.length;o>i;i++)n=e[i],r.push(t[n]);return r}(),i.join("")},l=function(e){return 255&e},u=function(e){var t,n,o;return t=[e.slice(0,4),e.slice(4,6),e.slice(6,8),e.slice(8,10),e.slice(10,16)],n=function(){var n,o,r;for(r=[],n=0,o=t.length;o>n;n++)e=t[n],r.push(i(e));return r}(),o=n.join("-")},s=function(t){var i,o,s,a,u;null==t&&(t={}),u=new Array(16);try{e.getRandomValues(u)}catch(e){if(o=e,!o.message.match(n)||!t.allowInsecure)throw o;r(u)}return i=function(){var e,t,n;for(n=[],e=0,t=u.length;t>e;e++)a=u[e],n.push(l(a));return n}()},r=function(e){var t,n,i;for(i=Math.pow(2,8),a=t=0,n=e.length;n>=0?n>t:t>n;a=n>=0?++t:--t)e[a]=Math.floor(Math.random()*i);return e},o.v4=function(e){var t;return null==e&&(e={}),t=s({allowInsecure:e.allowInsecure}),t[6]=15&t[6]|64,t[8]=63&t[8]|128,u(t)},o})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/ux_analytics_v2",["jquery"],function(t){var n;return n=function(){function n(t,n,i,o){this.request_id=t,this.org_referrer=n,this.logger=i,null==o&&(o={}),this._trackModalHide=e(this._trackModalHide,this),this._trackModalShow=e(this._trackModalShow,this),this._trackScrolling=e(this._trackScrolling,this),this._storeDelayedLinkClick=e(this._storeDelayedLinkClick,this),this._handleLinkClick=e(this._handleLinkClick,this),this._delayed_init=e(this._delayed_init,this),this.init_time=this._now(),this.lastScrollOffset=0,this.sessionStorage=this._isSessionStorageAvailable()&&window.sessionStorage,this.current_modal_id=null,this.modal_class=o.modal_class||".ui-modal",this.delayed_link_click_logging=o.delayed_link_click_logging||!0,this._heartbeat(),setTimeout(this._delayed_init,50)}var i,o,r;return r=500,o={heartbeat:"heartbeat",pageView:"page_view",scroll:"scroll_event",linkClick:"link_click",linkNoSessionStorage:"link_no_session_storage",modalOpen:"modal_open",modalClose:"modal_close"},i={linkClick:"clicked_link",scrollTimer:"scrollTimer"},n.prototype._delayed_init=function(){return this._logPageViewEvent(),this._logDelayedClickEvent(),this._setupListeners()},n.prototype._setupListeners=function(){return t(window).on("scroll",this._throttle(this._trackScrolling,2e3)),t(document.body).on("mousedown","a",this._handleLinkClick),t(document).on("modalOpened",this._trackModalShow),t(document).on("modalClosed",this._trackModalHide)},n.prototype._logPageViewEvent=function(){return this._log(o.pageView)},n.prototype._handleLinkClick=function(e){var n,i,r,s;return i=e.currentTarget,n=t(i),s=null!=n?n.offset():void 0,r={link_id:null!=n?n.attr("data-trackingid"):void 0,origin_href:null!=i?i.href:void 0,url:this._get_safe_href(),vertical_offset:this._vertical_offset(),time_on_page:this._time_on_page(),top:Math.round(null!=s?s.top:void 0),left:Math.round(null!=s?s.left:void 0),link_rank:this._link_rank(i,n,s),request_id:this.request_id},null!=this.org_referrer&&(r.org_referrer=this.org_referrer),this.delayed_link_click_logging?this._storeDelayedLinkClick(r):this._log(o.linkClick,r)},n.prototype._storeDelayedLinkClick=function(e){var t,n;if(!this.sessionStorage)return this._log_on_page(o.linkNoSessionStorage),!1;try{this.sessionStorage.setItem(i.linkClick,JSON.stringify(e))}catch(e){return t=e,!1}return!0},n.prototype._logDelayedClickEvent=function(){var e,t,n,r;if(this.sessionStorage&&(e=this.sessionStorage.getItem(i.linkClick)))try{
return r=JSON.parse(e),r.destination_url=this._get_safe_href(),this._log(o.linkClick,r),this.sessionStorage.removeItem(i.linkClick)}catch(e){t=e}},n.prototype._trackScrolling=function(){return clearTimeout(t.data(this,i.scrollTimer)),t.data(this,i.scrollTimer,setTimeout(function(e){return function(){var t;return t=e._vertical_offset(),e.lastScrollOffset!==t?(e.lastScrollOffset=t,e._log_on_page(o.scroll)):void 0}}(this),r))},n.prototype._trackModalShow=function(e){var n;return this.current_modal_id=null!=(n=t(this.modal_class).filter(":visible")[0])?n.id:void 0,this.current_modal_id?this._log_modal(o.modalOpen,this.current_modal_id):void 0},n.prototype._trackModalHide=function(e){return this.current_modal_id?(this._log_modal(o.modalClose,this.current_modal_id),this.current_modal_id=null):void 0},n.prototype._heartbeat=function(e){return null==e&&(e=0),setTimeout(function(t){return function(){return t._log_on_page(o.heartbeat),t._heartbeat(e+1)}}(this),1e3*Math.pow(3,e)+1e3)},n.prototype._vertical_offset=function(){return t(window).scrollTop()},n.prototype._time_on_page=function(){var e;return e=this._now(),Math.round((e-this.init_time)/1e3)},n.prototype._link_rank=function(e,n,i){var o,r,s,a,l,u;for(u=t("a[href='"+n.attr("href")+"']"),s=a=0,l=u.length;l>a;s=++a){if(o=u[s],r=t(o).offset(),o===e&&r.top===i.top&&r.left===i.left)return s+1;return}return-1},n.prototype._isSessionStorageAvailable=function(){var e,t,n;n="uxa_"+(Math.floor(1e4*Math.random())+1e4);try{return window.sessionStorage.setItem(n,n),window.sessionStorage.removeItem(n),!0}catch(t){return e=t,!1}},n.prototype._get_safe_href=function(e){return null==e&&(e=window),e.location.href},n.prototype._now=function(){return(Date.now||function(){return(new Date).getTime()})()},n.prototype._throttle=function(e,t,n){var i,o,r;return null==n&&(n={}),r=null,o=0,i=function(t){return function(){var i,s,a;return o=n.leading===!1?0:t._now(),r=null,a=e.apply(s,i),r?void 0:s=i=null}}(this),function(s){return function(){var a,l,u,c,d;return u=s._now(),o||n.leading!==!1||(o=u),c=t-(u-o),l=s,a=arguments,0>=c||c>t?(r&&(clearTimeout(r),r=null),o=u,d=e.apply(l,a),r||(l=a=null)):r||n.trailing===!1||(r=setTimeout(i,c)),d}}(this)},n.prototype._log_modal=function(e,t){var n;return n={modal:t},this._log_on_page(e,n)},n.prototype._log_on_page=function(e,t){return null==t&&(t={}),t.vertical_offset||(t.vertical_offset=this._vertical_offset()),t.time_on_page||(t.time_on_page=this._time_on_page()),this._log(e,t)},n.prototype._log=function(e,t){var n,i;null==t&&(t={}),e!==o.linkClick&&(t.url||(t.url=this._get_safe_href()),t.request_id||(t.request_id=this.request_id),null!=this.org_referrer&&(t.org_referrer=this.org_referrer));try{return this.logger.log(e,t)}catch(e){n=e}},n}()})}.call(this),function(){define("modules/clean/video_util",["jquery","modules/core/browser","modules/core/i18n","external/flash_detect","external/videojs/video","external/videojs/videojs_hls","modules/clean/ajax","modules/constants/static","modules/constants/viewer"],function(e,t,n,i,o,r,s,a,l){var u,c,d;return c=n._,u={_video_counter:0,embed:function(n,i){var o,r,u,p,_,h,m,f,v,g,y,b,w;if(null==i&&(i={}),!this.can_embed_type(i.type))return null!=i.onError&&setTimeout(function(){return i.onError("needflash")},0),document.createElement("div");for(i.preload="undefined"!=typeof i.preload?i.preload:!0,i.preload&&(i.preload="auto"),p="video-"+this._video_counter,this._video_counter+=1,w=e("<video/>",{class:"video-js vjs-default-skin vjs-big-play-centered",id:p,controls:i.controls}),w=w[0],o=-1,v=["width","height","preload","poster","autoplay"],u=0,_=v.length;_>u;u++)m=v[u],i[m]&&w.setAttribute(m,i[m]);return g=e("<source/>",{src:i.src,type:i.type}),g=g[0],w.appendChild(g),n=e(n),n.empty(),n=n[0],n.appendChild(w),h=function(){var n,r,a,l;return l=this,"function"==typeof i.onReady&&i.onReady(),n=function(){return null!=l.hls?l.hls.fillBuffer():void 0},t&&(t.ipad&&(r=0,e(document).on("dropdownOpened modalOpened",function(t,n){return r+=n,e(l.el_).children("video").removeAttr("controls")}),e(document).on("dropdownClosed modalClosed",function(t,n){return r-=n,0===r?e(l.el_).children("video").attr("controls","controls"):void 0})),t.msie&&"9.0"===t.version&&l.on("playing",function(){return l.removeClass("vjs-seeking")})),"Hls"===l.techName&&l.on("seeked",function(){return l.controlBar.currentTimeDisplay.updateContent()}),l.on("pause",function(){return o=setInterval(n,500),l.ended()?l.removeClass("vjs-has-started"):void 0}),l.on("play",function(){return clearInterval(o),o=-1}),l.on("dispose",function(){return clearInterval(o)}),l.on("ended",function(){return l.src({type:i.type,src:i.src})}),"application/vnd.apple.mpegurl"===i.type&&d(l),a=function(){return l.addClass("show-truncated-bar")},!i.metadata&&i.metadata_link?s.AuthenticatedRequest({url:i.metadata_link,type:"GET",data:{},xhrFields:{withCredentials:!0},success:function(e){return"function"==typeof i.metadata_cb&&i.metadata_cb(e),e=JSON.parse(e),e.is_truncated?a.defer():void 0}}):i.metadata&&i.metadata.is_truncated?a.defer():void 0},b=c("The clip displayed here is a preview. To view the entire video, download or add it to your Dropbox."),l.transcoder_hls4web&&(videojs.Hls.GOAL_BUFFER_LENGTH=120),videojs.TruncatedBar=videojs.Component.extend(),videojs.TruncatedBar.prototype.options_={loadEvent:"play",components:{}},videojs.TruncatedBar.prototype.createEl=function(){var e;return e=videojs.createEl("div",{className:"truncated-bar",id:"truncated-video-message-bar"}),e.textContent=b,e},videojs.options.children.TruncatedBar={},r={swf:a.static_url_video_js_swf,flashVars:{contentType:i.type,hlsDebugLevel:l.hls_debug_level}},y=l.transcoder_hls4web?["html5","hls","flash"]:["flash"],f=videojs(w,{flash:r,techOrder:y},h),i.onError&&f.on("error",i.onError),f},can_embed_type:function(e){var t;return""!==("function"==typeof(t=document.createElement("video")).canPlayType?t.canPlayType(e):void 0)?!0:i.installed&&i.majorAtLeast(10)?"application/vnd.apple.mpegurl"===e||"video/flv"===e||"video/mp4"===e:!1}},d=function(e){var t,n,i,o,r,a,l,u,c,d,p,_,h,m,f,v,g,y,b,w,E,T,C,S,k,I,A,P,N,R,O,D,x;for(T=[250,500,1500,3e3],f=null,w=null,b=null,N=0,g=-1,m=!1,y=null,h=-1,k=[],R=!0,D=0,_={},v=0,E=T.length;E>v;v++)I=T[v],_[I.toString()]=0;return O=null,x=[],S=100,A=function(){var t,n,i,o,r;for(t={},n=0,i=T.length;i>n;n++)I=T[n],r=_[I.toString()],t[I.toString()]=Math.round(r/D*100)||0;return o={duration:Math.round(1e3*e.duration()),initial_bitrate:T[g]||0,initial_play_wait:y||0,bitrate_percentages:JSON.stringify(t),stalls:N,quality_events:JSON.stringify(k),xhr_errors:JSON.stringify(x),percentage_watched:S},P(),s.AuthenticatedRequest({url:"/video_web_play_log",type:"POST",data:o})},P=function(){var e,t;for(f=null,w=null,b=null,N=0,g=-1,m=!1,y=null,h=-1,k=[],R=!0,D=0,_={},e=0,t=T.length;t>e;e++)I=T[e],_[I.toString()]=0;return O=null,x=[],S=100},i=function(){return d(),A()},u=function(){return d(),S=Math.round(e.currentTime()/e.duration()*100),isFinite(S)||(S=0),A()},p=function(){return R?(O=Date.now(),R=!1):void 0},d=function(){var e;if(!R)return e=Date.now()-O,D+=e,_[T[h].toString()]+=e,R=!0},r=function(){return null===f&&(b=f=Date.now()),w=Date.now()},t=function(){var t;return t=e.hls.selectPlaylist().attributes.BANDWIDTH/1e3,T.indexOf(t)},n=function(){return h=t(),g=h,p(),m?void 0:(y=null===f?0:Date.now()-f,m=!0)},o=function(){return d()},l=function(){return w=Date.now()},c=function(){return d(),Date.now()-w>5e3?N+=1:void 0},a=function(){var n;if(!(e.ended()||e.error()||e.paused()))return d(),n=h,h=t(),Date.now()-f<1e3?g=h:k.push([T[n],T[h],Date.now()-b]),b=Date.now(),p()},e.on("play",r),e.on("pause",o),e.on("canplay",n),e.on("waiting",c),e.on("seeking",l),e.on("ended",i),e.on("shutdown",u),e.on("mediachange",a),"Hls"===e.techName?(C=videojs.Hls.xhr,videojs.Hls.xhr=function(e,t){var n;return n=function(e,n){var i;return e&&(i="",""!==this.responseType&&"text"!==this.responseType||(i=this.responseText),x.push([this.status.toString(),i,n])),t.call(this,e,n)},C.call(this,e,n)}):void 0},u})}.call(this),function(){define("modules/clean/zendesk_feedback",["jquery","external/classnames","external/react","modules/core/i18n","modules/clean/ajax","modules/clean/multiaccount_login","modules/clean/react/button","modules/clean/react/modal","modules/clean/react/css","modules/clean/react/select","modules/clean/react/sprite","modules/clean/sharing/views/hover_close_button","modules/core/notify"],function(e,t,n,i,o,r,s,a,l,u,c,d,p){var _,h,m,f,v,g,y,b,w,E,T,C,S,k,I,A,P,N,R;return S=s.button,_=a.Modal,h=u.input,m=u.option,A=n.DOM,k=n.createElement,R=n.addons.update,b=i.i18n_default_project("sharing")._,w=n.createClass({displayName:"ZendeskFeedbackButton",render:function(){return A.button({className:"button-as-link zendesk-feedback-button",onClick:function(){return _.showInstance(k(v))}},b("Feedback",{comment:"For context, this is a button on the main page the user can click on to give feedback"}))}}),E=n.createClass({displayName:"ZendeskFeedbackForm",getInitialState:function(){return{}},render:function(){return k(_,{className:"zendesk-feedback-form",title:b("Send us your feedback"),acceptButtonDisabled:!this.state.message||this.state.isSending,acceptButtonText:b("Send feedback"),autoClose:!1,dismissButtonText:b("Cancel"),onAccept:function(e){return function(){return e.setState({isSending:!0}),P([e.refs.category.getValue(),"tiburon_form_perm"],e.state.message,null,function(){return e.setState({isSending:!1})})}}(this)},A.label({htmlFor:"feedback-category"},b("Category")),k(h,{ref:"category",className:"u-mar-bottom-m feedback-category",id:"feedback-category",defaultValue:"tiburon_form_fdbk_shrr"},k(m,{value:"tiburon_form_fdbk_shrr"},b("I have feedback about sharing files with others")),k(m,{value:"tiburon_form_fdbk_rcvr"},b("I have feedback about accessing files shared with me")),k(m,{value:"tiburon_form_fdbk_gen"},b("I have general feedback")),k(m,{value:"tiburon_form_fdbk_bug"},b("I found a bug"))),A.label({htmlFor:"feedback-content"},b("What is your feedback?")),A.textarea({className:"zendesk-feedback-form__textbox",id:"feedback-content",onChange:function(e){return function(t){return e.setState({message:t.target.value})}}(this)}))}}),C=n.createClass({displayName:"ZendeskQuantitativeForm",SCORES:[{NAME:"easy_score",PROMPT:b("How easy or difficult was it for you?"),ONE_LABEL:b("Very easy"),FIVE_LABEL:b("Very difficult"),HIDDEN_ONE_LABEL:b("1 means very easy"),HIDDEN_FIVE_LABEL:b("5 means very difficult")},{NAME:"clearness_score",PROMPT:b("Were your options clear, or did you find them confusing?"),ONE_LABEL:b("Very clear"),FIVE_LABEL:b("Very confusing"),HIDDEN_ONE_LABEL:b("1 means very clear"),HIDDEN_FIVE_LABEL:b("5 means very confusing")},{NAME:"confidence_score",PROMPT:b("How confident are you that you did things the right way?"),ONE_LABEL:b("Very confident"),FIVE_LABEL:b("Not at all confident"),HIDDEN_ONE_LABEL:b("1 means very confident"),HIDDEN_FIVE_LABEL:b("5 means not at all confident")}],propTypes:{title:n.PropTypes.string.isRequired,zendeskTag:n.PropTypes.string.isRequired},getInitialState:function(){return{message:"",scores:{}}},render:function(){var e,n;return k(_,{className:"zendesk-feedback-form",title:this.props.title,acceptButtonDisabled:this.state.isSending||this.SCORES.reduce(function(e){return function(t,n){return!e.state.scores[n.NAME]||t}}(this),!1),acceptButtonText:b("Send feedback"),autoClose:!1,dismissButtonText:b("Cancel"),onAccept:function(e){return function(){return e.setState({isSending:!0}),P([e.props.zendeskTag],e.state.message,e.state.scores,function(){return e.setState({isSending:!1})})}}(this)},function(){var i,o,r,s;for(r=this.SCORES,s=[],i=0,o=r.length;o>i;i++)n=r[i],s.push(A.div({className:"zendesk-feedback-form__score-bar u-mar-bottom-s",role:"radiogroup"},A.label({},n.PROMPT),function(){var i,o;for(o=[],e=i=1;6>i;e=++i)o.push(A.button({"aria-checked":this.state.scores[n.NAME]===e,onClick:function(e){return function(t,n){return function(){var i;return i={},i[n.NAME]={$set:t},e.setState({scores:R(e.state.scores,i)})}}}(this)(e,n),role:"radio",className:t("c-btn","c-btn--secondary","zendesk-feedback-form__score-button",{"c-btn--disabled":this.state.scores[n.NAME]===e})},e));return o}.call(this),A.div({},A.span({className:"zendesk-feedback-form__score-label"},n.ONE_LABEL),A.span({className:"ax-visually-hidden"},n.HIDDEN_ONE_LABEL),A.span({className:"zendesk-feedback-form__score-label"},n.FIVE_LABEL),A.span({className:"ax-visually-hidden"},n.HIDDEN_FIVE_LABEL))));return s}.call(this),A.label({htmlFor:"feedback--main-reason"},b("What’s the main reason for your scores?")),A.textarea({className:"zendesk-feedback-form__textbox",id:"feedback--main-reason",onChange:function(e){return function(t){return e.setState({message:t.target.value})}}(this)}))}}),T=n.createClass({displayName:"ZendeskFlyout",propTypes:{onCloseClick:n.PropTypes.func},componentDidMount:function(){return this.refs.mainButton.getDOMNode().focus()},render:function(){return A.div({className:"zendesk-flyout"},A.div({className:"zendesk-flyout__header u-pad-left-l u-pad-bottom-m u-pad-top-m"},b("Have a moment?"),k(d,{className:"zendesk-flyout__x u-mar-right-m",onClick:function(e){return function(){var t;return"function"==typeof(t=e.props).onCloseClick&&t.onCloseClick(),I()}}(this)})),A.div({className:"u-pad-left-l u-mar-bottom-m u-pad-top-m u-mar-right-m"},b("Help us make your Dropbox experience even better by answering a few questions."),A.button({className:"c-btn c-btn--primary u-mar-top-m zendesk-flyout__main_button",onClick:function(e){return function(){return I(),_.showInstance(k(y,e.props))}}(this),ref:"mainButton"},b("Give feedback"))))}}),f=l(w,["/static/css/zendesk_feedback-vfljBsKoD.css"]),v=l(E,["/static/css/zendesk_feedback-vfljBsKoD.css"]),y=l(C,["/static/css/zendesk_feedback-vfljBsKoD.css"]),g=l(T,["/static/css/zendesk_feedback-vfljBsKoD.css"]),N=function(t){var i;return i=e("<div />").attr({class:"zendesk-flyout-container"}).prependTo("body")[0],n.render(k(g,t),i)},I=function(){return e(".zendesk-flyout-container").remove()},P=function(e,t,n,i){return""===t&&null!=n&&(t="Scores only"),o.WebRequest({url:"/help/user_feedback",data:{tags:JSON.stringify(e),details:t,user_feedback:JSON.stringify(n)},success:function(){return p.success(b("Thanks for helping make Dropbox better!")),_.close()},error:i})},{ZendeskFeedbackButton:f,showZendeskFlyout:N}})}.call(this),function(){define("modules/constants/browse",[],function(){return window.BrowseConstants})}.call(this),function(){define("modules/constants/comments_panel",[],function(){return window.CommentsPanelConstants})}.call(this),function(){define("modules/constants/contacts",[],function(){return window.ContactsConstants})}.call(this),function(){define("modules/constants/file_viewer",[],function(){return window.FileViewerConstants})}.call(this),function(){define("modules/constants/python",[],function(){return PythonConstants||{}})}.call(this),function(){define("modules/constants/sharing",[],function(){return"undefined"!=typeof SharingServerConstants&&null!==SharingServerConstants?SharingServerConstants:{}})}.call(this),function(){define("modules/constants/static",[],function(){return StaticConstants||{}})}.call(this),function(){"use strict";var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/core/type",["external/underscore"],function(t){var n,i,o,r,s,a,l,u;return s={},s.Type=n=function(){function e(e,n){if(!t.isString(e)&&!t.isFunction(e))throw new TypeError("First parameter needs to be a string identifying the type");if(!t.isFunction(n))throw new TypeError("Second parameter needs to be a predicate defining the type");t.isFunction(e)?this.getTypeString=e:this.getTypeString=function(){return e},this.predicate=n}return e}(),o=function(e){var i,r;if(u(e))return!0;if(e instanceof n)return!0;if(t.isFunction(e))return!0;if(t.isArray(e)){if(1!==e.length)return!1;if(!o(e[0]))return!1}else{if(!(t.isObject(e)&&null==e.prototype&&e.constructor===Object&&t.keys(e).length>0))return!1;for(i in e)if(r=e[i],!o(r))return!1}return!0},i=function(){var e,i,r,s,a,l,u;return u=new n("undefined",t.isUndefined),i=new n("null",t.isNull),e=new n("Boolean",t.isBoolean),r=new n("Number",t.isNumber),a=new n("String",t.isString),s=new n("Object",function(e){return t.isObject(e)&&!t.isFunction(e)&&!t.isArray(e)}),l=new n("Type",o),function(t){return"undefined"==typeof t?u:null===t?i:t===Boolean?e:t===Number?r:t===String?a:t===Object?s:t===n?l:void 0}}(),s.isBasicType=u=function(e){return null!=i(e)},s.firstFailingKeypath=a=function(o,r,s){var l,c,d,p,_,h,m,f,v,g;if(null==s&&(s=[]),u(o)){if(!i(o).predicate(r))return s}else if(o instanceof n){if(!o.predicate(r))return s}else if(t.isFunction(o)){if(!(r instanceof o))return s}else if(t.isArray(o)){if(a(Array,r,s))return s;for(c=d=0,h=r.length;h>d;c=++d){if(l=r[c],s.push(c),a(o[0],l,s))return s;s.pop()}}else{if(a(Object,r,s))return s;for(g=t.keys(o),f=t.keys(r),_=0,m=f.length;m>_;_++)if(p=f[_],e.call(g,p)<0)return s;for(p in o){if(v=o[p],s.push(p),a(v,r[p],s))return s;s.pop()}}},s.checkType=r=function(e,t){return null==a(e,t)},s.getTypeString=l=function(e){var o,r,s;if(u(e))return i(e).getTypeString();if(e instanceof n)return e.getTypeString();if(t.isFunction(e))return e.name;if(t.isArray(e))return"["+l(e[0])+"]";r=[];for(o in e)s=e[o],r.push(o+": "+l(s));return"{"+r.join(", ")+"}"},s})}.call(this),function(){"use strict";var e=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty,n=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},i=[].slice;define("modules/core/types",["external/underscore","modules/constants/env","modules/core/type"],function(t,o,r){var s,a,l,u,c,d,p,_,h,m,f,v,g,y,b,w,E,T,C,S;return f=r.Type,v=r.checkType,w=r.getTypeString,b=r.firstFailingKeypath,E=r.isBasicType,_=function(){try{return Boolean(localStorage.production_typechecking)}catch(e){return!1}}(),m=function(t){function n(e){n.__super__.constructor.call(this,w.bind(null,e),v.bind(null,e))}return e(n,t),n}(f),c=function(i){function o(e,n){null!=o.names?o.names.set(this,e):this.__name===e,null!=n&&t.extend(this,n)}e(o,i);try{o.names=new WeakMap}catch(e){o.names=null}return o.prototype.getTypeString=function(){return null!=o.names?o.names.get(this):this.__name},o.prototype.predicate=function(e){return n.call(t.values(this),e)>=0},o}(f),l=function(t){function n(e){this.valType=e}return e(n,t),n.prototype.getTypeString=function(){return"Dict[string -> "+w(this.valType)+"]"},n.prototype.predicate=function(e){var t,n;return function(){var i;i=[];for(t in e)n=e[t],i.push(v(this.valType,n));return i}.call(this).every(function(e){return e})},n}(f),g=function(e,n){var o,r,s,a,l,u,c,d;if(E(e));else if(e instanceof f)null!=e.parameter_types&&t.isFunction(n)&&!n.isTypeChecked&&(n=S.apply(null,i.call(e.parameter_types).concat([n])));else if(t.isFunction(e));else if(t.isArray(e))for(s=a=0,u=n.length;u>a;s=++a)o=n[s],r=g(e[0],o),r!==o&&(n=n.slice(),n[s]=r);else for(l in e)c=e[l],d=g(c,n[l]),d!==n[l]&&(n=t.clone(n),n[l]=d);return n},T=function(e,n,i,o){var r,s,a,l;for(r=0,l=n.length;l>r;r++)s=n[r],o=o[s],i=t.isArray(i)?i[0]:i[s];return n.length>0&&(a=", key "+n.join(".")),a=null!=a?a:"","Argument "+e+a+": Value "+JSON.stringify(o,null,"  ")+" doesn't match type "+w(i)},S=function(){var e,n,o,r;return r=2<=arguments.length?i.call(arguments,0,n=arguments.length-1):(n=0,[]),e=arguments[n++],o=function(){var n,o,s,a,l,u,c,d,p,_,h,f;if(o=1<=arguments.length?i.call(arguments,0):[],n=r,d=t.find(r,function(e){return e instanceof m}),null!=d&&(p=t.indexOf(n,d),_=Math.max(o.length-n.length+1,0),h=[p,1],t.times(_,function(){return h.push(d)}),n=n.slice(),n.splice.apply(n,h)),o.length>n.length)throw new Error("Too many arguments: Supplied "+o.length+" but expected up to "+n.length);for(a=l=0,u=n.length;u>l;a=++l){if(f=n[a],s=b(f,o[a]),null!=s)throw c=T(a,s,f,o[a]),new TypeError(c);o[a]=g(f,o[a])}return e.apply(this,o)},o.isTypeChecked=!0,o},C=function(e,t){var n;return n=function(){var n,o,r,s;if(n=1<=arguments.length?i.call(arguments,0):[],s=t.apply(this,n),o=b(e,s),null!=o)throw r=T(0,o,e,s),new TypeError(r);return s},t.isTypeChecked&&(n.isTypeChecked=!0),n},u=function(e,t){var n,i;return n=function(){return"("+w(e)+"|"+w(t)+")"},i=function(n){return v(e,n)||v(t,n)},new f(n,i)},p=function(e){var t,n,i;return e instanceof f&&e.isOptional||e instanceof m?e:(t=function(){return"?"+w(e)},n=function(t){return null==t||v(e,t)},i=new f(t,n),e instanceof f&&null!=e.parameter_types&&(i.parameter_types=e.parameter_types),i.isOptional=!0,i)},d=function(){var e,n,o,r;return r=1<=arguments.length?i.call(arguments,0):[],e=function(){return"function("+r.map(w).join(", ")+")"},n=t.isFunction,o=new f(e,n),o.parameter_types=r,o},h=function(e){return new m(e)},a=function(e){return new l(e)},y={},y.takes=C(Function,S(h(f),Function,S)),y.returns=C(Function,S(f,Function,C)),y.Type=f,y.Enum=c,y.Dict=C(f,S(f,a)),y.Either=C(f,S(f,f,u)),y.Maybe=C(f,S(f,p)),y.Splat=C(f,S(f,h)),y.Any=s=new f("Any",function(e){return!0}),y.Func=C(f,S(h(f),d)),y.inject=C(Object,S(Object,function(e){return t.extend(e,t.omit(y,"inject"))})),o.IS_PROD&&!_&&(y.takes=function(){var e,t,n;return e=2<=arguments.length?i.call(arguments,0,n=arguments.length-1):(n=0,[]),t=arguments[n++]},y.returns=function(){var e,t,n;return e=2<=arguments.length?i.call(arguments,0,n=arguments.length-1):(n=0,[]),t=arguments[n++]}),y})}.call(this),function(){define("modules/core/user_i18n",["modules/constants/viewer"],function(e){var t;return t=function(){function t(){}return t.getInitials=function(e){var n;return e?(n=e.trim().split(" "),n.length>=2?t._is_cjk_locale()?n[n.length-1][0]+n[0][0]:n[0][0]+n[n.length-1][0]:t._is_cjk_locale()&&!t._is_ascii_name(e)&&e.length>1?e.substring(0,2):e.substring(0,1)):""},t._is_ascii_name=function(e){var t,n,i,o;for(n=i=0,o=e.length;o>i;n=++i)if(t=e[n],e.charCodeAt(n)>=128)return!1;return!0},t._is_cjk_locale=function(){var t;return"zh"===(t=e.USER_LOCALE)||"ja"===t||"ko"===t},t}()})}.call(this),function(){define("modules/core/visibility",["jquery"],function(e){var t,n,i;return t={},i=function(){return document.hasFocus()},n=function(t){return e(window).one("focus",t)},t.when=function(){var t,o;return t=new e.Deferred,o=function(){return t.resolve()},i()?o():n(o),t.promise()},t})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/dirty/browse/preview_sf_members",["dropbox","jquery","external/react","modules/clean/ajax","modules/clean/analytics","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/photo_avatar","modules/clean/avatar/size","modules/clean/avatar/viewer_avatar","modules/clean/browse_events","modules/clean/components/loading_indicator","modules/clean/components/title_bubble","modules/clean/dbmodal","modules/clean/em_string","modules/clean/gandalf_util","modules/clean/react/button","modules/clean/react/flag","modules/clean/react/image","modules/clean/sharing/api","modules/clean/viewer","modules/core/browser","modules/core/i18n","modules/clean/sharing/member_avatars","modules/clean/static_urls","modules/clean/filepath"],function(t,n,i,o,r,s,a,l,u,c,d,p,_,h,m,f,v,g,y,b,w,E,T,C,S,k,I){var A,P,N,R,O,D,x,L,M,F,U,B,q,W,V,H,j,G,z;return R=t.Browse,D=t.ExistingSharedFolderOptionsContent,q=t.SharingModals,U=r.SharedFolderActivityLogger,N=c.AVATAR_DIMENSION_BY_SIZE,O=m.DBModalStack,B=w.SharingApi,V=C._,z=C.ungettext,G=k.static_url,H=i.createElement,j=i.DOM,L=15,P=N.MEDIUM,W="south",A=!0,M=function(){function t(t){this._sharing_api_request_handler=e(this._sharing_api_request_handler,this),this._log_event=e(this._log_event,this),this._browse_update_handler=e(this._browse_update_handler,this),this.focus_sharing_options_modal_invite_form=e(this.focus_sharing_options_modal_invite_form,this),this.overflow_click_handler=e(this.overflow_click_handler,this),this.avatar_click_handler=e(this.avatar_click_handler,this),this.invite_button_click_handler=e(this.invite_button_click_handler,this),this.settings_button_click_handler=e(this.settings_button_click_handler,this),this.container_element=t[0],this.last_visited_ns_id=null,this.$body=n("body"),this.$browse_files=n("#browse-files"),n(document).on(p.UPDATE,this._browse_update_handler),n(document).on(B.REQUEST_SUCCEEDED_EVENT,this._sharing_api_request_handler)}return t.prototype.settings_button_click_handler=function(){return this._show_shared_folder_members_modal(),this._log_event("preview_sf_members_settings_button_clicked")},t.prototype.invite_button_click_handler=function(){return this._show_add_people_modal(),this._log_event("preview_sf_members_invite_button_clicked")},t.prototype.avatar_click_handler=function(e,t){return this._log_event("preview_sf_members_avatar_clicked")},t.prototype.overflow_click_handler=function(){return this._show_shared_folder_members_modal(),this._log_event("preview_sf_members_overflow_number_clicked")},t.prototype.focus_sharing_options_modal_invite_form=function(e){return O.unregister(D.CONTENT_LOADED_EVENT,this.focus_sharing_options_modal_invite_form),n("#sharing-options-new-collab-input").focus()},t.prototype._should_show_create_share_ui=function(){return R.can_nest_in_containing_ns&&R.containing_ns_path()},t.prototype._browse_update_handler=function(){var e;return R.inside_dir&&R.inside_shared_folder?(e={user:R.active_user,onSettingsButtonClick:this.settings_button_click_handler,onOverflowCountClick:this.overflow_click_handler,onAvatarClick:this.avatar_click_handler},this._should_show_create_share_ui()?e.folderName=I.filename(R.containing_fq_path()):e.folderName=R.containing_mount_point().split("/").pop(),R.inside_team_folder?e.folderType="TEAM":e.folderType="SHARED",o.WebRequest({url:"/share_ajax/preview_members/"+R.containing_ns_id(),subject_user:R.active_user,data:{max_results:L},success:function(t){return function(o){return o=JSON.parse(o),o.ns_id===R.containing_ns_id()?(e=n.extend({},e,{numUndisplayableUsersAndInvites:o.num_avatars_not_shown,numUsersAndInvites:o.num_users_and_invites,numUsersAndInvitesOutsideTeam:o.num_users_and_invites_outside_team,groups:o.groups,invitations:o.invitations,joinedMembers:o.joined_members}),o.user_can_invite&&("SHARED"===e.folderType||t._should_show_create_share_ui())&&(e.inviteButton=new x({onClick:t.invite_button_click_handler})),i.render(new F(e),t.container_element),R.update_header_height()):void 0}}(this)}),R.containing_ns_id()!==this.last_visited_ns_id&&(i.render(new F(e),this.container_element),R.update_header_height()),this._log_event("preview_sf_members_shown")):i.unmountComponentAtNode(this.container_element)&&R.update_header_height(),this.last_visited_ns_id=R.inside_dir?R.containing_ns_id():null},t.prototype._show_shared_folder_members_modal=function(){return this._should_show_create_share_ui()?q.show_share_existing_modal(R.containing_fq_path(),R.active_user,R.can_change_new_ns_options):q.show_shared_folder_options_modal(R.containing_mount_point(),R.active_user)},t.prototype._show_add_people_modal=function(){return this._should_show_create_share_ui()?q.show_share_existing_modal(R.containing_fq_path(),R.active_user):(O.register(D.CONTENT_LOADED_EVENT,this.focus_sharing_options_modal_invite_form),q.show_shared_folder_options_modal(R.containing_mount_point(),R.active_user))},t.prototype._log_event=function(e,t){return null==t&&(t={}),t.ns_id=R.containing_ns_id(),U.log("web",e,R.active_user,t)},t.prototype._sharing_api_request_handler=function(e,t){var n;return n=t.request_url,n.indexOf("/share_ajax/leave")>-1||n.indexOf("/share_ajax/unshare")>-1||!R.inside_dir||t.ns_id!==R.containing_ns_id()?void 0:this._browse_update_handler()},t}(),F=i.createClass({displayName:"PreviewSFMembersView",mixins:[S],propTypes:{folderName:i.PropTypes.string.isRequired,folderType:i.PropTypes.oneOf(["SHARED","TEAM"]).isRequired,user:i.PropTypes.object.isRequired,onSettingsButtonClick:i.PropTypes.func.isRequired,onOverflowCountClick:i.PropTypes.func,onAvatarClick:i.PropTypes.func,inviteButton:i.PropTypes.element,numUndisplayableUsersAndInvites:i.PropTypes.number,numUsersAndInvites:i.PropTypes.number,numUsersAndInvitesOutsideTeam:i.PropTypes.number,groups:i.PropTypes.array,invitations:i.PropTypes.array,joinedMembers:i.PropTypes.array,avatarDimension:i.PropTypes.number,titleButtonDirection:i.PropTypes.string},getDefaultProps:function(){return{titleButtonDirection:W,avatarDimension:P,maxVisibleAvatars:L,animation:A}},render:function(){return j.div({className:this.getClassName()},H(y,{rightAttachment:this.renderButtons()},this.renderFolderInfo(),this.props.numUsersAndInvites?"SHARED"===this.props.folderType?this.renderAvatars():this.renderTeamFolder():j.div({className:"loading-indicator-container"},H(_))))},getClassName:function(){return i.addons.classSet({"preview-sf-members-box":!0,"c-banner c-banner--unpinned u-pad-s":!0,"team-folder":"TEAM"===this.props.folderType})},renderTeamFolder:function(){var e,t;return e=null,this.props.groups&&(t=this.props.groups[0],t&&t.is_automatic&&(e=V("editor"===t.access_type?"%(group_name)s can edit":"%(group_name)s can view"),e=e.format({group_name:t.name}))),j.div({className:"team-folder-member-entry"},u({dimension:24,photoUrl:G("/static/images/icons/team_24-vflGwWtBj.png"),shape:"SQUARE",optionalClass:"u-mar-right-xs"}),j.span({className:"u-l-ib u-l-ib--m"},e))},renderButtons:function(){return j.div({},this.props.inviteButton,j.button({className:"c-btn c-btn--secondary settings-button",importance:"tertiary",onClick:this.props.onSettingsButtonClick,title:V("Settings")},V("Settings")))},renderFolderInfo:function(){return j.div({className:"shared-folder-info u-mar-bottom-xs"},j.strong({className:"shared-folder-name"},f.em_snippet(this.props.folderName,18)),this.props.numUsersAndInvites?j.span({className:"u-mar-horizontal-xs"},"•"):void 0,this.props.numUsersAndInvites?this.renderNumberOfMembers():void 0)},renderNumberOfMembers:function(){var e,t;return t=z("%(num_total)s member","%(num_total)s members",this.props.numUsersAndInvites,{comment:'Another pluralized string MAY be concatenated to this to make a string like: "15 members (4 outside of TechCorp Inc.)"'}),this.props.numUsersAndInvitesOutsideTeam?(t+=z(" (%(num_outside)s outside of %(team_name)s)"," (%(num_outside)s outside of %(team_name)s)",this.props.numUsersAndInvitesOutsideTeam,{comment:'This will be concatenated to another string to make a string like: "15 members (4 outside of TechCorp Inc.)"'}),e=t.format({num_total:this.props.numUsersAndInvites,num_outside:this.props.numUsersAndInvitesOutsideTeam,team_name:f.em_snippet(E.get_viewer().team_name,16)})):e=t.format({num_total:this.props.numUsersAndInvites}),j.span({className:"members-string u-font-meta"},e)},renderAvatars:function(){var e,t,n,i,o;return e=[],o=[],this.props.numUsersAndInvites&&(i=this.findOwnerAndMeInJoinedMembers(this.props.joinedMembers),n=i[0],t=i[1],null!=n&&(e.push(this.renderJoinedMember(n)),o.push(n.user_id)),null!=t&&t!==n&&(e.push(this.renderJoinedMember(t)),o.push(t.user_id)),this.addGroupsMembersInvitations(e,this.props.groups,this.props.joinedMembers,this.props.invitations,o)),this.renderAvatarList(e)}}),x=i.createClass({displayName:"InviteButton",propTypes:{onClick:i.PropTypes.func.isRequired},render:function(){return j.button({className:"c-btn c-btn--secondary u-mar-right-xs",onClick:this.props.onClick,title:V("Add members")},H(b,{alt:V("Add members"),src:G("/static/images/account_photo/icon-add-people-vfl6PECU8.png"),srcHiRes:G("/static/images/account_photo/icon-add-people@2x-vflNPmgwH.png")}))}}),M})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/dirty/browse/shared_with",["dropbox","jquery","external/react","modules/clean/ajax","modules/clean/analytics","modules/clean/avatar/shared_link_avatar","modules/clean/avatar/size","modules/clean/browse_events","modules/clean/components/title_bubble","modules/clean/dbmodal","modules/clean/em_string","modules/clean/file_events","modules/clean/gandalf_util","modules/clean/react/button","modules/clean/react/sharing/shared_with_view","modules/clean/sharing/api","modules/clean/sharing/shared_link_modal","modules/clean/viewer","modules/core/browser","modules/core/i18n","modules/clean/sharing/member_avatars","modules/clean/account/email","modules/clean/datetime"],function(t,n,i,o,r,s,a,l,u,c,d,p,_,h,m,f,v,g,y,b,w,E,T){
var C,S,k,I,A,P,N,R,O,D,x,L,M,F,U,B,q,W,V,H,j,G,z,K,$,Y,Z;return k=t.Browse,q=t.SharingModals,W=t.SharingShmodel,G=t.UpdateEvents,V=t.SimpleSharing,P=t.ExistingSharedFolderOptionsModal,L=t.SharedLinkSettingsModal,x=r.SharedFolderActivityLogger,S=a.AVATAR_DIMENSION_BY_SIZE,I=c.DBModalStack,U=m.SharedWithView,B=f.SharingApi,z=b._,Z=b.ungettext,A=E.EmailVerification,Y=T.nice_date_with_month_name,$=i.DOM,K=i.createElement,O=5,C=S.SMALL,H="south",D="--",R="file_row_sharing_menu",N=100,j={PUBLIC:1,TEAM_ONLY:2,PASSWORD:3},M=function(){function t(t){this.render_callback=t.render_callback,this.max_visible_avatars=t.max_visible_avatars,this._load_next_shared_link_info=e(this._load_next_shared_link_info,this),this._load_all_sf_info=e(this._load_all_sf_info,this),this._sf_info_stale=e(this._sf_info_stale,this),this._exists_unloaded_sf=e(this._exists_unloaded_sf,this),this._load_sf_info_if_missing=e(this._load_sf_info_if_missing,this),this.preload=e(this.preload,this),this.loading_sf_info=!1,this.loading_link_info=!1,this.loaded_sf_info=!1,this.ns_to_props={},this.shared_link_maps_by_folder={},this.looked_up_files_in_curr_dir={}}return t.prototype.preload=function(){return null!=k.inside_root_folder&&k.inside_root_folder||""===window.encodedpath?this._load_all_sf_info():void 0},t.prototype.get_props_for_file=function(e){var t,n,i,o;return n=null,null!=e.target_ns&&(n=this.ns_to_props[e.target_ns]),t=k.containing_fq_path(),o=this.shared_link_maps_by_folder[t],o&&(i=o[this._shared_link_key(e)],i?(n||(n={user:k.active_user}),n.sharedLinkInfo=i):null!=n&&delete n.sharedLinkInfo),n},t.prototype.ready_for_render=function(){var e;return this._in_directory_with_shared_folders()&&!this.loaded_sf_info?!1:(e=k.containing_fq_path(),!(!e in this.shared_link_maps_by_folder))},t.prototype.load_missing_info=function(){return this._load_sf_info_if_missing(),this._load_shared_link_info_if_missing()},t.prototype.load_all_info=function(){return this._load_all_sf_info(),this._load_all_shared_link_info()},t.prototype.load_on_update=function(){return this._load_sf_info_if_missing(),this._load_all_shared_link_info()},t.prototype.load_on_link_remove=function(){var e;return e=k.containing_fq_path(),this.shared_link_maps_by_folder[e]={},this._load_all_shared_link_info()},t.prototype._load_sf_info_if_missing=function(){return this._in_directory_with_shared_folders()&&(this._exists_unloaded_sf()||this._sf_info_stale())?this._load_all_sf_info():void 0},t.prototype._in_directory_with_shared_folders=function(){var e,t,n,i;if(!k.inside_dir)return!1;for(i=k.files,t=0,n=i.length;n>t;t++)if(e=i[t],parseInt(e.target_ns))return!0;return!1},t.prototype._exists_unloaded_sf=function(){var e,t,n,i;for(i=k.files,t=0,n=i.length;n>t;t++)if(e=i[t],parseInt(e.target_ns)&&null==this.ns_to_props[e.target_ns])return!0;return!1},t.prototype._sf_info_stale=function(){var e,t,n,i,o,r;for(r=!k.inside_shared_folder,i=k.files,t=0,n=i.length;n>t;t++)if(e=i[t],parseInt(e.target_ns)&&null!=(null!=(o=this.ns_to_props[e.target_ns])?o.includeInherited:void 0)==!r)return this.loaded_sf_info=!1,!0;return!1},t.prototype._load_all_sf_info=function(){return null==k.active_user||this.loading_sf_info?void 0:(this.loading_sf_info=!0,o.WebRequest({url:"/share_ajax/shared_with",dataType:"json",subject_user:k.active_user,data:{max_results:this.max_visible_avatars,fq_path_prefix:k.containing_fq_path(),include_inherited:!k.inside_shared_folder},success:function(e){return function(t){var n,i,o,r,s;for(s={},n=0,i=t.length;i>n;n++)r=t[n],o={user:k.active_user,numUndisplayableUsersAndInvites:r.num_avatars_not_shown,groups:r.groups,invitations:r.invitations,joinedMembers:r.joined_members,includeInherited:!k.inside_shared_folder},s[r.ns_id]=o;return e.ns_to_props=s,e.loading_sf_info=!1,e.loaded_sf_info=!0,e.render_callback()}}(this)}))},t.prototype._shared_link_key=function(e){return e.fq_path+"_"+e.to_key()},t.prototype._load_shared_link_info_if_missing=function(){return this.loading_link_info?void 0:this._load_next_shared_link_info()},t.prototype._load_all_shared_link_info=function(){return this.looked_up_files_in_curr_dir={},this._load_next_shared_link_info()},t.prototype._load_next_shared_link_info=function(e){var t,n,i,r,s;if(null==e&&(e=null),this.loading_link_info=!1,!(k.in_search_mode()||e&&e!==k.containing_fq_path())){for(null===e&&(e=k.containing_fq_path()),n=[],s=k.files,i=0,r=s.length;r>i&&(t=s[i],t.fq_path in this.looked_up_files_in_curr_dir||(n.push(t.fq_path),this.looked_up_files_in_curr_dir[t.fq_path]=!0,n.length!==N));i++);if(0!==n.length)return this.loading_link_info=!0,o.SilentBackgroundRequest({url:"/sm/get_token_info",dataType:"json",data:{paths:JSON.stringify(n)},subject_user:k.active_user.id,success:function(t){return function(n){var i,o,r,s,a,l;for(a=t.shared_link_maps_by_folder[e]||{},s=n.shmodels,o=0,r=s.length;r>o;o++)l=s[o],l.disabled||(i=k.find_file(l.path),null!=i&&(a[t._shared_link_key(i)]=l));return t.shared_link_maps_by_folder[e]=a,t.render_callback(),t._load_next_shared_link_info(e)}}(this)})}},t}(),F=function(){function t(t,i){this.shared_link_image_static_url_map=i,this._render_all=e(this._render_all,this),this._sharing_api_request_handler=e(this._sharing_api_request_handler,this),this._browse_link_remove_handler=e(this._browse_link_remove_handler,this),this._browse_update_handler=e(this._browse_update_handler,this),this._browse_add_handler=e(this._browse_add_handler,this),this._browse_rename_handler=e(this._browse_rename_handler,this),this._browse_render_handler=e(this._browse_render_handler,this),this._open_shared_folder_options_modal=e(this._open_shared_folder_options_modal,this),this._wrap_avatar_click_handler_with_fq_path=e(this._wrap_avatar_click_handler_with_fq_path,this),this._wrap_handler_with_fq_path=e(this._wrap_handler_with_fq_path,this),this.overflow_click_handler=e(this.overflow_click_handler,this),this.avatar_click_handler=e(this.avatar_click_handler,this),this.shared_link_avatar_click_handler=e(this.shared_link_avatar_click_handler,this),this.cached_loader=new M({render_callback:this._render_all,max_visible_avatars:O}),this.first_render=!0,this.rendered_element_by_file_key={},n(document).on(l.RENDER,this._browse_render_handler),n(document).on(G.ADD,this._browse_add_handler),n(document).on(l.UPDATE,this._browse_update_handler),n(document).on(B.REQUEST_SUCCEEDED_EVENT,this._sharing_api_request_handler),n(document).on(p.RENAME,this._browse_rename_handler),n(document).on(l.NEW_PAGE,this._browse_add_handler),n(document).on(p.LINKS_REMOVE,this._browse_link_remove_handler),setTimeout(this.cached_loader.preload,50)}return t.prototype.shared_link_avatar_click_handler=function(e){var t,n,i;return n=e.path,i=k.active_user,A.get_for_user(i).verified_or_show()?(t=k.find_file(n),W.shmodel(n,R)):void 0},t.prototype.avatar_click_handler=function(e,t,n){return this._open_shared_folder_options_modal(e)},t.prototype.overflow_click_handler=function(e){return this._open_shared_folder_options_modal(e)},t.prototype._wrap_handler_with_fq_path=function(e,t){var n;return n=t.fq_path,function(t){return function(){return e(n)}}(this)},t.prototype._wrap_avatar_click_handler_with_fq_path=function(e){var t;return t=e.fq_path,function(e){return function(n,i){return e.avatar_click_handler(t,n,i)}}(this)},t.prototype._open_shared_folder_options_modal=function(e){var t,n;return n=k.active_user,A.get_for_user(n).verified_or_show()?(t=new P(n,e),t.show()):void 0},t.prototype._browse_render_handler=function(){return this.rendered_element_by_file_key={},setTimeout(this._render_all,20)},t.prototype._browse_rename_handler=function(){return setTimeout(this._render_all,1e3)},t.prototype._browse_add_handler=function(){return this.cached_loader.load_missing_info()},t.prototype._browse_update_handler=function(){return k.in_search_mode()?void n("#browse-box").removeClass("show-shared-with"):(this.rendered_element_by_file_key={},n("#browse-box").addClass("show-shared-with"),this.cached_loader.load_on_update())},t.prototype._browse_link_remove_handler=function(){return this.cached_loader.load_on_link_remove()},t.prototype._sharing_api_request_handler=function(e,t){var n;return n=t.request_url,n.indexOf("/share_ajax/leave")>-1||n.indexOf("/share_ajax/unshare")>-1?void 0:this.cached_loader.load_all_info()},t.prototype._are_props_equal=function(e,t){var n,i,o,r;for(r=["sharedLinkInfo","user","numUndisplayableUsersAndInvites","groups","invitations","joinedMembers"],i=0,o=r.length;o>i;i++)if(n=r[i],e[n]!==t[n])return!1;return!0},t.prototype._render_all=function(){var e,t,o,r,s,a,l,u,c,d,p;if(this.cached_loader.ready_for_render()){for(e=this.first_render,this.first_render=!1,u=k.files,d=[],r=0,s=u.length;s>r;r++){if(o=u[r],a=this.cached_loader.get_props_for_file(o),p=o.is_deleted?z("deleted"):a?null:D,c=this.rendered_element_by_file_key[o.to_key()],null!=c){if(null!=p&&c.text_display===p)continue;if(null!=c.react_comp&&null!=a&&(l=c.react_comp,l.isMounted()&&this._are_props_equal(l.props,a)))continue}t=n(o.get_div()).find(".sharing .sharers"),t.length?null!=p?(t.text(p),d.push(this.rendered_element_by_file_key[o.to_key()]={text_display:p})):(a.animation=e,a.onOverflowCountClick=this._wrap_handler_with_fq_path(this.overflow_click_handler,o),a.onAvatarClick=this._wrap_avatar_click_handler_with_fq_path(o),a.onSharedLinkClick=this.shared_link_avatar_click_handler,l=i.render(new U(a),t[0]),d.push(this.rendered_element_by_file_key[o.to_key()]={react_comp:l})):d.push(void 0)}return d}},t}()})}.call(this),function(){define("modules/dirty/home",["jquery","dropbox","modules/clean/account/email","modules/clean/analytics","modules/clean/browse_events","modules/clean/viewer","modules/dirty/sharing/sharing_growth_email_experiments"],function(e,t,n,i,o,r,s,a){var l,u,c,d,p,_;return l=t.Browse,c=t.FileOps,_=t.SharingModals,u=n.EmailVerification,p=i.SharedFolderActivityLogger,d={init:function(t){var n,i,o;if(t.show_email_just_verified)return u.getForRole(t.role).show_verified_modal();if(t.show_email_just_verified_and_changed)return u.getForRole(t.role).show_verified_and_changed_modal();if(t.show_sent_verification_email)return u.getForRole(t.role).show_sent_modal();if(t.show_upload)return i=function(){var e;return t.email_src&&(e={ns_id:l.containing_ns_id(),email_src:t.email_src},p.log("web","show_upload_modal_for_sf_from_email",l.active_user,e),s.listen_for_first_upload(l.active_user,e)),c.show_upload.bind(c)()},d._call_when_browse_ready(i);if(t.show_share_existing_modal)return t.email_src&&(n={email_src:t.email_src},p.log("web","show_share_existing_folder_modal_from_email",l.active_user,n)),_.show_share_existing_modal(t.fq_path,l.active_user);if(t.show_share_options&&!t.share_subfolder)return o=r.get_viewer().get_user_by_role(t.role),o||(o=r.get_viewer().get_users()[0]),_.show_shared_folder_options_modal(t.fq_path,o);if(t.show_share_options&&t.share_subfolder)return o=r.get_viewer().get_user_by_role(t.role),o||(o=r.get_viewer().get_users()[0]),_.show_shared_subfolder_modal(t.fq_path,o);if(t.show_pro_trial_modal);else{if(t.show_upsell_modal)return e("#db-modal-upsell-home-modal").addClass("show-upsell-modal").trigger("show-upsell-modal");if(t.show_overquota_lp)return a.get_href("/pro/out-of-space")}},_call_when_browse_ready:function(e){var t;return l.first_load?(t=function(n){return document.stopObserving(o.UPDATE,t),e()},document.observe(o.UPDATE,t)):e()}}})}.call(this),function(){define("modules/dirty/react/file_viewer/controller",["external/react","modules/constants/python","modules/constants/viewer","modules/clean/activity/activity","modules/clean/loggers/file_viewer_logger","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/file_viewer","modules/dirty/react/file_viewer/share_helpers","modules/clean/previews/util"],function(e,t,n,i,o,r,s,a,l){var u,c,d,p,_,h;return c=t.FileViewModeType,d=t.FileViewTargetType,u=i.ActivityContext,h=l.PermissionHelper,p=e.createFactory(s),_={fileViewer:null,targetElementId:"",_onClose:null,open:function(t,i,s,l,c){var _,m,f,v;return this.targetElementId=l,this.isShown()?void 0:(c.fileViewTarget===d.SHARED_LINK?c.activityContext=u.SHARED_LINK_VIEW:c.fileViewTarget===d.SHARED_CONTENT_LINK?c.activityContext=u.SHARED_CONTENT_LINK_VIEW:(c.activityContext=u.BROWSE_FILE_VIEWER,c.shareHelpers=a),null!=s&&(this._onClose=c.onCloseViewer,c.onCloseViewer=this.close.bind(this)),_=!!c.disableFlipping,v={disableFlipping:_},h.is_commenting_integrated()&&(v.areCommentsOpen=n.SHOW_COMMENTS_PANEL),r.setup(t,i,s,v),o.start(),m=p(c),f=document.getElementById(this.targetElementId),this.fileViewer=e.render(m,f))},updateFiles:function(e){return this.isShown()?r.updateFiles(e):void 0},close:function(){var t;return this.isShown()?(t=document.getElementById(this.targetElementId),e.unmountComponentAtNode(t),r.cleanup(),this.fileViewer=null,"function"==typeof this._onClose?this._onClose():void 0):void 0},isShown:function(){return null!=this.fileViewer}}})}.call(this),function(){define("modules/dirty/react/file_viewer/share_helpers",["modules/core/notify","modules/clean/ajax","modules/clean/filepath","modules/dirty/sharing/browse_ui_util"],function(e,t,n,i){var o,r,s;return s=i.showTiburonUIIfAllowed,r=function(t){return require(["dropbox"],t,function(t){return e.error(e.DEFAULT_ERROR)})},o={fetchTkey:function(e,n,i){return t.SilentBackgroundRequest({url:"/sm/get_token",type:"POST",data:{path:e},dataType:"json",subject_user:n,success:function(e){return i(e.tkey)}})},share:function(e,t){return s(t,{fqPath:e,isFolder:!1,origin:"PREVIEW_PAGE"})?void 0:r(function(n){var i;return i=n.ShareLinkModal,new i(t.id,e,"file_viewer").show()})},removeShareLink:function(e,t,i,o,s,a,l){return null==s&&(s=!1),r(function(r){var u,c;return u=r.SharingModel,c=n.filename(e),u.confirm_remove(c,t,0,0,0,i,s,a,l,o)})}}})}.call(this),function(){define("modules/dirty/react/previews/preview_toolbar",["jquery","external/underscore","external/react","modules/core/notify","modules/clean/filepath","modules/clean/previews/preview_actions_helper","modules/clean/react/previews/preview_toolbar","modules/core/exception"],function(e,t,n,i,o,r,s,a){var l,u,c,d,p,_,h,m,f;return u=r.LegacyFileViewerActions,l=r.LegacyFilePreviewActions,_=s.ReactPreviewToolbarClass,d=s.PreviewToolbarDocType,m=a.assert,p=n.createFactory(_),f=function(e){return require(["dropbox"],e,function(){return i.error(i.DEFAULT_ERROR)})},h={FILE_VIEWER:"FILE_VIEWER",FILE_PREVIEW:"FILE_PREVIEW"},c=n.createClass({displayName:"PreviewToolbar",propTypes:{"viewer-type":n.PropTypes.oneOf(t.values(h)).isRequired},getInitialState:function(){var e;return this.props["viewer-type"]===h.FILE_VIEWER?e=u:this.props["viewer-type"]===h.FILE_PREVIEW&&(e=l),{actions:e,fileDocPreviewStatus:null,fileExtension:null,fileHref:null,filePreviewType:null,pdfLink:null}},componentDidMount:function(){return this._listenForFileEvents()},componentDidUpdate:function(){var t,n,i,o;return this.props["viewer-type"]===h.FILE_VIEWER&&(t=e("#file-viewer"),1===t.length&&(t.on("db:filepreview:open",null!=(n=this.refs.reactPreviewToolbar)?n.onPreviewOpen:void 0),t.on("db:filepreview:close",null!=(i=this.refs.reactPreviewToolbar)?i.onPreviewClose:void 0))),null!=(o=this.refs.reactPreviewToolbar)?o.onPreviewOpen():void 0},componentWillUnmount:function(){var t,n,i,o;if(this.props["viewer-type"]===h.FILE_VIEWER){if(t=e("#file-viewer"),1===t.length)return t.off("db:filepreview:open",null!=(n=this.refs.reactPreviewToolbar)?n.onPreviewOpen:void 0),t.off("db:filepreview:close",null!=(i=this.refs.reactPreviewToolbar)?i.onPreviewClose:void 0)}else if(this.props["viewer-type"]===h.FILE_PREVIEW)return null!=(o=this.refs.reactPreviewToolbar)?o.onPreviewClose:void 0},_listenForFileEvents:function(){return this.props["viewer-type"]===h.FILE_VIEWER?e("#file-viewer").on("db:filepreview:open",function(e){return function(t,n){return null!=n.fq_path?e.setState({fileDocPreviewStatus:n.doc_preview_status,fileExtension:o.file_extension_for_logging(n.fq_path),fileHref:n.href,filePreviewType:n.preview_type}):void 0}}(this)):this.props["viewer-type"]===h.FILE_PREVIEW?this.state.actions.getEmbedContainer().on("previewrendered",function(e){return function(){return f(function(t){var n,i;return n=t.FilePreview,i=t.SharingModel,e.setState({pdfLink:n.pdfLink,fileExtension:o.file_extension_for_logging(i.filename)})})}}(this)):void 0},_onAfterFileViewerExit:function(){return f(function(e){var t;return t=e.FileViewer,t.hide()})},render:function(){var e;return this.state.fileExtension?(e=null,this.props["viewer-type"]===h.FILE_VIEWER&&(e=this._onAfterFileViewerExit),p({ref:"reactPreviewToolbar",actions:this.state.actions,fileExtension:this.state.fileExtension,afterFileViewerExit:e,pdfLink:this.state.pdfLink,fileDocPreviewStatus:this.state.fileDocPreviewStatus,fileHref:this.state.fileHref,filePreviewType:this.state.filePreviewType})):null}}),{PreviewToolbar:c,ViewerTypes:h}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/dirty/search/search_bar",["jquery","external/underscore","external/modernizr","modules/core/exception","modules/core/i18n","modules/core/browser","modules/core/notify","modules/clean/ajax","modules/clean/analytics","modules/clean/browse_events","modules/clean/filepath","modules/clean/gandalf_util","modules/clean/keycode","modules/clean/page_role_observer","modules/clean/search/search_helpers","modules/clean/search/search_type","modules/clean/viewer","modules/constants/python","modules/constants/viewer"],function(t,n,i,o,r,s,a,l,u,c,d,p,_,h,m,f,v,g,y){var b,w,E,T,C,S;return S=o.assert,C=r._,T=u.SearchClientActivityLogger,b=y.ROLE_PERSONAL,w=y.ROLE_WORK,E=function(){function o(n,i,r,s){this.user_id=i,this.origin=r,null==s&&(s={}),this._focusDropdownRow=e(this._focusDropdownRow,this),this._unfocusDropdownRow=e(this._unfocusDropdownRow,this),this._getDropdownRow=e(this._getDropdownRow,this),this._hasDropdownRowAtIndex=e(this._hasDropdownRowAtIndex,this),this._getDropdownRowCount=e(this._getDropdownRowCount,this),this._isSearchBarVisible=e(this._isSearchBarVisible,this),this._fileForKey=e(this._fileForKey,this),this._keyForDropdownIndex=e(this._keyForDropdownIndex,this),this._runSearch=e(this._runSearch,this),this._openSuggestionByFileKey=e(this._openSuggestionByFileKey,this),this._suggestionClicked=e(this._suggestionClicked,this),this._buildSuggestion=e(this._buildSuggestion,this),this._getDropdownRowFocuser=e(this._getDropdownRowFocuser,this),this._displaySuggestions=e(this._displaySuggestions,this),this._hideSuggestions=e(this._hideSuggestions,this),this._showSuggestions=e(this._showSuggestions,this),this._gatherSuggestions=e(this._gatherSuggestions,this),this._searchInputUpdate=e(this._searchInputUpdate,this),this._trackKeyDownInSearchBar=e(this._trackKeyDownInSearchBar,this),this._searchBarUnFocused=e(this._searchBarUnFocused,this),this._searchBarFocused=e(this._searchBarFocused,this),this.blur=e(this.blur,this),this.focus=e(this.focus,this),this._on_role_change=e(this._on_role_change,this),this._on_browse_update=e(this._on_browse_update,this),this._on_window_blur=e(this._on_window_blur,this),this._on_window_focus=e(this._on_window_focus,this),this._debug_log=e(this._debug_log,this),this.$search_bar_holder=t(n),this.$search_bar=this.$search_bar_holder.find("#browse-search-input input"),this.$search_button=this.$search_bar_holder.find("#search-button"),this.$suggestion_list_holder=this.$search_bar_holder.find("#browse-search-suggested-list"),this.$suggestion_list=this.$suggestion_list_holder.find(".search-results"),this.$search_text=this.$suggestion_list_holder.find(".search-text"),this.$search_loading=this.$suggestion_list_holder.find("#search-loading"),this._prev_search_val="",this._prev_search_scope="",this._focused_dropdown_row=-1,this._window_blurred=!1,this._fq_path="",this._debug=!1,this._is_transitioning=!1,t(window).on("blur",this._on_window_blur),t(window).on("focus",this._on_window_focus),t(document).on(c.UPDATE,this._on_browse_update),h.addListener(this._on_role_change),this.$search_bar_holder.on("submit",function(e){return e.preventDefault()}),this.$search_bar.on("focus",function(e){return function(t){return e._debug_log("input-focus"),setTimeout(function(){return e._searchBarFocused()},0)}}(this)),this.$search_bar.on("blur",function(e){return function(t){return e._debug_log("input-blur"),setTimeout(function(){return e._searchBarUnFocused()},0)}}(this)),this.$search_bar.on("keydown",this._trackKeyDownInSearchBar),this.$search_button.on("click",this._runSearch),this.$search_text.on("mousedown",this._runSearch),this.$search_text.on("mousemove",this._getDropdownRowFocuser(0)),this._hideSuggestions(),this.$search_loading.hide(),s.listen_for_search_events===!0&&t(document).on(o.FOCUS_SEARCH_EVENT,this.focus)}return o.FOCUS_SEARCH_EVENT="db:searchbar:focus",o.SUBMIT_SEARCH_EVENT="db:searchbar:submit",o.PREVIEW_SEARCH_EVENT="db:searchbar:preview",o.prototype._files={},o.prototype.teardown=function(){return t(document).off(o.FOCUS_SEARCH_EVENT,this.focus),t(document).off(c.UPDATE,this._on_browse_update),t(window).off("blur",this._on_window_blur),t(window).off("focus",this._on_window_focus),h.removeListener(this._on_role_change)},o.prototype._debug_log=function(e){return this._debug?console.log("SearchBar: "+e):void 0},o.prototype._on_window_focus=function(){return this._window_blurred=!1},o.prototype._on_window_blur=function(){return this._window_blurred=!0},o.prototype._on_browse_update=function(e,t){return this._fq_path=(null!=t?t.containing_fq_path:void 0)||""},o.prototype._on_role_change=function(e){var t;return this.$search_bar.val(""),this._searchInputUpdate(),t=v.get_viewer(),this.user_id=t.get_user_by_role(e).id},o.prototype.focus=function(){return this.$search_bar.trigger("focus"),this._searchBarFocused(!0)},o.prototype.blur=function(){return this.$search_bar.trigger("blur"),this._searchBarUnFocused(!0)},o.prototype.previewFile=function(e,n){var i,r,l,u;return null==n&&(n=!1),u=v.get_viewer().get_user_by_id(this.user_id),r=this.origin,p.getGandalfRule("file_viewer_react")&&!e.is_dir?(l={file_nsid:e.ns_id,file_sjid:e.sjid,firefly:!1,match_type:e.match_type,position:e.sort_rank,request_id:e.request_id,viewport:"dropdown-view",action_type:"file_view"},T.log("result_action",u.id,l),void require(["modules/dirty/react/file_viewer/controller"],function(t){return t.open([e],0,u,"react-file-viewer",{disableRouting:!0,oref:g.OREF_CONSTANTS.BROWSE_SEARCHBOX,fileViewTarget:g.FileViewTargetType.PRIVATE,fileViewOrigin:r,fileViewAction:g.FileViewActionType.SEARCH})},function(){return a.error(a.DEFAULT_ERROR)})):(i=t.Event(o.PREVIEW_SEARCH_EVENT),this.$search_bar.trigger(i,[{file:e,force_new_window:n}]),i.isDefaultPrevented()?void 0:n===!0?s.open_tab(e.href):e.dir?s.redirect(e.href):require(["dropbox"],function(t){var n;return n=t.FileViewer,n.show(e,u,{},g.OREF_CONSTANTS.BROWSE_SEARCHBOX)},function(){return a.error(a.DEFAULT_ERROR)}))},o.prototype._scopedSearch=function(){return""!==this._fq_path},o.prototype._searchBarFocused=function(e){return null==e&&(e=!1),this._debug_log("unfocus, winblur="+this._window_blurred.toString()),!e&&this._window_blurred||this.$search_bar.hasClass("focused")?void 0:(this.$search_bar_holder.addClass("focused"),this.$search_bar.addClass("focused"),this._is_transitioning=!0,this._callAfterTransition(function(e){return function(){return e._is_transitioning=!1}}(this)),this._searchInputUpdate())},o.prototype._searchBarUnFocused=function(e){return null==e&&(e=!1),this._debug_log("unfocus, winblur="+this._window_blurred.toString()),!e&&this._window_blurred||!this.$search_bar.hasClass("focused")?void 0:(this.$search_bar.removeClass("focused"),this.$search_bar_holder.removeClass("focused"),this._hideSuggestions())},o.prototype._trackKeyDownInSearchBar=function(e){switch(e.keyCode){case _.ESC:return this._onEscKey(e);case _.ENTER:return this._onEnterKey(e);case _.UP:return this._onUpKey(e);case _.DOWN:return this._onDownKey(e);case _.LEFT:case _.RIGHT:break;default:return clearTimeout(this.search_key_up_timer),this.search_key_up_timer=setTimeout(function(e){return function(){return e._searchInputUpdate(!0)}}(this),100)}},o.prototype._onEscKey=function(){return this.blur()},o.prototype._onEnterKey=function(){return 0===this._focused_dropdown_row||-1===this._focused_dropdown_row?this._runSearch():this._openSuggestionByFileKey(this._keyForDropdownIndex(this._focused_dropdown_row),!1)},o.prototype._onUpKey=function(e){return this._isSearchBarVisible()?(this._focusDropdownRow(Math.max(0,this._focused_dropdown_row-1)),e.preventDefault()):void 0},o.prototype._onDownKey=function(e){return this._isSearchBarVisible()?(this._focusDropdownRow(Math.min(this._getDropdownRowCount()-1,this._focused_dropdown_row+1)),e.preventDefault()):this._searchInputUpdate()},o.prototype._searchInputUpdate=function(){var e,t,i,o,r,s;return r=this.$search_bar.val(),""===r?(this.$search_text.html(""),this.$search_bar_holder.removeClass("active"),this._hideSuggestions(),this.$search_text.html(""),this.$suggestion_list.html(""),this._prev_search_val="",this._prev_search_scope=""):(this.$search_bar_holder.addClass("active"),this._showSuggestions(),s=v.get_viewer().get_user_by_id(this.user_id),i=v.get_root_name(s),e=C("Search for ‘%(res)s’ in %(root)s").format({res:'<span class="search-val-text">'+n.escape(r)+"</span>",root:n.escape(i)}),this._scopedSearch()&&(t=d.filename(this._fq_path),e=C("Search for ‘%(res)s’ in %(path)s").format({res:'<span class="search-val-text">'+n.escape(r)+"</span>",path:"<span>"+n.escape(t)+"</span>"})),o='<span class="dropdown-top-text">'+e+"</span>",this.$search_text.html(o),this._gatherSuggestions())},o.prototype._gatherSuggestions=function(){var e,t,n,i;if(n=this.$search_bar.val(),this._prev_search_val===n){if(this._scopedSearch()&&this._prev_search_scope===this._fq_path)return;if(""===this._prev_search_scope)return}return this.$suggestion_list.html(""),e={query:n,filename_only:!0,max_results:8},this._scopedSearch()?(e.fq_path=this._fq_path,this._prev_search_scope=this._fq_path):this._prev_search_scope="",this._prev_search_val=n,this.$search_loading.show(),t={firefly:!0,path_scoped:!1,search_type:f.COMPLETION,query_string:n},T.log("query_started",this.user_id,t),i=(new Date).getTime(),l.WebRequest({url:"/ajax_fulltext_search",data:e,subject_user:this.user_id,success:function(e){return function(o,r,s){var a,l;return e.$search_loading.hide(),l=s.getResponseHeader("x-dropbox-request-id"),o=JSON.parse(o),a=o.file_info.length>0?o.file_info[0]:null,t=T.create_completion_log_dict(t,l,i,n,n===e.$search_bar.val(),o.file_info.length,null,a),T.log("query_completed",e.user_id,t),n===e.$search_bar.val()?e._displaySuggestions(o,l):void 0}}(this),error:function(e){return function(n,o,r){var s;return e.$search_loading.hide(),s=n.getResponseHeader("x-dropbox-request-id"),t=T.create_completion_log_dict(t,s,i,null,null,null,o),T.log("query_failed",e.user_id,t)}}(this)})},o.prototype._showSuggestions=function(){return this._callAfterTransition(function(e){return function(){return e.$search_bar.hasClass("focused")?(e.$suggestion_list_holder.show(),e._focusDropdownRow(0)):void 0}}(this))},o.prototype._hideSuggestions=function(){return this.$suggestion_list_holder.hide()},o.prototype._displaySuggestions=function(e,t){var n,i,o,r,s,a,l,u;for(null==t&&(t=null),i=e.file_info,this._files={},l=[],a=i.slice(0,8),r=o=0,s=a.length;s>o;r=++o)n=a[r],u=this._buildSuggestion(n),u.on("mousemove",this._getDropdownRowFocuser(r+1)),l.push(u),this._files[this._keyForFile(n)]=this._createBrowseFileShim(n,t);return this.$suggestion_list.html(l),this.$suggestion_list_holder.addClass("ie8hax").removeClass("ie8hax")},o.prototype._getDropdownRowFocuser=function(e){return function(t){return function(){return t._focusDropdownRow(e)}}(this)},o.prototype._buildSuggestion=function(e){var n,i,o,r,s,a,l;return l=e.fq_path.split("/"),s=l.slice(-1)[0],i=m.highlightMatch(s,e.filename_highlights).addClass("file-name"),a=2===l.length?"/":l.slice(0,-1).join("/"),o=t("<span class='file-path'><span class='file-path-in' /><span class='file-location' /></span>"),o.find(".file-path-in").text(C("in ")),o.find(".file-location").text(a),n=t("<img class='sprite sprite_web icon s_web_"+e.icon+"' src='/static/images/icons/icon_spacer-vflN3BYt2.gif'/>"),r=t('<div class="search-item clearfix"/>').append(o.prepend(n,i)),r.attr("data-identity",this._keyForFile(e)),r.data("suggestion-href",e.href),r.on("mousedown",this._suggestionClicked),r},o.prototype._suggestionClicked=function(e){var t,n;return t=1,n=e.metaKey||e.button===t,this._openSuggestionByFileKey(this._keyForElement(e.target),n),this._searchBarUnFocused(!0)},o.prototype._openSuggestionByFileKey=function(e,t){var n;return n=this._fileForKey(e),this.previewFile(n,t),this._hideSuggestions()},o.prototype._runSearch=function(){var e,i,r;return clearTimeout(this.search_key_up_timer),e=t.Event(o.SUBMIT_SEARCH_EVENT),this.$search_bar.trigger(e),!e.isDefaultPrevented()&&t.trim(this.$search_bar.val())?(r=v.get_viewer().get_user_by_id(this.user_id),i=m.buildSearchURL(r,this.$search_bar.val(),this._fq_path),this.$search_bar_holder.removeClass("active").addClass("loading"),n.defer(function(){return s.redirect(i)}),this._hideSuggestions()):void 0},o.prototype._keyForFile=function(e){return e.ns_id+"_"+e.sjid},o.prototype._keyForDropdownIndex=function(e){return this._getDropdownRow(e).data("identity")},o.prototype._fileForKey=function(e){return this._files[e]},o.prototype._keyForElement=function(e){return t(e).closest("[data-identity]").attr("data-identity")},o.prototype._isSearchBarVisible=function(){return this.$suggestion_list_holder.is(":visible")},o.prototype._getDropdownRowCount=function(){return this._isSearchBarVisible()?this.$suggestion_list.children().size()+1:0},o.prototype._hasDropdownRowAtIndex=function(e){return e>=-1&&e<this._getDropdownRowCount()},o.prototype._getDropdownRow=function(e){return S(this._hasDropdownRowAtIndex(e),"Focus on nonexistent search bar suggestion"),0===e?this.$search_text:this.$suggestion_list.children().eq(e-1)},o.prototype._unfocusDropdownRow=function(){return this._hasDropdownRowAtIndex(this._focused_dropdown_row)&&(this._getDropdownRow(this._focused_dropdown_row).removeClass("focused"),this.$search_bar_holder.addClass("ie8hax").removeClass("ie8hax")),this._focused_dropdown_row=-1},o.prototype._focusDropdownRow=function(e){return this._focused_dropdown_row!==e?(this._unfocusDropdownRow(),this._getDropdownRow(e).addClass("focused"),this.$search_bar_holder.addClass("ie8hax").removeClass("ie8hax"),this._focused_dropdown_row=e):void 0},o.prototype._createBrowseFileShim=function(e,t){var i;return null==t&&(t=null),n.extend({},e,{filename:d.filename(e.fq_path),size:"None"!==e.size?e.size:"",is_deleted:-1===e.bytes,dir:e.is_dir?1:0,sort_key:e.sort_key||[""],request_id:t,match_type:null!=(i=e.match_type)?i:"UNKNOWN_MATCH",last_modified_fname:null,caption:null})},o.prototype._callAfterTransition=function(e){var t,o;return o=this.$search_bar.css("transition-duration"),t=o&&"0s"!==o,i.csstransitions&&t&&this._is_transitioning?this.$search_bar.one("transitionend",e):n.defer(e)},o}()})}.call(this),function(){define("modules/dirty/sharing/browse_ui_util",["require","external/react","external/underscore","modules/clean/account/email","modules/clean/contacts/data","modules/clean/filepath","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/modal","modules/clean/sharing/actions/share_modal","modules/clean/sharing/api/client","modules/clean/sharing/content_info","modules/clean/sharing/ui_util","modules/clean/viewer","modules/constants/env","modules/core/uri","modules/dirty/sharing/share_modal"],function(e,t,n,i,o,r,s,a,l,u,c,d,p,_,h,m,f){var v,g,y,b,w,E,T,C,S,k,I,A,P,N,R,O,D,x,L,M,F,U,B;return b=i.EmailVerification,g=o.Contact,T=s.FileTypes,v=a.BrowseContext,w=a.File,k=l.Modal,E=c.FileShareApiClient,C=c.FolderShareApiClient,y=d.ContentInfo,S=p.GoldenGate,A=p.Tiburon,U=p.logTiburonEvent,I=f.ShareModalLegacyShim,
R=t.createElement,B=function(t,i,o){var r,s,a,l,c,d,p,h;null==o&&(o={}),t.id||(t=_.get_viewer().get_user_by_id(t)),null==o.userRootNs&&(o.userRootNs=t.root_ns),o.modalSessionId=Math.random(),p=x(i),n.extend(p,o);try{l=y.createFromParams(p)}catch(e){return!1}return U(l,t.id,"BEGIN_SHARE_FLOW"),s=i instanceof v?i:p.browseContext,c=D(t,l,s),c?(e(["dropbox"],function(e){var t;return t=e.BrowseActions,t.showCopyPublicUrlModal(c)}),!0):N(t,l,s)?(b.get_for_user(t).verified_or_show()&&(h=t.id+":"+l.id,d=l.isFolder()?C:E,a=new d({userId:t.id}),r=new u(h,a,t),r.initializeShareModal(l),k.showInstance(R(I,{actionHandler:r,user:t,contentInfo:l,initialRecipientTokens:null!=p.prefillEmail?[new g({email:p.prefillEmail})]:void 0,renderedClass:I}))),!0):!1},x=function(e){var t,n;return e instanceof w?(t=(n=e.type)===T.FILE||n===T.PACKAGE,{exists:!e.isDeleted,fileId:e.file_id,fqPath:e.fq_path,icon:e.icon,isFolder:!t,isTeamSharedFolder:e.type===T.TEAM_SHARED_FOLDER,nsId:e.ns_id,nsPath:e.ns_path,targetNsId:e.target_ns}):e instanceof v?L(e):e},L=function(e){return e.isInsideDeletedFolder||e.isInsideDeletedSharedFolder?null:e.isInFolderMode?e.isInsideSharedFolder?e.currentNSPath&&e.isInsideTeamFolderTree?{fqPath:e.currentFQPath,isFolder:!0,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}:{fqPath:e.currentMountPoint,isFolder:!0,nsId:null,nsPath:e.currentMountPoint,targetNsId:e.currentNSID}:{fqPath:e.currentFQPath,isFolder:!0,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}:{fqPath:e.currentFQPath,isFolder:!1,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}},F=function(e,t,n){var i,o;o=x(t);try{i=y.createFromParams(o)}catch(e){return!1}return Boolean(D(e,i,n)||N(e,i,n))},N=function(e,t,n){var i;if(!S.canDeepNest(e.id)&&!A.goldenGateUI(e.id)){if((null!=n?n.isInsideAutoTeamFolder:void 0)&&t.isFolder())return!1;if(t.isTeamSharedFolder())return!1}return t.isFolder()?(i=t.displayPath(),i&&"/"!==i&&A.foldersUI(e.id)):A.filesUI(e.id)},P=function(e,t){var n;return(null!=e?e.config.isPublicFolderEnabled:void 0)?(n=t.displayPath(),r.normalize(n).toLowerCase().match(/^\/public($|\/)/)):!1},O=function(e,t){var n,i;return i=x(t),n=y.createFromParams(i),P(e,n)},D=function(e,t,n){var i,o,r,s;return(null!=n?n.config:void 0)?(t instanceof y?i=t:(r=x(t),i=y.createFromParams(r)),null!=n.config.publicAppToken&&i.nsPath()?o="/spa/"+n.config.publicAppToken+i.nsPath()+"/data":P(n,i)&&i.isFile()&&(o="/u/"+e.id+i.displayPath().substring("/public".length)),o&&(s=String(new m({scheme:"https",authority:h.PUBSERVER,path:o}))),s):null},M=function(e,t,n){return t.is_dir&&O(n,t)?!1:e&&!t.isDeleted},{fileIsInPublicFolder:O,getLegacyPublicFolderShareURI:D,getShareModalInfo:x,isShareButtonEnabled:M,isTiburonUIAllowed:F,showTiburonUIIfAllowed:B}})}.call(this),function(){define("modules/dirty/sharing/sf_access_type",["jquery","modules/core/controller_helpers","modules/core/i18n","modules/core/notify","modules/clean/analytics","modules/clean/components/bubble_picker","modules/clean/dbmodal","modules/clean/dbmodal_loading","modules/clean/groups/api","modules/clean/sharing/api","modules/clean/viewer"],function(e,t,n,i,o,r,s,a,l,u,c){var d,p,_,h,m,f;return f=n._,h=o.SharedFolderActivityLogger,d=s.DBModal,p=s.DBModalStack,m=u.SharingApi,_=function(){function e(e,n){this.$access_type_el=e,this.ajax_data=n,this.bubble_picker=t.get_controller(this.$access_type_el),this.$access_type_el.on(r.CHANGED,function(e){return function(t,n){var i,o,r,s,a,l;return r=n.old_val,o=n.clicked_val,Number(r)===Number(o)?!1:(e.ajax_data&&(l=c.get_viewer().get_user_by_id(e.ajax_data.user_id),s=e.ajax_data.params,i=e.ajax_data.access_types,a=e.$access_type_el.closest(".bs-row").find(".sf-display-name").text(),"owner"===i[o]?(e.show_make_owner_modal(l,s.member_uid,s.ns_id,a,o),e.bubble_picker.set_value(r)):e.update_access_type(l,s,a,o)),!1)}}(this))}return e.prototype.show_make_owner_modal=function(e,t,n,o,r){return require(["dropbox"],function(i){var s;return s=i.MakeOwnerModal,p.push(new s(e,{element_id:"make-owner-confirm-modal",member_uid:t,member_name:o,ns_id:n,access_type:r}))},function(){return i.error(i.DEFAULT_ERROR)})},e.prototype.update_access_type=function(e,t,n,o){var r,s,u;return r={ns_id:t.ns_id,access_type:o},u=function(o){return function(s){var l,u,c;if(c=JSON.parse(s.responseText),r.member_id=t.member_uid,"OK"===c.status){switch(r.succes=!0,c.access_type){case"viewer":u=f("%(name)s can only view now.").format({name:n});break;case"editor":u=f("%(name)s can edit now.").format({name:n});break;case"owner":u=f("%(name)s is the owner now.").format({name:n})}u&&i.success(u)}else"ERROR"===c.status&&(r.succes=!1,c.msg&&(r.message=c.msg,i.error(c.msg)),c.reload&&(l=d.get_containing_modal(o.$access_type_el),l&&l instanceof a&&l.fetch()));return h.log("web","invite_modal_change_callback",e,r)}}(this),s=new m(e),t.member_uid?(s.update_member_access_type(t.ns_id,t.member_uid,o,u),r.member_uid=t.member_uid,h.log("web","invite_modal_change_collaborator",e,r)):t.invite_id?(s.update_invite_access_type(t.invite_id,o,u),r.invite_id=t.invite_id,h.log("web","invite_modal_change_invite",e,r)):t?(l.change_group_access_type({ns_id:t.ns_id,group_id:t.group_gid,access_type:o},u),r.group_id=t.group_gid,h.log("web","invite_modal_change_group",e,r)):void 0},e}()})}.call(this),function(){define("modules/dirty/sharing/share_modal",["external/react","external/underscore","modules/clean/flux/dispatcher","modules/clean/react/browse/constants","modules/clean/react/modal","modules/clean/sharing/content_info","modules/clean/sharing/share_modal","modules/clean/user"],function(e,t,n,i,o,r,s,a){var l,u,c,d,p,_,h;return p=i.SharedWithActionTypes,u=o.Modal,l=r.ContentInfo,c=s.ShareModal,h=s.show,_=e.createElement,d=e.createClass({displayName:"ShareModalLegacyShim",propTypes:{user:e.PropTypes.instanceOf(a).isRequired},render:function(){var e;return e={onLinkSettingsClick:this._handleLinkSettingsClick,showLegacyShareModal:this._showLegacyShareModal},t.extend(e,t.omit(this.props,t.keys(e))),_(c,e)},_handleLinkSettingsClick:function(e,t){return require(["dropbox"],function(n){return function(i){var o;return o=i.SharedLinkSettingsModal,new o(n.props.user.id,null,t,e.url,!0).show(),u.close()}}(this))},_showLegacyShareModal:function(e,t){return require(["dropbox"],function(n){var i;return i=n.SharingModals,t.isFileFolder()?i.show_share_existing_modal(t.displayPath(),e):i.show_shared_folder_options_modal(t.displayPath(),e),u.close()})}}),{ShareModalLegacyShim:d}})}.call(this),function(){define("modules/dirty/sharing/sharing_growth_email_experiments",["dropbox","modules/clean/analytics"],function(e,t){var n,i,o;return o=e.Upload,n=t.SharedFolderActivityLogger,i=function(){function e(){}return e.listen_for_first_upload=function(e,t){var i;return i=function(r){return function(r){return n.log("web","file_upload",e,t),document.stopObserving(o.QUEUE_EVT,i),document.stopObserving(o.CHOOSE_FILE_BASIC,i)}}(this),document.observe(o.QUEUE_EVT,i),document.observe(o.CHOOSE_FILE_BASIC,i)},e}()})}.call(this),function(){define("modules/dirty/sharing/wizard_modals",["require","external/react","external/underscore","modules/core/notify","modules/clean/components/ajax_form","modules/clean/react/modal","modules/clean/sharing/api","modules/clean/sharing/constants","modules/clean/sharing/wizard/share_new_folder_wizard_modal","modules/clean/sharing/wizard/share_existing_folder_wizard_modal","modules/dirty/sharing/browse_ui_util"],function(e,t,n,i,o,r,s,a,l,u,c){var d,p,_,h,m,f,v,g;return d=r.Modal,h=s.SharingApi,_=l.ShareNewFolderWizardModal,p=u.ShareExistingFolderWizardModal,g=c.showTiburonUIIfAllowed,m=t.createElement,v=function(e,n){return a.TIBURON.WIZARD_UI[e]?(d.showInstance(t.createElement(_,{user:e,onBack:function(){return n.show()},onSubmit:function(t,n){var r,s,a;return a=function(){if(!g(e,{fqPath:"/"+t,isFolder:!0,exists:!1,origin:"WIZARD"}))throw new Error("Tiburon UI must be allowed")},r=function(e){var t;return t=o.extract_errors(e.responseText),t!==!1?"string"==typeof t?i.error(t):"function"==typeof n?n(t):void 0:void 0},s=new h(e),s.validate_new_sf_path(t,a,r)}})),!0):!1},f=function(e,n){return a.TIBURON.WIZARD_UI[e]?(d.showInstance(t.createElement(p,{user:e,onBack:function(){return n.show()},onSubmit:function(t){var n,r,s;return s=function(){if(!g(e,{fqPath:t,isFolder:!0,exists:!0,origin:"WIZARD"}))throw new Error("Tiburon UI must be allowed")},n=function(e){var t;if(t=o.extract_errors(e.responseText),t===!1);else if("string"==typeof t)return i.error(t)},r=new h(e),r.validate_existing_sf_path(t,s,n)}})),!0):!1},{showShareNewFolderWizardModalIfAllowed:v,showShareExistingFolderWizardModalIfAllowed:f}})}.call(this);
//# sourceMappingURL=pkg-aa.min.js-vflQxNgc3.map